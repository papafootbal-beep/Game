<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Mystery Boxes Simulator</title>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #080b12;
  --bg2: #0d1120;
  --bg3: #111827;
  --border: #1e2d45;
  --gold: #f5c842;
  --gold2: #e8a800;
  --blue: #3b82f6;
  --purple: #8b5cf6;
  --epic: #c084fc;
  --legendary: #f5c842;
  --rare: #60a5fa;
  --common: #94a3b8;
  --green: #22c55e;
  --red: #ef4444;
  --text: #e2e8f0;
  --muted: #64748b;
  --radius: 12px;
}

* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Rajdhani', sans-serif;
  font-size: 16px;
  min-height: 100vh;
  overflow-x: hidden;
}

/* Ambient BG */
body::before {
  content: '';
  position: fixed; inset: 0;
  background:
    radial-gradient(ellipse 60% 40% at 20% 10%, rgba(59,130,246,.07) 0%, transparent 70%),
    radial-gradient(ellipse 50% 50% at 80% 80%, rgba(139,92,246,.06) 0%, transparent 70%);
  pointer-events: none; z-index: 0;
}

/* ===== HEADER ===== */
header {
  position: sticky; top: 0; z-index: 100;
  background: rgba(8,11,18,.95);
  backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--border);
  padding: 10px 16px;
  display: flex; align-items: center; justify-content: space-between;
}
.logo {
  font-family: 'Orbitron', sans-serif;
  font-size: 14px; font-weight: 900;
  color: var(--gold);
  letter-spacing: 2px;
  text-shadow: 0 0 20px rgba(245,200,66,.4);
}
.balance-display {
  display: flex; flex-direction: column; align-items: flex-end;
}
.balance-label { font-size: 10px; color: var(--muted); letter-spacing: 1px; text-transform: uppercase; }
.balance-amount {
  font-family: 'Orbitron', sans-serif;
  font-size: 18px; font-weight: 700;
  color: var(--gold);
  transition: transform .1s;
}
.balance-amount.pop { transform: scale(1.15); }
.passive-rate { font-size: 11px; color: var(--green); }

/* ===== NAV ===== */
nav {
  display: flex;
  background: var(--bg2);
  border-bottom: 1px solid var(--border);
  position: sticky; top: 57px; z-index: 99;
}
nav button {
  flex: 1; padding: 12px 6px;
  background: none; border: none; cursor: pointer;
  color: var(--muted); font-family: 'Rajdhani', sans-serif;
  font-size: 12px; font-weight: 600; letter-spacing: .5px;
  text-transform: uppercase; transition: all .2s;
  border-bottom: 2px solid transparent;
  display: flex; flex-direction: column; align-items: center; gap: 3px;
}
nav button .nav-icon { font-size: 18px; display:flex; align-items:center; justify-content:center; }
nav button.active { color: var(--gold); border-bottom-color: var(--gold); }

/* ===== SCREENS ===== */
.screen { display: none; padding: 16px; position: relative; z-index: 1; min-height: calc(100vh - 110px); }
.screen.active { display: block; }

/* ===== CLICKER SCREEN ===== */
.stats-row {
  display: grid; grid-template-columns: 1fr 1fr;
  gap: 10px; margin-bottom: 20px;
}
.stat-card {
  background: var(--bg3); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 12px;
}
.stat-card .s-label { font-size: 11px; color: var(--muted); text-transform: uppercase; letter-spacing: .5px; }
.stat-card .s-val { font-size: 20px; font-weight: 700; color: var(--text); margin-top: 2px; }
.stat-card .s-val span { font-size: 12px; color: var(--muted); }

/* Click button */
.click-area {
  display: flex; flex-direction: column; align-items: center;
  margin: 10px 0 24px;
}
.click-btn {
  width: 160px; height: 160px;
  border-radius: 50%;
  background: radial-gradient(circle at 35% 35%, #1e3a5f, #0a1628);
  border: 3px solid var(--gold);
  box-shadow: 0 0 30px rgba(245,200,66,.25), inset 0 0 40px rgba(0,0,0,.5);
  cursor: pointer; font-size: 56px;
  display: flex; align-items: center; justify-content: center;
  transition: transform .08s, box-shadow .08s;
  user-select: none; position: relative; overflow: hidden;
}
.click-btn:active {
  transform: scale(.93);
  box-shadow: 0 0 50px rgba(245,200,66,.5), inset 0 0 40px rgba(0,0,0,.5);
}
.click-btn::after {
  content: '';
  position: absolute; inset: 0; border-radius: 50%;
  background: radial-gradient(circle, rgba(245,200,66,.15) 0%, transparent 70%);
  opacity: 0; transition: opacity .15s;
}
.click-btn:active::after { opacity: 1; }

.click-hint { font-size: 12px; color: var(--muted); margin-top: 10px; letter-spacing: 1px; }
.per-click { font-size: 13px; color: var(--gold); margin-top: 4px; font-weight: 600; }

/* Float +‚Ç¨ animation */
.float-earn {
  position: fixed;
  font-family: 'Orbitron', sans-serif;
  font-size: 20px; font-weight: 700;
  color: var(--gold);
  pointer-events: none; z-index: 9999;
  text-shadow: 0 0 10px rgba(245,200,66,.8);
  animation: floatUp .9s ease-out forwards;
}
@keyframes floatUp {
  0% { opacity: 1; transform: translateY(0) scale(1); }
  100% { opacity: 0; transform: translateY(-80px) scale(.6); }
}

/* Upgrades */
.section-title {
  font-size: 13px; font-weight: 700; letter-spacing: 2px;
  text-transform: uppercase; color: var(--muted);
  margin-bottom: 12px; display: flex; align-items: center; gap: 8px;
}
.section-title::after { content:''; flex:1; height:1px; background: var(--border); }

.upgrade-list { display: flex; flex-direction: column; gap: 10px; }
.upgrade-item {
  background: var(--bg3); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 14px;
  display: flex; align-items: center; gap: 14px;
  transition: border-color .2s, opacity .2s;
}
.upgrade-item.owned { border-color: rgba(34,197,94,.3); background: rgba(34,197,94,.04); }
.upgrade-item.locked { opacity: .5; }
.upg-icon { font-size: 28px; flex-shrink: 0; }
.upg-info { flex: 1; }
.upg-name { font-size: 15px; font-weight: 700; }
.upg-desc { font-size: 12px; color: var(--muted); margin-top: 2px; }
.upg-btn {
  padding: 8px 16px;
  border-radius: 8px; border: none; cursor: pointer;
  font-family: 'Rajdhani', sans-serif; font-size: 13px; font-weight: 700;
  transition: all .2s; white-space: nowrap;
}
.upg-btn.buyable { background: var(--gold); color: #000; }
.upg-btn.buyable:active { transform: scale(.96); }
.upg-btn.cant { background: var(--bg); color: var(--muted); border: 1px solid var(--border); cursor: not-allowed; }
.upg-btn.done { background: rgba(34,197,94,.15); color: var(--green); border: 1px solid rgba(34,197,94,.3); cursor: default; }

/* ===== CASES SCREEN ===== */
.cases-grid {
  display: grid; gap: 14px;
}
.case-card {
  background: var(--bg3); border: 1px solid var(--border);
  border-radius: 16px; overflow: hidden;
  transition: border-color .2s, transform .15s;
}
.case-card:active { transform: scale(.98); }
.case-banner {
  padding: 18px 18px 12px;
  display: flex; align-items: center; gap: 14px;
}
.case-emoji { font-size: 42px; }
.case-meta { flex: 1; }
.case-name { font-size: 18px; font-weight: 700; }
.case-desc { font-size: 12px; color: var(--muted); margin-top: 2px; }
.case-price-tag {
  font-family: 'Orbitron', sans-serif;
  font-size: 16px; font-weight: 700; color: var(--gold);
}
.case-rarity-bar {
  margin: 0 18px 12px;
}
.case-rarity-bar-track {
  display: flex; height: 18px; border-radius: 4px; overflow: hidden; gap: 2px;
}
.rarity-seg {
  height: 100%; border-radius: 4px;
  display: flex; align-items: center; justify-content: center;
  transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  overflow: hidden; position: relative;
}
.rarity-seg-label {
  font-family: 'Rajdhani', sans-serif; font-size: 9px; font-weight: 700;
  color: rgba(255,255,255,0.95); white-space: nowrap; pointer-events: none;
  text-shadow: 0 1px 3px rgba(0,0,0,0.7); line-height: 1;
  position: absolute; left: 50%; transform: translateX(-50%);
}
.rarity-seg { position: relative; overflow: hidden; }
.rarity-seg-label .pity-plus { display: none; }
.open-case-btn {
  width: calc(100% - 36px); margin: 0 18px 16px;
  padding: 12px; border-radius: 10px; border: none;
  font-family: 'Rajdhani', sans-serif; font-size: 15px; font-weight: 700;
  letter-spacing: 1px; cursor: pointer; transition: all .2s;
}
.open-case-btn.can { background: var(--gold); color: #000; }
.open-case-btn.cannot {
  background: var(--bg); color: var(--muted);
  border: 1px solid var(--border); cursor: not-allowed;
}

/* Case opening modal */
.modal-overlay {
  position: fixed; inset: 0; z-index: 200;
  background: rgba(0,0,0,.88);
  display: flex; align-items: center; justify-content: center;
  padding: 20px;
  opacity: 0; pointer-events: none;
  transition: opacity .3s;
}
.modal-overlay.show { opacity: 1; pointer-events: all; }

.modal {
  background: var(--bg2); border: 1px solid var(--border);
  border-radius: 20px; width: 100%; max-width: 400px;
  overflow: hidden;
  transform: scale(.9) translateY(20px);
  transition: transform .3s;
}
.modal-overlay.show .modal { transform: scale(1) translateY(0); }

/* Spinning carousel */
.carousel-wrap {
  position: relative; overflow: hidden;
  height: 130px;
  background: linear-gradient(180deg, var(--bg) 0%, var(--bg3) 100%);
  border-bottom: 1px solid var(--border);
}
.carousel-track {
  display: flex; align-items: center;
  height: 100%;
  position: absolute; left: 0; top: 0;
  gap: 8px; padding: 0 4px;
  will-change: transform;
  transition: transform 3s cubic-bezier(0.12, 0.8, 0.3, 1);
}
.carousel-item {
  width: 100px; height: 100px; flex-shrink: 0;
  border-radius: 12px; border: 2px solid;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center; gap: 4px;
  font-size: 28px;
  background: var(--bg2);
}
.carousel-item .c-name { font-size: 10px; font-weight: 600; text-align: center; line-height: 1.2; padding: 0 4px; }
.carousel-item img { display:block; object-fit:contain; }
.item-emoji img { display:block; object-fit:contain; }
.shop-item-emoji img { display:block; object-fit:contain; }
.pi-emoji img { display:block; object-fit:contain; }
.carousel-item.common { border-color: var(--common); }
.carousel-item.rare { border-color: var(--rare); background: rgba(96,165,250,.08); }
.carousel-item.epic { border-color: var(--epic); background: rgba(192,132,252,.08); }
.carousel-item.legendary { border-color: var(--legendary); background: rgba(245,200,66,.1); box-shadow: 0 0 20px rgba(245,200,66,.3); }

/* pointer line */
.carousel-wrap::after {
  content: '';
  position: absolute; left: 50%; top: 0; bottom: 0;
  width: 2px; background: var(--gold);
  box-shadow: 0 0 8px rgba(245,200,66,.8);
  transform: translateX(-50%);
  z-index: 2;
}
.carousel-wrap::before {
  content: '‚ñº';
  position: absolute; left: 50%; top: 4px;
  transform: translateX(-50%);
  color: var(--gold); font-size: 12px; z-index: 3;
}

.modal-result { padding: 20px; text-align: center; }
.result-hidden { opacity: 0; transform: translateY(10px); transition: all .5s .2s; }
.result-hidden.show { opacity: 1; transform: translateY(0); }
.result-rarity {
  display: inline-block; padding: 4px 16px;
  border-radius: 20px; font-size: 12px; font-weight: 700;
  letter-spacing: 1px; text-transform: uppercase; margin-bottom: 8px;
}
.result-item-name { font-size: 22px; font-weight: 700; margin-bottom: 6px; }
.result-item-val { font-size: 14px; color: var(--muted); margin-bottom: 20px; }
.result-item-val span { color: var(--gold); font-weight: 700; }
.result-actions { display: flex; gap: 10px; }
.result-actions button {
  flex: 1; padding: 12px;
  border-radius: 10px; border: none; cursor: pointer;
  font-family: 'Rajdhani', sans-serif; font-size: 14px; font-weight: 700;
  transition: all .2s;
}
.btn-sell { background: var(--green); color: #000; }
.btn-keep { background: var(--bg3); color: var(--text); border: 1px solid var(--border)!important; }
.btn-sell:active, .btn-keep:active { transform: scale(.96); }
.spin-btn {
  width: 100%; padding: 16px;
  background: var(--gold); color: #000;
  border: none; cursor: pointer;
  font-family: 'Orbitron', sans-serif; font-size: 14px; font-weight: 700;
  letter-spacing: 2px; transition: all .2s;
}
.spin-btn:active { transform: scale(.98); }
.spin-btn:disabled { opacity: .5; cursor: not-allowed; }

/* confetti */
.confetti-piece {
  position: fixed; pointer-events: none; z-index: 9999;
  width: 8px; height: 8px; border-radius: 2px;
  animation: confettiFall 2s ease-out forwards;
}
@keyframes confettiFall {
  0% { opacity: 1; transform: translateY(-10px) rotate(0deg) scale(1); }
  100% { opacity: 0; transform: translateY(300px) rotate(720deg) scale(.3); }
}

/* ===== INVENTORY SCREEN ===== */
.inv-header {
  display: flex; justify-content: space-between; align-items: center;
  margin-bottom: 16px;
}
.inv-count { font-size: 13px; color: var(--muted); }
.inv-grid {
  display: grid; grid-template-columns: repeat(2, 1fr);
  gap: 10px;
}
.inv-item {
  background: var(--bg3); border-radius: var(--radius);
  border: 1px solid var(--border); padding: 12px;
  display: flex; flex-direction: column; gap: 6px;
  transition: border-color .2s;
}
.inv-item:hover { border-color: var(--gold); }
.inv-item .item-rarity-dot {
  width: 8px; height: 8px; border-radius: 50%;
  display: inline-block; margin-right: 6px;
}
.inv-item .item-emoji { font-size: 32px; }
.inv-item .item-name { font-size: 13px; font-weight: 700; line-height: 1.3; }
.inv-item .item-val { font-size: 12px; color: var(--muted); }
.inv-item .item-val span { color: var(--gold); }
.sell-instant-btn {
  padding: 7px; border-radius: 8px; border: none;
  background: rgba(34,197,94,.15); color: var(--green);
  font-family: 'Rajdhani', sans-serif; font-size: 12px; font-weight: 700;
  cursor: pointer; transition: all .2s;
}
.sell-instant-btn:active { transform: scale(.95); background: rgba(34,197,94,.3); }

.empty-state {
  text-align: center; padding: 60px 20px;
  color: var(--muted); font-size: 14px;
}
.empty-state .e-icon { font-size: 48px; margin-bottom: 12px; }

/* ===== TOAST ===== */
.toast {
  position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%) translateY(20px);
  background: var(--bg3); border: 1px solid var(--border);
  border-radius: 10px; padding: 10px 20px;
  font-size: 14px; font-weight: 600; z-index: 300;
  opacity: 0; transition: all .3s; white-space: nowrap;
  pointer-events: none;
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
.toast.success { border-color: var(--green); color: var(--green); }
.toast.gold { border-color: var(--gold); color: var(--gold); }

/* Rarity colors */
.r-common { color: var(--common); }
.r-rare { color: var(--rare); }
.r-epic { color: var(--epic); }
.r-legendary { color: var(--legendary); }
.bg-common { background: rgba(148,163,184,.15); color: var(--common); border: 1px solid rgba(148,163,184,.3); }
.bg-rare { background: rgba(96,165,250,.15); color: var(--rare); border: 1px solid rgba(96,165,250,.3); }
.bg-epic { background: rgba(192,132,252,.15); color: var(--epic); border: 1px solid rgba(192,132,252,.3); }
.bg-legendary { background: rgba(245,200,66,.15); color: var(--legendary); border: 1px solid rgba(245,200,66,.3); }


/* ===== SHOP SCREEN ===== */
.shop-item {
  background: var(--bg3); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 14px;
  display: flex; flex-direction: column; gap: 8px;
  transition: border-color .2s;
}
.shop-item.sold { opacity: .5; }
.shop-item-top { display: flex; align-items: center; gap: 10px; }
.shop-item-emoji { font-size: 30px; flex-shrink: 0; }
.shop-item-info { flex: 1; }
.shop-item-name { font-size: 14px; font-weight: 700; }
.shop-item-from { font-size: 11px; color: var(--muted); }
.price-input-wrap { display: flex; align-items: center; gap: 8px; }
.price-input {
  flex: 1; background: var(--bg); border: 1px solid var(--border);
  border-radius: 8px; padding: 8px 12px;
  color: var(--text); font-family: 'Rajdhani',sans-serif; font-size: 15px; font-weight: 700;
  outline: none; transition: border-color .2s;
}
.price-input:focus { border-color: var(--gold); }
.price-hint { font-size: 11px; color: var(--muted); }
.price-hint span { color: var(--gold); }
.list-btn {
  padding: 10px; border-radius: 8px; border: none; cursor: pointer;
  font-family: 'Rajdhani',sans-serif; font-size: 13px; font-weight: 700;
  background: var(--blue); color: #fff; transition: all .2s;
}
.list-btn:active { transform: scale(.96); }
.list-btn:disabled { opacity:.4; cursor:not-allowed; }
.timer-bar-wrap { height: 4px; background: var(--bg); border-radius: 2px; overflow:hidden; }
.timer-bar { height: 100%; background: var(--gold); border-radius: 2px; transition: width .5s linear; }
.timer-label { font-size: 11px; color: var(--muted); text-align: right; margin-top: 2px; }
.shop-sold-badge {
  display: inline-block; padding: 3px 10px; border-radius: 6px;
  background: rgba(34,197,94,.15); color: var(--green);
  font-size: 12px; font-weight: 700;
}

/* ===== STATS SCREEN ===== */
.stats-big-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
.stats-big-card {
  background: var(--bg3); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 16px; text-align: center;
}
.stats-big-card .sb-val { font-family:'Orbitron',sans-serif; font-size: 22px; font-weight: 700; color: var(--gold); }
.stats-big-card .sb-label { font-size: 11px; color: var(--muted); margin-top: 4px; text-transform: uppercase; letter-spacing:.5px; }
.best-drop-card {
  background: var(--bg3); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 16px;
  display: flex; align-items: center; gap: 14px;
}
.best-drop-emoji { font-size: 40px; }
.best-drop-info .bd-label { font-size: 11px; color: var(--muted); text-transform: uppercase; letter-spacing:.5px; }
.best-drop-info .bd-name { font-size: 18px; font-weight: 700; margin-top: 2px; }
.best-drop-info .bd-val { font-size: 14px; color: var(--gold); margin-top: 2px; }
.rarity-stats { display: flex; flex-direction: column; gap: 8px; margin-top: 16px; }
.rarity-stat-row { display: flex; align-items: center; gap: 10px; }
.rarity-stat-row .rs-label { min-width: 100px; font-size: 13px; }
.rarity-stat-row .rs-bar { flex:1; height: 8px; background: var(--bg); border-radius: 4px; overflow:hidden; }
.rarity-stat-row .rs-fill { height: 100%; border-radius: 4px; transition: width 1s; }
.rarity-stat-row .rs-count { min-width: 30px; text-align: right; font-size: 13px; font-weight:700; }

/* ===== ITEMS PREVIEW MODAL ===== */
.preview-modal {
  background: var(--bg2); border: 1px solid var(--border);
  border-radius: 20px; width: 100%; max-width: 400px;
  max-height: 85vh; overflow-y: auto;
  transform: scale(.9) translateY(20px);
  transition: transform .3s;
}
.modal-overlay.show .preview-modal { transform: scale(1) translateY(0); }
.preview-header {
  padding: 16px 20px; border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
  position: sticky; top: 0; background: var(--bg2); z-index: 1;
}
.preview-header h3 { font-size: 18px; font-weight: 700; }
.close-btn {
  width: 32px; height: 32px; border-radius: 50%; border: 1px solid var(--border);
  background: var(--bg3); color: var(--text); cursor: pointer; font-size: 16px;
  display: flex; align-items: center; justify-content: center;
}
.preview-list { padding: 12px; display: flex; flex-direction: column; gap: 8px; }
.preview-item {
  display: flex; align-items: center; gap: 12px;
  background: var(--bg3); border-radius: 10px; padding: 10px 14px;
  border-left: 3px solid;
}
.preview-item.common  { border-color: var(--common); }
.preview-item.rare    { border-color: var(--rare); }
.preview-item.epic    { border-color: var(--epic); }
.preview-item.legendary { border-color: var(--legendary); }
.preview-item .pi-emoji { font-size: 24px; flex-shrink:0; }
.preview-item .pi-name { flex:1; font-size: 14px; font-weight: 600; }
.preview-item .pi-chance { font-size: 11px; color: var(--muted); text-align:right; }
.preview-item .pi-val { font-size: 13px; font-weight: 700; text-align:right; }

/* ===== LOGO ===== */
.logo-wrap {
  display: flex; flex-direction: column; line-height: 1;
}
.logo-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 11px; font-weight: 900; letter-spacing: 3px;
  color: var(--gold);
  text-shadow: 0 0 14px rgba(245,200,66,.5);
  white-space: nowrap;
}
.logo-sub {
  font-size: 9px; color: var(--muted); letter-spacing: 2px;
  text-transform: uppercase; margin-top: 1px;
}

/* ===== STORAGE LIMIT BAR ===== */
.limit-bar-wrap {
  display: flex; align-items: center; gap: 8px;
  margin-bottom: 12px; font-size: 12px; color: var(--muted);
}
.limit-bar { flex:1; height: 6px; background: var(--bg); border-radius: 3px; overflow:hidden; }
.limit-fill { height:100%; border-radius:3px; transition: width .3s; background: var(--blue); }
.limit-fill.warn { background: #f59e0b; }
.limit-fill.full { background: var(--red); }

/* ===== SHOP LOCKED ===== */
.shop-locked {
  display: flex; flex-direction: column; align-items: center;
  justify-content: center; padding: 60px 20px; text-align: center; gap: 16px;
}
.shop-locked-icon { font-size: 56px; }
.shop-locked h3 { font-size: 20px; font-weight: 700; color: var(--text); }
.shop-locked p { font-size: 14px; color: var(--muted); }
.unlock-btn {
  padding: 14px 32px; border-radius: 12px; border: none; cursor: pointer;
  font-family: 'Orbitron', sans-serif; font-size: 14px; font-weight: 700;
  background: var(--gold); color: #000; transition: all .2s;
  letter-spacing: 1px;
}
.unlock-btn:disabled { opacity:.4; cursor:not-allowed; }
.unlock-btn:not(:disabled):active { transform: scale(.97); }

/* ===== MAX PRICE BTN ===== */
.max-btn {
  padding: 8px 10px; border-radius: 8px; border: 1px solid var(--gold);
  background: rgba(245,200,66,.1); color: var(--gold);
  font-family: 'Rajdhani',sans-serif; font-size: 12px; font-weight: 700;
  cursor: pointer; white-space: nowrap; flex-shrink: 0; transition: all .2s;
}
.max-btn:active { background: rgba(245,200,66,.25); }

/* ===== RESET BTN ===== */
.reset-btn {
  width: 100%; margin-top: 24px; padding: 14px;
  border-radius: 12px; border: 1px solid rgba(239,68,68,.4);
  background: rgba(239,68,68,.08); color: var(--red);
  font-family: 'Rajdhani', sans-serif; font-size: 15px; font-weight: 700;
  cursor: pointer; letter-spacing: 1px; transition: all .2s;
}
.reset-btn:active { background: rgba(239,68,68,.2); }

/* ===== CONFIRM MODAL ===== */
.confirm-modal {
  background: var(--bg2); border: 1px solid rgba(239,68,68,.4);
  border-radius: 20px; width: 100%; max-width: 340px;
  padding: 28px 24px; text-align: center;
  transform: scale(.9); transition: transform .3s;
}
.modal-overlay.show .confirm-modal { transform: scale(1); }
.confirm-modal h3 { font-size: 20px; font-weight: 700; color: var(--red); margin-bottom: 8px; }
.confirm-modal p  { font-size: 14px; color: var(--muted); margin-bottom: 24px; }
.confirm-actions  { display: flex; gap: 10px; }
.confirm-yes { flex:1; padding:12px; border-radius:10px; border:none; cursor:pointer; background:var(--red); color:#fff; font-family:'Rajdhani',sans-serif; font-size:15px; font-weight:700; }
.confirm-no  { flex:1; padding:12px; border-radius:10px; border:1px solid var(--border); background:var(--bg3); color:var(--text); font-family:'Rajdhani',sans-serif; font-size:15px; font-weight:700; cursor:pointer; }

/* ===== SHOP TABS ===== */
.shop-tabs {
  display: flex; gap: 0; margin-bottom: 16px;
  border-bottom: 2px solid var(--border);
}
.shop-tab {
  flex: 1; padding: 10px 8px; background: none; border: none;
  font-family: 'Rajdhani', sans-serif; font-size: 13px; font-weight: 700;
  color: var(--muted); cursor: pointer; letter-spacing: .5px;
  border-bottom: 2px solid transparent; margin-bottom: -2px;
  transition: all .2s; text-transform: uppercase;
}
.shop-tab.active { color: var(--gold); border-bottom-color: var(--gold); }

/* ===== MULT UPGRADE CARD ===== */
.mult-upgrade-card {
  background: var(--bg3); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 18px; margin-bottom: 14px;
}
.mult-upgrade-header {
  display: flex; align-items: center; gap: 12px; margin-bottom: 14px;
}
.mult-upgrade-icon { font-size: 32px; }
.mult-upgrade-title { font-size: 16px; font-weight: 700; }
.mult-upgrade-subtitle { font-size: 12px; color: var(--muted); margin-top: 2px; }
.mult-progress-track {
  height: 8px; background: var(--bg); border-radius: 4px;
  overflow: hidden; margin-bottom: 8px;
}
.mult-progress-fill {
  height: 100%; border-radius: 4px; background: linear-gradient(90deg, var(--blue), var(--gold));
  transition: width .5s;
}
.mult-steps {
  display: flex; justify-content: space-between;
  font-family: 'Rajdhani', sans-serif; font-size: 10px;
  color: var(--muted); margin-bottom: 16px;
}
.mult-steps span.done { color: var(--green); }
.mult-steps span.current { color: var(--gold); font-weight: 700; }
.mult-upgrade-btn {
  width: 100%; padding: 13px; border-radius: 10px; border: none;
  font-family: 'Rajdhani', sans-serif; font-size: 15px; font-weight: 700;
  cursor: pointer; letter-spacing: .5px; transition: all .2s;
  background: var(--blue); color: #fff;
}
.mult-upgrade-btn:disabled {
  opacity: .4; cursor: not-allowed; background: var(--bg3);
  color: var(--muted); border: 1px solid var(--border);
}
.mult-upgrade-btn.maxed {
  background: var(--gold); color: #000; cursor: default;
}
.mult-upgrade-btn:not(:disabled):not(.maxed):active { transform: scale(.97); }
.mult-current-badge {
  display: inline-flex; align-items: center; gap: 6px;
  background: rgba(245,200,66,.12); border: 1px solid rgba(245,200,66,.3);
  border-radius: 8px; padding: 6px 12px; margin-bottom: 14px;
  font-size: 13px; font-weight: 700; color: var(--gold);
}

/* ===== BULK MOVE BTN ===== */
.bulk-move-btn {
  width: 100%; padding: 12px; border-radius: 10px; border: none; cursor: pointer;
  font-family: 'Rajdhani', sans-serif; font-size: 14px; font-weight: 700;
  background: linear-gradient(135deg, #3b82f6, #6366f1);
  color: #fff; letter-spacing: .5px; transition: all .2s;
}
.bulk-move-btn:active { transform: scale(.97); opacity: .9; }

/* ===== LIST ALL MAX BTN ===== */
.list-all-max-btn {
  padding: 6px 12px; border-radius: 8px; border: 1px solid var(--gold);
  background: rgba(245,200,66,.15); color: var(--gold);
  font-family: 'Rajdhani', sans-serif; font-size: 12px; font-weight: 700;
  cursor: pointer; white-space: nowrap; flex-shrink: 0;
  transition: all .2s; letter-spacing: .5px;
}
.list-all-max-btn:active { background: rgba(245,200,66,.3); transform: scale(.97); }

/* ===== MYSTERY GRID ===== */
.mystery-grid {
  display: flex; flex-direction: column; gap: 14px; padding-bottom: 20px;
}
.mystery-card {
  background: var(--bg2); border-radius: var(--radius);
  border: 1px solid var(--border); overflow: hidden;
  position: relative;
}
.mystery-card::before {
  content: ''; position: absolute; inset: 0;
  background: linear-gradient(135deg, var(--mbox-color, #6366f1) 0%, transparent 60%);
  opacity: 0.08; pointer-events: none;
}
.mystery-banner {
  display: flex; align-items: center; gap: 14px;
  padding: 16px 18px 12px; border-bottom: 1px solid var(--border);
}
.mystery-icon { font-size: 42px; flex-shrink: 0; }
.mystery-meta { flex: 1; }
.mystery-name {
  font-family: 'Orbitron', sans-serif; font-size: 13px;
  font-weight: 700; color: var(--text); letter-spacing: .5px;
}
.mystery-desc { font-size: 12px; color: var(--muted); margin-top: 3px; }
.mystery-price {
  font-family: 'Orbitron', sans-serif; font-size: 15px;
  font-weight: 700; color: var(--gold); text-align: right;
}
.mystery-price-sub { font-size: 10px; color: var(--muted); text-align: right; }
.mystery-prizes-preview {
  padding: 10px 18px; display: flex; gap: 6px; flex-wrap: wrap;
}
.mystery-prize-pill {
  font-size: 10px; font-weight: 600; padding: 3px 8px;
  border-radius: 20px; display: flex; align-items: center; gap: 4px;
}
.mystery-prize-pill.legendary { background: rgba(245,200,66,.15); color: var(--legendary); border: 1px solid rgba(245,200,66,.2); }
.mystery-prize-pill.epic      { background: rgba(192,132,252,.12); color: var(--epic);      border: 1px solid rgba(192,132,252,.2); }
.mystery-prize-pill.rare      { background: rgba(96,165,250,.1);  color: var(--rare);      border: 1px solid rgba(96,165,250,.2); }
.mystery-prize-pill.common    { background: rgba(148,163,184,.1); color: var(--common);    border: 1px solid rgba(148,163,184,.2); }
.mystery-open-btn {
  width: calc(100% - 36px); margin: 0 18px 16px;
  padding: 13px; border-radius: 10px; border: none; cursor: pointer;
  font-family: 'Rajdhani', sans-serif; font-size: 15px; font-weight: 700;
  letter-spacing: 1px; transition: all .2s; color: #000;
  background: linear-gradient(135deg, var(--mbox-color, #f5c842), #f97316);
}
.mystery-open-btn.cannot {
  background: var(--bg3); color: var(--muted);
  border: 1px solid var(--border); cursor: not-allowed;
}
.mystery-open-btn:not(.cannot):active { transform: scale(.97); }

/* ===== PRIZE WON CARD ===== */
.prize-won-card {
  display: flex; align-items: center; gap: 12px;
  padding: 12px 14px; border-radius: 12px; border: 1px solid;
  animation: prizeSlideIn 0.5s cubic-bezier(0.34,1.56,0.64,1);
}
.prize-won-card.legendary { border-color: var(--legendary); background: rgba(245,200,66,.08); }
.prize-won-card.epic      { border-color: var(--epic);      background: rgba(192,132,252,.08); }
.prize-won-card.rare      { border-color: var(--rare);      background: rgba(96,165,250,.08); }
.prize-won-card.common    { border-color: var(--border);    background: var(--bg2); }
@keyframes prizeSlideIn {
  from { opacity:0; transform: translateY(-20px) scale(0.85); }
  to   { opacity:1; transform: translateY(0) scale(1); }
}
.prize-won-num {
  width: 24px; height: 24px; border-radius: 50%; background: var(--bg);
  display: flex; align-items: center; justify-content: center;
  font-size: 11px; font-weight: 700; color: var(--gold); flex-shrink: 0;
}
.prize-won-name { font-size: 13px; font-weight: 700; flex: 1; }
.prize-won-val  { font-size: 12px; color: var(--gold); font-weight: 700; }

/* ===== LIFESHOP ===== */
.lifeshop-pane { display: flex; flex-direction: column; gap: 10px; padding-bottom: 20px; }
.ls-item-card {
  background: var(--bg2); border-radius: 12px; border: 1px solid var(--border);
  padding: 14px 16px; display: flex; align-items: center; gap: 14px;
  position: relative; overflow: hidden; transition: border-color .2s;
}
.ls-item-card.owned-card { border-color: rgba(245,200,66,.35); background: rgba(245,200,66,.04); }
.ls-item-card.cant-afford { opacity: .55; }
.ls-item-emoji { font-size: 32px; flex-shrink: 0; width: 44px; text-align: center; }
.ls-item-info  { flex: 1; min-width: 0; }
.ls-item-name  { font-size: 13px; font-weight: 700; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.ls-item-price { font-size: 12px; color: var(--gold); font-weight: 600; margin-top: 2px; }
.ls-item-count { font-size: 10px; color: var(--muted); margin-top: 2px; }
.ls-buy-btn {
  padding: 8px 14px; border-radius: 9px; border: none; cursor: pointer;
  font-family: 'Rajdhani', sans-serif; font-size: 12px; font-weight: 700;
  background: linear-gradient(135deg, var(--gold), #f97316); color: #000;
  flex-shrink: 0; white-space: nowrap; transition: all .18s; letter-spacing: .4px;
}
.ls-buy-btn:active { transform: scale(.95); }
.ls-buy-btn.ls-cant { background: var(--bg3); color: var(--muted); cursor: not-allowed; }
.ls-sell-btn {
  padding: 8px 12px; border-radius: 9px; border: 1px solid rgba(239,68,68,.3);
  background: rgba(239,68,68,.1); color: #ef4444; cursor: pointer;
  font-family: 'Rajdhani', sans-serif; font-size: 11px; font-weight: 700;
  flex-shrink: 0; white-space: nowrap; transition: all .18s;
}
.ls-sell-btn:active { transform: scale(.95); }
.ls-owned-badge {
  font-size: 9px; background: rgba(245,200,66,.2); color: var(--gold);
  border: 1px solid rgba(245,200,66,.3); border-radius: 10px;
  padding: 2px 7px; font-weight: 700; letter-spacing: .5px;
}
/* Forbes table */
.forbes-table { display: flex; flex-direction: column; gap: 6px; }
.forbes-row {
  display: flex; align-items: center; gap: 10px; padding: 10px 14px;
  background: var(--bg2); border-radius: 10px; border: 1px solid var(--border);
}
.forbes-row.player-row { border-color: rgba(245,200,66,.4); background: rgba(245,200,66,.06); }
.forbes-rank { font-family:'Orbitron',sans-serif; font-size: 12px; font-weight: 700; width: 28px; color: var(--muted); flex-shrink:0; }
.forbes-row.player-row .forbes-rank { color: var(--gold); }
.forbes-emoji { font-size: 20px; flex-shrink:0; }
.forbes-name  { flex: 1; font-size: 13px; font-weight: 600; color: var(--text); }
.forbes-net   { font-size: 12px; color: var(--muted); text-align:right; }
.forbes-row.player-row .forbes-name,
.forbes-row.player-row .forbes-net { color: var(--gold); }
/* Capital milestones */
.milestone-card {
  background: var(--bg2); border-radius: 12px; border: 1px solid var(--border);
  padding: 14px 16px; margin-bottom: 10px;
}
.milestone-card.unlocked { border-color: rgba(245,200,66,.4); }
.milestone-progress {
  height: 6px; background: var(--bg3); border-radius: 3px; margin-top: 8px; overflow: hidden;
}
.milestone-fill { height: 100%; border-radius: 3px; transition: width .5s; }

/* ===== ACHIEVEMENT POPUP ===== */
#achPopup {
  position: fixed;
  top: 72px;
  left: 50%;
  transform: translateX(-50%) translateY(-20px);
  z-index: 9999;
  background: linear-gradient(135deg, #1c1408, #2e1f06);
  border: 1px solid rgba(245,200,66,.5);
  border-radius: 14px;
  padding: 14px 20px;
  min-width: 260px;
  max-width: 340px;
  box-shadow: 0 8px 32px rgba(0,0,0,.7), 0 0 0 1px rgba(245,200,66,.15), inset 0 1px 0 rgba(245,200,66,.1);
  opacity: 0;
  transition: opacity .35s ease, transform .35s cubic-bezier(.34,1.56,.64,1);
  pointer-events: none;
}

/* ===== ACHIEVEMENT CARDS ===== */
.ach-card {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 14px;
  border-radius: 12px;
  background: var(--bg2);
  border: 1px solid var(--border);
  margin-bottom: 8px;
  transition: border-color .2s;
}
.ach-card.ach-done {
  border-color: rgba(245,200,66,.35);
  background: rgba(245,200,66,.04);
}
.ach-icon {
  font-size: 26px;
  width: 38px;
  text-align: center;
  flex-shrink: 0;
  filter: grayscale(80%) opacity(.45);
}
.ach-icon-done {
  filter: none;
}
.ach-body {
  flex: 1;
  min-width: 0;
}
.ach-title {
  font-size: 13px;
  font-weight: 700;
  color: var(--muted);
}
.ach-card.ach-done .ach-title {
  color: var(--text);
}
.ach-desc {
  font-size: 11px;
  color: var(--muted);
  opacity: .7;
  margin-top: 2px;
}
.ach-progress-wrap {
  margin-top: 6px;
}
.ach-progress-bar {
  height: 4px;
  background: var(--bg3);
  border-radius: 2px;
  overflow: hidden;
}
.ach-progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--gold), #f97316);
  border-radius: 2px;
  transition: width .5s ease;
}
.ach-pct {
  font-size: 10px;
  color: var(--muted);
  margin-top: 3px;
}
.ach-badge {
  font-size: 10px;
  font-weight: 700;
  padding: 4px 9px;
  border-radius: 20px;
  flex-shrink: 0;
  letter-spacing: .3px;
  white-space: nowrap;
}
.ach-badge-done {
  background: rgba(245,200,66,.15);
  color: var(--gold);
  border: 1px solid rgba(245,200,66,.3);
}
.ach-badge-locked {
  background: var(--bg3);
  color: var(--muted);
  border: 1px solid var(--border);
}

/* ===== COLLECTIONS ===== */
.coll-case-card {
  background: var(--bg2); border-radius: 14px; border: 1px solid var(--border);
  padding: 14px 16px; cursor: pointer; transition: border-color .2s, transform .15s;
  user-select: none;
}
.coll-case-card:active { transform: scale(.98); }
.coll-case-card.mastered { border-color: rgba(245,200,66,.5); background: rgba(245,200,66,.04); }
.coll-case-header { display: flex; align-items: center; gap: 12px; }
.coll-case-icon { font-size: 28px; flex-shrink:0; }
.coll-case-meta { flex: 1; }
.coll-case-name { font-size: 14px; font-weight: 700; color: var(--text); }
.coll-case-prog { font-size: 11px; color: var(--muted); margin-top: 2px; }
.coll-prog-bar { height: 6px; background: var(--bg3); border-radius: 3px; margin-top: 8px; overflow: hidden; }
.coll-prog-fill { height: 100%; border-radius: 3px; background: linear-gradient(90deg, var(--blue), var(--legendary)); transition: width .5s; }
.coll-case-card.mastered .coll-prog-fill { background: linear-gradient(90deg, var(--gold), #f97316); }
.coll-bonuses { display: flex; gap: 6px; margin-top: 8px; flex-wrap: wrap; }
.coll-bonus-badge {
  font-size: 10px; font-weight: 700; letter-spacing: .4px;
  padding: 3px 9px; border-radius: 8px;
  background: rgba(245,200,66,.15); color: var(--gold);
  border: 1px solid rgba(245,200,66,.3);
}
.coll-bonus-badge.inactive { background: var(--bg3); color: var(--muted); border-color: var(--border); }
/* Collection detail modal */
#collectionModal { display:none; }
#collectionModal.show { display:flex; }
.coll-slots-grid {
  display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 12px;
}
.coll-slot {
  background: var(--bg3); border-radius: 10px; border: 1px solid var(--border);
  padding: 10px 8px; text-align: center; position: relative; transition: all .2s;
}
.coll-slot.filled { background: var(--bg2); border-color: var(--border); }
.coll-slot.filled.legendary { border-color: rgba(245,200,66,.5); background: rgba(245,200,66,.04); }
.coll-slot.filled.epic      { border-color: rgba(139,92,246,.4); background: rgba(139,92,246,.04); }
.coll-slot.filled.rare      { border-color: rgba(59,130,246,.35); background: rgba(59,130,246,.03); }
.coll-slot.filled.common    { border-color: rgba(156,163,175,.3); }
.coll-slot.empty .coll-slot-emoji { filter: grayscale(1); opacity: .22; }
.coll-slot-emoji { font-size: 26px; display: block; margin-bottom: 4px; }
.coll-slot-name { font-size: 10px; color: var(--muted); line-height: 1.2; }
.coll-slot.filled .coll-slot-name { color: var(--text); }
.coll-slot-check { position:absolute;top:4px;right:5px;font-size:11px; }
/* Certificate animation */
@keyframes certPop {
  0%   { transform: scale(0.3) rotate(-20deg); opacity: 0; }
  60%  { transform: scale(1.1) rotate(3deg); opacity: 1; }
  100% { transform: scale(1) rotate(0); opacity: 1; }
}
.cert-popup {
  position: fixed; inset: 0; z-index: 9999; display: flex; align-items: center;
  justify-content: center; background: rgba(0,0,0,.7); backdrop-filter: blur(4px);
}
.cert-card {
  background: linear-gradient(135deg, #1a1209, #2d1f0e);
  border: 2px solid var(--gold); border-radius: 20px;
  padding: 32px 28px; text-align: center; max-width: 300px;
  animation: certPop .6s cubic-bezier(.34,1.56,.64,1) forwards;
}
.cert-title   { font-family:'Orbitron',sans-serif; font-size: 13px; color: var(--gold); letter-spacing: 2px; margin-bottom: 8px; }
.cert-case    { font-size: 40px; margin: 12px 0; display:flex; justify-content:center; align-items:center; }
.cert-bonuses { font-size: 12px; color: var(--text); margin-top: 14px; line-height: 1.8; }

@keyframes fadeFlash {
  0%   { opacity:1; }
  100% { opacity:0; }
}
@keyframes popIn {
  0%   { transform: scale(0.5); opacity:0; }
  100% { transform: scale(1);   opacity:1; }
}

@keyframes fadeIn {
  from { opacity:0; transform:translateX(-50%) translateY(10px); }
  to   { opacity:1; transform:translateX(-50%) translateY(0); }
}

/* ‚îÄ‚îÄ Forbes enhanced rows ‚îÄ‚îÄ */
.forbes-badge {
  display: inline-block; font-size: 9px; font-weight: 700;
  padding: 2px 7px; border-radius: 6px; letter-spacing: .3px;
}
.forbes-badge.sleep  { background: rgba(107,114,128,.12); color:#6b7280; }
.forbes-badge.crisis { background: rgba(239,68,68,.15);   color:#ef4444; border:1px solid rgba(239,68,68,.25); }
.forbes-badge.grow   { background: rgba(34,197,94,.12);   color:#22c55e; }

.forbes-row.crisis-row {
  border-color: rgba(239,68,68,.5) !important;
  background: rgba(239,68,68,.06) !important;
  animation: crisisPulse 1.2s ease-out;
}
@keyframes crisisPulse {
  0%   { background: rgba(239,68,68,.25); }
  100% { background: rgba(239,68,68,.06); }
}
.forbes-crisis-detail {
  font-size: 11px; color: var(--muted); line-height: 1.4;
  padding: 6px 12px 8px 42px;
  background: rgba(239,68,68,.04);
  border: 1px solid rgba(239,68,68,.15);
  border-top: none;
  border-radius: 0 0 8px 8px;
  margin-top: -4px;
  animation: slideDown .3s ease;
}
@keyframes slideDown {
  from { opacity:0; transform: translateY(-6px); }
  to   { opacity:1; transform: translateY(0); }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CONTAINERS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.containers-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 16px;
  padding: 12px 0 80px;
}
.cnt-card {
  border-radius: 16px;
  overflow: hidden;
  border: 1px solid rgba(255,255,255,.1);
  background: var(--bg2);
  cursor: pointer;
  transition: transform .15s, box-shadow .15s;
}
.cnt-card:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(0,0,0,.4); }
.cnt-header {
  padding: 0;
  position: relative;
  height: 160px;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}
.cnt-body { padding: 12px 14px 14px; }
.cnt-title { font-size: 17px; font-weight: 800; margin-bottom: 2px; }
.cnt-subtitle { font-size: 11px; color: var(--muted); margin-bottom: 8px; }
.cnt-price-row { display:flex; align-items:center; justify-content:space-between; }
.cnt-open-btn {
  padding: 8px 20px;
  border: none; border-radius: 10px;
  font-family: Rajdhani,sans-serif;
  font-size: 13px; font-weight: 800;
  cursor: pointer; color: #000;
  background: linear-gradient(135deg, var(--gold), #f97316);
}
.cnt-open-btn:disabled { opacity:.4; cursor:not-allowed; background:#555; color:#aaa; }
.cnt-rarity-bar { margin-top: 8px; }

/* ‚îÄ‚îÄ Container SVG 3D visual ‚îÄ‚îÄ */
.cnt-svg-wrap { width:100%; height:100%; position:relative; }

/* ‚ïê‚ïê CONTAINER OPEN MODAL ‚ïê‚ïê */
#containerModal {
  position: fixed; inset: 0; z-index: 3000;
  background: rgba(0,0,0,.96);
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  overflow: hidden;
}
.cont-modal-inner {
  width: 100%; max-width: 420px;
  display: flex; flex-direction: column;
  align-items: center;
  padding: 0 20px 40px;
}

/* ‚îÄ‚îÄ Container door animation ‚îÄ‚îÄ */
.cont-scene {
  width: 300px; height: 200px;
  position: relative;
  perspective: 600px;
  margin: 10px 0 20px;
}
.cont-body {
  position: absolute; inset: 0;
  border-radius: 8px;
  display: flex; overflow: hidden;
}
.cont-door-left, .cont-door-right {
  position: absolute; top: 0; bottom: 0; width: 50%;
  transform-origin: left center;
  backface-visibility: hidden;
  transition: transform 1.2s cubic-bezier(.4,0,.2,1);
  display: flex; flex-direction: column;
  justify-content: center; align-items: center;
  gap: 12px;
}
.cont-door-left  { left: 0; transform-origin: left center; }
.cont-door-right { right: 0; transform-origin: right center; }
.cont-door-left.open  { transform: perspective(600px) rotateY(-110deg); }
.cont-door-right.open { transform: perspective(600px) rotateY(110deg); }
.cont-door-hinge {
  width: 8px; border-radius: 4px;
  height: 80%; position: absolute;
  background: rgba(0,0,0,.3);
}
.cont-door-left  .cont-door-hinge { right: 0; }
.cont-door-right .cont-door-hinge { left: 0; }
.cont-door-stripe {
  width: 100%; height: 14px;
  opacity: .7;
}
.cont-door-lock {
  width: 28px; height: 28px;
  border-radius: 50%;
  border: 3px solid rgba(255,255,255,.4);
  background: rgba(0,0,0,.3);
  display: flex; align-items: center; justify-content: center;
  font-size: 13px;
}

/* ‚îÄ‚îÄ Prize revealed inside container ‚îÄ‚îÄ */
.cont-prize-area {
  position: absolute; inset: 0;
  display: flex; align-items: center; justify-content: center;
  opacity: 0; transition: opacity .5s ease .8s;
}
.cont-prize-area.show { opacity: 1; }

/* ‚îÄ‚îÄ Vehicle 3D CSS models ‚îÄ‚îÄ */
.vehicle-3d-wrap {
  position: relative; display: flex;
  flex-direction: column; align-items: center;
}

/* ‚îÄ‚îÄ Result card ‚îÄ‚îÄ */
.cont-result-card {
  width: 100%; border-radius: 14px;
  padding: 16px; text-align: center;
  border: 1px solid rgba(255,255,255,.1);
  background: var(--bg2);
  opacity: 0; transform: translateY(20px);
  transition: opacity .5s ease 1.5s, transform .5s ease 1.5s;
}
.cont-result-card.show { opacity: 1; transform: translateY(0); }
.cont-result-name { font-size: 18px; font-weight: 800; margin: 8px 0 4px; }
.cont-result-rarity { font-size: 11px; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 4px; }
.cont-result-value { font-size: 22px; font-weight: 800; color: var(--gold); }

.cont-result-btns {
  display: flex; gap: 8px; margin-top: 12px;
  opacity: 0; transition: opacity .4s ease 2.2s;
}
.cont-result-btns.show { opacity: 1; }

</style>
</head>
<body>

<header>
  <div class="logo-wrap">
    <div class="logo-title">üì¶ Mystery Boxes</div>
    <div class="logo-sub">Simulator</div>
  </div>
  <div class="balance-display">
    <div class="balance-label">–ë–∞–ª–∞–Ω—Å</div>
    <div class="balance-amount" id="balanceDisplay">0‚Ç¨</div>
    <div class="passive-rate" id="passiveDisplay"></div>
  </div>
</header>

<nav>
  <button class="active" onclick="showScreen('clicker',this)">
    <span class="nav-icon"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0OCA0OCI+CiAgPGRlZnM+CiAgICA8cmFkaWFsR3JhZGllbnQgaWQ9ImNnMSIgY3g9IjUwJSIgY3k9IjQwJSIgcj0iNTUlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZiYmYyNCIvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNiNDUzMDkiLz4KICAgIDwvcmFkaWFsR3JhZGllbnQ+CiAgICA8ZmlsdGVyIGlkPSJjZ3MiPjxmZURyb3BTaGFkb3cgZHg9IjAiIGR5PSIxIiBzdGREZXZpYXRpb249IjEuNSIgZmxvb2QtY29sb3I9IiMwMDAiIGZsb29kLW9wYWNpdHk9IjAuNCIvPjwvZmlsdGVyPgogIDwvZGVmcz4KICA8IS0tIENvaW4gLS0+CiAgPGNpcmNsZSBjeD0iMzAiIGN5PSIxNCIgcj0iOSIgZmlsbD0idXJsKCNjZzEpIiBmaWx0ZXI9InVybCgjY2dzKSIvPgogIDxjaXJjbGUgY3g9IjMwIiBjeT0iMTQiIHI9IjciIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZkZTY4YSIgc3Ryb2tlLXdpZHRoPSIxLjIiIG9wYWNpdHk9IjAuNyIvPgogIDx0ZXh0IHg9IjMwIiB5PSIxOCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjgiIGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSIjNzgzNTBmIj7igqw8L3RleHQ+CiAgPCEtLSBTcGFya2xlcyAtLT4KICA8Y2lyY2xlIGN4PSIzOSIgY3k9IjgiIHI9IjEuNSIgZmlsbD0iI2ZiYmYyNCIgb3BhY2l0eT0iMC44Ii8+CiAgPGNpcmNsZSBjeD0iNDIiIGN5PSIxNCIgcj0iMSIgZmlsbD0iI2ZiYmYyNCIgb3BhY2l0eT0iMC42Ii8+CiAgPGNpcmNsZSBjeD0iMzgiIGN5PSIxOSIgcj0iMSIgZmlsbD0iI2ZiYmYyNCIgb3BhY2l0eT0iMC41Ii8+CiAgPCEtLSBIYW5kL2ZpbmdlciAtLT4KICA8cGF0aCBkPSJNOCAzOCBROCAyOCAxNCAyNiBMMTQgMTggUTE0IDE1IDE3IDE1IFEyMCAxNSAyMCAxOCBMMjAgMjYgUTIyIDI1IDI0IDI2IFEyNiAyNSAyNyAyNyBRMjkgMjYgMzAgMjggTDMwIDM2IFEzMCA0MiAyNCA0NCBMMTQgNDQgUTggNDQgOCAzOFoiIGZpbGw9IiNmY2Q1YTAiIGZpbHRlcj0idXJsKCNjZ3MpIi8+CiAgPHBhdGggZD0iTTIwIDI2IEwyMCAxOCIgc3Ryb2tlPSIjZTVhODZiIiBzdHJva2Utd2lkdGg9IjAuOCIgZmlsbD0ibm9uZSIvPgogIDwhLS0gRmluZ2VyIHRpcCBoaWdobGlnaHQgLS0+CiAgPGVsbGlwc2UgY3g9IjE3IiBjeT0iMTUuNSIgcng9IjIiIHJ5PSIxIiBmaWxsPSIjZmZmIiBvcGFjaXR5PSIwLjMiLz4KPC9zdmc+" width="22" height="22" style="display:block"></span>–ö–ª—ñ–∫–µ—Ä
  </button>
  <button onclick="showScreen('cases',this)">
    <span class="nav-icon"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0OCA0OCI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImJveGciIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjNjM2NmYxIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iIzQzMzhjYSIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iYm94dGciIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjODE4Y2Y4Ii8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iIzYzNjZmMSIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDxmaWx0ZXIgaWQ9ImJ4cyI+PGZlRHJvcFNoYWRvdyBkeD0iMCIgZHk9IjIiIHN0ZERldmlhdGlvbj0iMiIgZmxvb2QtY29sb3I9IiM0MzM4Y2EiIGZsb29kLW9wYWNpdHk9IjAuNSIvPjwvZmlsdGVyPgogICAgPGZpbHRlciBpZD0iZ2x3Ij48ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIyIiByZXN1bHQ9ImIiLz48ZmVNZXJnZT48ZmVNZXJnZU5vZGUgaW49ImIiLz48ZmVNZXJnZU5vZGUgaW49IlNvdXJjZUdyYXBoaWMiLz48L2ZlTWVyZ2U+PC9maWx0ZXI+CiAgPC9kZWZzPgogIDwhLS0gR2xvdyAtLT4KICA8Y2lyY2xlIGN4PSIyNCIgY3k9IjI2IiByPSIxNiIgZmlsbD0iIzYzNjZmMSIgb3BhY2l0eT0iMC4xMiIvPgogIDwhLS0gQm94IGJvZHkgLS0+CiAgPHJlY3QgeD0iOCIgeT0iMjIiIHdpZHRoPSIzMiIgaGVpZ2h0PSIyMiIgcng9IjMiIGZpbGw9InVybCgjYm94ZykiIGZpbHRlcj0idXJsKCNieHMpIi8+CiAgPCEtLSBCb3ggbGlkIC0tPgogIDxyZWN0IHg9IjYiIHk9IjE2IiB3aWR0aD0iMzYiIGhlaWdodD0iOCIgcng9IjMiIGZpbGw9InVybCgjYm94dGcpIi8+CiAgPCEtLSBSaWJib24gdmVydGljYWwgLS0+CiAgPHJlY3QgeD0iMjEiIHk9IjE2IiB3aWR0aD0iNiIgaGVpZ2h0PSIyOCIgZmlsbD0iI2Y1Yzg0MiIgb3BhY2l0eT0iMC44NSIvPgogIDwhLS0gUmliYm9uIGhvcml6b250YWwgLS0+CiAgPHJlY3QgeD0iOCIgeT0iMjciIHdpZHRoPSIzMiIgaGVpZ2h0PSI1IiBmaWxsPSIjZjVjODQyIiBvcGFjaXR5PSIwLjg1Ii8+CiAgPCEtLSBCb3cgLS0+CiAgPGVsbGlwc2UgY3g9IjE3IiBjeT0iMTYiIHJ4PSI2IiByeT0iNCIgZmlsbD0iI2ZkZTY4YSIgdHJhbnNmb3JtPSJyb3RhdGUoLTIwLDE3LDE2KSIvPgogIDxlbGxpcHNlIGN4PSIzMSIgY3k9IjE2IiByeD0iNiIgcnk9IjQiIGZpbGw9IiNmZGU2OGEiIHRyYW5zZm9ybT0icm90YXRlKDIwLDMxLDE2KSIvPgogIDxjaXJjbGUgY3g9IjI0IiBjeT0iMTYiIHI9IjMuNSIgZmlsbD0iI2Y1Yzg0MiIvPgogIDwhLS0gU3RhcnMgLS0+CiAgPGNpcmNsZSBjeD0iMTMiIGN5PSIyOSIgcj0iMS4yIiBmaWxsPSIjZmZmIiBvcGFjaXR5PSIwLjQiLz4KICA8Y2lyY2xlIGN4PSIzNSIgY3k9IjMzIiByPSIxIiBmaWxsPSIjZmZmIiBvcGFjaXR5PSIwLjMiLz4KPC9zdmc+" width="22" height="22" style="display:block"></span>–ö–µ–π—Å–∏
  </button>
  <button onclick="showScreen('inventory',this)">
    <span class="nav-icon"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0OCA0OCI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImJwZyIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+CiAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiMxMGI5ODEiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjMDY1ZjQ2Ii8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPGZpbHRlciBpZD0iYnBzIj48ZmVEcm9wU2hhZG93IGR4PSIwIiBkeT0iMiIgc3RkRGV2aWF0aW9uPSIyIiBmbG9vZC1jb2xvcj0iIzAwMCIgZmxvb2Qtb3BhY2l0eT0iMC4zNSIvPjwvZmlsdGVyPgogIDwvZGVmcz4KICA8IS0tIFN0cmFwIC0tPgogIDxwYXRoIGQ9Ik0xNyAxMiBRMTcgNiAyNCA2IFEzMSA2IDMxIDEyIiBmaWxsPSJub25lIiBzdHJva2U9IiMzNGQzOTkiIHN0cm9rZS13aWR0aD0iMy41IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KICA8IS0tIEJvZHkgLS0+CiAgPHJlY3QgeD0iOSIgeT0iMTQiIHdpZHRoPSIzMCIgaGVpZ2h0PSIyOCIgcng9IjciIGZpbGw9InVybCgjYnBnKSIgZmlsdGVyPSJ1cmwoI2JwcykiLz4KICA8IS0tIEhpZ2hsaWdodCAtLT4KICA8cmVjdCB4PSIxMiIgeT0iMTciIHdpZHRoPSIyNCIgaGVpZ2h0PSI4IiByeD0iNCIgZmlsbD0id2hpdGUiIG9wYWNpdHk9IjAuMDgiLz4KICA8IS0tIEZyb250IHBvY2tldCAtLT4KICA8cmVjdCB4PSIxMyIgeT0iMjgiIHdpZHRoPSIyMiIgaGVpZ2h0PSIxMSIgcng9IjQiIGZpbGw9IiMwNjVmNDYiLz4KICA8IS0tIFBvY2tldCB6aXBwZXIgLS0+CiAgPGxpbmUgeDE9IjE2IiB5MT0iMzQiIHgyPSIzMiIgeTI9IjM0IiBzdHJva2U9IiMzNGQzOTkiIHN0cm9rZS13aWR0aD0iMS41IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KICA8Y2lyY2xlIGN4PSIzMiIgY3k9IjM0IiByPSIyIiBmaWxsPSIjNmVlN2I3Ii8+CiAgPCEtLSBUb3AgYnVja2xlIC0tPgogIDxyZWN0IHg9IjIwIiB5PSIxMyIgd2lkdGg9IjgiIGhlaWdodD0iNCIgcng9IjIiIGZpbGw9IiMzNGQzOTkiLz4KPC9zdmc+" width="22" height="22" style="display:block"></span>–°–∫–ª–∞–¥
    <span id="invBadge" style="display:none;font-size:9px;background:var(--gold);color:#000;border-radius:8px;padding:1px 5px;"></span>
  </button>
  <button onclick="showScreen('shop',this)">
    <span class="nav-icon"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0OCA0OCI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9InNoZyIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjM2I4MmY2Ii8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iIzFkNGVkOCIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDxmaWx0ZXIgaWQ9InNocyI+PGZlRHJvcFNoYWRvdyBkeD0iMCIgZHk9IjIiIHN0ZERldmlhdGlvbj0iMiIgZmxvb2QtY29sb3I9IiMwMDAiIGZsb29kLW9wYWNpdHk9IjAuMzUiLz48L2ZpbHRlcj4KICAgIDxmaWx0ZXIgaWQ9InNnIj48ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIxLjUiIHJlc3VsdD0iYiIvPjxmZU1lcmdlPjxmZU1lcmdlTm9kZSBpbj0iYiIvPjxmZU1lcmdlTm9kZSBpbj0iU291cmNlR3JhcGhpYyIvPjwvZmVNZXJnZT48L2ZpbHRlcj4KICA8L2RlZnM+CiAgPCEtLSBCdWlsZGluZyAtLT4KICA8cmVjdCB4PSI2IiB5PSIyMCIgd2lkdGg9IjM2IiBoZWlnaHQ9IjI0IiByeD0iMyIgZmlsbD0idXJsKCNzaGcpIiBmaWx0ZXI9InVybCgjc2hzKSIvPgogIDwhLS0gUm9vZi9hd25pbmcgLS0+CiAgPHBhdGggZD0iTTQgMjAgTDI0IDEwIEw0NCAyMCBaIiBmaWxsPSIjMjU2M2ViIi8+CiAgPHJlY3QgeD0iNCIgeT0iMjAiIHdpZHRoPSI0MCIgaGVpZ2h0PSI0IiByeD0iMiIgZmlsbD0iIzYwYTVmYSIvPgogIDwhLS0gU2lnbiAtLT4KICA8cmVjdCB4PSIxMCIgeT0iMTQiIHdpZHRoPSIyOCIgaGVpZ2h0PSI3IiByeD0iMiIgZmlsbD0iIzFlNDBhZiIvPgogIDx0ZXh0IHg9IjI0IiB5PSIyMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjYiIGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSIjZjVjODQyIj5TSE9QPC90ZXh0PgogIDwhLS0gRG9vciAtLT4KICA8cmVjdCB4PSIxOSIgeT0iMzAiIHdpZHRoPSIxMCIgaGVpZ2h0PSIxNCIgcng9IjIiIGZpbGw9IiMxZTNhOGEiLz4KICA8Y2lyY2xlIGN4PSIyNyIgY3k9IjM3IiByPSIxLjIiIGZpbGw9IiM2MGE1ZmEiLz4KICA8IS0tIFdpbmRvd3MgLS0+CiAgPHJlY3QgeD0iOCIgeT0iMjYiIHdpZHRoPSI4IiBoZWlnaHQ9IjciIHJ4PSIyIiBmaWxsPSIjOTNjNWZkIiBvcGFjaXR5PSIwLjciLz4KICA8cmVjdCB4PSIzMiIgeT0iMjYiIHdpZHRoPSI4IiBoZWlnaHQ9IjciIHJ4PSIyIiBmaWxsPSIjOTNjNWZkIiBvcGFjaXR5PSIwLjciLz4KICA8IS0tIFdpbmRvdyBjcm9zcyAtLT4KICA8bGluZSB4MT0iMTIiIHkxPSIyNiIgeDI9IjEyIiB5Mj0iMzMiIHN0cm9rZT0iI2JmZGJmZSIgc3Ryb2tlLXdpZHRoPSIwLjgiLz4KICA8bGluZSB4MT0iOCIgIHkxPSIyOS41IiB4Mj0iMTYiIHkyPSIyOS41IiBzdHJva2U9IiNiZmRiZmUiIHN0cm9rZS13aWR0aD0iMC44Ii8+CiAgPGxpbmUgeDE9IjM2IiB5MT0iMjYiIHgyPSIzNiIgeTI9IjMzIiBzdHJva2U9IiNiZmRiZmUiIHN0cm9rZS13aWR0aD0iMC44Ii8+CiAgPGxpbmUgeDE9IjMyIiB5MT0iMjkuNSIgeDI9IjQwIiB5Mj0iMjkuNSIgc3Ryb2tlPSIjYmZkYmZlIiBzdHJva2Utd2lkdGg9IjAuOCIvPgogIDwhLS0gU3RhcnMvc3BhcmtsZXMgb24gc2lnbiAtLT4KICA8Y2lyY2xlIGN4PSIxMCIgY3k9IjE3LjUiIHI9IjEiIGZpbGw9IiNmNWM4NDIiIGZpbHRlcj0idXJsKCNzZykiLz4KICA8Y2lyY2xlIGN4PSIzOCIgY3k9IjE3LjUiIHI9IjEiIGZpbGw9IiNmNWM4NDIiIGZpbHRlcj0idXJsKCNzZykiLz4KPC9zdmc+" width="22" height="22" style="display:block"></span>–ú–∞–≥–∞–∑–∏–Ω
  </button>
  <button onclick="showScreen('lifeshop',this)">
    <span class="nav-icon" style="font-size:20px;">üíé</span>LifeShop
  </button>
  <button onclick="showScreen('stats',this)">
    <span class="nav-icon"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0OCA0OCI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImIxZyIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjYTc4YmZhIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iIzdjM2FlZCIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iYjJnIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjAlIiB5Mj0iMTAwJSI+CiAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiNmNWM4NDIiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjZDk3NzA2Ii8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPGxpbmVhckdyYWRpZW50IGlkPSJiM2ciIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzM0ZDM5OSIvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiMwNTk2NjkiLz4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICA8ZmlsdGVyIGlkPSJzdHMiPjxmZURyb3BTaGFkb3cgZHg9IjAiIGR5PSIxIiBzdGREZXZpYXRpb249IjEuNSIgZmxvb2QtY29sb3I9IiMwMDAiIGZsb29kLW9wYWNpdHk9IjAuMyIvPjwvZmlsdGVyPgogIDwvZGVmcz4KICA8IS0tIEF4ZXMgLS0+CiAgPGxpbmUgeDE9IjgiIHkxPSI2IiB4Mj0iOCIgeTI9IjM4IiBzdHJva2U9IiM0YTU1NjgiIHN0cm9rZS13aWR0aD0iMS41IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KICA8bGluZSB4MT0iOCIgeTE9IjM4IiB4Mj0iNDIiIHkyPSIzOCIgc3Ryb2tlPSIjNGE1NTY4IiBzdHJva2Utd2lkdGg9IjEuNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPCEtLSBCYXJzIC0tPgogIDxyZWN0IHg9IjEyIiB5PSIyMiIgd2lkdGg9IjciIGhlaWdodD0iMTYiIHJ4PSIyIiBmaWxsPSJ1cmwoI2IxZykiIGZpbHRlcj0idXJsKCNzdHMpIi8+CiAgPHJlY3QgeD0iMjIiIHk9IjE0IiB3aWR0aD0iNyIgaGVpZ2h0PSIyNCIgcng9IjIiIGZpbGw9InVybCgjYjJnKSIgZmlsdGVyPSJ1cmwoI3N0cykiLz4KICA8cmVjdCB4PSIzMiIgeT0iMTAiIHdpZHRoPSI3IiBoZWlnaHQ9IjI4IiByeD0iMiIgZmlsbD0idXJsKCNiM2cpIiBmaWx0ZXI9InVybCgjc3RzKSIvPgogIDwhLS0gQmFyIHRvcHMgaGlnaGxpZ2h0IC0tPgogIDxyZWN0IHg9IjEyIiB5PSIyMiIgd2lkdGg9IjciIGhlaWdodD0iMyIgcng9IjIiIGZpbGw9IndoaXRlIiBvcGFjaXR5PSIwLjI1Ii8+CiAgPHJlY3QgeD0iMjIiIHk9IjE0IiB3aWR0aD0iNyIgaGVpZ2h0PSIzIiByeD0iMiIgZmlsbD0id2hpdGUiIG9wYWNpdHk9IjAuMjUiLz4KICA8cmVjdCB4PSIzMiIgeT0iMTAiIHdpZHRoPSI3IiBoZWlnaHQ9IjMiIHJ4PSIyIiBmaWxsPSJ3aGl0ZSIgb3BhY2l0eT0iMC4yNSIvPgogIDwhLS0gVHJlbmQgbGluZSAtLT4KICA8cG9seWxpbmUgcG9pbnRzPSIxNS41LDIyIDI1LjUsMTQgMzUuNSwxMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZjg3MTcxIiBzdHJva2Utd2lkdGg9IjEuNSIgc3Ryb2tlLWRhc2hhcnJheT0iMiwxLjUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgogIDxjaXJjbGUgY3g9IjE1LjUiIGN5PSIyMiIgcj0iMiIgZmlsbD0iI2Y4NzE3MSIvPgogIDxjaXJjbGUgY3g9IjI1LjUiIGN5PSIxNCIgcj0iMiIgZmlsbD0iI2Y4NzE3MSIvPgogIDxjaXJjbGUgY3g9IjM1LjUiIGN5PSIxMCIgcj0iMiIgZmlsbD0iI2Y4NzE3MSIvPgo8L3N2Zz4=" width="22" height="22" style="display:block"></span>–°—Ç–∞—Ç
  </button>
</nav>

<!-- ===== CLICKER SCREEN ===== -->
<div class="screen active" id="screen-clicker">
  <!-- –ü.11: Capital mini-banner -->
  <div style="background:linear-gradient(135deg,#1a1209,#2d1f0e);border:1px solid rgba(245,200,66,.25);border-radius:12px;padding:10px 14px;margin-bottom:8px;display:flex;align-items:center;justify-content:space-between;gap:6px;position:relative;overflow:hidden;">
    <div style="position:absolute;inset:0;background:radial-gradient(circle at 70% 50%,rgba(245,200,66,.05),transparent);pointer-events:none;"></div>
    <div>
      <div style="font-size:9px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;">–ö–∞–ø—ñ—Ç–∞–ª</div>
      <div style="font-size:17px;font-weight:800;color:var(--gold);font-family:'Orbitron',sans-serif;" id="clickerCapTotal">0‚Ç¨</div>
    </div>
    <div style="text-align:center;">
      <div style="font-size:9px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;">–ë–∞–ª–∞–Ω—Å</div>
      <div style="font-size:14px;font-weight:700;color:var(--green);" id="clickerBalance">0‚Ç¨</div>
    </div>
    <div style="text-align:right;">
      <div style="font-size:9px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;">Forbes</div>
      <div style="font-size:14px;font-weight:800;color:var(--gold);font-family:'Orbitron',sans-serif;" id="clickerForbes">#‚Äî</div>
    </div>
  </div>
  <!-- hidden spans for totalEarned and perClickDisplay used elsewhere -->
  <div style="display:none;"><span id="totalEarned">0‚Ç¨</span><span id="perClickDisplay">1</span></div>

  <div class="click-area">
    <button class="click-btn" id="clickBtn" onclick="handleClick(event)">üí∞</button>
    <div class="click-hint">–¢–ê–ü –î–õ–Ø –ó–ê–†–û–ë–Ü–¢–ö–£</div>
    <div class="per-click">+<span id="clickValHint">1</span>‚Ç¨ –∑–∞ –∫–ª—ñ–∫</div>
  </div>

  <div class="section-title">–ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è</div>
  <div class="upgrade-list" id="upgradeList"></div>
</div>

<!-- ===== CASES SCREEN ===== -->
<div class="screen" id="screen-cases">
  <div class="shop-tabs" id="casesTabs">
    <button class="shop-tab active" id="casesTab-regular" onclick="switchCasesTab('regular')">üì¶ –ö–µ–π—Å–∏</button>
    <button class="shop-tab" id="casesTab-mystery" onclick="switchCasesTab('mystery')">üé∞ Mystery Box</button>
    <button class="shop-tab" id="casesTab-containers" onclick="switchCasesTab('containers')">üö¢ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏</button>
  </div>
  <div id="casesPane-regular">
    <div class="cases-grid" id="casesGrid"></div>
  </div>
  <div id="casesPane-mystery" style="display:none">
    <div class="mystery-grid" id="mysteryGrid"></div>
  </div>
  <div id="casesPane-containers" style="display:none">
    <div class="containers-grid" id="containersGrid"></div>
  </div>
</div>

<!-- ===== INVENTORY SCREEN ===== -->
<div class="screen" id="screen-inventory">
  <div style="display:none;"><span id="invCount"></span></div>
  <div class="shop-tabs" style="margin-top:6px;">
    <button class="shop-tab active" id="invTab-items" onclick="switchInvTab('items')">üì¶ –ü—Ä–µ–¥–º–µ—Ç–∏</button>
    <button class="shop-tab" id="invTab-upgrades" onclick="switchInvTab('upgrades')">‚¨ÜÔ∏è –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è</button>
    <button class="shop-tab" id="invTab-collections" onclick="switchInvTab('collections')">üèÖ –ö–æ–ª–µ–∫—Ü—ñ—ó</button>
  </div>
  <!-- Items pane -->
  <div id="invPane-items">
    <div class="limit-bar-wrap">
      <span id="invLimitLabel">0 / 10</span>
      <div class="limit-bar"><div class="limit-fill" id="invLimitBar" style="width:0%"></div></div>
    </div>
    <div id="bulkMoveWrap" style="display:none;margin-bottom:12px;">
      <button class="bulk-move-btn" onclick="bulkMoveToShop()">üöÄ –ü–µ—Ä–µ–º—ñ—Å—Ç–∏—Ç–∏ –≤—Å–µ –≤ –º–∞–≥–∞–∑–∏–Ω</button>
    </div>
    <div class="inv-grid" id="inventoryGrid"></div>
  </div>
  <!-- Upgrades pane -->
  <div id="invPane-upgrades" style="display:none">
    <div id="bulkMoveUpgradeCard"></div>
    <div id="invLimitUpgradeCard"></div>
  </div>
  <!-- Collections pane -->
  <div id="invPane-collections" style="display:none">
    <div id="collectionsGrid" style="display:flex;flex-direction:column;gap:10px;padding-bottom:20px;"></div>
  </div>
</div>

<!-- ===== SHOP SCREEN ===== -->
<div class="screen" id="screen-shop">
  <div id="shopLocked">
    <div class="shop-locked">
      <div class="shop-locked-icon">üîí</div>
      <h3>–û–Ω–ª–∞–π–Ω-–ú–∞–≥–∞–∑–∏–Ω</h3>
      <p>–í—ñ–¥–∫—Ä–∏–π –≤–ª–∞—Å–Ω–∏–π –º–∞–≥–∞–∑–∏–Ω —ñ –ø—Ä–æ–¥–∞–≤–∞–π –ø—Ä–µ–¥–º–µ—Ç–∏ –∑–∞ –≤–ª–∞—Å–Ω–æ—é —Ü—ñ–Ω–æ—é</p>
      <button class="unlock-btn" id="unlockShopBtn" onclick="unlockShop()">üè™ –í—ñ–¥–∫—Ä–∏—Ç–∏ –∑–∞ 500‚Ç¨</button>
    </div>
  </div>
  <div id="shopUnlocked" style="display:none">
    <div style="display:none;"><span id="shopCount"></span></div>
    <!-- Tabs -->
    <div class="shop-tabs">
      <button class="shop-tab active" id="shopTab-listings" onclick="switchShopTab('listings')">üìã –õ—ñ—Å—Ç–∏–Ω–≥–∏</button>
      <button class="shop-tab" id="shopTab-upgrades" onclick="switchShopTab('upgrades')">‚¨ÜÔ∏è –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è</button>
    </div>

    <!-- Tab: Listings -->
    <div id="shopPane-listings">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;">
        <div class="limit-bar-wrap" style="flex:1;margin:0;">
          <span id="shopLimitLabel">0 / 10</span>
          <div class="limit-bar"><div class="limit-fill" id="shopLimitBar" style="width:0%"></div></div>
        </div>
        <button id="listAllMaxBtn" onclick="listAllAtMax()" style="display:none" class="list-all-max-btn">‚ö° MAX ALL</button>
      </div>
      <div id="shopGrid" style="display:flex;flex-direction:column;gap:12px;"></div>
    </div>

    <!-- Tab: Upgrades -->
    <div id="shopPane-upgrades" style="display:none">
      <div id="multUpgradeCard"></div>
      <div id="shopLimitUpgradeCard"></div>
      <div id="listAllMaxCard"></div>
      <!-- –ö–æ–ª–µ–∫—Ü—ñ–π–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è -->
      <div style="margin-top:6px;">
        <div style="font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--muted);margin-bottom:8px;padding:0 2px;">üèÜ –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –∫–æ–ª–µ–∫—Ü—ñ–π</div>
        <div id="collShopUpgradesContainer"></div>
      </div>
    </div>
  </div>
</div>

<!-- ===== STATS SCREEN ===== -->
<!-- ===== LIFESHOP SCREEN ===== -->
<div class="screen" id="screen-lifeshop">
  <div id="capitalBanner" style="background:linear-gradient(135deg,#1a1209,#2d1f0e);border:1px solid rgba(245,200,66,.3);border-radius:14px;padding:16px;margin-bottom:14px;position:relative;overflow:hidden;">
    <div style="position:absolute;inset:0;background:radial-gradient(circle at 80% 50%,rgba(245,200,66,.06),transparent 60%);pointer-events:none;"></div>
    <div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:4px;">–í–∞—à –ö–∞–ø—ñ—Ç–∞–ª</div>
    <div id="capitalAmount" style="font-family:'Orbitron',sans-serif;font-size:26px;font-weight:900;color:var(--gold);line-height:1;">0‚Ç¨</div>
    <div style="display:flex;gap:16px;margin-top:10px;flex-wrap:wrap;">
      <div style="font-size:11px;color:var(--muted);">üí∞ –ì–æ—Ç—ñ–≤–∫–∞: <span id="capCash" style="color:var(--text)">0‚Ç¨</span></div>
      <div style="font-size:11px;color:var(--muted);">üì¶ –°–∫–ª–∞–¥: <span id="capInventory" style="color:var(--text)">0‚Ç¨</span></div>
      <div style="font-size:11px;color:var(--muted);">üíé LifeShop: <span id="capLifeshop" style="color:var(--text)">0‚Ç¨</span></div>
    </div>
    <div id="forbesRankBadge" style="position:absolute;top:12px;right:14px;text-align:right;">
      <div style="font-size:10px;color:var(--muted);">Forbes —Ä–µ–π—Ç–∏–Ω–≥</div>
      <div id="forbesRankNum" style="font-family:'Orbitron',sans-serif;font-size:18px;font-weight:800;color:var(--gold);">#‚Äî</div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="shop-tabs" id="lifeshopTabs">
    <button class="shop-tab active" id="lstab-transport"   onclick="switchLifeTab('transport')">üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</button>
    <button class="shop-tab"        id="lstab-realestate"  onclick="switchLifeTab('realestate')">üè† –ù–µ—Ä—É—Ö–æ–º—ñ—Å—Ç—å</button>
    <button class="shop-tab"        id="lstab-luxury"      onclick="switchLifeTab('luxury')">üíé –†–æ–∑–∫—ñ—à</button>
    <button class="shop-tab"        id="lstab-owned"       onclick="switchLifeTab('owned')">üóÉÔ∏è –í–ª–∞—Å–Ω—ñ—Å—Ç—å</button>
  </div>

  <div id="lspane-transport"  class="lifeshop-pane"></div>
  <div id="lspane-realestate" class="lifeshop-pane" style="display:none;"></div>
  <div id="lspane-luxury"     class="lifeshop-pane" style="display:none;"></div>
  <div id="lspane-owned"      class="lifeshop-pane" style="display:none;"></div>
</div>

<div class="screen" id="screen-stats">
  <!-- Capital summary banner -->
  <div id="statsCapitalBanner" style="background:linear-gradient(135deg,#1a1209,#2d1f0e);border:1px solid rgba(245,200,66,.3);border-radius:14px;padding:14px 16px;margin-bottom:14px;position:relative;overflow:hidden;">
    <div style="position:absolute;inset:0;background:radial-gradient(circle at 80% 50%,rgba(245,200,66,.06),transparent 60%);pointer-events:none;"></div>
    <div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:2px;">–ó–∞–≥–∞–ª—å–Ω–∏–π –ö–∞–ø—ñ—Ç–∞–ª</div>
    <div id="statsCapitalAmount" style="font-family:'Orbitron',sans-serif;font-size:22px;font-weight:900;color:var(--gold);">0‚Ç¨</div>
    <div style="display:flex;gap:14px;margin-top:8px;flex-wrap:wrap;">
      <div style="font-size:11px;color:var(--muted);">üí∞ <span id="statsCapCash">0‚Ç¨</span></div>
      <div style="font-size:11px;color:var(--muted);">üì¶ <span id="statsCapInv">0‚Ç¨</span></div>
      <div style="font-size:11px;color:var(--muted);">üíé <span id="statsCapLife">0‚Ç¨</span></div>
    </div>
    <div style="position:absolute;top:10px;right:14px;text-align:right;">
      <div style="font-size:10px;color:var(--muted);">Forbes</div>
      <div id="statsForbesRank" style="font-family:'Orbitron',sans-serif;font-size:16px;font-weight:800;color:var(--gold);">#‚Äî</div>
    </div>
  </div>
  <div class="stats-big-grid">
    <div class="stats-big-card">
      <div class="sb-val" id="statCasesOpened">0</div>
      <div class="sb-label">–ö–µ–π—Å—ñ–≤ –≤—ñ–¥–∫—Ä–∏—Ç–æ</div>
    </div>
    <div class="stats-big-card">
      <div class="sb-val" id="statTotalEarned">0‚Ç¨</div>
      <div class="sb-label">–ó–∞—Ä–æ–±–ª–µ–Ω–æ –≤—Å—å–æ–≥–æ</div>
    </div>
    <div class="stats-big-card">
      <div class="sb-val" id="statItemsSold">0</div>
      <div class="sb-label">–ü—Ä–æ–¥–∞–Ω–æ –ø—Ä–µ–¥–º–µ—Ç—ñ–≤</div>
    </div>
    <div class="stats-big-card">
      <div class="sb-val" id="statInShop">0</div>
      <div class="sb-label">–í –º–∞–≥–∞–∑–∏–Ω—ñ</div>
    </div>
  </div>
  <div class="section-title">–ù–∞–π–∫—Ä–∞—â–∏–π –¥—Ä–æ–ø</div>
  <div class="best-drop-card" id="bestDropCard">
    <div class="best-drop-emoji">üéÅ</div>
    <div class="best-drop-info">
      <div class="bd-label">–©–µ –Ω–µ –≤—ñ–¥–∫—Ä–∏–≤–∞–≤ –∫–µ–π—Å—ñ–≤</div>
      <div class="bd-name" id="bestDropName">‚Äî</div>
      <div class="bd-val" id="bestDropVal"></div>
    </div>
  </div>
  <div class="section-title" style="margin-top:20px;">–†—ñ–¥–∫—ñ—Å—Ç—å –¥—Ä–æ–ø—ñ–≤</div>
  <div class="rarity-stats" id="rarityStats"></div>
  <div class="section-title" style="margin-top:20px;">üèÜ –î–æ—Å—è–≥–Ω–µ–Ω–Ω—è</div>
  <div id="achievementsSection"></div>
  <button class="reset-btn" onclick="confirmReset()">üóëÔ∏è –°–∫–∏–Ω—É—Ç–∏ –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å</button>
</div>

<!-- ===== MODAL: Items Preview ===== -->
<div class="modal-overlay" id="previewModal">
  <div class="preview-modal">
    <div class="preview-header">
      <h3 id="previewTitle">–í–º—ñ—Å—Ç –∫–µ–π—Å—É</h3>
      <button class="close-btn" onclick="closePreviewModal()">‚úï</button>
    </div>
    <div class="preview-list" id="previewList"></div>
  </div>
</div>

<!-- ===== MODAL: Case opening ===== -->
<div class="modal-overlay" id="caseModal">
  <div class="modal">
    <div class="carousel-wrap">
      <div class="carousel-track" id="carouselTrack"></div>
    </div>
    <div class="modal-result" id="modalResult" style="display:none">
      <div id="resultRarityBadge" class="result-rarity"></div>
      <div id="resultEmoji" style="font-size:52px;margin-bottom:8px;display:flex;align-items:center;justify-content:center;min-height:56px;"></div>
      <div id="resultName" class="result-item-name"></div>
      <div id="resultVal" class="result-item-val"></div>
      <div class="result-actions">
        <button class="btn-sell" onclick="sellResult()">üí∏ –ü—Ä–æ–¥–∞—Ç–∏</button>
        <button class="btn-keep" onclick="keepResult()">üéí –î–æ —Å–∫–ª–∞–¥—É</button>
      </div>
    </div>
    <button class="spin-btn" id="spinBtn" onclick="spinCarousel()">üé≤ –í–Ü–î–ö–†–ò–¢–ò</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<!-- ===== CONFIRM RESET MODAL ===== -->
<div class="modal-overlay" id="confirmModal">
  <div class="confirm-modal">
    <h3>‚ö†Ô∏è –°–∫–∏–Ω—É—Ç–∏ –ø—Ä–æ–≥—Ä–µ—Å?</h3>
    <p>–í–µ—Å—å –±–∞–ª–∞–Ω—Å, –ø—Ä–µ–¥–º–µ—Ç–∏, –∞–ø–≥—Ä–µ–π–¥–∏ —Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥—É—Ç—å –≤–∏–¥–∞–ª–µ–Ω—ñ –Ω–∞–∑–∞–≤–∂–¥–∏.</p>
    <div class="confirm-actions">
      <button class="confirm-yes" onclick="doReset()">–¢–∞–∫, —Å–∫–∏–Ω—É—Ç–∏</button>
      <button class="confirm-no"  onclick="closeConfirm()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
    </div>
  </div>
</div>


<!-- ===== COLLECTION DETAIL MODAL ===== -->
<div class="modal-overlay" id="collectionModal">
  <div class="modal" style="max-width:440px;max-height:85vh;overflow-y:auto;padding:18px;">
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:6px;">
      <div id="collModalIcon" style="font-size:32px;flex-shrink:0;"></div>
      <div style="flex:1;">
        <div id="collModalName" style="font-size:16px;font-weight:800;color:var(--text);"></div>
        <div id="collModalProg" style="font-size:12px;color:var(--muted);margin-top:2px;"></div>
      </div>
      <button onclick="closeCollModal()" style="background:none;border:none;font-size:20px;color:var(--muted);cursor:pointer;padding:4px;">‚úï</button>
    </div>
    <div id="collModalBonuses" style="margin-bottom:10px;"></div>
    <div id="collModalSlots" class="coll-slots-grid"></div>
  </div>
</div>


<script>
// =================== GAME DATA ===================
const UPGRADES = [
  // ‚îÄ‚îÄ –†–∞–Ω–Ω—ñ–π –µ—Ç–∞–ø ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  { id:'glove',   name:'–†—É–∫–∞–≤–∏—á–∫–∞',        icon:'üß§', price:50,          clickBonus:2,     passiveBonus:0,    desc:'+2‚Ç¨ –∑–∞ –∫–ª—ñ–∫' },
  { id:'fast',    name:'–®–≤–∏–¥–∫–∏–π –ø–∞–ª–µ—Ü—å',   icon:'‚ö°', price:500,         clickBonus:5,     passiveBonus:0,    desc:'+5‚Ç¨ –∑–∞ –∫–ª—ñ–∫' },
  { id:'energy',  name:'–ï–Ω–µ—Ä–≥–µ—Ç–∏–∫',        icon:'ü•§', price:2_000,       clickBonus:50,    passiveBonus:0,    desc:'+50‚Ç¨ –∑–∞ –∫–ª—ñ–∫' },
  { id:'auto1',   name:'–ê–≤—Ç–æ-–∫–ª—ñ–∫–µ—Ä v1',  icon:'ü§ñ', price:10_000,      clickBonus:0,     passiveBonus:15,   desc:'+15‚Ç¨/—Å–µ–∫ –ø–∞—Å–∏–≤–Ω–æ' },
  { id:'golden',  name:'–ó–æ–ª–æ—Ç–∏–π —Ç–∞—á',      icon:'‚ú®', price:50_000,      clickBonus:200,   passiveBonus:0,    desc:'+200‚Ç¨ –∑–∞ –∫–ª—ñ–∫' },
  // ‚îÄ‚îÄ –°–µ—Ä–µ–¥–Ω—ñ–π –µ—Ç–∞–ø ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  { id:'cyber',   name:'–ö—ñ–±–µ—Ä-—Ä—É–∫–∞–≤–∏—Ü—è',   icon:'ü¶æ', price:250_000,     clickBonus:800,   passiveBonus:0,    desc:'+800‚Ç¨ –∑–∞ –∫–ª—ñ–∫' },
  { id:'factory', name:'–ê–≤—Ç–æ-–∑–∞–≤–æ–¥',        icon:'üè≠', price:800_000,     clickBonus:0,     passiveBonus:2000, desc:'+2,000‚Ç¨/—Å–µ–∫ –ø–∞—Å–∏–≤–Ω–æ' },
  { id:'matrix',  name:'–ú–∞—Ç—Ä–∏—Ü—è –§–æ—Ä—Ç—É–Ω–∏',  icon:'üîÆ', price:3_500_000,   clickBonus:4000,  passiveBonus:0,    desc:'+4,000‚Ç¨ –∑–∞ –∫–ª—ñ–∫' },
  // ‚îÄ‚îÄ –ü—ñ–∑–Ω—ñ–π –µ—Ç–∞–ø ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  { id:'quantum', name:'–ö–≤–∞–Ω—Ç–æ–≤–∏–π –î–æ—Ç–∏–∫',  icon:'‚öõÔ∏è', price:20_000_000,  clickBonus:18000, passiveBonus:0,    desc:'+18,000‚Ç¨ –∑–∞ –∫–ª—ñ–∫' },
  { id:'godmode', name:'–†–µ–∂–∏–º –ë–æ–≥–∞',        icon:'üëÅÔ∏è', price:120_000_000, clickBonus:80000, passiveBonus:0,    desc:'+80,000‚Ç¨ –∑–∞ –∫–ª—ñ–∫' },
];

// Inventory limit upgrade levels (state.invUpgLevel indexes into this)
const INV_LEVELS = [
  { slots:10,  price:0,     label:'–ë–∞–∑–æ–≤–∏–π',   desc:'10 –º—ñ—Å—Ü—å –Ω–∞ —Å–∫–ª–∞–¥—ñ' },
  { slots:15,  price:800,   label:'–†—ñ–≤–µ–Ω—å I',  desc:'15 –º—ñ—Å—Ü—å –Ω–∞ —Å–∫–ª–∞–¥—ñ' },
  { slots:25,  price:3000,  label:'–†—ñ–≤–µ–Ω—å II', desc:'25 –º—ñ—Å—Ü—å –Ω–∞ —Å–∫–ª–∞–¥—ñ' },
  { slots:40,  price:12000, label:'–†—ñ–≤–µ–Ω—å III',desc:'40 –º—ñ—Å—Ü—å –Ω–∞ —Å–∫–ª–∞–¥—ñ' },
  { slots:60,  price:40000, label:'–†—ñ–≤–µ–Ω—å IV', desc:'60 –º—ñ—Å—Ü—å –Ω–∞ —Å–∫–ª–∞–¥—ñ' },
  { slots:100, price:150000,label:'–ú–∞–∫—Å–∏–º—É–º',  desc:'100 –º—ñ—Å—Ü—å ‚Äî –º–∞–∫—Å–∏–º—É–º!' },
];

// Shop limit upgrade levels (state.shopUpgLevel indexes into this)
const SHOP_LEVELS = [
  { slots:10,  price:0,     label:'–ë–∞–∑–æ–≤–∏–π',   desc:'10 —Å–ª–æ—Ç—ñ–≤ —É –º–∞–≥–∞–∑–∏–Ω—ñ' },
  { slots:15,  price:1500,  label:'–†—ñ–≤–µ–Ω—å I',  desc:'15 —Å–ª–æ—Ç—ñ–≤ —É –º–∞–≥–∞–∑–∏–Ω—ñ' },
  { slots:25,  price:6000,  label:'–†—ñ–≤–µ–Ω—å II', desc:'25 —Å–ª–æ—Ç—ñ–≤ —É –º–∞–≥–∞–∑–∏–Ω—ñ' },
  { slots:40,  price:25000, label:'–†—ñ–≤–µ–Ω—å III',desc:'40 —Å–ª–æ—Ç—ñ–≤ —É –º–∞–≥–∞–∑–∏–Ω—ñ' },
  { slots:60,  price:80000, label:'–†—ñ–≤–µ–Ω—å IV', desc:'60 —Å–ª–æ—Ç—ñ–≤ —É –º–∞–≥–∞–∑–∏–Ω—ñ' },
  { slots:100, price:300000,label:'–ú–∞–∫—Å–∏–º—É–º',  desc:'100 —Å–ª–æ—Ç—ñ–≤ ‚Äî –º–∞–∫—Å–∏–º—É–º!' },
];

// Bulk-move upgrade (one-time purchase)
const BULK_MOVE_PRICE = 2000;

const CASES = [
  // ‚îÄ‚îÄ 1. Street Stuff ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  { id:'street', name:'Street Stuff', icon:'__ELEC_CASE__', price:15,
    desc:'–í—É–ª–∏—á–Ω–∏–π –Ω–∞–±—ñ—Ä –Ω–∞ –∫–æ–∂–µ–Ω –¥–µ–Ω—å', color:'#64748b',
    items:[
      {name:'–ë—Ä–µ–ª–æ–∫',              emoji:'üóùÔ∏è', rarity:'common',    value:1},
      {name:'–ü–æ–ø—Å–æ–∫–µ—Ç',            emoji:'üîµ', rarity:'common',    value:2},
      {name:'–ß–æ—Ö–æ–ª',               emoji:'üì±', rarity:'common',    value:3},
      {name:'–®–∫–∞—Ä–ø–µ—Ç–∫–∏',           emoji:'üß¶', rarity:'common',    value:2},
      {name:'–ö–∞–±–µ–ª—å USB',          emoji:'üîã', rarity:'common',    value:4},
      {name:'–°–ø—ñ–Ω–Ω–µ—Ä',             emoji:'üåÄ', rarity:'common',    value:3},
      {name:'–§–ª–µ—à–∫–∞ 128GB',        emoji:'üíæ', rarity:'rare',      value:8},
      {name:'–ó–∞–ø–∞–ª—å–Ω–∏—á–∫–∞ Zippo',   emoji:'üî•', rarity:'rare',      value:10},
      {name:'–ö–µ–ø–∫–∞',               emoji:'üß¢', rarity:'rare',      value:11},
      {name:'–ì–∞–º–∞–Ω–µ—Ü—å',            emoji:'üëõ', rarity:'rare',      value:12},
      {name:'–ù–∞–≤—É—à–Ω–∏–∫–∏ Skullcandy',emoji:'üéß', rarity:'epic',      value:30},
      {name:'–¢–µ—Ä–º–æ—Å Stanley',      emoji:'üß¥', rarity:'epic',      value:45},
      {name:'JBL Flip 6',          emoji:'üîä', rarity:'epic',      value:55},
      {name:'Powerbank 30000mAh',  emoji:'‚ö°', rarity:'legendary', value:120},
      {name:'Par–∞—Å–æ–ª—å–∫–∞ Xiaomi',   emoji:'‚òÇÔ∏è', rarity:'legendary', value:180},
    ]},

  // ‚îÄ‚îÄ 2. Office Hero ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  { id:'office', name:'Office Hero', icon:'üóÇÔ∏è', price:50,
    desc:'–í—Å–µ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–≥–æ –æ—Ñ—ñ—Å—É', color:'#3b82f6',
    items:[
      {name:'–°—Ç—ñ–∫–µ—Ä–∏',             emoji:'üìå', rarity:'common',    value:5},
      {name:'–ß–∞—à–∫–∞',               emoji:'‚òï', rarity:'common',    value:8},
      {name:'USB-–≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä',      emoji:'üí®', rarity:'common',    value:10},
      {name:'–ü—ñ–¥—Å—Ç–∞–≤–∫–∞ –¥–ª—è —Ä—É—á–æ–∫', emoji:'‚úèÔ∏è', rarity:'common',    value:12},
      {name:'–ê–Ω—Ç–∏—Å–µ–ø—Ç–∏–∫',          emoji:'üß¥', rarity:'common',    value:9},
      {name:'–ö–∏–ª–∏–º–æ–∫',             emoji:'üü´', rarity:'common',    value:13},
      {name:'–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞ –º–∏—à–∞',    emoji:'üñ±Ô∏è', rarity:'rare',      value:25},
      {name:'–û—Ä–≥–∞–Ω–∞–π–∑–µ—Ä',          emoji:'üóÇÔ∏è', rarity:'rare',      value:30},
      {name:'–©–æ–¥–µ–Ω–Ω–∏–∫ Moleskine',  emoji:'üìì', rarity:'rare',      value:35},
      {name:'–ö–∏–ª–∏–º–æ–∫ –∑ –ø—ñ–¥—ñ–≥—Ä—ñ–≤–æ–º',emoji:'üî•', rarity:'rare',      value:40},
      {name:'–†—é–∫–∑–∞–∫ Bobby',        emoji:'üéí', rarity:'epic',      value:100},
      {name:'–ö–∞–≤–æ–≤–∞—Ä–∫–∞',           emoji:'‚òï', rarity:'epic',      value:150},
      {name:'–ö–ª–∞–≤—ñ–∞—Ç—É—Ä–∞ Keychron', emoji:'‚å®Ô∏è', rarity:'epic',      value:200},
      {name:'–ö—Ä—ñ—Å–ª–æ Ergo',         emoji:'ü™ë', rarity:'legendary', value:400},
      {name:'–õ–∞–º–ø–∞ Dyson Morph',   emoji:'üí°', rarity:'legendary', value:700},
    ]},

  // ‚îÄ‚îÄ 3. Home Chef ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  { id:'chef', name:'Home Chef', icon:'üë®‚Äçüç≥', price:150,
    desc:'–î–ª—è —Å–ø—Ä–∞–≤–∂–Ω—å–æ–≥–æ —à–µ—Ñ-–∫—É—Ö–∞—Ä—è', color:'#f97316',
    items:[
      {name:'–®–ø–∞–∂–∫–∏',              emoji:'üç¢', rarity:'common',    value:15},
      {name:'–õ–æ–ø–∞—Ç–∫–∏',             emoji:'ü•Ñ', rarity:'common',    value:18},
      {name:'–°–ø–µ—Ü—ñ—ó',              emoji:'üå∂Ô∏è', rarity:'common',    value:20},
      {name:'–§–∞—Ä—Ç—É—Ö',              emoji:'üëï', rarity:'common',    value:22},
      {name:'–§–æ—Ä–º–∞ –¥–ª—è –≤–∏–ø—ñ—á–∫–∏',   emoji:'üßÅ', rarity:'common',    value:24},
      {name:'–î–æ—à–∫–∞',               emoji:'ü™µ', rarity:'common',    value:25},
      {name:'–¢–æ—Å—Ç–µ—Ä',              emoji:'üçû', rarity:'rare',      value:75},
      {name:'–ë–ª–µ–Ω–¥–µ—Ä',             emoji:'ü•§', rarity:'rare',      value:90},
      {name:'–í–∞–≥–∏ –∫—É—Ö–æ–Ω–Ω—ñ',        emoji:'‚öñÔ∏è', rarity:'rare',      value:105},
      {name:'–ï–ª–µ–∫—Ç—Ä–æ—á–∞–π–Ω–∏–∫',       emoji:'‚òï', rarity:'rare',      value:120},
      {name:'–í–∞–∫—É—É–º–∞—Ç–æ—Ä',          emoji:'üì¶', rarity:'epic',      value:300},
      {name:'–ê–µ—Ä–æ—Ñ—Ä–∏—Ç—é—Ä–Ω–∏—Ü—è',      emoji:'üç≥', rarity:'epic',      value:450},
      {name:'–ù–∞–±—ñ—Ä –Ω–æ–∂—ñ–≤',         emoji:'üî™', rarity:'epic',      value:600},
      {name:'–ö—É—Ö–æ–Ω–Ω–∏–π –∫–æ–º–±–∞–π–Ω',    emoji:'ü§ñ', rarity:'legendary', value:1200},
      {name:'–ì—Ä–∏–ª—å Tefal',         emoji:'üî•', rarity:'legendary', value:2000},
    ]},

  // ‚îÄ‚îÄ 4. Gamer's Den ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  { id:'gamer', name:"Gamer's Den", icon:'üéÆ', price:450,
    desc:'–¢–æ–ø–æ–≤–µ –≥–∞—Ä–Ω—ñ—Ä—É–≤–∞–Ω–Ω—è –¥–ª—è –≥–µ–π–º–µ—Ä–∞', color:'#8b5cf6',
    items:[
      {name:'–°—Ç—ñ–∫–µ—Ä–ø–∞–∫',           emoji:'üé®', rarity:'common',    value:45},
      {name:'–ö–∞–±–µ–ª—å-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç',   emoji:'üîå', rarity:'common',    value:50},
      {name:'–û–∫—É–ª—è—Ä–∏ –¥–ª—è –ü–ö',      emoji:'üëì', rarity:'common',    value:55},
      {name:'–ö–µ–π–∫–∞–ø–∏',             emoji:'‚å®Ô∏è', rarity:'common',    value:55},
      {name:'–ö—Ä—ñ–ø–ª–µ–Ω–Ω—è –º–æ–Ω—ñ—Ç–æ—Ä–∞',  emoji:'üñ•Ô∏è', rarity:'common',    value:60},
      {name:'–ö–∏–ª–∏–º–æ–∫ –≤–µ–ª–∏–∫–∏–π',     emoji:'üü´', rarity:'common',    value:65},
      {name:'–ú–∏—à–∞ Logitech G',     emoji:'üñ±Ô∏è', rarity:'rare',      value:225},
      {name:'RGB —Å—Ç—Ä—ñ—á–∫–∞',         emoji:'üåà', rarity:'rare',      value:270},
      {name:'–í–µ–±-–∫–∞–º–µ—Ä–∞',          emoji:'üì∑', rarity:'rare',      value:310},
      {name:'–ú—ñ–∫—Ä–æ—Ñ–æ–Ω',            emoji:'üé§', rarity:'rare',      value:350},
      {name:'–ì–∞—Ä–Ω—ñ—Ç—É—Ä–∞ Razer',     emoji:'üéß', rarity:'epic',      value:900},
      {name:'–°—Ç—Ä—ñ–º-–¥–µ–∫–∞ Elgato',   emoji:'üéõÔ∏è', rarity:'epic',      value:1400},
      {name:'–ö—Ä—ñ—Å–ª–æ –≥–µ–π–º–µ—Ä—Å—å–∫–µ',   emoji:'ü™ë', rarity:'epic',      value:1800},
      {name:'–ú–æ–Ω—ñ—Ç–æ—Ä LG Ultra',    emoji:'üñ•Ô∏è', rarity:'legendary', value:3500},
      {name:'–í—ñ–¥–µ–æ–∫–∞—Ä—Ç–∞ RTX 4060', emoji:'üíª', rarity:'legendary', value:6000},
    ]},

  // ‚îÄ‚îÄ 5. Fitness Pro ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  { id:'fitness', name:'Fitness Pro', icon:'üèãÔ∏è', price:1000,
    desc:'–í—Å–µ –¥–ª—è —Ç—Ä–µ–Ω—É–≤–∞–Ω—å —ñ –∑–¥–æ—Ä–æ–≤ º—è', color:'#22c55e',
    items:[
      {name:'–ú–∞–≥–Ω–µ–∑—ñ—è',            emoji:'ü§ç', rarity:'common',    value:100},
      {name:'–ù–∞–ø—É–ª—å—Å–Ω–∏–∫–∏',         emoji:'üß§', rarity:'common',    value:110},
      {name:'–†—É—à–Ω–∏–∫',              emoji:'üè≥Ô∏è', rarity:'common',    value:115},
      {name:'–°–∫–∞–∫–∞–ª–∫–∞',            emoji:'„Ä∞Ô∏è', rarity:'common',    value:125},
      {name:'–ï—Å–ø–∞–Ω–¥–µ—Ä',            emoji:'üí™', rarity:'common',    value:135},
      {name:'–ì–µ—Ç—Ä–∏',               emoji:'üß¶', rarity:'common',    value:150},
      {name:'–°–ø–æ—Ä—Ç–∏–≤–Ω–∞ —Å—É–º–∫–∞',     emoji:'üëú', rarity:'rare',      value:500},
      {name:'–ô–æ–≥–∞-–º–∞—Ç',            emoji:'üßò', rarity:'rare',      value:600},
      {name:'–®–µ–π–∫–µ—Ä –±—Ä–µ–Ω–¥–æ–≤–∏–π',    emoji:'ü•§', rarity:'rare',      value:700},
      {name:'–ù–∞–≤—É—à–Ω–∏–∫–∏ —Å–ø–æ—Ä—Ç',     emoji:'üéß', rarity:'rare',      value:800},
      {name:'–ú–∞—Å–∞–∂–Ω–∏–π –ø—ñ—Å—Ç–æ–ª–µ—Ç',   emoji:'üî´', rarity:'epic',      value:2000},
      {name:'Garmin Watch',        emoji:'‚åö', rarity:'epic',      value:3000},
      {name:'–ì–∞–Ω—Ç–µ–ª—ñ –Ω–∞–±—ñ—Ä–Ω—ñ',     emoji:'üèãÔ∏è', rarity:'epic',      value:4000},
      {name:'–í–µ–ª–æ—Ç—Ä–µ–Ω–∞–∂–µ—Ä',        emoji:'üö¥', rarity:'legendary', value:8000},
      {name:'–ë—ñ–≥–æ–≤–∞ –¥–æ—Ä—ñ–∂–∫–∞',      emoji:'üèÉ', rarity:'legendary', value:14000},
    ]},

  // ‚îÄ‚îÄ 6. Apple Garden ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  { id:'apple', name:'Apple Garden', icon:'üçé', price:2500,
    desc:'–ü—Ä–µ–º—ñ—É–º Apple-–µ–∫–æ—Å–∏—Å—Ç–µ–º–∞', color:'#94a3b8',
    items:[
      {name:'–°–µ—Ä–≤–µ—Ç–∫–∞ –ø–æ–ª—ñ—Ä—É–≤–∞–ª—å–Ω–∞',emoji:'üßπ', rarity:'common',   value:250},
      {name:'–ü–µ—Ä–µ—Ö—ñ–¥–Ω–∏–∫',          emoji:'üîå', rarity:'common',    value:275},
      {name:'–ö–∞–±–µ–ª—å Lightning',    emoji:'üîã', rarity:'common',    value:290},
      {name:'–ó–∞—Ä—è–¥–∫–∞ 20W',         emoji:'‚ö°', rarity:'common',    value:310},
      {name:'–†–µ–º—ñ–Ω–µ—Ü—å Solo Loop',  emoji:'‚åö', rarity:'common',    value:340},
      {name:'–°–∏–ª—ñ–∫–æ–Ω–æ–≤–∏–π —á–æ—Ö–æ–ª',   emoji:'üì±', rarity:'common',    value:370},
      {name:'AirPods Pro 2',       emoji:'üéß', rarity:'rare',      value:1200},
      {name:'Apple Pencil',        emoji:'‚úèÔ∏è', rarity:'rare',      value:1500},
      {name:'MagSafe Battery',     emoji:'üîã', rarity:'rare',      value:1700},
      {name:'AirTag 4-pack',       emoji:'üè∑Ô∏è', rarity:'rare',      value:2000},
      {name:'Apple Watch S9',      emoji:'‚åö', rarity:'epic',      value:5000},
      {name:'iPad Air',            emoji:'üìü', rarity:'epic',      value:7500},
      {name:'AirPods Max',         emoji:'üéß', rarity:'epic',      value:10000},
      {name:'MacBook Air M3',      emoji:'üíª', rarity:'legendary', value:20000},
      {name:'Mac Pro',             emoji:'üñ•Ô∏è', rarity:'legendary', value:35000},
    ]},

  // ‚îÄ‚îÄ 7. Photo Studio ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  { id:'photo', name:'Photo Studio', icon:'üì∑', price:5500,
    desc:'–î–ª—è —Å–ø—Ä–∞–≤–∂–Ω—ñ—Ö –º–∞–π—Å—Ç—Ä—ñ–≤ —Ñ–æ—Ç–æ', color:'#ec4899',
    items:[
      {name:'–ß–∏—Å—Ç—è—á–∏–π –Ω–∞–±—ñ—Ä',      emoji:'üßπ', rarity:'common',    value:550},
      {name:'–ë–ª–µ–Ω–¥–∞',              emoji:'üî≠', rarity:'common',    value:600},
      {name:'–†–µ–º—ñ–Ω—å –¥–ª—è –∫–∞–º–µ—Ä–∏',   emoji:'üéóÔ∏è', rarity:'common',    value:650},
      {name:'–ö–∞—Ä—Ç–∞ –ø–∞–º º—è—Ç—ñ 256GB',emoji:'üíæ', rarity:'common',    value:700},
      {name:'–®—Ç–∞—Ç–∏–≤–Ω–∞ –≥–æ–ª—ñ–≤–∫–∞',    emoji:'üî©', rarity:'common',    value:750},
      {name:'–§—ñ–ª—å—Ç—Ä–∏ UV',          emoji:'üîÆ', rarity:'common',    value:820},
      {name:'–ö—ñ–ª—å—Ü–µ–≤–∞ –ª–∞–º–ø–∞',      emoji:'üí°', rarity:'rare',      value:2700},
      {name:'–®—Ç–∞—Ç–∏–≤ Manfrotto',    emoji:'üì∑', rarity:'rare',      value:3200},
      {name:'–°–ø–∞–ª–∞—Ö Godox',        emoji:'‚ö°', rarity:'rare',      value:3800},
      {name:'–û–± º—î–∫—Ç–∏–≤ 50mm f/1.8',emoji:'üîç', rarity:'rare',      value:4400},
      {name:'–û–± º—î–∫—Ç–∏–≤ 70-200mm',  emoji:'üî≠', rarity:'epic',      value:11000},
      {name:'Sony A7 IV Body',     emoji:'üì∏', rarity:'epic',      value:17000},
      {name:'Canon EOS R5',        emoji:'üì∑', rarity:'epic',      value:22000},
      {name:'Hasselblad X2D',      emoji:'üèÜ', rarity:'legendary', value:44000},
      {name:'Phase One IQ4',       emoji:'üëë', rarity:'legendary', value:75000},
    ]},

  // ‚îÄ‚îÄ 8. Hobbyist Workshop ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  { id:'workshop', name:'Hobbyist Workshop', icon:'üîß', price:10000,
    desc:'–ú–∞–π—Å—Ç–µ—Ä–Ω—è –¥–ª—è —Å–ø—Ä–∞–≤–∂–Ω—ñ—Ö –µ–Ω—Ç—É–∑—ñ–∞—Å—Ç—ñ–≤', color:'#f59e0b',
    items:[
      {name:'–ó–∞—Ö–∏—Å–Ω—ñ –æ–∫—É–ª—è—Ä–∏',     emoji:'ü•Ω', rarity:'common',    value:1000},
      {name:'–ú–∞—Å–∫–∞',               emoji:'üò∑', rarity:'common',    value:1100},
      {name:'–†—É–ª–µ—Ç–∫–∞',             emoji:'üìè', rarity:'common',    value:1150},
      {name:'–õ—ñ—Ö—Ç–∞—Ä',              emoji:'üî¶', rarity:'common',    value:1200},
      {name:'–û—Ä–≥–∞–Ω–∞–π–∑–µ—Ä –±–æ–ª—Ç—ñ–≤',   emoji:'üóÇÔ∏è', rarity:'common',    value:1300},
      {name:'–ù–∞–±—ñ—Ä –∫–ª—é—á—ñ–≤',        emoji:'üîë', rarity:'common',    value:1500},
      {name:'–ü–µ—Ä—Ñ–æ—Ä–∞—Ç–æ—Ä',          emoji:'üî®', rarity:'rare',      value:5000},
      {name:'–®–ª—ñ—Ñ—É–≤–∞–ª—å–Ω–∞ –º–∞—à–∏–Ω–∞',  emoji:'‚öôÔ∏è', rarity:'rare',      value:6000},
      {name:'–ù–∞–±—ñ—Ä —Å–≤–µ—Ä–¥–µ–ª',       emoji:'ü™õ', rarity:'rare',      value:7000},
      {name:'–ë—É–¥—ñ–≤–µ–ª—å–Ω–∏–π –ø–∏–ª–æ—Å–æ—Å', emoji:'üåÄ', rarity:'rare',      value:8000},
      {name:'–ù–∞–±—ñ—Ä —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ DeWalt',emoji:'üß∞',rarity:'epic',  value:20000},
      {name:'–ó–≤–∞—Ä—é–≤–∞–ª—å–Ω–∏–π –∞–ø–∞—Ä–∞—Ç', emoji:'‚ö°', rarity:'epic',      value:30000},
      {name:'–í–µ—Ä—Å—Ç–∞–∫',             emoji:'ü™ö', rarity:'epic',      value:40000},
      {name:'3D –ü—Ä–∏–Ω—Ç–µ—Ä Bambu',    emoji:'üñ®Ô∏è', rarity:'legendary', value:80000},
      {name:'–ì—Ä–∞–≤—ñ—Ä—É–≤–∞–ª—å–Ω–∏–π –≤–µ—Ä—Å—Ç–∞—Ç',emoji:'‚öôÔ∏è',rarity:'legendary',value:140000},
    ]},

  // ‚îÄ‚îÄ 9. Smart Comfort ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  { id:'smart', name:'Smart Comfort', icon:'üè†', price:16000,
    desc:'–†–æ–∑—É–º–Ω–∏–π –¥—ñ–º –ø—Ä–µ–º—ñ—É–º-–∫–ª–∞—Å—É', color:'#06b6d4',
    items:[
      {name:'–°–º–∞—Ä—Ç-–ª–∞–º–ø–æ—á–∫–∞',      emoji:'üí°', rarity:'common',    value:1600},
      {name:'–†–æ–∑—É–º–Ω–∞ —Ä–æ–∑–µ—Ç–∫–∞',     emoji:'üîå', rarity:'common',    value:1800},
      {name:'–î–∞—Ç—á–∏–∫ –∑–∞—Ç–æ–ø–ª–µ–Ω–Ω—è',   emoji:'üíß', rarity:'common',    value:2000},
      {name:'–ü—É–ª—å—Ç Harmony',       emoji:'üì°', rarity:'common',    value:2100},
      {name:'–í—ñ–¥–µ–æ–¥–∑–≤—ñ–Ω–æ–∫',        emoji:'üì∑', rarity:'common',    value:2200},
      {name:'–¢–µ—Ä–º–æ—Å—Ç–∞—Ç',           emoji:'üå°Ô∏è', rarity:'common',    value:2400},
      {name:'–†–æ–∑—É–º–Ω—ñ —à—Ç–æ—Ä–∏',       emoji:'ü™ü', rarity:'rare',      value:8000},
      {name:'–ö–æ–ª–æ–Ω–∫–∞ Sonos',       emoji:'üîä', rarity:'rare',      value:9500},
      {name:'–û—á–∏—Å–Ω–∏–∫ Dyson',       emoji:'üí®', rarity:'rare',      value:11000},
      {name:'–°–º–∞—Ä—Ç-–¥–∑–µ—Ä–∫–∞–ª–æ',      emoji:'ü™û', rarity:'rare',      value:12000},
      {name:'–†–æ–±–æ—Ç-–ø–∏–ª–æ—Å–æ—Å+–±–∞–∑–∞',  emoji:'ü§ñ', rarity:'epic',      value:32000},
      {name:'–ü—Ä–æ–µ–∫—Ç–æ—Ä Freestyle',  emoji:'üìΩÔ∏è', rarity:'epic',      value:48000},
      {name:'–°–∏—Å—Ç–µ–º–∞ —Ä–æ–∑—É–º–Ω–æ–≥–æ –¥–æ–º—É',emoji:'üè†',rarity:'epic',     value:64000},
      {name:'Samsung TV 85"',      emoji:'üì∫', rarity:'legendary', value:120000},
      {name:'–†–æ–∑—É–º–Ω–µ –ª—ñ–∂–∫–æ',       emoji:'üõèÔ∏è', rarity:'legendary', value:220000},
    ]},

  // ‚îÄ‚îÄ 10. Elite Collector ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  { id:'elite', name:'Elite Collector', icon:'üëë', price:22000,
    desc:'–ö–æ–ª–µ–∫—Ü—ñ—è –¥–ª—è –æ–±—Ä–∞–Ω–∏—Ö', color:'#f5c842',
    items:[
      {name:'–ö–∞—Ä—Ç—Ö–æ–ª–¥–µ—Ä',          emoji:'üí≥', rarity:'common',    value:2200},
      {name:'–ö—Ä–∞–≤–∞—Ç–∫–∞',            emoji:'üëî', rarity:'common',    value:2500},
      {name:'–ö–Ω–∏–≥–∞ –∫–æ–ª–µ–∫—Ü—ñ–π–Ω–∞',    emoji:'üìö', rarity:'common',    value:2700},
      {name:'–ì–∞–º–∞–Ω–µ—Ü—å –±—Ä–µ–Ω–¥–æ–≤–∏–π',  emoji:'üëõ', rarity:'common',    value:2900},
      {name:'–û–∫—É–ª—è—Ä–∏ —Å–æ–Ω—Ü–µ–∑–∞—Ö–∏—Å–Ω—ñ',emoji:'üï∂Ô∏è', rarity:'common',   value:3100},
      {name:'–ü–∞—Ä–∞—Å–æ–ª—å–∫–∞ –µ–ª—ñ—Ç–Ω–∞',   emoji:'‚òÇÔ∏è', rarity:'common',    value:3300},
      {name:'–†—É—á–∫–∞ Montblanc',     emoji:'üñäÔ∏è', rarity:'rare',      value:11000},
      {name:'–ó–∞–ø–æ–Ω–∫–∏ Cartier',     emoji:'üíé', rarity:'rare',      value:13000},
      {name:'–†–µ–º—ñ–Ω—å Gucci',        emoji:'üëî', rarity:'rare',      value:15000},
      {name:'–®–∞—Ä—Ñ Herm√®s',         emoji:'üß£', rarity:'rare',      value:17000},
      {name:'–ö–æ—Å—Ç—é–º Tom Ford',     emoji:'ü§µ', rarity:'epic',      value:44000},
      {name:'–°—É–º–∫–∞ Louis Vuitton', emoji:'üëú', rarity:'epic',      value:66000},
      {name:'–í–∏–Ω–Ω–∞ —à–∞—Ñ–∞',          emoji:'üç∑', rarity:'epic',      value:88000},
      {name:'Omega Seamaster',     emoji:'‚åö', rarity:'legendary', value:170000},
      {name:'–ó–æ–ª–æ—Ç–∞ –º–æ–Ω–µ—Ç–∞',       emoji:'ü™ô', rarity:'legendary', value:300000},
    ]},
];


// =================== MYSTERY BOXES DATA ===================
const MYSTERY_BOXES = [
  { id:'mbox1', name:"Traveler's Dream", icon:'‚úàÔ∏è', price:50000,
    desc:'–ù–µ–∑–∞–±—É—Ç–Ω—ñ –ø—Ä–∏–≥–æ–¥–∏ –∑ —É—Å—å–æ–≥–æ —Å–≤—ñ—Ç—É', color:'#0ea5e9',
    items:[
      // Common (20)
      {name:'–ù–∞–¥—É–≤–Ω–∞ –ø–æ–¥—É—à–∫–∞ –¥–ª—è —à–∏—ó',      emoji:'üí∫', rarity:'common', value:4000},
      {name:'–ú–∞—Å–∫–∞ –¥–ª—è —Å–Ω—É',                emoji:'üò¥', rarity:'common', value:4300},
      {name:'–ù–∞–±—ñ—Ä –ø–µ—Ä–µ—Ö—ñ–¥–Ω–∏–∫—ñ–≤',           emoji:'üîå', rarity:'common', value:4600},
      {name:'–¢–µ—Ä–º–æ—Å Stanley Classic',       emoji:'üß¥', rarity:'common', value:4800},
      {name:'–ü–∞–≤–µ—Ä–±–∞–Ω–∫ Solar 10000mAh',     emoji:'‚ö°', rarity:'common', value:5000},
      {name:'–û–∫—É–ª—è—Ä–∏ Ray-Ban Aviator',      emoji:'üï∂Ô∏è', rarity:'common', value:5200},
      {name:'–°–∫—Ä–µ—Ç—á-–∫–∞—Ä—Ç–∞ —Å–≤—ñ—Ç—É XL',        emoji:'üó∫Ô∏è', rarity:'common', value:5500},
      {name:'–®–≤–∏–¥–∫–æ—Å–æ—Ö–Ω—É—á–∏–π —Ä—É—à–Ω–∏–∫',        emoji:'üè≥Ô∏è', rarity:'common', value:5700},
      {name:'–ß–æ—Ö–æ–ª –¥–ª—è –≤–∞–ª—ñ–∑–∏',             emoji:'üß≥', rarity:'common', value:5900},
      {name:'–û—Ä–≥–∞–Ω–∞–π–∑–µ—Ä –¥–ª—è –¥—Ä–æ—Ç—ñ–≤',        emoji:'üîÄ', rarity:'common', value:6000},
      {name:'–ù–∞–±—ñ—Ä –º—ñ–Ω—ñ-–∫–æ—Å–º–µ—Ç–∏–∫–∏',         emoji:'üíÑ', rarity:'common', value:6100},
      {name:'–ü–ª—è—à–∫–∞ –∑ —Ñ—ñ–ª—å—Ç—Ä–æ–º',            emoji:'üö∞', rarity:'common', value:6200},
      {name:'–ö–æ–º–ø—Ä–µ—Å—ñ–π–Ω—ñ —à–∫–∞—Ä–ø–µ—Ç–∫–∏',        emoji:'üß¶', rarity:'common', value:6300},
      {name:'–°–æ–Ω—Ü–µ–∑–∞—Ö–∏—Å–Ω–∏–π –∫—Ä–µ–º Luxury',    emoji:'üåû', rarity:'common', value:6400},
      {name:'–ö–Ω–∏–≥–∞ "–¢–æ–ø 100 –º—ñ—Å—Ü—å"',        emoji:'üìñ', rarity:'common', value:6500},
      {name:'–ü–∞—Ä–∞—Å–æ–ª—å–∫–∞-—Ç—Ä–æ—Å—Ç–∏–Ω–∞',          emoji:'‚òÇÔ∏è', rarity:'common', value:6600},
      {name:'–ì–∞–º–∞–Ω–µ—Ü—å –∑ RFID –∑–∞—Ö–∏—Å—Ç–æ–º',     emoji:'üëõ', rarity:'common', value:6700},
      {name:'–í–æ–¥–æ–Ω–µ–ø—Ä–æ–Ω–∏–∫–Ω–∏–π —á–æ—Ö–æ–ª',        emoji:'üì±', rarity:'common', value:6800},
      {name:'–î–æ—Ä–æ–∂–Ω—è –∞–ø—Ç–µ—á–∫–∞',              emoji:'ü©π', rarity:'common', value:6900},
      {name:'–ú–∞–≥–Ω—ñ—Ç "I was there"',         emoji:'üß≤', rarity:'common', value:7000},
      // Rare (15)
      {name:'–í–∞–ª—ñ–∑–∞ Louis Vuitton Horizon', emoji:'üß≥', rarity:'rare',   value:10000},
      {name:'–ù–∞–º–µ—Ç –¥–ª—è —Å—Ö–æ–¥–∂–µ–Ω–Ω—è',          emoji:'‚õ∫', rarity:'rare',   value:11000},
      {name:'–ì—ñ—Ä—Å—å–∫–æ–ª–∏–∂–Ω–∏–π –∫–æ–º–ø–ª–µ–∫—Ç',       emoji:'üéø', rarity:'rare',   value:12000},
      {name:'GoPro Hero 12 Bundle',         emoji:'üì∑', rarity:'rare',   value:12500},
      {name:'–†—é–∫–∑–∞–∫ Peak Design 45L',       emoji:'üéí', rarity:'rare',   value:13000},
      {name:'–°–æ–Ω—è—á–Ω–∞ –ø–∞–Ω–µ–ª—å 200W',          emoji:'‚òÄÔ∏è', rarity:'rare',   value:13500},
      {name:'–ö–æ–ª–µ–∫—Ü—ñ–π–Ω—ñ –ø—É—Ç—ñ–≤–Ω–∏–∫–∏',         emoji:'üìö', rarity:'rare',   value:14000},
      {name:'–î—Ä–æ–Ω –¥–ª—è –ø–æ–¥–æ—Ä–æ–∂–µ–π',           emoji:'üöÅ', rarity:'rare',   value:14500},
      {name:'–°–ø–∞–ª—å–Ω–∏–π –º—ñ—à–æ–∫ Extreme',       emoji:'üõå', rarity:'rare',   value:15500},
      {name:'–ù–∞–≤—ñ–≥–∞—Ç–æ—Ä Garmin',             emoji:'üó∫Ô∏è', rarity:'rare',   value:16000},
      {name:'–ü–æ—Ä—Ç–∞—Ç–∏–≤–Ω–∏–π —Ñ—ñ–ª—å—Ç—Ä –≤–æ–¥–∏',      emoji:'üíß', rarity:'rare',   value:16500},
      {name:'–ë—ñ–Ω–æ–∫–ª—å Nikon',               emoji:'üî≠', rarity:'rare',   value:17000},
      {name:'–û–∫—É–ª—è—Ä–∏ –¥–ª—è –ø–ª–∞–≤–∞–Ω–Ω—è+–¥–∏—Å–ø–ª–µ–π',emoji:'ü•Ω', rarity:'rare',   value:17500},
      {name:'–®–∫—ñ—Ä—è–Ω—ñ –∞–∫—Å–µ—Å—É–∞—Ä–∏ –ø–∞—Å–ø–æ—Ä—Ç–∞',  emoji:'üìã', rarity:'rare',   value:17800},
      {name:'–î–æ—Ä–æ–∂–Ω—è –ø—Ä–∞—Å–∫–∞ –ø—Ä–µ–º—ñ—É–º',       emoji:'üîß', rarity:'rare',   value:18000},
      // Epic (7)
      {name:'–¢–∏–∂–¥–µ–Ω—å —É Burj Al Arab',       emoji:'üè®', rarity:'epic',   value:60000},
      {name:'–¢—É—Ä –Ω–∞ –≤–µ—Ä—Ç–æ–ª—å–æ—Ç—ñ –Ω–∞–¥ –ê–ª—å–ø–∞–º–∏',emoji:'üöÅ', rarity:'epic',   value:65000},
      {name:'–ù–∞–±—ñ—Ä –¥–ª—è –¥–∞–π–≤—ñ–Ω–≥—É Scubapro',  emoji:'ü§ø', rarity:'epic',   value:72000},
      {name:'–ö–≤–∏—Ç–æ–∫ –≤ –ø–µ—Ä—à–∏–π –∫–ª–∞—Å Emirates',emoji:'‚úàÔ∏è', rarity:'epic',   value:78000},
      {name:'–ï–∫—Å–ø–µ–¥–∏—Ü—ñ—è –≤ –ê–Ω—Ç–∞—Ä–∫—Ç–∏–¥—É',      emoji:'üßä', rarity:'epic',   value:85000},
      {name:'–°–∞—Ñ–∞—Ä—ñ-—Ç—É—Ä —É –ö–µ–Ω—ñ—ó',          emoji:'ü¶Å', rarity:'epic',   value:88000},
      {name:'–ü–æ–≤—ñ—Ç—Ä—è–Ω–∞ –∫—É–ª—è –≤ –ö–∞–ø–ø–∞–¥–æ–∫—ñ—ó',  emoji:'üéà', rarity:'epic',   value:90000},
      // Legendary (3)
      {name:'–ö—Ä—É—ó–∑ "–ù–∞–≤–∫–æ–ª–æ —Å–≤—ñ—Ç—É"',        emoji:'üö¢', rarity:'legendary', value:250000},
      {name:'–ü–æ–ª—ñ—Ç —É –Ω–µ–≤–∞–≥–æ–º–æ—Å—Ç—ñ Zero-G',   emoji:'üõ∏', rarity:'legendary', value:275000},
      {name:'–ü—Ä–∏–≤–∞—Ç–Ω–∏–π –ø–µ—Ä–µ–ª—ñ—Ç –±—ñ–∑–Ω–µ—Å-–¥–∂–µ—Ç',emoji:'üõ©Ô∏è', rarity:'legendary', value:300000},
    ]},

  { id:'mbox2', name:'Secret Tech Lab', icon:'üî¨', price:100000,
    desc:'–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó –º–∞–π–±—É—Ç–Ω—å–æ–≥–æ –≤–∂–µ —Å—å–æ–≥–æ–¥–Ω—ñ', color:'#8b5cf6',
    items:[
      // Common (20)
      {name:'–°–º–∞—Ä—Ç-–∫—ñ–ª—å—Ü–µ Oura Ring',       emoji:'üíç', rarity:'common', value:8000},
      {name:'–õ–µ–≤—ñ—Ç–∞—Ü—ñ–π–Ω–∞ –ª–∞–º–ø–∞ Flyte',      emoji:'üí°', rarity:'common', value:8500},
      {name:'–°–º–∞—Ä—Ç-—Ä—É—á–∫–∞ Moleskine Set',    emoji:'‚úèÔ∏è', rarity:'common', value:9000},
      {name:'–ù–∞–≤—É—à–Ω–∏–∫–∏ Dyson Zone',         emoji:'üéß', rarity:'common', value:9500},
      {name:'–ß–æ—Ö–æ–ª –∑ E-Ink –µ–∫—Ä–∞–Ω–æ–º',        emoji:'üì±', rarity:'common', value:10000},
      {name:'USB-—Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ –∫–æ—Å–º–µ—Ç–∏–∫–∏',    emoji:'üßä', rarity:'common', value:10500},
      {name:'–†–æ–∑—É–º–Ω–∞ —Å–∫–∞—Ä–±–Ω–∏—á–∫–∞-—Å–µ–π—Ñ',      emoji:'üîí', rarity:'common', value:11000},
      {name:'–ö–ª–∞–≤—ñ–∞—Ç—É—Ä–∞ Apple Magic',       emoji:'‚å®Ô∏è', rarity:'common', value:11500},
      {name:'–°–º–∞—Ä—Ç-–ø–ª—è—à–∫–∞ HidrateSpark',    emoji:'üíß', rarity:'common', value:12000},
      {name:'–¢–µ—Å—Ç–µ—Ä —è–∫–æ—Å—Ç—ñ –ø–æ–≤—ñ—Ç—Ä—è',        emoji:'üí®', rarity:'common', value:12500},
      {name:'–ó–∞—Ä—è–¥–∫–∞ Nomad Base Station',   emoji:'üîã', rarity:'common', value:12800},
      {name:'–õ–∞–∑–µ—Ä–Ω–∞ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∞ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∞',emoji:'üñ•Ô∏è', rarity:'common', value:13000},
      {name:'AirTag Gold Edition',          emoji:'üè∑Ô∏è', rarity:'common', value:13500},
      {name:'–ê–Ω—Ç–∏-—Å—Ç—Ä–µ—Å –∫—É–± OLED',          emoji:'üéÆ', rarity:'common', value:14000},
      {name:'–†–æ–∑—É–º–Ω–∞ —Å–∫–∞–∫–∞–ª–∫–∞ Tangram',     emoji:'‚ö°', rarity:'common', value:14500},
      {name:'–§–æ—Ç–æ–ø—Ä–∏–Ω—Ç–µ—Ä Fujifilm Pocket',  emoji:'üì∏', rarity:'common', value:14800},
      {name:'–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –º–∞—Å–∫–∞ –¥–ª—è —Å–Ω—É',     emoji:'üò¥', rarity:'common', value:15000},
      {name:'–ü—ñ–¥—Å—Ç–∞–≤–∫–∞ –∑ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è–º',     emoji:'üì°', rarity:'common', value:15000},
      {name:'USB-–≥—Ä—ñ–ª–∫–∞ –¥–ª—è —Ä—É–∫',           emoji:'ü§≤', rarity:'common', value:15000},
      {name:'–ù–∞–≥—Ä—ñ–≤–∞—á –¥–ª—è —á–∞—à–∫–∏ App',       emoji:'‚òï', rarity:'common', value:15000},
      // Rare (15)
      {name:'–î—Ä–æ–Ω DJI Inspire 3',           emoji:'üöÅ', rarity:'rare',   value:25000},
      {name:'–°–º–∞—Ä—Ç-–¥–∑–µ—Ä–∫–∞–ª–æ Hi-Tech',       emoji:'ü™û', rarity:'rare',   value:27000},
      {name:'–°–º–∞—Ä—Ç—Ñ–æ–Ω –∑ –≥–Ω—É—á–∫–∏–º –µ–∫—Ä–∞–Ω–æ–º',   emoji:'üì±', rarity:'rare',   value:28000},
      {name:'–ì–æ–ª–æ–≥—Ä–∞—Ñ—ñ—á–Ω–∏–π –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä 3D',  emoji:'üåÄ', rarity:'rare',   value:29000},
      {name:'–ì—ñ–¥—Ä–æ–ø–æ–Ω–Ω–∞ —Ñ–µ—Ä–º–∞ Click&Grow',  emoji:'üå±', rarity:'rare',   value:30000},
      {name:'–ó–∞–º–æ–∫ –∑ –≤–µ–Ω–Ω–∏–º —Å–∫–∞–Ω–µ—Ä–æ–º',      emoji:'üîê', rarity:'rare',   value:31000},
      {name:'–®–æ–ª–æ–º Quest Pro MR',           emoji:'ü•Ω', rarity:'rare',   value:32000},
      {name:'–ë—ñ–æ–º–µ—Ç—Ä–∏—á–Ω–∏–π —Å–µ–π—Ñ',            emoji:'üîí', rarity:'rare',   value:33000},
      {name:'–ú–∞—Ç—Ä–∞—Ü –∑ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –∫–ª—ñ–º–∞—Ç—É',   emoji:'üõèÔ∏è', rarity:'rare',   value:34000},
      {name:'–†–æ–±–æ-–º–∏–π–Ω–∏–∫ –≤—ñ–∫–æ–Ω Winbot',     emoji:'ü§ñ', rarity:'rare',   value:35000},
      {name:'–†–æ–∑—É–º–Ω–∏–π –∞–∫–≤–∞—Ä—ñ—É–º –∞–≤—Ç–æ',       emoji:'üêü', rarity:'rare',   value:36000},
      {name:'–ï–ª–µ–∫—Ç—Ä–æ-—Å–∫–µ–π—Ç–±–æ—Ä–¥ Carbon',     emoji:'üõπ', rarity:'rare',   value:37000},
      {name:'Bose QuietComfort Special',    emoji:'üéß', rarity:'rare',   value:38000},
      {name:'Garmin Marq —Å–º–∞—Ä—Ç-–≥–æ–¥–∏–Ω–Ω–∏–∫',   emoji:'‚åö', rarity:'rare',   value:39000},
      {name:'–û—á–∏—â—É–≤–∞—á Dyson Big+Quiet',     emoji:'üí®', rarity:'rare',   value:40000},
      // Epic (7)
      {name:'Apple Vision Pro 2',           emoji:'ü•Ω', rarity:'epic',   value:120000},
      {name:'–ö—Ä—ñ—Å–ª–æ-—Å—Ç–∞–Ω—Ü—ñ—è Acer Predator', emoji:'ü™ë', rarity:'epic',   value:130000},
      {name:'Tesla Powerwall Home Battery', emoji:'‚ö°', rarity:'epic',   value:140000},
      {name:'–ü—Ä–æ–∑–æ—Ä–∏–π Micro-LED –¥–∏—Å–ø–ª–µ–π',   emoji:'üì∫', rarity:'epic',   value:155000},
      {name:'–†–æ–∑—É–º–Ω–∞ –∫—É—Ö–Ω—è-—Ä–æ–±–æ—Ç',          emoji:'ü§ñ', rarity:'epic',   value:165000},
      {name:'–ï–∫–∑–æ—Å–∫–µ–ª–µ—Ç –¥–ª—è —Å–ø–∏–Ω–∏',         emoji:'ü¶æ', rarity:'epic',   value:175000},
      {name:'–†–æ–∑—É–º–Ω–µ –¥–∑–µ—Ä–∫–∞–ª–æ+—Ç—Ä–µ–Ω–µ—Ä',      emoji:'ü™û', rarity:'epic',   value:180000},
      // Legendary (3)
      {name:'–õ–∞–∑–µ—Ä–Ω–∏–π –¢–í Hisense 150"',     emoji:'üì∫', rarity:'legendary', value:500000},
      {name:'–†–æ–±–æ–ø–µ—Å Unitree Go2 Pro',      emoji:'üêï', rarity:'legendary', value:550000},
      {name:'–ö–∞–ø—Å—É–ª–∞ –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∏–ª',  emoji:'üõ∏', rarity:'legendary', value:600000},
    ]},

  { id:'mbox3', name:'History Keeper', icon:'üèõÔ∏è', price:150000,
    desc:'–ê—Ä—Ç–µ—Ñ–∞–∫—Ç–∏ —Ç–∞ —Å–∫–∞—Ä–±–∏ —Ü–∏–≤—ñ–ª—ñ–∑–∞—Ü—ñ–π', color:'#d97706',
    items:[
      // Common (20)
      {name:'–°—Ç–∞—Ä–∞ –≥–∞–∑–µ—Ç–∞ 1920-—Ö',          emoji:'üì∞', rarity:'common', value:12000},
      {name:'–°—Ä—ñ–±–Ω–∏–π —Å–≤—ñ—á–Ω–∏–∫',              emoji:'üïØÔ∏è', rarity:'common', value:12500},
      {name:'–ù–∞–±—ñ—Ä –¥–ª—è –ª–∏—Å—Ç—ñ–≤ Vintage',     emoji:'‚úâÔ∏è', rarity:'common', value:13000},
      {name:'–ú–∞—Ä–∫–∞ "Blue Mauritius"',       emoji:'üìÆ', rarity:'common', value:14000},
      {name:'–°—Ç–∞—Ä–æ–≤–∏–Ω–Ω–∏–π –∫–ª—é—á –≤—ñ–¥ –∑–∞–º–∫—É',   emoji:'üóùÔ∏è', rarity:'common', value:14500},
      {name:'–ì–ª–∏–Ω—è–Ω–∞ —Ç—Ä—É–±–∫–∞',               emoji:'ü™à', rarity:'common', value:15000},
      {name:'–ü–µ—Ä–æ –∑ –∑–æ–ª–æ—Ç–∏–º –Ω–∞–∫–æ–Ω–µ—á–Ω–∏–∫–æ–º',  emoji:'üñäÔ∏è', rarity:'common', value:15500},
      {name:'–°–∫–ª—è–Ω–∞ —á–æ—Ä–Ω–∏–ª—å–Ω–∏—Ü—è',           emoji:'ü´ô', rarity:'common', value:16000},
      {name:'–ß–µ—Ä–µ–ø –∑ –≥—ñ—Ä—Å—å–∫–æ–≥–æ –∫—Ä–∏—à—Ç–∞–ª—é',   emoji:'üíÄ', rarity:'common', value:17000},
      {name:'–ö–∞—Ä—Ç–∏–Ω–∞ –Ω–µ–≤—ñ–¥–æ–º–æ–≥–æ –º–∞–π—Å—Ç—Ä–∞',   emoji:'üñºÔ∏è', rarity:'common', value:17500},
      {name:'–§–∞—Ä—Ñ–æ—Ä–æ–≤–∞ –ª—è–ª—å–∫–∞',             emoji:'ü™Ü', rarity:'common', value:18000},
      {name:'–°—Ç–∞—Ä–∏–π –∫–∏—à–µ–Ω—å–∫–æ–≤–∏–π –≥–æ–¥–∏–Ω–Ω–∏–∫',  emoji:'‚è±Ô∏è', rarity:'common', value:19000},
      {name:'–õ–∞—Ç—É–Ω–Ω–∏–π –∫–∞–ª–µ–π–¥–æ—Å–∫–æ–ø',         emoji:'üîÆ', rarity:'common', value:20000},
      {name:'–ö–∞–º—ñ–Ω—å –∑ –ø–µ—Ç—Ä–æ–≥–ª—ñ—Ñ–∞–º–∏',        emoji:'ü™®', rarity:'common', value:21000},
      {name:'–°—Ç–∞—Ä–æ–≤–∏–Ω–Ω–∞ —Å–∫—Ä–∏–Ω—è',            emoji:'üì¶', rarity:'common', value:21500},
      {name:'–ö–æ–ª–µ–∫—Ü—ñ—è –∑–∞—Å—É—à–µ–Ω–∏—Ö –º–µ—Ç–µ–ª–∏–∫—ñ–≤', emoji:'ü¶ã', rarity:'common', value:22000},
      {name:'–ú–æ–Ω–æ–∫–ª—å —É –∑–æ–ª–æ—Ç—ñ–π –æ–ø—Ä–∞–≤—ñ',     emoji:'üßê', rarity:'common', value:22000},
      {name:'–®–∫—ñ—Ä—è–Ω–∞ –ø–∞–ø–∫–∞',               emoji:'üìÅ', rarity:'common', value:22000},
      {name:'–ì—ñ–ø—Å–æ–≤–∞ –º–∞—Å–∫–∞',               emoji:'üé≠', rarity:'common', value:22000},
      {name:'–ú–µ–¥–∞–ª—å–π–æ–Ω –ø—ñ–¥ —Ñ–æ—Ç–æ',           emoji:'üìø', rarity:'common', value:22000},
      // Rare (15)
      {name:'–ö–∞—Ç–∞–Ω–∞ –ø–µ—Ä—ñ–æ–¥—É –ï–¥–æ',           emoji:'‚öîÔ∏è', rarity:'rare',   value:40000},
      {name:'–ö–∞—Ä—Ç–∞ —Å–≤—ñ—Ç—É –Ω–∞ –ø–µ—Ä–≥–∞–º–µ–Ω—Ç—ñ',    emoji:'üó∫Ô∏è', rarity:'rare',   value:42000},
      {name:'Beatles First Press –≤—ñ–Ω—ñ–ª',    emoji:'üéµ', rarity:'rare',   value:44000},
      {name:'–ù–∞–±—ñ—Ä –≤–æ—Å–∫–æ–≤–∏—Ö –ø–µ—á–∞—Ç–æ–∫',       emoji:'üíå', rarity:'rare',   value:46000},
      {name:'–°—Ä—ñ–±–Ω–∞ —á–∞—à–∞ –í—ñ–∫—Ç–æ—Ä—ñ–∞–Ω—Å—å–∫–∞',   emoji:'üèÜ', rarity:'rare',   value:48000},
      {name:'–°—Ç–∞—Ä–æ–≤–∏–Ω–Ω–∏–π –º—ñ–∫—Ä–æ—Å–∫–æ–ø –ª–∞—Ç—É–Ω—å',emoji:'üî¨', rarity:'rare',   value:50000},
      {name:'–ù–∞–±—ñ—Ä –∫–∞–ª—ñ–≥—Ä–∞—Ñ—ñ—ó XIX —Å—Ç',      emoji:'‚úçÔ∏è', rarity:'rare',   value:52000},
      {name:'–í–∞–∑–∞ –¥–∏–Ω–∞—Å—Ç—ñ—ó –ú—ñ–Ω',           emoji:'üè∫', rarity:'rare',   value:54000},
      {name:'–ë—Ä–æ–Ω–∑–æ–≤–∞ —Å—Ç–∞—Ç—É–µ—Ç–∫–∞ –ë—É–¥–¥–∏',     emoji:'üôè', rarity:'rare',   value:55000},
      {name:'–ü–µ—Ä—à–∞ –∫–∞–º–µ—Ä–∞ Leica',           emoji:'üì∑', rarity:'rare',   value:56000},
      {name:'–ö–æ–º–ø–∞—Å –∫–∞–ø—ñ—Ç–∞–Ω–∞',              emoji:'üß≠', rarity:'rare',   value:57000},
      {name:'–ö–Ω–∏–≥–∞ –∑ –∞–≤—Ç–æ–≥—Ä–∞—Ñ–æ–º',           emoji:'üìï', rarity:'rare',   value:58000},
      {name:'–ì—Ä–∞–º–æ—Ñ–æ–Ω –ø–æ—á–∞—Ç–∫—É XX —Å—Ç',       emoji:'üìª', rarity:'rare',   value:59000},
      {name:'–°–∫—Ä–∏–Ω—å–∫–∞ –∑ —ñ–Ω–∫—Ä—É—Å—Ç–∞—Ü—ñ—î—é',      emoji:'üíé', rarity:'rare',   value:60000},
      {name:'–°—Ä—ñ–±–Ω—ñ —Å—Ç–æ–ª–æ–≤—ñ –ø—Ä–∏–ª–∞–¥–∏',       emoji:'üç¥', rarity:'rare',   value:60000},
      // Epic (7)
      {name:'–õ–∏—Ü–∞—Ä—Å—å–∫–∏–π –æ–±–ª–∞–¥—É–Ω–æ–∫ XVI —Å—Ç',  emoji:'üõ°Ô∏è', rarity:'epic',   value:200000},
      {name:'–ê–Ω—Ç–∏–∫–≤–∞—Ä–Ω–∏–π –ø—ñ–¥–ª–æ–≥–æ–≤–∏–π –≥–æ–¥–∏–Ω', emoji:'üï∞Ô∏è', rarity:'epic',   value:220000},
      {name:'–î–∞–≤–Ω—å–æ—Ä–∏–º—Å—å–∫–∞ —Ñ—ñ–±—É–ª–∞ –∑ –∑–æ–ª–æ—Ç–∞',emoji:'üèÖ', rarity:'epic',   value:240000},
      {name:'–ü–µ—Ä—Å—å–∫—ñ –∫–∏–ª–∏–º–∏ —Ä—É—á–Ω–æ—ó —Ä–æ–±–æ—Ç–∏', emoji:'ü™û', rarity:'epic',   value:260000},
      {name:'–ü–µ—Ä—à–∞ –º–∞—à–∏–Ω–∫–∞ Remington',      emoji:'‚å®Ô∏è', rarity:'epic',   value:280000},
      {name:'–ö–æ–ª–µ–∫—Ü—ñ–π–Ω–µ –≤–∏–Ω–æ 1945 —Ä–æ–∫—É',    emoji:'üç∑', rarity:'epic',   value:290000},
      {name:'–ú–æ—Ä—Å—å–∫–∏–π —Ö—Ä–æ–Ω–æ–º–µ—Ç—Ä',           emoji:'‚è±Ô∏è', rarity:'epic',   value:300000},
      // Legendary (3)
      {name:'–ó–æ–ª–æ—Ç–∏–π —Å—Ç–∞—Ç–µ—Ä –ú–∞–∫–µ–¥–æ–Ω—Å—å–∫–æ–≥–æ', emoji:'ü™ô', rarity:'legendary', value:750000},
      {name:'–§—Ä–∞–≥–º–µ–Ω—Ç —Å–ø—Ä–∞–≤–∂–Ω—å–æ–≥–æ –º–µ—Ç–µ–æ—Ä–∏—Ç–∞',emoji:'‚òÑÔ∏è',rarity:'legendary', value:825000},
      {name:'–û—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ "–ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω—ñ –Ω–∞—á–∞–ª–∞"',emoji:'üìú',rarity:'legendary', value:900000},
    ]},

  { id:'mbox4', name:'Cyberpunk Vibe', icon:'ü§ñ', price:200000,
    desc:'–ù–µ–æ-–º–∞–π–±—É—Ç–Ω—î –≤–∂–µ —Ç—É—Ç', color:'#ec4899',
    items:[
      // Common (20)
      {name:'–ù–µ–æ–Ω–æ–≤–∞ –º–∞—Å–∫–∞ –¥–ª—è –≤–µ—á—ñ—Ä–æ–∫',    emoji:'üé≠', rarity:'common', value:18000},
      {name:'–ü–ª–∞–∫–∞—Ç –∑—ñ —Å–≤—ñ—Ç–ª–æ–¥—ñ–æ–¥–∞–º–∏',      emoji:'üí°', rarity:'common', value:19000},
      {name:'–°–∫–ª—è–Ω–∞ —Ñ–ª–µ—à–∫–∞ –Ω–µ–æ–Ω',           emoji:'üíæ', rarity:'common', value:20000},
      {name:'–ö–∞–±–µ–ª—å —É —Å—Ç–∞–ª–µ–≤—ñ–π –æ–ø–ª—ñ—Ç—Ü—ñ',    emoji:'üîå', rarity:'common', value:21000},
      {name:'–ù–∞–≤—É—à–Ω–∏–∫–∏ Cat-ear RGB',        emoji:'üéß', rarity:'common', value:22000},
      {name:'–†—É–∫–∞–≤–∏—á–∫–∞ –∑ –¥–∞—Ç—á–∏–∫–∞–º–∏',        emoji:'üß§', rarity:'common', value:23000},
      {name:'–ë—Ä–∞—Å–ª–µ—Ç E-ink –µ–∫—Ä–∞–Ω',          emoji:'‚åö', rarity:'common', value:24000},
      {name:'–°—Ç—ñ–∫–µ—Ä–ø–∞–∫ "Glitch art"',       emoji:'üé®', rarity:'common', value:25000},
      {name:'Cyber-Fuel –∫–µ–π—Å –Ω–∞–ø–æ—ó–≤',       emoji:'ü•§', rarity:'common', value:26000},
      {name:'–ö–∏–ª–∏–º–æ–∫ –±–µ–∑–¥—Ä–æ—Ç–æ–≤–∞ –∑–∞—Ä—è–¥–∫–∞',   emoji:'üñ•Ô∏è', rarity:'common', value:27000},
      {name:'–í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä –ü–ö –∑ –≥–æ–ª–æ–≥—Ä–∞–º–æ—é',   emoji:'üåÄ', rarity:'common', value:27500},
      {name:'–ü—ñ–¥—Å—Ç–∞–≤–∫–∞ –≥–∞—Ä–Ω—ñ—Ç—É—Ä–∏ "Hand"',   emoji:'üñêÔ∏è', rarity:'common', value:28000},
      {name:'USB-—Ö–∞–± —É —Ñ–æ—Ä–º—ñ —è–¥—Ä–∞',         emoji:'‚öõÔ∏è', rarity:'common', value:28500},
      {name:'–ü–∞—Å–ø–æ—Ä—Ç "Netrunner"',          emoji:'üìã', rarity:'common', value:29000},
      {name:'–ó–∞–ø–∞–ª—å–Ω–∏—á–∫–∞ –ø–ª–∞–∑–º–æ–≤–∞',         emoji:'üî•', rarity:'common', value:29500},
      {name:'–û–∫—É–ª—è—Ä–∏ "Cyclops"',            emoji:'üï∂Ô∏è', rarity:'common', value:30000},
      {name:'–ë—Ä–µ–ª–æ–∫-—Ç–æ–∫–µ–Ω',                 emoji:'üîë', rarity:'common', value:30000},
      {name:'–õ—ñ—Ö—Ç–∞—Ä–∏–∫ 5000Lm',             emoji:'üî¶', rarity:'common', value:30000},
      {name:'–ó–Ω–∞—á–æ–∫ "High Tech Low Life"',  emoji:'üìå', rarity:'common', value:30000},
      {name:'–ß–æ—Ö–æ–ª –∑ –º—ñ–∫—Ä–æ—Å—Ö–µ–º–∞–º–∏',         emoji:'üì±', rarity:'common', value:30000},
      // Rare (15)
      {name:'AR-–æ–∫—É–ª—è—Ä–∏ Nreal Air 2 Ultra', emoji:'ü•Ω', rarity:'rare',   value:55000},
      {name:'–ö–ª–∞–≤—ñ–∞—Ç—É—Ä–∞ —Ä—ñ–¥–∫–∏–π –º–µ—Ç–∞–ª',      emoji:'‚å®Ô∏è', rarity:'rare',   value:58000},
      {name:'–°–º–∞—Ä—Ç-–¥–∑–µ—Ä–∫–∞–ª–æ –∑ –º–µ—Ä–µ–∂–µ—é',    emoji:'ü™û', rarity:'rare',   value:62000},
      {name:'–¢–µ–ø–ª–æ–≤—ñ–∑–æ—Ä-–º–æ–Ω–æ–∫–ª—å –ø—Ä–µ–º—ñ—É–º',   emoji:'üëÅÔ∏è', rarity:'rare',   value:65000},
      {name:'–ù–µ–æ–Ω–æ–≤—ñ –≤–∏–≤—ñ—Å–∫–∏ –∫–∞—Å—Ç–æ–º–Ω—ñ',     emoji:'üí°', rarity:'rare',   value:68000},
      {name:'Steam Deck 3 (—Ä–µ–ø–ª—ñ–∫–∞)',        emoji:'üéÆ', rarity:'rare',   value:71000},
      {name:'–ö–∞—Ç–∞–Ω–∞ –∑ –ª–∞–∑–µ—Ä–Ω–∏–º –ª–µ–∑–æ–º',      emoji:'‚öîÔ∏è', rarity:'rare',   value:74000},
      {name:'–ö–∏–±–µ—Ä-–¥–µ–∫–∞ –∫–æ–º–ø º—é—Ç–µ—Ä',         emoji:'üíª', rarity:'rare',   value:76000},
      {name:'–ú–∞—Å–∫–∞ —Å–∞–º—É—Ä–∞—è-–∫—ñ–±–æ—Ä–≥–∞',        emoji:'üé≠', rarity:'rare',   value:78000},
      {name:'–ù–∞–≤—É—à–Ω–∏–∫–∏ –∫—ñ—Å—Ç–∫–æ–≤–∞ –ø—Ä–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å',emoji:'üéß',rarity:'rare',   value:80000},
      {name:'–†—é–∫–∑–∞–∫ LED-–ø–∞–Ω–µ–ª—å 4K',         emoji:'üéí', rarity:'rare',   value:81000},
      {name:'–ö—Ä–æ—Å—ñ–≤–∫–∏ –∞–≤—Ç–æ-—à–Ω—É—Ä—ñ–≤–∫–∞',       emoji:'üëü', rarity:'rare',   value:82000},
      {name:'–†–æ–∑—É–º–Ω–∏–π —Ä–µ—Å–ø—ñ—Ä–∞—Ç–æ—Ä',          emoji:'üò∑', rarity:'rare',   value:83000},
      {name:'–ü–ª–∞–∑–º–æ–≤–∞ –ª–∞–º–ø–∞ –≥—ñ–≥–∞–Ω—Ç',        emoji:'‚ö°', rarity:'rare',   value:84000},
      {name:'–ì–æ–¥–∏–Ω–Ω–∏–∫ –≥–∞–∑–æ—Ä–æ–∑—Ä—è–¥–Ω—ñ —ñ–Ω–¥–∏–∫',  emoji:'‚è∞', rarity:'rare',   value:85000},
      // Epic (7)
      {name:'Cyber-PC Super-Nova –≤–æ–¥—è–Ω–µ –æ—Ö–æ–ª',emoji:'üíª',rarity:'epic',  value:350000},
      {name:'–ö—É—Ä—Ç–∫–∞ —Å–º–∞—Ä—Ç-—Ç–∫–∞–Ω–∏–Ω–∞ –µ–∫—Ä–∞–Ω–∏',  emoji:'üß•', rarity:'epic',   value:400000},
      {name:'Nanoleaf Limited Edition',     emoji:'üí°', rarity:'epic',   value:440000},
      {name:'–¢—É—Ä–µ–ª—å-–æ—Ö–æ—Ä–æ–Ω–µ—Ü—å (–º—É–ª—è–∂)',      emoji:'üî´', rarity:'epic',   value:480000},
      {name:'–†–æ–∑—É–º–Ω–∞ —Ç–∞—Ç—É-–º–∞—à–∏–Ω–∞ –®–Ü',       emoji:'üé®', rarity:'epic',   value:510000},
      {name:'–®–æ–ª–æ–º –ø—ñ–ª–æ—Ç–∞ AR-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å',    emoji:'ü™ñ', rarity:'epic',   value:540000},
      {name:'–ë—ñ–æ-—Ä–µ–∞–∫—Ç–æ—Ä –¥–ª—è –º–æ—Ö—É',         emoji:'üåø', rarity:'epic',   value:550000},
      // Legendary (3)
      {name:'–ï–ª–µ–∫—Ç—Ä–æ–±–∞–π–∫ "Neo-Tokyo"',      emoji:'üèçÔ∏è', rarity:'legendary', value:1000000},
      {name:'–ë—ñ–æ–Ω—ñ—á–Ω–∏–π –ø—Ä–æ—Ç–µ–∑ —Ä—É–∫–∏ (–¥–µ–∫–æ—Ä)',emoji:'ü¶æ', rarity:'legendary', value:1100000},
      {name:'–°–∏—Å—Ç–µ–º–∞ VR –ø–æ–≤–Ω–æ–≥–æ –∑–∞–Ω—É—Ä–µ–Ω–Ω—è', emoji:'ü•Ω', rarity:'legendary', value:1200000},
    ]},

  { id:'mbox5', name:'Fortune Teller', icon:'üîÆ', price:250000,
    desc:'–î–æ–ª—è, —É–¥–∞—á–∞ —ñ –∑–æ–ª–æ—Ç–æ –Ω–∞ –∫–æ–∂–Ω–æ–º—É –∫—Ä–æ—Ü—ñ', color:'#f5c842',
    items:[
      // Common (20)
      {name:'–ó–æ–ª–æ—Ç–∞ –ø—ñ–¥–∫–æ–≤–∞ –Ω–∞ —É–¥–∞—á—É',      emoji:'ü™Ñ', rarity:'common', value:25000},
      {name:'–ö–Ω–∏–≥–∞ –∑–∞–∫–ª—è—Ç—å –ø—Ä–µ–º—ñ—É–º',        emoji:'üìñ', rarity:'common', value:26000},
      {name:'–ê–º—É–ª–µ—Ç "–û–∫–æ"',                emoji:'üëÅÔ∏è', rarity:'common', value:27000},
      {name:'–ú–æ–Ω–µ—Ç–∞ –∑ –≥—Ä–∞–≤—ñ—é–≤–∞–Ω–Ω—è–º',        emoji:'ü™ô', rarity:'common', value:28000},
      {name:'–ê—Ä–æ–º–∞—Ç–∏—á–Ω—ñ —Å–≤—ñ—á–∫–∏ Luxury',     emoji:'üïØÔ∏è', rarity:'common', value:29000},
      {name:'–ì—Ä–∞–ª—å–Ω—ñ –∫–æ—Å—Ç—ñ –∑ –ø–æ–∑–æ–ª–æ—Ç–æ—é',    emoji:'üé≤', rarity:'common', value:30000},
      {name:'–ú–∞—è—Ç–Ω–∏–∫ –¥–ª—è –ª–æ–∑–æ—Ö–æ–¥—Å—Ç–≤–∞',      emoji:'‚öñÔ∏è', rarity:'common', value:31000},
      {name:'–®–∫—ñ—Ä—è–Ω–∏–π –º—ñ—à–µ—á–æ–∫ –¥–ª—è –º–æ–Ω–µ—Ç',   emoji:'üëõ', rarity:'common', value:32000},
      {name:'–†—É–Ω—ñ—á–Ω—ñ –∫–∞–º–µ–Ω—ñ –∑ –∞–≥–∞—Ç—É',       emoji:'üîÆ', rarity:'common', value:33000},
      {name:'–°—ñ–ª—å –¥–ª—è –≤–∞–Ω–Ω "Magic Relax"',  emoji:'üõÅ', rarity:'common', value:34000},
      {name:'–ß–æ—Ä–Ω–µ –ø–µ—Ä–æ –≤–æ—Ä–æ–Ω–∞ (–¥–µ–∫–æ—Ä)',    emoji:'ü™∂', rarity:'common', value:35000},
      {name:'–ü—ñ–¥—Å—Ç–∞–≤–∫–∞ –ø—ñ–¥ –∫—É–ª—é',           emoji:'üîÆ', rarity:'common', value:36000},
      {name:'–ù–∞–±—ñ—Ä –µ—Ñ—ñ—Ä–Ω–∏—Ö –º–∞—Å–µ–ª',          emoji:'üåø', rarity:'common', value:37000},
      {name:'–ú–µ—Ç–∞–ª–µ–≤–∞ –∫–∞—Ä—Ç–∫–∞ VIP',          emoji:'üí≥', rarity:'common', value:38000},
      {name:'–ö—Ä–∏—à—Ç–∞–ª–µ–≤–∞ –ø—ñ—Ä–∞–º—ñ–¥–∞',          emoji:'üî∫', rarity:'common', value:39000},
      {name:'–ë—Ä–∞—Å–ª–µ—Ç —á–µ—Ä–≤–æ–Ω–∞ –Ω–∏—Ç–∫–∞+–∑–æ–ª–æ—Ç–æ', emoji:'üìø', rarity:'common', value:39500},
      {name:'–ü–æ–¥—É—à–∫–∞ –¥–ª—è –º–µ–¥–∏—Ç–∞—Ü—ñ—ó',        emoji:'üßò', rarity:'common', value:40000},
      {name:'–ö—É—Ä–∏–ª—å–Ω–∏—Ü—è –¥–ª—è –ø–∞—Ö–æ—â—ñ–≤',       emoji:'ü´ß', rarity:'common', value:40000},
      {name:'–ú–∞–≥—ñ—á–Ω–∏–π –ø—ñ—Å–æ–∫ —É –∫–æ–ª–±—ñ',       emoji:'‚è≥', rarity:'common', value:40000},
      {name:'–õ–æ–≤–µ—Ü—å —Å–Ω—ñ–≤ –µ–∫–∑–æ—Ç–∏—á–Ω–∏–π',       emoji:'üåô', rarity:'common', value:40000},
      // Rare (15)
      {name:'–°—Ä—ñ–±–Ω–∏–π –∫—É–±–æ–∫ –ø–µ—Ä–µ–º–æ–∂—Ü—è',      emoji:'üèÜ', rarity:'rare',   value:70000},
      {name:'–®–∞—Ö–∏ –Ω–µ—Ñ—Ä–∏—Ç —Ç–∞ –º–∞—Ä–º—É—Ä',        emoji:'‚ôüÔ∏è', rarity:'rare',   value:73000},
      {name:'–ö–∞—Ä—Ç–∏ –¢–∞—Ä–æ –∑–æ–ª–æ—Ç–µ —Ç–∏—Å–Ω–µ–Ω–Ω—è',   emoji:'üÉè', rarity:'rare',   value:76000},
      {name:'–°—Ç–∞—Ç—É–µ—Ç–∫–∞ –±–æ–≥–∏–Ω—ñ –§–æ—Ä—Ç—É–Ω–∏',     emoji:'üèõÔ∏è', rarity:'rare',   value:79000},
      {name:'–ú–æ–Ω–µ—Ç–∞ "Double Eagle"',        emoji:'ü™ô', rarity:'rare',   value:82000},
      {name:'–ö—É–±–∏–∫–∏ –∑ –∫—ñ—Å—Ç–∫–∏ –º–∞–º–æ–Ω—Ç–∞',      emoji:'üé≤', rarity:'rare',   value:84000},
      {name:'–ö–Ω–∏–≥–∞ –ø—Ä–æ—Ä–æ—Ü—Ç–≤ –∞–Ω—Ç–∏–∫–≤–∞—Ä–Ω–∞',    emoji:'üìú', rarity:'rare',   value:86000},
      {name:'–ú–∞–≥—ñ—á–Ω–∏–π –∞–º—É–ª–µ—Ç –∑ —Ä—É–±—ñ–Ω–æ–º',    emoji:'üíé', rarity:'rare',   value:88000},
      {name:'–°—Ä—ñ–±–Ω–µ –¥–∑–µ—Ä–∫–∞–ª–æ –≤–æ—Ä–æ–∂—ñ–Ω–Ω—è',    emoji:'ü™û', rarity:'rare',   value:90000},
      {name:'–®–∞—Ñ–∫–∞ –º–∞–≥—ñ—á–Ω–∏—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ñ–≤',    emoji:'üóÑÔ∏è', rarity:'rare',   value:92000},
      {name:'–ü—ñ–¥–∫–æ–≤–∞ 24-–∫–∞—Ä–∞—Ç–Ω–µ –ø–æ–∫—Ä–∏—Ç—Ç—è',  emoji:'üê¥', rarity:'rare',   value:93000},
      {name:'–ö—ñ–ª—å—Ü–µ –∑ —Ç–∞—î–º–Ω–∏–º –∑–Ω–∞–∫–æ–º',      emoji:'üíç', rarity:'rare',   value:95000},
      {name:'–ß–æ—Ä–Ω–∞ –ø–µ—Ä–ª–∏–Ω–∞ –≤ —Ä–∞–∫–æ–≤–∏–Ω—ñ',     emoji:'ü¶™', rarity:'rare',   value:97000},
      {name:'–õ–∞–º–ø–∞ –ê–ª–∞–¥–¥—ñ–Ω–∞ –ø–æ–∑–æ–ª–æ—Ç–∞',      emoji:'ü™î', rarity:'rare',   value:98000},
      {name:'–ö–∞—Ä—Ç–∞ —Å–∫–∞—Ä–±—ñ–≤ –Ω–∞ —à–∫—ñ—Ä—ñ',       emoji:'üó∫Ô∏è', rarity:'rare',   value:100000},
      // Epic (7)
      {name:'–ö–∞—Ä—Ç–∞ "–ó–æ–ª–æ—Ç–∏–π –î–∂–æ–∫–µ—Ä"',       emoji:'üÉè', rarity:'epic',   value:500000},
      {name:'–ö—Ä–∏—à—Ç–∞–ª–µ–≤–∞ –∫—É–ª—è –∫–≤–∞—Ä—Ü',        emoji:'üîÆ', rarity:'epic',   value:570000},
      {name:'–§—ñ—à–∫–∏ –∫–∞–∑–∏–Ω–æ –õ–∞—Å-–í–µ–≥–∞—Å 1950—Ö', emoji:'üé∞', rarity:'epic',   value:640000},
      {name:'–ö–∞—Ä—Ç–∏–Ω–∞ "–§–æ—Ä—Ç—É–Ω–∞" –∑–æ–ª–æ—Ç–∞ —Ä–∞–º–∞',emoji:'üñºÔ∏è', rarity:'epic',   value:700000},
      {name:'–ù–∞–±—ñ—Ä –¥–ª—è –ø–æ–∫–µ—Ä—É –∫—Ä–æ–∫–æ–¥–∏–ª',    emoji:'üé¥', rarity:'epic',   value:740000},
      {name:'–°–∫—É–ª—å–ø—Ç—É—Ä–∞ "–ó–æ–ª–æ—Ç–∏–π –¢–µ–ª–µ—Ü—å"',  emoji:'üêÇ', rarity:'epic',   value:770000},
      {name:'–ì–æ–¥–∏–Ω–Ω–∏–∫-—Å–∫–µ–ª–µ—Ç–æ–Ω —Ä—É—á–Ω–∞ —Ä–æ–±–æ—Ç–∞',emoji:'‚åö',rarity:'epic',   value:800000},
      // Legendary (3)
      {name:'–ó–æ–ª–æ—Ç–∏–π –∑–ª–∏—Ç–æ–∫ 2.5–∫–≥',         emoji:'ü•á', rarity:'legendary', value:1250000},
      {name:'–ë–ª–∞–∫–∏—Ç–Ω–∏–π –¥—ñ–∞–º–∞–Ω—Ç 3 –∫–∞—Ä–∞—Ç–∏',   emoji:'üíé', rarity:'legendary', value:1375000},
      {name:'–ö–ª—é—á VIP-–ª–æ–∂—ñ –∫–∞–∑–∏–Ω–æ –Ω–∞–∑–∞–≤–∂–¥–∏',emoji:'üóùÔ∏è', rarity:'legendary', value:1500000},
    ]},
];



// =================== MARKET PULSE AI ===================
// Phase-based growth rates per minute
function getRivalGrowthRate(net) {
  if (net < 100_000_000_000)  return 0.0040;  // < 100B ‚Üí +0.4%/—Ö–≤
  if (net < 250_000_000_000)  return 0.0015;  // 100‚Äì250B ‚Üí +0.15%/—Ö–≤
  return 0.0002;                               // > 250B ‚Üí +0.02%/—Ö–≤
}

// –ü–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –∫—Ä–∏–∑–æ–≤—ñ –ø–æ–¥—ñ—ó –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –º—ñ–ª—å—è—Ä–¥–µ—Ä–∞
const RIVAL_CRISIS_EVENTS = {
  '–Ü–ª–æ–Ω –ú–∞—Å–∫': [
    { text: '–°–∫–∞–Ω–¥–∞–ª—å–Ω–∏–π —Ç–≤—ñ—Ç –æ–±–≤–∞–ª–∏–≤ –∞–∫—Ü—ñ—ó Tesla –Ω–∞ 12%', loss: 0.025 },
    { text: 'SEC —Ä–æ–∑–ø–æ—á–∞–ª–æ –∫—Ä–∏–º—ñ–Ω–∞–ª—å–Ω–µ —Ä–æ–∑—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è SpaceX', loss: 0.018 },
    { text: 'Twitter/X –∑–∞—Ñ—ñ–∫—Å—É–≤–∞–≤ —Ä–µ–∫–æ—Ä–¥–Ω–∏–π –≤—ñ–¥—Ç—ñ–∫ —Ä–µ–∫–ª–∞–º–æ–¥–∞–≤—Ü—ñ–≤', loss: 0.014 },
    { text: '–ü—Ä–æ–≤–∞–ª –∑–∞–ø—É—Å–∫—É Starship ‚Äî —Å—Ç—Ä–∞—Ö–æ–≤–∏–π –∑–±–∏—Ç–æ–∫ $3B', loss: 0.020 },
    { text: '–ú–∞—Å–∫ –ø—Ä–æ–≥—Ä–∞–≤ –º–µ–≥–∞—Å—É–¥–æ–≤–∏–π –ø–æ–∑–æ–≤ –∞–∫—Ü—ñ–æ–Ω–µ—Ä—ñ–≤ Tesla', loss: 0.022 },
    { text: '–†–æ–∑–ø—Ä–æ–¥–∞–∂ –∞–∫—Ü—ñ–π Tesla —Ç–æ–ø-–º–µ–Ω–µ–¥–∂–µ—Ä–∞–º–∏ –æ–±–≤–∞–ª–∏–≤ –∫—É—Ä—Å', loss: 0.016 },
    { text: 'Neuralink –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ –≤ –Ñ–° —á–µ—Ä–µ–∑ –ø–æ—Ä—É—à–µ–Ω–Ω—è –±—ñ–æ–µ—Ç–∏–∫–∏', loss: 0.010 },
    { text: '–£—Ä—è–¥ –°–®–ê —Å–∫–∞—Å—É–≤–∞–≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç SpaceX –Ω–∞ $8B', loss: 0.019 },
    { text: '–ú–∞—Å–æ–≤—ñ –∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –≤ Tesla —Å–ø—Ä–æ–≤–æ–∫—É–≤–∞–ª–∏ —Å—Ç—Ä–∞–π–∫', loss: 0.012 },
    { text: '–†–µ–π—Ç–∏–Ω–≥–æ–≤—ñ –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞ –∑–Ω–∏–∑–∏–ª–∏ –æ—Ü—ñ–Ω–∫—É Tesla –¥–æ "—Å–º—ñ—Ç—Ç—î–≤–æ–≥–æ"', loss: 0.017 },
  ],
  '–î–∂–µ—Ñ—Ñ –ë–µ–∑–æ—Å': [
    { text: '–Ñ–° –≤–∏–ø–∏—Å–∞–≤ Amazon –∞–Ω—Ç–∏–º–æ–Ω–æ–ø–æ–ª—å–Ω–∏–π —à—Ç—Ä–∞—Ñ ‚Ç¨8.25B', loss: 0.015 },
    { text: 'AWS –∑–∞–∑–Ω–∞–≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∑–±–æ—é ‚Äî –∫–ª—ñ—î–Ω—Ç–∏ –º–∞—Å–æ–≤–æ –π–¥—É—Ç—å', loss: 0.012 },
    { text: '–°—Ç—Ä–∞–π–∫ 350,000 –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤ Amazon –ø–∞—Ä–∞–ª—ñ–∑—É–≤–∞–≤ —Å–∫–ª–∞–¥–∏', loss: 0.009 },
    { text: 'Blue Origin –≤–∏–±—É—Ö–Ω—É–≤ –ø—ñ–¥ —á–∞—Å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–æ—Ç—É', loss: 0.022 },
    { text: '–ö–æ–Ω–≥—Ä–µ—Å –°–®–ê —Ä–æ–∑–ø–æ—á–∞–≤ —Å–ª—É—Ö–∞–Ω–Ω—è —â–æ–¥–æ –º–æ–Ω–æ–ø–æ–ª—ñ—ó Amazon', loss: 0.016 },
    { text: '–í–∏—Ç—ñ–∫ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö 200M –∫–ª—ñ—î–Ω—Ç—ñ–≤ Amazon', loss: 0.013 },
    { text: 'Amazon Prime –≤—Ç—Ä–∞—Ç–∏–≤ 40M –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤ –∑–∞ –∫–≤–∞—Ä—Ç–∞–ª', loss: 0.018 },
    { text: '–ë–µ–∑–æ—Å –ø—Ä–æ–≥—Ä–∞–≤ —Å—É–¥–æ–≤–∏–π –ø–æ–∑–æ–≤ —â–æ–¥–æ —É–º–æ–≤ –ø—Ä–∞—Ü—ñ', loss: 0.008 },
    { text: 'FTC –∑–∞–±–ª–æ–∫—É–≤–∞–ª–∞ –∑–ª–∏—Ç—Ç—è Amazon –∑ MGM Studios', loss: 0.011 },
    { text: 'Warehouse Robotics –ø—Ä–æ–µ–∫—Ç –ø—Ä–æ–≤–∞–ª–∏–≤—Å—è ‚Äî —Å–ø–∏—Å–∞–Ω–æ $4.5B', loss: 0.014 },
  ],
  '–ë–µ—Ä–Ω–∞—Ä –ê—Ä–Ω–æ': [
    { text: '–ö–∏—Ç–∞–π –≤–≤—ñ–≤ 45% –º–∏—Ç–æ –Ω–∞ –≤—Å—ñ –ø—Ä–æ–¥—É–∫—Ç–∏ LVMH', loss: 0.020 },
    { text: '–ü–æ–ª—ñ—Ü—ñ—è –≤–∏–ª—É—á–∏–ª–∞ 2M –ø—ñ–¥—Ä–æ–±–æ–∫ Louis Vuitton ‚Äî —Å–∫–∞–Ω–¥–∞–ª', loss: 0.013 },
    { text: '–ù–µ–≤–¥–∞–ª–µ –ø–æ–≥–ª–∏–Ω–∞–Ω–Ω—è Richemont ‚Äî –∑–±–∏—Ç–∫–∏ ‚Ç¨6B', loss: 0.021 },
    { text: '–ö–æ–ª–µ–∫—Ü—ñ—è Dior –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å ‚Äî –∫—Ä–∏—Ç–∏–∫–∏ —Ä–æ–∑–≥—Ä–æ–º–∏–ª–∏ –±—Ä–µ–Ω–¥', loss: 0.008 },
    { text: '–ê—Ä–Ω–æ –∑–≤–∏–Ω—É–≤–∞—á—É—é—Ç—å —É –∫–æ—Ä—É–ø—Ü—ñ–π–Ω—ñ–π —Å—Ö–µ–º—ñ —É –§—Ä–∞–Ω—Ü—ñ—ó', loss: 0.017 },
    { text: 'Christian Dior –≤—ñ–¥–∫–ª–∏–∫–∞–≤ –ø—Ä–æ–¥—É–∫—Ü—ñ—é —á–µ—Ä–µ–∑ —Ö—ñ–º—ñ—á–Ω–∏–π —Å–∫–∞–Ω–¥–∞–ª', loss: 0.011 },
    { text: 'Moet Hennessy –≤—Ç—Ä–∞—á–∞—î —Ä–∏–Ω–∫–æ–≤—É —á–∞—Å—Ç–∫—É –≤ –°–®–ê', loss: 0.009 },
    { text: '–°—Ç—Ä–∞–π–∫ 80,000 –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤ LVMH –ø–æ –≤—Å—ñ–π –§—Ä–∞–Ω—Ü—ñ—ó', loss: 0.014 },
    { text: 'Bulgari –ø—Ä–æ–≥—Ä–∞–≤ –ø–∞—Ç–µ–Ω—Ç–Ω–∏–π —Å—É–¥ ‚Äî –≤–∏–ø–ª–∞—Ç–∞ ‚Ç¨1.8B', loss: 0.012 },
    { text: '–ë–æ–π–∫–æ—Ç LVMH —É –Ø–ø–æ–Ω—ñ—ó –ø—ñ—Å–ª—è —Å–∫–∞–Ω–¥–∞–ª—å–Ω–∏—Ö –∑–∞—è–≤ –ê—Ä–Ω–æ', loss: 0.016 },
  ],
  '–ë—ñ–ª–ª –ì–µ–π—Ç—Å': [
    { text: '–°–∫–∞–Ω–¥–∞–ª —É Gates Foundation ‚Äî –≤—ñ–¥—Å—Ç–∞–≤–∫–∏ —Ä–∞–¥–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ–≤', loss: 0.011 },
    { text: '–í–µ–ª–∏–∫–∏–π –ø—Ä–æ–≥—Ä–∞—à –≤ —ñ–Ω–≤–µ—Å—Ç–∏—Ü—ñ–π–Ω–æ–º—É –ø–æ—Ä—Ç—Ñ–µ–ª—ñ Cascade', loss: 0.016 },
    { text: '–°—Ç–∞–≤–∫–∞ –Ω–∞ —Å—ñ–ª—å—Å—å–∫–æ–≥–æ—Å–ø–æ–¥–∞—Ä—Å—å–∫—ñ –∑–µ–º–ª—ñ –æ–±–µ—Ä–Ω—É–ª–∞—Å—å –∑–±–∏—Ç–∫–∞–º–∏', loss: 0.013 },
    { text: '–ê–Ω—Ç–∏–≤–∞–∫—Ü–∏–Ω–Ω–∏–π —Ä—É—Ö –ø–∞–ø–ª—é–∂–∏—Ç—å —Ñ–æ–Ω–¥ —É 40 –∫—Ä–∞—ó–Ω–∞—Ö', loss: 0.009 },
    { text: '–ß–µ—Ç–≤–µ—Ä—Ç–∏–π Foundation –ø–∞—Ä—Ç–Ω–µ—Ä –æ–≥–æ–ª–æ—Å–∏–≤ –±–∞–Ω–∫—Ä—É—Ç—Å—Ç–≤–æ', loss: 0.014 },
    { text: 'Microsoft (–ø–∞—Å–∏–≤–Ω–∞ —á–∞—Å—Ç–∫–∞) –ø—ñ–¥ —Å–ª—ñ–¥—Å—Ç–≤–æ–º DOJ', loss: 0.012 },
    { text: '–Ø–¥–µ—Ä–Ω–∏–π –ø—Ä–æ–µ–∫—Ç TerraPower –ø—Ä–∏–∑—É–ø–∏–Ω–µ–Ω–æ –Ω–∞ 5 —Ä–æ–∫—ñ–≤', loss: 0.018 },
    { text: '–ì–µ–π—Ç—Å–∞ —Å—É–¥—è—Ç—å –∑–∞ –ø—Ä–∏—Ö–æ–≤–∞–Ω—ñ –∞–∫—Ç–∏–≤–∏ –≤ –æ—Ñ—à–æ—Ä–∞—Ö', loss: 0.015 },
    { text: '–ú–µ—Ä–µ–∂–∞ —à–∫—ñ–ª Gates Foundation –∑–∞–∑–Ω–∞–ª–∞ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –∫—Ä–∞—Ö—É', loss: 0.010 },
    { text: 'Cascade Investment –ø—Ä–æ–≥—Ä–∞–≤ —Å—Ç–∞–≤–∫—É –Ω–∞ –Ω–∞—Ñ—Ç–æ–≤–∏–π —Å–µ–∫—Ç–æ—Ä', loss: 0.019 },
  ],
  '–õ–∞—Ä—Ä—ñ –ï–ª–ª—ñ—Å–æ–Ω': [
    { text: 'Oracle –ø—Ä–æ–≥—Ä–∞–≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç –ü–µ–Ω—Ç–∞–≥–æ–Ω—É –Ω–∞ $10B Microsoft', loss: 0.020 },
    { text: '–ì–ª–æ–±–∞–ª—å–Ω–∏–π –∑–±—ñ–π Oracle Cloud ‚Äî 6 –≥–æ–¥–∏–Ω –ø—Ä–æ—Å—Ç–æ—é', loss: 0.015 },
    { text: '–ö–æ–ª–∏—à–Ω—ñ –ø–∞—Ä—Ç–Ω–µ—Ä–∏ –ø–æ–¥–∞–ª–∏ –ø–æ–∑–æ–≤ –Ω–∞ –ï–ª–ª—ñ—Å–æ–Ω–∞ ‚Äî $2.3B', loss: 0.011 },
    { text: '–ö–≤–∞—Ä—Ç–∞–ª—å–Ω–∞ –∑–≤—ñ—Ç–Ω—ñ—Å—Ç—å Oracle: –ø—Ä–∏–±—É—Ç–æ–∫ –Ω–∏–∂—á–µ –ø—Ä–æ–≥–Ω–æ–∑—É –Ω–∞ 40%', loss: 0.022 },
    { text: 'Oracle –≤—Ç—Ä–∞—Ç–∏–ª–∞ –¥–µ—Ä–∂–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∏ –ø—ñ—Å–ª—è –≤–∏—Ç–æ–∫—É –¥–µ—Ä–∂–¥–∞–Ω–∏—Ö', loss: 0.017 },
    { text: 'TikTok —Ä–æ–∑—ñ—Ä–≤–∞–≤ —Ö–º–∞—Ä–Ω—É —É–≥–æ–¥—É –∑ Oracle', loss: 0.013 },
    { text: '–ú–∞—Å–æ–≤–∞ —Ö–≤–∏–ª—è –∑–≤—ñ–ª—å–Ω–µ–Ω—å –≤ Oracle ‚Äî –∞–∫—Ü—ñ—ó –ø–∞–¥–∞—é—Ç—å', loss: 0.009 },
    { text: '–ï–ª–ª—ñ—Å–æ–Ω –ø—Ä–æ–≥—Ä–∞–≤ —Å—É–¥–æ–≤–∏–π –ø–æ–∑–æ–≤ —â–æ–¥–æ –∞–≤—Ç–æ—Ä—Å—å–∫–∏—Ö –ø—Ä–∞–≤ Java', loss: 0.016 },
    { text: 'Oracle ERP –ø—Ä–æ–≤–∞–ª–∏–≤—Å—è —É 3 –≤–µ–ª–∏–∫–∏—Ö –±–∞–Ω–∫–∞—Ö –æ–¥–Ω–æ—á–∞—Å–Ω–æ', loss: 0.018 },
    { text: 'SEC —Ä–æ–∑—Å–ª—ñ–¥—É—î —ñ–Ω—Å–∞–π–¥–µ—Ä—Å—å–∫—ñ —É–≥–æ–¥–∏ –ï–ª–ª—ñ—Å–æ–Ω–∞', loss: 0.014 },
  ],
  '–£–æ—Ä—Ä–µ–Ω –ë–∞—Ñ—Ñ–µ—Ç': [
    { text: 'Berkshire Hathaway: —Ä–µ–∫–æ—Ä–¥–Ω—ñ –∑–±–∏—Ç–∫–∏ $28B –∑–∞ –∫–≤–∞—Ä—Ç–∞–ª', loss: 0.011 },
    { text: '–°—Ç–∞–≤–∫–∞ –Ω–∞ –∑–∞–ª—ñ–∑–Ω–∏—á–Ω—ñ –ø–µ—Ä–µ–≤–µ–∑–µ–Ω–Ω—è –æ–±–µ—Ä–Ω—É–ª–∞—Å—å –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–æ—é', loss: 0.016 },
    { text: '–ö–ª—é—á–æ–≤–∏–π –∞–∫—Ç–∏–≤ Berkshire ‚Äî Apple ‚Äî –æ–±–≤–∞–ª–∏–≤—Å—è –Ω–∞ 30%', loss: 0.020 },
    { text: '–ú–µ–¥—ñ–∞—Å–∫–∞–Ω–¥–∞–ª –∑ –¥–æ—á—ñ—Ä–Ω—å–æ—é –∫–æ–º–ø–∞–Ω—ñ—î—é Berkshire', loss: 0.009 },
    { text: '–°—Ç—Ä–∞—Ö–æ–≤–∏–π –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª Geico –∑–∞–∑–Ω–∞–≤ —Ä–µ–∫–æ—Ä–¥–Ω–∏—Ö –≤–∏–ø–ª–∞—Ç', loss: 0.014 },
    { text: '–ë–∞—Ñ—Ñ–µ—Ç –ø–æ–º–∏–ª–∏–≤—Å—è –∑—ñ —Å—Ç–∞–≤–∫–æ—é –Ω–∞ –±–∞–Ω–∫—ñ–≤—Å—å–∫–∏–π —Å–µ–∫—Ç–æ—Ä', loss: 0.017 },
    { text: 'Wells Fargo (—á–∞—Å—Ç–∫–∞ Berkshire) –ø—ñ–¥ –∫—Ä–∏–º—ñ–Ω–∞–ª—å–Ω–∏–º —Å–ª—ñ–¥—Å—Ç–≤–æ–º', loss: 0.013 },
    { text: 'Berkshire Energy –ø—Ä–æ–≥—Ä–∞–ª–∞ —Ä–µ–≥—É–ª—è—Ç–æ—Ä–Ω—É –±–∏—Ç–≤—É –≤ 5 —à—Ç–∞—Ç–∞—Ö', loss: 0.012 },
    { text: '–†–∏–Ω–æ–∫ —Ä–æ–∑–∫—Ä–∏—Ç–∏–∫—É–≤–∞–≤ —Ä—ñ—à–µ–Ω–Ω—è –ë–∞—Ñ—Ñ–µ—Ç–∞ —É—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –≥–æ—Ç—ñ–≤–∫—É', loss: 0.008 },
    { text: '–Ü–Ω–≤–µ—Å—Ç–∏—Ü—ñ—è –≤ —è–ø–æ–Ω—Å—å–∫—ñ —Ç–æ—Ä–≥–æ–≤—ñ –¥–æ–º–∏ –¥–∞–ª–∞ –Ω—É–ª—å–æ–≤–∏–π –¥–æ—Ö—ñ–¥', loss: 0.010 },
  ],
  '–õ–∞—Ä—Ä—ñ –ü–µ–π–¥–∂': [
    { text: 'DOJ –≤–∏–≥—Ä–∞–≤ –∞–Ω—Ç–∏–º–æ–Ω–æ–ø–æ–ª—å–Ω–∏–π —Å—É–¥ ‚Äî Google –∑–º—É—à–µ–Ω–∏–π —Ä–æ–∑–ø–∞—Å—Ç–∏—Å—å', loss: 0.022 },
    { text: '–ü–æ—à—É–∫ Google –∑–ª–∏–≤ 500M –∑–∞–ø–∏—Å—ñ–≤ ‚Äî —à—Ç—Ä–∞—Ñ ‚Ç¨12B', loss: 0.014 },
    { text: 'Google Bard –ø—Ä–æ–≤–∞–ª–∏–≤—Å—è ‚Äî ChatGPT –∑–∞–±–∏—Ä–∞—î 35% —Ä–∏–Ω–∫—É', loss: 0.016 },
    { text: '–Ñ–° –∑–∞–±–ª–æ–∫—É–≤–∞–≤ –∑–ª–∏—Ç—Ç—è Alphabet —ñ–∑ —Å—Ç–∞—Ä—Ç–∞–ø–æ–º –Ω–∞ $8B', loss: 0.011 },
    { text: 'YouTube –≤—Ç—Ä–∞—Ç–∏–≤ –Ω–∞–π–±—ñ–ª—å—à–∏—Ö —Ä–µ–∫–ª–∞–º–æ–¥–∞–≤—Ü—ñ–≤ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–Ω—Ç', loss: 0.013 },
    { text: 'Waymo –∑–∞–∑–Ω–∞–≤ —Å–µ—Ä—ñ—ó –∞–≤–∞—Ä—ñ–π ‚Äî –ª—ñ—Ü–µ–Ω–∑—ñ—é –ø—Ä–∏–∑—É–ø–∏–Ω–µ–Ω–æ', loss: 0.018 },
    { text: 'Google Cloud –ø—Ä–æ–≥—Ä–∞–≤ —Ç–µ–Ω–¥–µ—Ä —É—Ä—è–¥—É –°–®–ê AWS', loss: 0.015 },
    { text: '–ü—Ä–æ–µ–∫—Ç Loon –æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–∞–∫—Ä–∏—Ç–æ ‚Äî —Å–ø–∏—Å–∞–Ω–æ $4B', loss: 0.010 },
    { text: 'Alphabet –ø—Ä–æ–≥—Ä–∞–≤ –ø–∞—Ç–µ–Ω—Ç–Ω–∏–π –ø–æ–∑–æ–≤ Sonos –Ω–∞ $1.67B', loss: 0.009 },
    { text: 'Google Play –ø—ñ–¥ —Å–ª—ñ–¥—Å—Ç–≤–æ–º –∑–∞ –Ω–µ—á–µ—Å–Ω—ñ –∫–æ–º—ñ—Å—ñ—ó 30%', loss: 0.012 },
  ],
  '–°–µ—Ä–≥—ñ–π –ë—Ä—ñ–Ω': [
    { text: 'Waymo —Å–ø—Ä–∏—á–∏–Ω–∏–≤ —Å–º–µ—Ä—Ç–µ–ª—å–Ω—É –î–¢–ü ‚Äî –º–∞—Å–æ–≤—ñ –ø–æ–∑–æ–≤–∏', loss: 0.020 },
    { text: '–Ñ–° –æ—à—Ç—Ä–∞—Ñ—É–≤–∞–≤ Google Ads –Ω–∞ ‚Ç¨6.5B –∑–∞ –º–æ–Ω–æ–ø–æ–ª—ñ–∑–º', loss: 0.017 },
    { text: '–ó–ª–∏—Ç—ñ –∞–ª–≥–æ—Ä–∏—Ç–º–∏ Google Search –ø—Ä–æ–¥–∞–Ω–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º', loss: 0.015 },
    { text: '–ü—Ä–æ–µ–∫—Ç Google Glass 2.0 –ø—Ä–æ–≤–∞–ª–∏–≤—Å—è –Ω–∞ —Å—Ç–∞—Ä—Ç—ñ', loss: 0.009 },
    { text: '–û—Å–æ–±–∏—Å—Ç—ñ –¥–∞–Ω—ñ –ë—Ä—ñ–Ω –∑–ª–∏—Ç—ñ —É –≤–µ–ª–∏–∫–æ–º—É –∑–ª–æ–º—ñ Google', loss: 0.011 },
    { text: '–ê–∫—Ü—ñ—ó Alphabet –æ–±–≤–∞–ª–∏–ª–∏—Å—å –ø—ñ—Å–ª—è –≤–∏—Ö–æ–¥—É –ü–µ–π–¥–∂–∞ –∑ —Ä–∞–¥–∏', loss: 0.013 },
    { text: 'Quantum AI –ø—Ä–æ–µ–∫—Ç –ø–æ—Ç—Ä–µ–±—É—î –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö $5B ‚Äî –∞–∫—Ü—ñ—ó –ø–∞–¥–∞—é—Ç—å', loss: 0.014 },
    { text: 'FTC —Ä–æ–∑–ø–æ—á–∞–ª–æ —Ä–æ–∑—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è —Ä–µ–∫–ª–∞–º–Ω–æ—ó –º–æ–Ω–æ–ø–æ–ª—ñ—ó Google', loss: 0.016 },
    { text: '–î–∏—Ä–∏–∂–∞–±–ª—å –ë—Ä—ñ–Ω Pathfinder –∑–Ω–∏—â–µ–Ω–æ —à—Ç–æ—Ä–º–æ–º ‚Äî –∑–±–∏—Ç–æ–∫ $300M', loss: 0.008 },
    { text: 'DeepMind –æ–≥–æ–ª–æ—Å–∏–≤ –ø—Ä–æ –≤—ñ–¥—Ö—ñ–¥ –∫–ª—é—á–æ–≤–∏—Ö –≤—á–µ–Ω–∏—Ö –¥–æ OpenAI', loss: 0.012 },
  ],
  '–ú–∞—Ä–∫ –¶—É–∫–µ—Ä–±–µ—Ä–≥': [
    { text: 'Meta –ø—Ä–æ–≥—Ä–∞–ª–∞ –º–∞—Å–æ–≤–∏–π –ø–æ–∑–æ–≤ —â–æ–¥–æ –≤–ø–ª–∏–≤—É –Ω–∞ –¥—ñ—Ç–µ–π: $7B', loss: 0.023 },
    { text: 'Instagram –≤—Ç—Ä–∞—Ç–∏–≤ 80M –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤ –∑–∞ –º—ñ—Å—è—Ü—å', loss: 0.019 },
    { text: 'Meta Quest 4 –ø—Ä–æ–≤–∞–ª–∏–≤—Å—è ‚Äî –ø–æ–≤–µ—Ä–Ω—É—Ç–æ 2M –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤', loss: 0.021 },
    { text: 'Apple –∑–∞–±–ª–æ–∫—É–≤–∞–≤ Facebook –∑ App Store ‚Äî –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–∏ –∑—ñ—Ä–≤–∞–ª–∏—Å—å', loss: 0.016 },
    { text: '–¶—É–∫–µ—Ä–±–µ—Ä–≥–∞ –¥–æ–ø–∏—Ç—É—é—Ç—å —É –ö–æ–Ω–≥—Ä–µ—Å—ñ 12 –≥–æ–¥–∏–Ω ‚Äî –∞–∫—Ü—ñ—ó –ø–∞–¥–∞—é—Ç—å', loss: 0.014 },
    { text: 'WhatsApp –≤—Ç—Ä–∞—Ç–∏–≤ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è ‚Äî –≥–ª–æ–±–∞–ª—å–Ω–∏–π —Å–∫–∞–Ω–¥–∞–ª', loss: 0.018 },
    { text: '–ú–µ—Ç–∞–≤—Å–µ—Å–≤—ñ—Ç Horizon Worlds ‚Äî –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∏—Ö —é–∑–µ—Ä—ñ–≤ 0.1M', loss: 0.022 },
    { text: '–ù–æ–≤–∞ —Ä–µ–∫–ª–∞–º–Ω–∞ –º–æ–¥–µ–ª—å Meta –ø–æ—Ä—É—à–∏–ª–∞ GDPR ‚Äî —à—Ç—Ä–∞—Ñ ‚Ç¨4B', loss: 0.017 },
    { text: 'Threads –∑—É–ø–∏–Ω–∏–≤ —Ä—ñ—Å—Ç ‚Äî Twitter –≤—ñ–¥–≤–æ—é–≤–∞–≤ –∞—É–¥–∏—Ç–æ—Ä—ñ—é', loss: 0.010 },
    { text: '–ü–µ—Ä—Å–æ–Ω–∞–ª Meta –º–∞—Å–æ–≤–æ –ø–æ–∫–∏–¥–∞—î —á–µ—Ä–µ–∑ —Ç–æ–∫—Å–∏—á–Ω—É –∫—É–ª—å—Ç—É—Ä—É', loss: 0.012 },
  ],
  '–°—Ç—ñ–≤ –ë–∞–ª–º–µ—Ä': [
    { text: 'LA Clippers –ø—Ä–æ–≥—Ä–∞–ª–∏ —á–µ–º–ø—ñ–æ–Ω–∞—Ç ‚Äî —Å–ø–æ–Ω—Å–æ—Ä–∏ –π–¥—É—Ç—å', loss: 0.013 },
    { text: '–°—Ç–∞—Ä—Ç–∞–ø Web3 –∑ –ø–æ—Ä—Ç—Ñ–µ–ª—é –ë–∞–ª–º–µ—Ä–∞ –∑–±–∞–Ω–∫—Ä—É—Ç—É–≤–∞–≤: -$900M', loss: 0.016 },
    { text: 'NBA –≤—ñ–¥—Å—É–¥–∏–ª–∞ —É –ë–∞–ª–º–µ—Ä–∞ –ø—Ä–∞–≤–æ –Ω–∞ —Ç–µ–ª–µ—Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó', loss: 0.011 },
    { text: '–ú–µ–¥—ñ–∞—Ö–æ–ª–¥–∏–Ω–≥ –ë–∞–ª–º–µ—Ä–∞ –∑–∞–∑–Ω–∞–≤ –∫—ñ–±–µ—Ä–∞—Ç–∞–∫–∏ ‚Äî $2B –∑–±–∏—Ç–æ–∫', loss: 0.019 },
    { text: '–ù–æ–≤–∞ –∞—Ä–µ–Ω–∞ Clippers –∫–æ—à—Ç—É–≤–∞–ª–∞ –≤–¥–≤—ñ—á—ñ –±—ñ–ª—å—à–µ –±—é–¥–∂–µ—Ç—É', loss: 0.014 },
    { text: '–ö–æ–º–µ—Ä—Ü—ñ–π–Ω–∞ –Ω–µ—Ä—É—Ö–æ–º—ñ—Å—Ç—å –ë–∞–ª–º–µ—Ä–∞ –≤ –∫—Ä–∏–∑—ñ –ª—ñ–∫–≤—ñ–¥–Ω–æ—Å—Ç—ñ', loss: 0.017 },
    { text: 'Microsoft (–ø–∞—Å–∏–≤–Ω–∞ —á–∞—Å—Ç–∫–∞) –≤–∏–ø–ª–∞—á—É—î —Ä–µ–∫–æ—Ä–¥–Ω—ñ –¥–∏–≤—ñ–¥–µ–Ω–¥–∏ ‚Äî –Ω–µ –Ω–∞ –∫–æ—Ä–∏—Å—Ç—å –ë–∞–ª–º–µ—Ä–∞', loss: 0.009 },
    { text: '–ü—Ä–æ–≤–∞–ª—å–Ω–∞ —ñ–Ω–≤–µ—Å—Ç–∏—Ü—ñ—è –≤ —Ä–µ–≥—ñ–æ–Ω–∞–ª—å–Ω—ñ –±–∞–Ω–∫–∏: -$1.4B', loss: 0.015 },
    { text: '–ö–ª—É–±–Ω–∏–π –ø–µ—Ä—Å–æ–Ω–∞–ª Clippers –ø–æ–¥–∞–≤ –∫–æ–ª–µ–∫—Ç–∏–≤–Ω–∏–π –ø–æ–∑–æ–≤', loss: 0.008 },
    { text: 'Balmer Group –∑–∞–∑–Ω–∞–ª–∞ –∞—É–¥–∏—Ç–æ—Ä—Å—å–∫–æ–≥–æ —Å–∫–∞–Ω–¥–∞–ª—É', loss: 0.012 },
  ],
  '–ú—É–∫–µ—à –ê–º–±–∞–Ω—ñ': [
    { text: '–í–∏–±—É—Ö –Ω–∞ –Ω–∞—Ñ—Ç–æ–ø–µ—Ä–µ—Ä–æ–±–Ω–æ–º—É –∑–∞–≤–æ–¥—ñ Reliance ‚Äî –∑–±–∏—Ç–æ–∫ $4B', loss: 0.021 },
    { text: '–£—Ä—è–¥ –Ü–Ω–¥—ñ—ó –≤–≤—ñ–≤ –Ω–∞–¥–ø–æ–¥–∞—Ç–æ–∫ –¥–ª—è Reliance Industries', loss: 0.016 },
    { text: 'Jio –≤—Ç—Ä–∞—Ç–∏–≤ 30M –∞–±–æ–Ω–µ–Ω—Ç—ñ–≤ —á–µ—Ä–µ–∑ —Ç–∞—Ä–∏—Ñ–Ω—É —Ä–µ—Ñ–æ—Ä–º—É', loss: 0.013 },
    { text: '–ï–∫–æ–ª–æ–≥—ñ—á–Ω–∏–π —Å–∫–∞–Ω–¥–∞–ª ‚Äî Reliance —à—Ç—Ä–∞—Ñ—É—é—Ç—å –Ω–∞ $2.5B', loss: 0.011 },
    { text: 'Amba –∑–∞–∑–Ω–∞–≤ –∫—Ä–∏–∑–∏ –ª—ñ–∫–≤—ñ–¥–Ω–æ—Å—Ç—ñ ‚Äî Moody –∑–Ω–∏–∂—É—î —Ä–µ–π—Ç–∏–Ω–≥', loss: 0.018 },
    { text: '–†–µ–ª—ñ–≥—ñ–π–Ω–∏–π –±–æ–π–∫–æ—Ç Reliance –≤ –ü—ñ–≤–Ω—ñ—á–Ω—ñ–π –Ü–Ω–¥—ñ—ó', loss: 0.009 },
    { text: '–ö—ñ–±–µ—Ä–∞—Ç–∞–∫–∞ –Ω–∞ Jio ‚Äî 150M –¥–∞–Ω–∏—Ö –∫–ª—ñ—î–Ω—Ç—ñ–≤ –∑–ª–∏—Ç–æ', loss: 0.015 },
    { text: '–¶—ñ–Ω–∏ –Ω–∞—Ñ—Ç–∏ –æ–±—Ä—É—à–∏–ª–∏—Å—å ‚Äî –¥–æ—Ö–æ–¥–∏ Reliance –≤–ø–∞–ª–∏ –Ω–∞ 40%', loss: 0.020 },
    { text: '–ù–æ–≤–∞ —Ç–æ—Ä–≥–æ–≤–µ–ª—å–Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ JioMart –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å', loss: 0.012 },
    { text: '–°—Ç—Ä–∞–π–∫ 120,000 –Ω–∞—Ñ—Ç–æ–≤–∏–∫—ñ–≤ Reliance –ø–æ –≤—Å—ñ–π –Ü–Ω–¥—ñ—ó', loss: 0.014 },
  ],
  '–ö–∞—Ä–ª–æ—Å –°–ª—ñ–º': [
    { text: 'Am√©rica M√≥vil –ø–æ–∑–±–∞–≤–ª–µ–Ω–æ –ª—ñ—Ü–µ–Ω–∑—ñ–π —É –ë—Ä–∞–∑–∏–ª—ñ—ó —Ç–∞ –ê—Ä–≥–µ–Ω—Ç–∏–Ω—ñ', loss: 0.019 },
    { text: '–ú–µ–∫—Å–∏–∫–∞ –≤–≤–µ–ª–∞ —Ä–µ–≤–æ–ª—é—Ü—ñ–π–Ω–∏–π —Ç–µ–ª–µ–∫–æ–º-–∞–Ω—Ç–∏–º–æ–Ω–æ–ø–æ–ª—å–Ω–∏–π –∑–∞–∫–æ–Ω', loss: 0.013 },
    { text: '–ë—É–¥—ñ–≤–µ–ª—å–Ω–∏–π —Ö–æ–ª–¥–∏–Ω–≥ Slim Group ‚Äî –±–∞–Ω–∫—Ä—É—Ç—Å—Ç–≤–æ —Ñ—ñ–ª—ñ—ó', loss: 0.016 },
    { text: 'Telmex –ø—Ä–æ–≥—Ä–∞–≤ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü—ñ—é AT&T —É –ú–µ–∫—Å–∏—Ü—ñ', loss: 0.011 },
    { text: '–°–ª—ñ–º –∑–≤–∏–Ω—É–≤–∞—á–µ–Ω–∏–π —É –∫–æ—Ä—É–ø—Ü—ñ—ó –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º —É—Ä—è–¥–æ–º', loss: 0.018 },
    { text: 'Am√©rica M√≥vil –≤–∏–ø–ª–∞—Ç–∏—Ç—å $3.5B –∑–∞ –ø–æ—Ä—É—à–µ–Ω–Ω—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü—ñ—ó', loss: 0.015 },
    { text: '–ó–±—ñ–π –º–µ—Ä–µ–∂—ñ Telcel –ø–∞—Ä–∞–ª—ñ–∑—É–≤–∞–≤ –ú–µ–∫—Å–∏–∫—É –Ω–∞ 8 –≥–æ–¥–∏–Ω', loss: 0.010 },
    { text: '–§—ñ–Ω–∞–Ω—Å–æ–≤–∏–π –ø–æ—Ä—Ç—Ñ–µ–ª—å Slim Group ‚Äî –∑–±–∏—Ç–∫–∏ –≤—ñ–¥ –∫—Ä–∏–∑–∏ –≤ –ê—Ä–≥–µ–Ω—Ç–∏–Ω—ñ', loss: 0.017 },
    { text: 'Claro Brasil –≤—Ç—Ä–∞—á–∞—î –ø–æ–∑–∏—Ü—ñ—ó —á–µ—Ä–µ–∑ Starlink –ú–∞—Å–∫–∞', loss: 0.012 },
    { text: '–ù–æ–≤—ñ –≤–∏–±–æ—Ä–∏ –≤ –ú–µ–∫—Å–∏—Ü—ñ ‚Äî —É—Ä—è–¥ –ø–µ—Ä–µ–≥–ª—è–¥–∞—î —É–≥–æ–¥–∏ –∑—ñ Slim', loss: 0.014 },
  ],
  '–§—Ä–∞–Ω—Å—É–∞–∑–∞ –ú–µ—î—Ä': [
    { text: 'Walmart –∑–Ω–∏–∑–∏–≤ –∫–≤–∞—Ä—Ç–∞–ª—å–Ω–∏–π –ø—Ä–æ–≥–Ω–æ–∑ –ø—Ä–∏–±—É—Ç–∫—É –Ω–∞ 25%', loss: 0.016 },
    { text: 'Amazon –∑–∞—Ö–æ–ø–∏–≤ 45% –æ–Ω–ª–∞–π–Ω-—Ä–∏–Ω–∫—É –°–®–ê ‚Äî Walmart –≤—ñ–¥—Å—Ç–∞—î', loss: 0.019 },
    { text: '–ú–∞—Å–æ–≤–∞ –∫—Ä–∞–¥—ñ–∂–∫–∞ —É 300 –º–∞–≥–∞–∑–∏–Ω–∞—Ö Walmart ‚Äî –∑–±–∏—Ç–æ–∫ $1.2B', loss: 0.009 },
    { text: 'FTC –∑–∞–±–ª–æ–∫—É–≤–∞–ª–∞ –∑–ª–∏—Ç—Ç—è Walmart –∑ Vizio', loss: 0.013 },
    { text: '–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∏ Walmart —Ä–æ–∑—Ä–∏–≤–∞—é—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∏ –ø—ñ—Å–ª—è —Å–∫–∞–Ω–¥–∞–ª—É', loss: 0.011 },
    { text: 'Walmart+ —Ç–∞–∫ —ñ –Ω–µ –Ω–∞–∑–¥–æ–≥–Ω–∞–≤ Amazon Prime ‚Äî –ø—Ä–æ–≤–∞–ª', loss: 0.015 },
    { text: '–°—ñ–º–µ–π–Ω–∏–π —Ç—Ä–∞—Å—Ç Walton –ø—ñ–¥ —Å–ª—ñ–¥—Å—Ç–≤–æ–º IRS', loss: 0.014 },
    { text: '–ú–∞—Å–æ–≤—ñ —Å—É–¥–æ–≤—ñ –ø–æ–∑–æ–≤–∏ –ø—Ä–æ—Ç–∏ Walmart –∑–∞ —É–º–æ–≤–∏ –ø—Ä–∞—Ü—ñ', loss: 0.010 },
    { text: 'Walmart Health –∑–∞–∫—Ä–∏–≤–∞—é—Ç—å —É—Å—ñ 51 –∫–ª—ñ–Ω—ñ–∫ ‚Äî $2B —Å–ø–∏—Å–∞–Ω–æ', loss: 0.017 },
    { text: '–ú–∞–≥–∞–∑–∏–Ω–∏ Walmart —É –ö–∏—Ç–∞—ó –º–∞—Å–æ–≤–æ –∑–∞–∫—Ä–∏–≤–∞—é—Ç—å—Å—è', loss: 0.012 },
  ],
  '–î–∂–∏–º –í–æ–ª—Ç–æ–Ω': [
    { text: 'Arvest Bank –∑–∞–∑–Ω–∞–≤ –Ω–∞–±—ñ–≥—É –≤–∫–ª–∞–¥–Ω–∏–∫—ñ–≤ ‚Äî –∫—Ä–∏–∑–∞ –ª—ñ–∫–≤—ñ–¥–Ω–æ—Å—Ç—ñ', loss: 0.016 },
    { text: '–°—ñ–º–µ–π–Ω–∏–π —Ç—Ä–∞—Å—Ç Walton –ø—Ä–æ–≥—Ä–∞–≤ IRS —Å–ø—ñ—Ä –Ω–∞ $4.5B', loss: 0.015 },
    { text: '–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∏ –ø–æ–¥–∞–ª–∏ –∫–æ–ª–µ–∫—Ç–∏–≤–Ω–∏–π –ø–æ–∑–æ–≤ –ø—Ä–æ—Ç–∏ Walmart', loss: 0.013 },
    { text: 'EPA –≤–∏–ø–∏—Å–∞–≤ Walmart —Ä–µ–∫–æ—Ä–¥–Ω–∏–π —à—Ç—Ä–∞—Ñ $3.1B –∑–∞ –≤—ñ–¥—Ö–æ–¥–∏', loss: 0.019 },
    { text: '–ú–µ–¥—ñ–∞—Å–∫–∞–Ω–¥–∞–ª ‚Äî Wolton Family Foundation –ø—ñ–¥ —Ä–æ–∑—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è–º', loss: 0.011 },
    { text: 'Walmart Supercenter: –º–∞—Å–æ–≤–∞ –∫–æ–Ω—Ç–∞–º—ñ–Ω–∞—Ü—ñ—è –ø—Ä–æ–¥—É–∫—Ç—ñ–≤', loss: 0.014 },
    { text: 'Acme Markets (—á–∞—Å—Ç–∫–∞ –í–æ–ª—Ç–æ–Ω–∞) –æ–≥–æ–ª–æ—Å–∏–≤ –±–∞–Ω–∫—Ä—É—Ç—Å—Ç–≤–æ', loss: 0.018 },
    { text: '–†–µ–≥—É–ª—è—Ç–æ—Ä–∏ –∑–∞–º–æ—Ä–æ–∑–∏–ª–∏ –∞–∫—Ç–∏–≤–∏ Arvest Bank –Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É', loss: 0.017 },
    { text: '–ö–ª–∞—Å-–µ–∫—à–Ω –ø—Ä–æ—Ç–∏ Walmart ‚Äî –ø—Ä–∞–≤–∞ —ñ–Ω–≤–∞–ª—ñ–¥—ñ–≤, $2B', loss: 0.010 },
    { text: '–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è Walmart —Å–∫–æ—Ä–æ—á—É—î 150K —Ä–æ–±–æ—á–∏—Ö –º—ñ—Å—Ü—å ‚Äî –±–æ–π–∫–æ—Ç', loss: 0.012 },
  ],
  '–ú—ñ—à–µ–ª—å –î–µ–ª–æ—Ä': [
    { text: '–ü—Ä–æ–º–∏—Å–ª–æ–≤–∏–π —Ö–æ–ª–¥–∏–Ω–≥ Delore –∑–∞–∑–Ω–∞–≤ –∫—Ä–∏–∑–∏ –ª—ñ–∫–≤—ñ–¥–Ω–æ—Å—Ç—ñ ‚Ç¨3B', loss: 0.023 },
    { text: 'IPO –¥–æ—á—ñ—Ä–Ω—å–æ—ó –∫–æ–º–ø–∞–Ω—ñ—ó –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å ‚Äî –º—ñ–Ω—É—Å 60% –≤ –ø–µ—Ä—à–∏–π –¥–µ–Ω—å', loss: 0.019 },
    { text: '–°—Ç—Ä–∞–π–∫ –Ω–∞ 20 –∑–∞–≤–æ–¥–∞—Ö –≥—Ä—É–ø–∏ –ø–∞—Ä–∞–ª—ñ–∑—É–≤–∞–≤ –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–æ', loss: 0.016 },
    { text: '–ê—Ä–±—ñ—Ç—Ä–∞–∂–Ω–∏–π —Å—É–¥ –≤–∏–Ω—ñ—Å —Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–æ—Ç–∏ Delore Group: ‚Ç¨2.5B', loss: 0.021 },
    { text: '–Ü–Ω–≤–µ—Å—Ç–æ—Ä–∏ –≤—ñ–¥–∫–ª–∏–∫–∞–ª–∏ ‚Ç¨5B –∑ —Ñ–æ–Ω–¥—ñ–≤ Delore', loss: 0.025 },
    { text: '–ï–∫–æ–ª–æ–≥—ñ—á–Ω–∞ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞ –Ω–∞ –∑–∞–≤–æ–¥—ñ Delore ‚Äî –∫—Ä–∏–º—ñ–Ω–∞–ª—å–Ω–∞ —Å–ø—Ä–∞–≤–∞', loss: 0.018 },
    { text: '–ö—Ä–µ–¥–∏—Ç–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ Delore Holdings –∑–Ω–∏–∂–µ–Ω–æ –¥–æ "—Å–º—ñ—Ç—Ç—î–≤–æ–≥–æ"', loss: 0.020 },
    { text: 'Delore –ø—Ä–æ–≥—Ä–∞–≤ —Ç–µ–Ω–¥–µ—Ä –Ñ–° –Ω–∞ ‚Ç¨8B –Ω–∞ –∫–æ—Ä–∏—Å—Ç—å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞', loss: 0.014 },
    { text: '–ü—Ä–æ–≤–∞–ª –¥–∏–≤–µ—Ä—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó ‚Äî —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—á–Ω–∏–π –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª –ª—ñ–∫–≤—ñ–¥–æ–≤–∞–Ω–æ', loss: 0.017 },
    { text: '–î–µ–ª–æ—Ä –∑–≤–∏–Ω—É–≤–∞—á–µ–Ω–∏–π —É –º–∞–Ω—ñ–ø—É–ª—è—Ü—ñ—ó —Ä–∏–Ω–∫–æ–º ‚Äî —Å–ª—ñ–¥—Å—Ç–≤–æ', loss: 0.015 },
  ],
  '–†–æ–±–µ—Ä—Ç –ê—Ä–Ω–æ': [
    { text: 'Research Affiliates –ø—Ä–æ–≥—Ä–∞–≤ –∫–ª—é—á–æ–≤–∏–π –ø–æ–∑–æ–≤: –≤–∏–ø–ª–∞—Ç–∞ $1.8B', loss: 0.021 },
    { text: '–ö–ª—ñ—î–Ω—Ç–∏ –≤–∏–≤–µ–ª–∏ $45B –∑ —Ñ–æ–Ω–¥—ñ–≤ RA –∑–∞ –∫–≤–∞—Ä—Ç–∞–ª', loss: 0.025 },
    { text: '–ù–æ–≤–∞ Smart Beta —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è –¥–∞–ª–∞ –º—ñ–Ω—É—Å–æ–≤–∏–π –¥–æ—Ö—ñ–¥ -18%', loss: 0.019 },
    { text: 'SEC –∑–∞–º–æ—Ä–æ–∑–∏–≤ –∞–∫—Ç–∏–≤–∏ Research Affiliates –Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É', loss: 0.016 },
    { text: '–ó–æ—Ä—è–Ω–∏–π –∞–Ω–∞–ª—ñ—Ç–∏–∫ RA –ø—ñ—à–æ–≤ –¥–æ BlackRock ‚Äî –≤—ñ–¥—Ç—ñ–∫ –∫–ª—ñ—î–Ω—Ç—ñ–≤', loss: 0.013 },
    { text: '–ê—Ä–Ω–æ –∑–≤–∏–Ω—É–≤–∞—á–µ–Ω–∏–π –≤ –º–∞–Ω—ñ–ø—É–ª—è—Ü—ñ—ó —Ñ–∞–∫—Ç–æ—Ä–Ω–∏–º–∏ —ñ–Ω–¥–µ–∫—Å–∞–º–∏', loss: 0.020 },
    { text: '–ü—Ä–æ–≤–∞–ª—å–Ω–∏–π –∑–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ ETF RA ‚Äî –∞–∫—Ç–∏–≤–∏ $200M –∑–∞–º—ñ—Å—Ç—å $5B', loss: 0.015 },
    { text: 'PIMCO —Ä–æ–∑—ñ—Ä–≤–∞–≤ –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ –∑ Research Affiliates', loss: 0.018 },
    { text: '–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–∏ —Å–∫–æ–ø—ñ—é–≤–∞–ª–∏ –º–µ—Ç–æ–¥–æ–ª–æ–≥—ñ—é RAFI ‚Äî —Å—É–¥–æ–≤–∞ –±–∏—Ç–≤–∞', loss: 0.011 },
    { text: '–ü–µ–Ω—Å—ñ–π–Ω—ñ —Ñ–æ–Ω–¥–∏ –º–∞—Å–æ–≤–æ –≤—ñ–¥–º–æ–≤–ª—è—é—Ç—å—Å—è –≤—ñ–¥ —Å—Ç—Ä–∞—Ç–µ–≥—ñ–π RA', loss: 0.017 },
  ],
  '–†–µ–π –î–∞–ª—ñ–æ': [
    { text: 'Bridgewater –ø–æ–∫–∞–∑–∞–≤ -23% –∑–∞ —Ä—ñ–∫ ‚Äî –≥—ñ—Ä—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —ñ—Å—Ç–æ—Ä—ñ—ó', loss: 0.022 },
    { text: '–ö–ª—ñ—î–Ω—Ç–∏ –≤–∏–≤–µ–ª–∏ $60B –∑ Bridgewater –∑–∞ –¥–≤–∞ –º—ñ—Å—è—Ü—ñ', loss: 0.025 },
    { text: 'China Fund Bridgewater –∑–∞–º–æ—Ä–æ–∂–µ–Ω–æ –∫–∏—Ç–∞–π—Å—å–∫–∏–º–∏ —Ä–µ–≥—É–ª—è—Ç–æ—Ä–∞–º–∏', loss: 0.019 },
    { text: '–í–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π —Å–∫–∞–Ω–¥–∞–ª Bridgewater ‚Äî —Ç–æ–ø-–º–µ–Ω–µ–¥–∂–µ—Ä–∏ –∑–∞–ª–∏—à–∞—é—Ç—å —Ñ–æ–Ω–¥', loss: 0.016 },
    { text: '–î–∞–ª—ñ–æ –∑–≤–∏–Ω—É–≤–∞—á—É—é—Ç—å —É —Ç–æ–∫—Å–∏—á–Ω—ñ–π –∫—É–ª—å—Ç—É—Ä—ñ ‚Äî NYT —Ä–æ–∑—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è', loss: 0.013 },
    { text: 'Pure Alpha —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å –Ω–∞ —Ä–∏–Ω–∫—É –æ–±–ª—ñ–≥–∞—Ü—ñ–π', loss: 0.018 },
    { text: '–†–µ–≥—É–ª—è—Ç–æ—Ä CFTC –≤—ñ–¥–∫—Ä–∏–≤ —Å–ø—Ä–∞–≤—É –ø—Ä–æ—Ç–∏ Bridgewater', loss: 0.020 },
    { text: '–†–æ–∑–ª—É—á–µ–Ω–Ω—è –î–∞–ª—ñ–æ ‚Äî —Å—É–¥ –¥—ñ–ª–∏—Ç—å $6B –∞–∫—Ç–∏–≤—ñ–≤ —Ñ–æ–Ω–¥—É', loss: 0.014 },
    { text: '–ö–Ω–∏–≥–∞ –î–∞–ª—ñ–æ "–ü—Ä–∏–Ω—Ü–∏–ø–∏" –¥–∏—Å–∫—Ä–µ–¥–∏—Ç–æ–≤–∞–Ω–∞ ‚Äî –±–æ–π–∫–æ—Ç —ñ–Ω–≤–µ—Å—Ç–æ—Ä—ñ–≤', loss: 0.009 },
    { text: 'Bridgewater –ø—Ä–æ–≥—Ä–∞–≤ —Å—Ç–∞–≤–∫—É –Ω–∞ –∑–æ–ª–æ—Ç–æ ‚Äî –∑–±–∏—Ç–æ–∫ $4B', loss: 0.017 },
  ],
  '–ü—ñ—Ç–µ—Ä –¢—ñ–ª—å': [
    { text: 'Palantir –ø—Ä–æ–≥—Ä–∞–≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¶–†–£ –Ω–∞ $2.5B Booz Allen', loss: 0.023 },
    { text: '–ü—Ä–æ–≤–∞–ª—å–Ω–∏–π —Å—Ç–∞—Ä—Ç–∞–ø –∑ Founders Fund ‚Äî —Å–ø–∏—Å–∞–Ω–æ $1.2B', loss: 0.019 },
    { text: '–°–∫–∞–Ω–¥–∞–ª—å–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ –ø—Ä–∏–∑–≤–µ–ª–∞ –¥–æ –±–æ–π–∫–æ—Ç—É Palantir', loss: 0.016 },
    { text: 'SEC –ø–æ—Ä—É—à–∏–ª–æ —Å–ø—Ä–∞–≤—É —â–æ–¥–æ —É–≥–æ–¥ Palantir –∑ —ñ–Ω—Å–∞–π–¥–µ—Ä–∞–º–∏', loss: 0.021 },
    { text: '–¢—ñ–ª—å –≤—ñ–¥–º–æ–≤–∏–≤—Å—è –≤—ñ–¥ –≥—Ä–æ–º–∞–¥—è–Ω—Å—Ç–≤–∞ ‚Äî –∑–∞–º–æ—Ä–æ–∂–µ–Ω–æ –∞–∫—Ç–∏–≤–∏ –≤ –°–®–ê', loss: 0.015 },
    { text: 'Palantir –≤—Ç—Ä–∞—Ç–∏–≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç –ú–í–§ —á–µ—Ä–µ–∑ –≤–∏—Ç—ñ–∫ –¥–∞–Ω–∏—Ö', loss: 0.018 },
    { text: 'Founders Fund: 5 –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω–∏—Ö –∫–æ–º–ø–∞–Ω—ñ–π –∑–±–∞–Ω–∫—Ä—É—Ç—É–≤–∞–ª–∏', loss: 0.014 },
    { text: 'Valar Ventures –∑–∞–∑–Ω–∞–≤ –º–∞—Å–æ–≤–æ–≥–æ –≤—ñ–¥—Ç–æ–∫—É LP-—ñ–Ω–≤–µ—Å—Ç–æ—Ä—ñ–≤', loss: 0.017 },
    { text: '–¢—ñ–ª—è –∑–≤–∏–Ω—É–≤–∞—á—É—é—Ç—å —É —Ñ—ñ–Ω–∞–Ω—Å—É–≤–∞–Ω–Ω—ñ –¥–µ–∑—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó ‚Äî —Å–∫–∞–Ω–¥–∞–ª', loss: 0.012 },
    { text: 'Palantir –ø—Ä–æ–≥—Ä–∞–≤ —Ç–µ–Ω–¥–µ—Ä NATO –Ω–∞ ‚Ç¨3.8B –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—É', loss: 0.020 },
  ],
  '–ü–∞—Ç—Ä—ñ–∫ –ö–æ–ª–ª—ñ—Å–æ–Ω': [
    { text: 'Stripe –ø–æ–∑–±–∞–≤–ª–µ–Ω–æ –ª—ñ—Ü–µ–Ω–∑—ñ—ó –≤ –Ñ–° —á–µ—Ä–µ–∑ –ø–æ—Ä—É—à–µ–Ω–Ω—è AML', loss: 0.025 },
    { text: '–ì–ª–æ–±–∞–ª—å–Ω–∏–π –∑–±—ñ–π Stripe ‚Äî 14 –≥–æ–¥–∏–Ω –±–µ–∑ –ø–ª–∞—Ç–µ–∂—ñ–≤ –¥–ª—è 2M —Å–∞–π—Ç—ñ–≤', loss: 0.022 },
    { text: 'Adyen —ñ PayPal –≤—ñ–¥–≤–æ—é–≤–∞–ª–∏ 35% —Ä–∏–Ω–∫—É —É Stripe –∑–∞ —Ä—ñ–∫', loss: 0.019 },
    { text: 'IPO Stripe –≤—ñ–¥–∫–ª–∞–¥–µ–Ω–æ –≤—á–µ—Ç–≤–µ—Ä—Ç–µ ‚Äî –æ—Ü—ñ–Ω–∫–∞ –≤–ø–∞–ª–∞ –¥–æ $35B', loss: 0.016 },
    { text: 'FTC –ø–æ—Ä—É—à–∏–ª–∞ —Å–ø—Ä–∞–≤—É —â–æ–¥–æ –∫–æ–º—ñ—Å—ñ–π Stripe –¥–ª—è –º–∞–ª–æ–≥–æ –±—ñ–∑–Ω–µ—Å—É', loss: 0.014 },
    { text: '–í–∏—Ç—ñ–∫ –∫–æ–¥—É Stripe ‚Äî –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—á–Ω–∏–π –∫–ª—é—á', loss: 0.020 },
    { text: 'Stripe –≤—Ç—Ä–∞—Ç–∏–≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç –∑ Apple Pay ‚Äî $4B –≤–∏—Ä—É—á–∫–∏ –ø—ñ–¥ —Ä–∏–∑–∏–∫–æ–º', loss: 0.018 },
    { text: '–ú–∞—Å–æ–≤–µ —à–∞—Ö—Ä–∞–π—Å—Ç–≤–æ —á–µ—Ä–µ–∑ Stripe ‚Äî –∑–±–∏—Ç–æ–∫ –∫–ª—ñ—î–Ω—Ç—ñ–≤ $2.3B', loss: 0.015 },
    { text: 'Stripe Atlas –∑–∞–∫—Ä–∏—Ç–æ —á–µ—Ä–µ–∑ —Ä–µ–≥—É–ª—è—Ç–æ—Ä–Ω–∏–π —Ç–∏—Å–∫ —É 12 –∫—Ä–∞—ó–Ω–∞—Ö', loss: 0.011 },
    { text: '–ù–∞–π–±—ñ–ª—å—à–∏–π –∫–ª—ñ—î–Ω—Ç Stripe ‚Äî Amazon ‚Äî –ø–µ—Ä–µ–π—à–æ–≤ –¥–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞', loss: 0.023 },
  ],
};

// State for tracking last-minute changes (for Forbes arrows display)
// rivalLastChange: { name: { delta: number, timestamp: ms } }


// =================== CONTAINERS DATA ===================
const CONTAINERS = [
  {
    id: 'urban_micro',
    name: 'Urban Micro',
    subtitle: '–ú—ñ—Å—å–∫–∏–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç',
    price: 450_000,
    color: '#e8e8e8',
    colorName: 'white',
    accent: '#888',
    stripeColor: '#bbb',
    items: [
      { name:'–°–∞–º–æ–∫–∞—Ç Xiaomi',           emoji:'üõ¥', rarity:'common',    value:5_000,    vehicleType:'micro' },
      { name:'–°–∫–µ–π—Ç–±–æ—Ä–¥ Pro',            emoji:'üõπ', rarity:'common',    value:8_000,    vehicleType:'micro' },
      { name:'–í–µ–ª–æ—Å–∏–ø–µ–¥ Giant',          emoji:'üö≤', rarity:'common',    value:12_000,   vehicleType:'bike'  },
      { name:'–ì—ñ—Ä–æ—Å–∫—É—Ç–µ—Ä',              emoji:'üõµ', rarity:'common',    value:15_000,   vehicleType:'micro' },
      { name:'–ú–æ–Ω–æ–∫–æ–ª–µ—Å–æ',              emoji:'‚öôÔ∏è', rarity:'common',    value:25_000,   vehicleType:'micro' },
      { name:'–ï–ª–µ–∫—Ç—Ä–æ—Å–∞–º–æ–∫–∞—Ç Dualtron', emoji:'‚ö°', rarity:'common',    value:40_000,   vehicleType:'micro' },
      { name:'–ú–æ–ø–µ–¥ Vespa',             emoji:'üõµ', rarity:'rare',      value:80_000,   vehicleType:'moto'  },
      { name:'–ö–≤–∞–¥—Ä–æ—Ü–∏–∫–ª Yamaha',       emoji:'üèéÔ∏è', rarity:'rare',      value:120_000,  vehicleType:'car'   },
      { name:'–ö—Ä–æ—Å–æ–≤–∏–π –±–∞–π–∫ KTM',       emoji:'üèçÔ∏è', rarity:'rare',      value:180_000,  vehicleType:'moto'  },
      { name:'–ï–ª–µ–∫—Ç—Ä–æ–±–∞–π–∫ Sur-Ron',     emoji:'‚ö°', rarity:'rare',      value:220_000,  vehicleType:'moto'  },
      { name:'–ö–∞—Ä—Ç –¥–ª—è –ø–µ—Ä–µ–≥–æ–Ω—ñ–≤',      emoji:'üèéÔ∏è', rarity:'epic',      value:450_000,  vehicleType:'car'   },
      { name:'–ë–∞–≥–≥—ñ Maverick',          emoji:'üöó', rarity:'epic',      value:600_000,  vehicleType:'car'   },
      { name:'Polaris Slingshot',       emoji:'üõ∫', rarity:'epic',      value:850_000,  vehicleType:'car'   },
      { name:'Harley-Davidson CVO',     emoji:'üèçÔ∏è', rarity:'legendary', value:1_500_000, vehicleType:'moto' },
      { name:'Ducati Panigale V4 R',    emoji:'üèçÔ∏è', rarity:'legendary', value:1_800_000, vehicleType:'moto' },
    ]
  },
  {
    id: 'street_classics',
    name: 'Street Classics',
    subtitle: '–ö–ª–∞—Å–∏–∫–∞ —Ç–∞ –¢—é–Ω—ñ–Ω–≥',
    price: 2_200_000,
    color: '#cc2200',
    colorName: 'red',
    accent: '#ff6644',
    stripeColor: '#ff4422',
    items: [
      { name:'–í–ê–ó 2101 Custom',           emoji:'üöó', rarity:'common',    value:60_000,    vehicleType:'car' },
      { name:'VW Golf Mk2',               emoji:'üöó', rarity:'common',    value:90_000,    vehicleType:'car' },
      { name:'Honda Civic Type-R 1998',   emoji:'üöó', rarity:'common',    value:130_000,   vehicleType:'car' },
      { name:'BMW E30',                   emoji:'üöó', rarity:'common',    value:180_000,   vehicleType:'car' },
      { name:'Mazda Miata',               emoji:'üöó', rarity:'common',    value:220_000,   vehicleType:'car' },
      { name:'Nissan Silvia S15',         emoji:'üöó', rarity:'common',    value:280_000,   vehicleType:'car' },
      { name:'Mitsubishi Lancer Evo IX',  emoji:'üèéÔ∏è', rarity:'rare',      value:500_000,   vehicleType:'car' },
      { name:'Subaru Impreza WRX STI',    emoji:'üèéÔ∏è', rarity:'rare',      value:650_000,   vehicleType:'car' },
      { name:'Toyota Supra A80',          emoji:'üèéÔ∏è', rarity:'rare',      value:850_000,   vehicleType:'car' },
      { name:'Nissan Skyline R34 GT-R',   emoji:'üèéÔ∏è', rarity:'rare',      value:1_100_000, vehicleType:'car' },
      { name:'Ford Mustang Shelby GT500', emoji:'üöó', rarity:'epic',      value:2_500_000, vehicleType:'car' },
      { name:'Dodge Charger 1969',        emoji:'üöó', rarity:'epic',      value:3_000_000, vehicleType:'car' },
      { name:'Plymouth Barracuda',        emoji:'üöó', rarity:'epic',      value:3_800_000, vehicleType:'car' },
      { name:'Porsche 911 Singer',        emoji:'üèéÔ∏è', rarity:'legendary', value:6_500_000, vehicleType:'car' },
      { name:'Ferrari F40',              emoji:'üèéÔ∏è', rarity:'legendary', value:9_000_000, vehicleType:'car' },
    ]
  },
  {
    id: 'business_class',
    name: 'Business Class',
    subtitle: '–ü—Ä–µ–º—ñ—É–º —Å–µ–≥–º–µ–Ω—Ç',
    price: 12_000_000,
    color: '#1a3a8f',
    colorName: 'blue',
    accent: '#4d88ff',
    stripeColor: '#2255cc',
    items: [
      { name:'Audi A6',                    emoji:'üöò', rarity:'common',    value:150_000,    vehicleType:'car' },
      { name:'BMW 5 Series',               emoji:'üöò', rarity:'common',    value:180_000,    vehicleType:'car' },
      { name:'Mercedes E-Class',           emoji:'üöò', rarity:'common',    value:210_000,    vehicleType:'car' },
      { name:'Volvo XC90',                 emoji:'üöò', rarity:'common',    value:250_000,    vehicleType:'car' },
      { name:'Lexus RX',                   emoji:'üöò', rarity:'common',    value:300_000,    vehicleType:'car' },
      { name:'Tesla Model 3',              emoji:'‚ö°', rarity:'common',    value:350_000,    vehicleType:'car' },
      { name:'Range Rover Vogue',          emoji:'üöô', rarity:'rare',      value:1_500_000,  vehicleType:'car' },
      { name:'Cadillac Escalade',          emoji:'üöô', rarity:'rare',      value:2_200_000,  vehicleType:'car' },
      { name:'Mercedes G63 AMG',           emoji:'üöô', rarity:'rare',      value:3_500_000,  vehicleType:'car' },
      { name:'Porsche Cayenne Turbo',      emoji:'üöô', rarity:'rare',      value:4_200_000,  vehicleType:'car' },
      { name:'Bentley Bentayga',           emoji:'üèÖ', rarity:'epic',      value:8_000_000,  vehicleType:'car' },
      { name:'Rolls-Royce Ghost',          emoji:'üëë', rarity:'epic',      value:12_000_000, vehicleType:'car' },
      { name:'Maybach S680',               emoji:'üëë', rarity:'epic',      value:15_000_000, vehicleType:'car' },
      { name:'Rolls-Royce Phantom',        emoji:'üëë', rarity:'legendary', value:25_000_000, vehicleType:'car' },
      { name:'Mercedes-Maybach Pullman',   emoji:'üëë', rarity:'legendary', value:35_000_000, vehicleType:'car' },
    ]
  },
  {
    id: 'hyper_track',
    name: 'Hyper Track',
    subtitle: '–°–ø–æ—Ä—Ç —Ç–∞ –®–≤–∏–¥–∫—ñ—Å—Ç—å',
    price: 60_000_000,
    color: '#1a1a1a',
    colorName: 'black',
    accent: '#f5c842',
    stripeColor: '#333',
    items: [
      { name:'Audi R8',                emoji:'üèéÔ∏è', rarity:'common',    value:1_200_000,   vehicleType:'car' },
      { name:'BMW M8',                 emoji:'üèéÔ∏è', rarity:'common',    value:1_500_000,   vehicleType:'car' },
      { name:'Nissan GT-R Nismo',      emoji:'üèéÔ∏è', rarity:'common',    value:2_000_000,   vehicleType:'car' },
      { name:'Porsche 911 GT3',        emoji:'üèéÔ∏è', rarity:'common',    value:2_800_000,   vehicleType:'car' },
      { name:'Corvette C8 Z06',        emoji:'üèéÔ∏è', rarity:'common',    value:3_500_000,   vehicleType:'car' },
      { name:'Lotus Emira',            emoji:'üèéÔ∏è', rarity:'common',    value:4_200_000,   vehicleType:'car' },
      { name:'Lamborghini Huracan STO',emoji:'üèéÔ∏è', rarity:'rare',      value:10_000_000,  vehicleType:'car' },
      { name:'Ferrari 488 Pista',      emoji:'üèéÔ∏è', rarity:'rare',      value:12_000_000,  vehicleType:'car' },
      { name:'McLaren 720S',           emoji:'üèéÔ∏è', rarity:'rare',      value:15_000_000,  vehicleType:'car' },
      { name:'Aston Martin DBS',       emoji:'üèéÔ∏è', rarity:'rare',      value:18_000_000,  vehicleType:'car' },
      { name:'Lamborghini Aventador SVJ', emoji:'üèéÔ∏è', rarity:'epic',   value:45_000_000,  vehicleType:'car' },
      { name:'Ferrari SF90',           emoji:'üèéÔ∏è', rarity:'epic',      value:55_000_000,  vehicleType:'car' },
      { name:'Porsche 918 Spyder',     emoji:'üèéÔ∏è', rarity:'epic',      value:70_000_000,  vehicleType:'car' },
      { name:'Bugatti Chiron Super Sport', emoji:'üèéÔ∏è', rarity:'legendary', value:150_000_000, vehicleType:'car' },
      { name:'Koenigsegg Jesko',       emoji:'üèéÔ∏è', rarity:'legendary', value:180_000_000, vehicleType:'car' },
    ]
  },
  {
    id: 'ultimate_collection',
    name: 'Ultimate Collection',
    subtitle: '–ï–∫—Å–∫–ª—é–∑–∏–≤–Ω—ñ –ì—ñ–ø–µ—Ä–∫–∞—Ä–∏',
    price: 350_000_000,
    color: '#4a0080',
    colorName: 'purple',
    accent: '#cc44ff',
    stripeColor: '#7700bb',
    items: [
      { name:'Lamborghini Urus Mansory', emoji:'üèéÔ∏è', rarity:'common',    value:8_000_000,    vehicleType:'car' },
      { name:'Ferrari Roma',             emoji:'üèéÔ∏è', rarity:'common',    value:10_000_000,   vehicleType:'car' },
      { name:'McLaren Artura',           emoji:'üèéÔ∏è', rarity:'common',    value:12_000_000,   vehicleType:'car' },
      { name:'Ford GT',                  emoji:'üèéÔ∏è', rarity:'common',    value:15_000_000,   vehicleType:'car' },
      { name:'Lexus LFA',                emoji:'üèéÔ∏è', rarity:'common',    value:18_000_000,   vehicleType:'car' },
      { name:'Porsche Carrera GT',       emoji:'üèéÔ∏è', rarity:'common',    value:22_000_000,   vehicleType:'car' },
      { name:'Pagani Huayra',            emoji:'üèéÔ∏è', rarity:'rare',      value:80_000_000,   vehicleType:'car' },
      { name:'Rimac Nevera',             emoji:'‚ö°',  rarity:'rare',      value:100_000_000,  vehicleType:'car' },
      { name:'Aston Martin Valkyrie',    emoji:'üèéÔ∏è', rarity:'rare',      value:130_000_000,  vehicleType:'car' },
      { name:'Gordon Murray T.50',       emoji:'üèéÔ∏è', rarity:'rare',      value:160_000_000,  vehicleType:'car' },
      { name:'Mercedes-AMG One',         emoji:'üèéÔ∏è', rarity:'epic',      value:350_000_000,  vehicleType:'car' },
      { name:'McLaren P1 GTR',           emoji:'üèéÔ∏è', rarity:'epic',      value:450_000_000,  vehicleType:'car' },
      { name:'Lamborghini Veneno',       emoji:'üèéÔ∏è', rarity:'epic',      value:600_000_000,  vehicleType:'car' },
      { name:'Bugatti La Voiture Noire', emoji:'üèéÔ∏è', rarity:'legendary', value:1_200_000_000, vehicleType:'car' },
      { name:'Ferrari 250 GTO Original',emoji:'üèÜ',  rarity:'legendary', value:2_500_000_000, vehicleType:'car' },
    ]
  },
];

// =================== LIFESHOP DATA ===================
const FORBES_RIVALS = [
  { name:'–Ü–ª–æ–Ω –ú–∞—Å–∫',         net:180_000_000_000, emoji:'üöÄ' },
  { name:'–î–∂–µ—Ñ—Ñ –ë–µ–∑–æ—Å',       net:120_000_000_000, emoji:'üì¶' },
  { name:'–ë–µ—Ä–Ω–∞—Ä –ê—Ä–Ω–æ',       net:100_000_000_000, emoji:'üëú' },
  { name:'–ë—ñ–ª–ª –ì–µ–π—Ç—Å',        net: 85_000_000_000, emoji:'üíª' },
  { name:'–õ–∞—Ä—Ä—ñ –ï–ª–ª—ñ—Å–æ–Ω',     net: 78_000_000_000, emoji:'‚òÅÔ∏è' },
  { name:'–£–æ—Ä—Ä–µ–Ω –ë–∞—Ñ—Ñ–µ—Ç',     net: 65_000_000_000, emoji:'üìà' },
  { name:'–õ–∞—Ä—Ä—ñ –ü–µ–π–¥–∂',       net: 58_000_000_000, emoji:'üîç' },
  { name:'–°–µ—Ä–≥—ñ–π –ë—Ä—ñ–Ω',       net: 55_000_000_000, emoji:'üåê' },
  { name:'–ú–∞—Ä–∫ –¶—É–∫–µ—Ä–±–µ—Ä–≥',    net: 48_000_000_000, emoji:'üë§' },
  { name:'–°—Ç—ñ–≤ –ë–∞–ª–º–µ—Ä',       net: 42_000_000_000, emoji:'ü™ü' },
  { name:'–ú—É–∫–µ—à –ê–º–±–∞–Ω—ñ',      net: 35_000_000_000, emoji:'‚õΩ' },
  { name:'–ö–∞—Ä–ª–æ—Å –°–ª—ñ–º',       net: 28_000_000_000, emoji:'üì°' },
  { name:'–§—Ä–∞–Ω—Å—É–∞–∑–∞ –ú–µ—î—Ä',    net: 20_000_000_000, emoji:'üõí' },
  { name:'–î–∂–∏–º –í–æ–ª—Ç–æ–Ω',       net: 15_000_000_000, emoji:'üè™' },
  { name:'–ú—ñ—à–µ–ª—å –î–µ–ª–æ—Ä',      net:  8_000_000_000, emoji:'üè≠' },
  { name:'–†–æ–±–µ—Ä—Ç –ê—Ä–Ω–æ',       net:  5_000_000_000, emoji:'üçæ' },
  { name:'–†–µ–π –î–∞–ª—ñ–æ',         net:  3_000_000_000, emoji:'üíπ' },
  { name:'–ü—ñ—Ç–µ—Ä –¢—ñ–ª—å',        net:  1_500_000_000, emoji:'üîê' },
  { name:'–ü–∞—Ç—Ä—ñ–∫ –ö–æ–ª–ª—ñ—Å–æ–Ω',   net:    700_000_000, emoji:'üí≥' },
  { name:'–¢–∏',               net:              0, emoji:'üòé', isPlayer:true },
];



const LIFESHOP_ITEMS = {
  transport: [
    { id:'tr01', name:'–°–ø–æ—Ä—Ç–∏–≤–Ω–∏–π –±–∞–π–∫ Ducati',         emoji:'üèçÔ∏è', price:50_000,          category:'transport' },
    { id:'tr02', name:'–¢—é–Ω—ñ–Ω–≥–æ–≤–∞–Ω–∏–π Jeep Wrangler',     emoji:'üöô', price:85_000,          category:'transport' },
    { id:'tr03', name:'Mercedes S-Class',               emoji:'üöò', price:130_000,         category:'transport' },
    { id:'tr04', name:'Tesla Model S Plaid',            emoji:'‚ö°', price:160_000,         category:'transport' },
    { id:'tr05', name:'–ú–∞—Å–ª–∫–∞—Ä 1969 —Ä–æ–∫—É',              emoji:'üöó', price:250_000,         category:'transport' },
    { id:'tr06', name:'Lamborghini Hurac√°n',            emoji:'üêÇ', price:350_000,         category:'transport' },
    { id:'tr07', name:'–ë—Ä–æ–Ω—å–æ–≤–∞–Ω–∏–π –ª—ñ–º—É–∑–∏–Ω',            emoji:'üöñ', price:500_000,         category:'transport' },
    { id:'tr08', name:'Ferrari Enzo (–∫–æ–ª–µ–∫—Ü—ñ–π–Ω–∏–π)',     emoji:'üèéÔ∏è', price:1_200_000,       category:'transport' },
    { id:'tr09', name:'–í–µ—Ä—Ç–æ–ª—ñ—Ç Robinson R44',          emoji:'üöÅ', price:2_500_000,       category:'transport' },
    { id:'tr10', name:'–ü—Ä–∏–≤–∞—Ç–Ω–∏–π –ª—ñ—Ç–∞–∫ Cessna',         emoji:'‚úàÔ∏è', price:5_000_000,       category:'transport' },
    { id:'tr11', name:'–®–≤–∏–¥–∫—ñ—Å–Ω–∞ —è—Ö—Ç–∞ 15–º',            emoji:'‚õµ', price:8_500_000,       category:'transport' },
    { id:'tr12', name:'–í–µ—Ä—Ç–æ–ª—ñ—Ç Bell 429',              emoji:'üöÅ', price:12_000_000,      category:'transport' },
    { id:'tr13', name:'Bugatti Chiron',                 emoji:'üêõ', price:18_000_000,      category:'transport' },
    { id:'tr14', name:'Gulfstream G650',                emoji:'üõ©Ô∏è', price:45_000_000,      category:'transport' },
    { id:'tr15', name:'–Ø—Ö—Ç–∞ Explorer (75–º)',            emoji:'üõ•Ô∏è', price:75_000_000,      category:'transport' },
    { id:'tr16', name:'Boeing 747 –≤–∞–Ω—Ç–∞–∂–Ω–∏–π',           emoji:'‚úàÔ∏è', price:120_000_000,     category:'transport' },
    { id:'tr17', name:'–°—É–ø–µ—Ä-—è—Ö—Ç–∞ Eclipse (80–º)',       emoji:'üö¢', price:200_000_000,     category:'transport' },
    { id:'tr18', name:'–û—Å–æ–±–∏—Å—Ç–∏–π –ø—ñ–¥–≤–æ–¥–Ω–∏–π —á–æ–≤–µ–Ω',      emoji:'ü§ø', price:350_000_000,     category:'transport' },
    { id:'tr19', name:'–ü—Ä–∏–≤–∞—Ç–Ω–∏–π –∞–≤—ñ–∞–Ω–æ—Å–µ—Ü—å',           emoji:'‚öì', price:750_000_000,     category:'transport' },
    { id:'tr20', name:'–ö–æ—Å–º—ñ—á–Ω–∏–π —à–∞—Ç—Ç–ª –¥–ª—è —Ç—É—Ä–∏–∑–º—É',    emoji:'üöÄ', price:1_500_000_000,   category:'transport' },
  ],
  realestate: [
    { id:'re01', name:'–°—Ç—É–¥—ñ—è –≤ —Ü–µ–Ω—Ç—Ä—ñ –º—ñ—Å—Ç–∞',          emoji:'üè†', price:150_000,         category:'realestate' },
    { id:'re02', name:'–ó–∞–º—ñ—Å—å–∫–∏–π –±—É–¥–∏–Ω–æ–∫ –∑ –±–∞—Å–µ–π–Ω–æ–º',   emoji:'üè°', price:350_000,         category:'realestate' },
    { id:'re03', name:'–õ–æ—Ñ—Ç —É –ù—å—é-–ô–æ—Ä–∫—É',              emoji:'üåÜ', price:750_000,         category:'realestate' },
    { id:'re04', name:'–ü–µ–Ω—Ç—Ö–∞—É—Å —É –î—É–±–∞—ó',              emoji:'üèôÔ∏è', price:1_500_000,       category:'realestate' },
    { id:'re05', name:'–í—ñ–ª–ª–∞ –Ω–∞ –±–µ—Ä–µ–∑—ñ –æ–∫–µ–∞–Ω—É',         emoji:'üåä', price:3_000_000,       category:'realestate' },
    { id:'re06', name:'–ú–∞—î—Ç–æ–∫ —É –õ–æ–Ω–¥–æ–Ω—ñ',              emoji:'üè∞', price:7_000_000,       category:'realestate' },
    { id:'re07', name:'–í–∏–Ω–æ—Ä–æ–±–Ω—è –≤ –¢–æ—Å–∫–∞–Ω—ñ',           emoji:'üç∑', price:12_000_000,      category:'realestate' },
    { id:'re08', name:'–ó–∞–º–æ–∫ —É –§—Ä–∞–Ω—Ü—ñ—ó',               emoji:'üèØ', price:25_000_000,      category:'realestate' },
    { id:'re09', name:'–®–∞–ª–µ –≤ –ö—É—Ä—à–µ–≤–µ–ª—ñ',              emoji:'‚õ∑Ô∏è', price:40_000_000,      category:'realestate' },
    { id:'re10', name:'–†–∞–Ω—á–æ –≤ –¢–µ—Ö–∞—Å—ñ (1000–≥–∞)',        emoji:'ü§†', price:65_000_000,      category:'realestate' },
    { id:'re11', name:'–•–º–∞—Ä–æ—á–æ—Å (–æ—Ñ—ñ—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä)',       emoji:'üè¢', price:150_000_000,     category:'realestate' },
    { id:'re12', name:'–¢—Ä–æ–ø—ñ—á–Ω–∏–π –æ—Å—Ç—Ä—ñ–≤',              emoji:'üèùÔ∏è', price:280_000_000,     category:'realestate' },
    { id:'re13', name:'–ú–µ—Ä–µ–∂–∞ –≥–æ—Ç–µ–ª—ñ–≤ –ª—é–∫—Å',           emoji:'üõéÔ∏è', price:500_000_000,     category:'realestate' },
    { id:'re14', name:'–ü—ñ–¥–≤–æ–¥–Ω–∏–π –≥–æ—Ç–µ–ª—å',              emoji:'üê†', price:850_000_000,     category:'realestate' },
    { id:'re15', name:'–ú—ñ—Å—Ç–æ-—Ç–µ—Ö–Ω–æ–ø–∞—Ä–∫',               emoji:'üåê', price:1_200_000_000,   category:'realestate' },
    { id:'re16', name:'–ù–∞—Ñ—Ç–æ–≤–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞',             emoji:'üõ¢Ô∏è', price:2_500_000_000,   category:'realestate' },
    { id:'re17', name:'–ö–æ—Ä–æ–ª—ñ–≤—Å—å–∫–∏–π –ø–∞–ª–∞—Ü',             emoji:'üëë', price:5_000_000_000,   category:'realestate' },
    { id:'re18', name:'–ö–Ω—è–∑—ñ–≤—Å—Ç–≤–æ',                    emoji:'üó∫Ô∏è', price:12_000_000_000,  category:'realestate' },
    { id:'re19', name:'–ü–ª–∞–≤—É—á–µ –º—ñ—Å—Ç–æ',                 emoji:'üåç', price:50_000_000_000,  category:'realestate' },
    { id:'re20', name:'–ö–æ–ª–æ–Ω—ñ—è –Ω–∞ –ú–∞—Ä—Å—ñ',              emoji:'üî¥', price:250_000_000_000, category:'realestate' },
  ],
  luxury: [
    { id:'lx01', name:'Rolex Daytona',                  emoji:'‚åö', price:40_000,          category:'luxury' },
    { id:'lx02', name:'–ö–æ–ª–µ–∫—Ü—ñ—è —Ä—ñ–¥–∫—ñ—Å–Ω–∏—Ö –≤–∏–Ω',         emoji:'üçæ', price:75_000,          category:'luxury' },
    { id:'lx03', name:'–ó–æ–ª–æ—Ç–∏–π —Å–∞–º–æ—Ä–æ–¥–æ–∫ (2–∫–≥)',         emoji:'ü•á', price:120_000,         category:'luxury' },
    { id:'lx04', name:'–°–∫—É–ª—å–ø—Ç—É—Ä–∞ —Å—É—á–∞—Å–Ω–æ–≥–æ –º–∏—Å—Ç–µ—Ü—Ç–≤–∞', emoji:'üóø', price:250_000,         category:'luxury' },
    { id:'lx05', name:'–î—ñ–∞–º–∞–Ω—Ç–æ–≤–µ –Ω–∞–º–∏—Å—Ç–æ',             emoji:'üíé', price:450_000,         category:'luxury' },
    { id:'lx06', name:'–†–æ—è–ª—å Steinway & Sons',          emoji:'üéπ', price:600_000,         category:'luxury' },
    { id:'lx07', name:'–†–∞—Ä–∏—Ç–µ—Ç–Ω—ñ –∫–æ–º—ñ–∫—Å–∏',              emoji:'üìö', price:900_000,         category:'luxury' },
    { id:'lx08', name:'–ö–∞—Ä—Ç–∏–Ω–∞ —ñ–º–ø—Ä–µ—Å—ñ–æ–Ω—ñ—Å—Ç–∞',          emoji:'üñºÔ∏è', price:2_500_000,       category:'luxury' },
    { id:'lx09', name:'–ö–æ—Ä–æ–Ω–∞ XVIII —Å—Ç–æ–ª—ñ—Ç—Ç—è',          emoji:'üëë', price:5_000_000,       category:'luxury' },
    { id:'lx10', name:'–°–∫–µ–ª–µ—Ç —Ç–∏—Ä–∞–Ω–æ–∑–∞–≤—Ä–∞',             emoji:'ü¶ñ', price:12_000_000,      category:'luxury' },
    { id:'lx11', name:'–Ø–π—Ü–µ –§–∞–±–µ—Ä–∂–µ (–æ—Ä–∏–≥—ñ–Ω–∞–ª)',        emoji:'ü•ö', price:25_000_000,      category:'luxury' },
    { id:'lx12', name:'–°–∫—Ä–∏–ø–∫–∞ –°—Ç—Ä–∞–¥—ñ–≤–∞—Ä—ñ',             emoji:'üéª', price:45_000_000,      category:'luxury' },
    { id:'lx13', name:'–ö–æ–ª–µ–∫—Ü—ñ—è –∞–≤—Ç–æ (20 —à—Ç—É–∫)',         emoji:'üöó', price:80_000_000,      category:'luxury' },
    { id:'lx14', name:'–ó–æ–ª–æ—Ç–∏–π —É–Ω—ñ—Ç–∞–∑ –∑ –¥—ñ–∞–º–∞–Ω—Ç–∞–º–∏',    emoji:'üöΩ', price:120_000_000,     category:'luxury' },
    { id:'lx15', name:'–†—É–∫–æ–ø–∏—Å –¥–∞ –í—ñ–Ω—á—ñ',              emoji:'üìú', price:250_000_000,     category:'luxury' },
    { id:'lx16', name:'–ê–ª–º–∞–∑ "–ó—ñ—Ä–∫–∞ –ê—Ñ—Ä–∏–∫–∏"',          emoji:'üí†', price:500_000_000,     category:'luxury' },
    { id:'lx17', name:'–û—Å–æ–±–∏—Å—Ç–∏–π —Å—É–ø—É—Ç–Ω–∏–∫',             emoji:'üõ∞Ô∏è', price:1_500_000_000,   category:'luxury' },
    { id:'lx18', name:'–§—É—Ç–±–æ–ª—å–Ω–∏–π –∫–ª—É–± –ê-–ª—ñ–≥–∏',         emoji:'‚öΩ', price:4_000_000_000,   category:'luxury' },
    { id:'lx19', name:'–ó–æ–ª–æ—Ç–∏–π –∑–∞–ø–∞—Å –±–∞–Ω–∫—É',            emoji:'üè¶', price:15_000_000_000,  category:'luxury' },
    { id:'lx20', name:'–ü—Ä–∞–≤–æ –Ω–∞ –ú—ñ—Å—è—Ü—å (—Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç)',   emoji:'üåï', price:100_000_000_000, category:'luxury' },
  ],
};

// Flat list for lookups
const LIFESHOP_ALL = [
  ...LIFESHOP_ITEMS.transport,
  ...LIFESHOP_ITEMS.realestate,
  ...LIFESHOP_ITEMS.luxury,
];

// Capital milestones that unlock elite cases
const CAPITAL_MILESTONES = [
  { capital:   5_000_000, id:'elite_common',    name:'–ï–ª—ñ—Ç–Ω–∏–π –ö–µ–π—Å I',     emoji:'üì¶', desc:'–í—Å—ñ Epic –∑ —É—Å—ñ—Ö –∫–µ–π—Å—ñ–≤', color:'#8b5cf6' },
  { capital:  50_000_000, id:'elite_rare',      name:'–ï–ª—ñ—Ç–Ω–∏–π –ö–µ–π—Å II',    emoji:'üíú', desc:'–¢—ñ–ª—å–∫–∏ Legendary –ø—Ä–µ–¥–º–µ—Ç–∏', color:'#f5c842' },
  { capital: 500_000_000, id:'elite_legendary', name:'–ú–µ–≥–∞–∫–µ–π—Å Forbes',    emoji:'üèÜ', desc:'–ù–∞–π—Ü—ñ–Ω–Ω—ñ—à—ñ –ø—Ä–µ–¥–º–µ—Ç–∏ –≥—Ä–∏', color:'#ef4444' },
];

const RARITY_WEIGHTS = { common:60, rare:25, epic:12, legendary:3 };
const RARITY_LABELS  = { common:'‚ö™ –ó–≤–∏—á–∞–π–Ω–∏–π', rare:'üîµ –†—ñ–¥–∫—ñ—Å–Ω–∏–π', epic:'üü£ –ï–ø—ñ—á–Ω–∏–π', legendary:'üü° –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∏–π' };
// Custom SVG item images
const ITEM_IMAGES = {
  '__ELEC_CASE__': 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA4MCA4MCI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9Indvb2RnIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzhiNWUzYyIvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiM1YzNkMWUiLz4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9Indvb2R0ZyIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+CiAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiNhMDcxNGYiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjN2E0ZTJkIi8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPGxpbmVhckdyYWRpZW50IGlkPSJsaWRnIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzljNmIzZSIvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiM2YjQ0MjIiLz4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICA8ZmlsdGVyIGlkPSJ3cyI+PGZlRHJvcFNoYWRvdyBkeD0iMCIgZHk9IjQiIHN0ZERldmlhdGlvbj0iNCIgZmxvb2QtY29sb3I9IiMwMDAiIGZsb29kLW9wYWNpdHk9IjAuNSIvPjwvZmlsdGVyPgogIDwvZGVmcz4KCiAgPCEtLSBTaGFkb3cgLS0+CiAgPGVsbGlwc2UgY3g9IjQwIiBjeT0iNzQiIHJ4PSIyOCIgcnk9IjUiIGZpbGw9ImJsYWNrIiBvcGFjaXR5PSIwLjMiLz4KCiAgPCEtLSBNYWluIGNyYXRlIGJvZHkgLS0+CiAgPHJlY3QgeD0iOCIgeT0iMzIiIHdpZHRoPSI2NCIgaGVpZ2h0PSI0MCIgcng9IjMiIGZpbGw9InVybCgjd29vZGcpIiBmaWx0ZXI9InVybCgjd3MpIi8+CgogIDwhLS0gV29vZCBncmFpbiBsaW5lcyBvbiBib2R5IC0tPgogIDxsaW5lIHgxPSI4IiAgeTE9IjQwIiB4Mj0iNzIiIHkyPSI0MCIgc3Ryb2tlPSIjNGEyZjE0IiBzdHJva2Utd2lkdGg9IjAuOCIgb3BhY2l0eT0iMC40Ii8+CiAgPGxpbmUgeDE9IjgiICB5MT0iNTAiIHgyPSI3MiIgeTI9IjUwIiBzdHJva2U9IiM0YTJmMTQiIHN0cm9rZS13aWR0aD0iMC44IiBvcGFjaXR5PSIwLjQiLz4KICA8bGluZSB4MT0iOCIgIHkxPSI2MCIgeDI9IjcyIiB5Mj0iNjAiIHN0cm9rZT0iIzRhMmYxNCIgc3Ryb2tlLXdpZHRoPSIwLjgiIG9wYWNpdHk9IjAuNCIvPgoKICA8IS0tIFZlcnRpY2FsIHBsYW5rcyAtLT4KICA8bGluZSB4MT0iMjYiIHkxPSIzMiIgeDI9IjI2IiB5Mj0iNzIiIHN0cm9rZT0iIzRhMmYxNCIgc3Ryb2tlLXdpZHRoPSIxLjUiIG9wYWNpdHk9IjAuNSIvPgogIDxsaW5lIHgxPSI1NCIgeTE9IjMyIiB4Mj0iNTQiIHkyPSI3MiIgc3Ryb2tlPSIjNGEyZjE0IiBzdHJva2Utd2lkdGg9IjEuNSIgb3BhY2l0eT0iMC41Ii8+CgogIDwhLS0gTWV0YWwgY29ybmVyIGJyYWNrZXRzIGJvZHkgLS0+CiAgPHJlY3QgeD0iOCIgIHk9IjMyIiB3aWR0aD0iOCIgIGhlaWdodD0iNSIgIHJ4PSIxIiBmaWxsPSIjNTU1IiBvcGFjaXR5PSIwLjciLz4KICA8cmVjdCB4PSI2NCIgeT0iMzIiIHdpZHRoPSI4IiAgaGVpZ2h0PSI1IiAgcng9IjEiIGZpbGw9IiM1NTUiIG9wYWNpdHk9IjAuNyIvPgogIDxyZWN0IHg9IjgiICB5PSI2NyIgd2lkdGg9IjgiICBoZWlnaHQ9IjUiICByeD0iMSIgZmlsbD0iIzU1NSIgb3BhY2l0eT0iMC43Ii8+CiAgPHJlY3QgeD0iNjQiIHk9IjY3IiB3aWR0aD0iOCIgIGhlaWdodD0iNSIgIHJ4PSIxIiBmaWxsPSIjNTU1IiBvcGFjaXR5PSIwLjciLz4KCiAgPCEtLSBEaXJ0L3N0YWluIHBhdGNoZXMgLS0+CiAgPGVsbGlwc2UgY3g9IjIyIiBjeT0iNTUiIHJ4PSI1IiByeT0iMyIgZmlsbD0iIzNhMjAxMCIgb3BhY2l0eT0iMC4zNSIvPgogIDxlbGxpcHNlIGN4PSI1OCIgY3k9IjYyIiByeD0iNCIgcnk9IjIuNSIgZmlsbD0iIzNhMjAxMCIgb3BhY2l0eT0iMC4zIi8+CiAgPGVsbGlwc2UgY3g9IjQwIiBjeT0iNDUiIHJ4PSIzIiByeT0iMiIgZmlsbD0iIzNhMjAxMCIgb3BhY2l0eT0iMC4yIi8+CgogIDwhLS0gU2NyYXRjaCBtYXJrcyAtLT4KICA8bGluZSB4MT0iMzAiIHkxPSIzNiIgeDI9IjM2IiB5Mj0iNDIiIHN0cm9rZT0iIzNhMjAxMCIgc3Ryb2tlLXdpZHRoPSIxIiBvcGFjaXR5PSIwLjUiLz4KICA8bGluZSB4MT0iMzIiIHkxPSIzNiIgeDI9IjM4IiB5Mj0iNDIiIHN0cm9rZT0iIzNhMjAxMCIgc3Ryb2tlLXdpZHRoPSIwLjciIG9wYWNpdHk9IjAuMzUiLz4KICA8bGluZSB4MT0iNDgiIHkxPSI1OCIgeDI9IjUyIiB5Mj0iNjUiIHN0cm9rZT0iIzNhMjAxMCIgc3Ryb2tlLXdpZHRoPSIwLjgiIG9wYWNpdHk9IjAuNCIvPgoKICA8IS0tIEhvbGUvY3JhY2sgLS0+CiAgPGVsbGlwc2UgY3g9IjE5IiBjeT0iNDgiIHJ4PSIyLjUiIHJ5PSIxLjUiIGZpbGw9IiMyYTFhMDgiIG9wYWNpdHk9IjAuNyIvPgogIDxwYXRoIGQ9Ik02MCA0NCBMNjMgNDcgTDYxIDQ4IEw2NCA1MiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMmExYTA4IiBzdHJva2Utd2lkdGg9IjEiIG9wYWNpdHk9IjAuNSIvPgoKICA8IS0tIExpZCAtLT4KICA8cmVjdCB4PSI2IiB5PSIyMCIgd2lkdGg9IjY4IiBoZWlnaHQ9IjE0IiByeD0iMyIgZmlsbD0idXJsKCNsaWRnKSIvPgogIDwhLS0gTGlkIGdyYWluIC0tPgogIDxsaW5lIHgxPSI2IiAgeTE9IjI3IiB4Mj0iNzQiIHkyPSIyNyIgc3Ryb2tlPSIjNGEyZjE0IiBzdHJva2Utd2lkdGg9IjAuOCIgb3BhY2l0eT0iMC40Ii8+CiAgPGxpbmUgeDE9IjI1IiB5MT0iMjAiIHgyPSIyNSIgeTI9IjM0IiBzdHJva2U9IiM0YTJmMTQiIHN0cm9rZS13aWR0aD0iMS4yIiBvcGFjaXR5PSIwLjQiLz4KICA8bGluZSB4MT0iNTUiIHkxPSIyMCIgeDI9IjU1IiB5Mj0iMzQiIHN0cm9rZT0iIzRhMmYxNCIgc3Ryb2tlLXdpZHRoPSIxLjIiIG9wYWNpdHk9IjAuNCIvPgogIDwhLS0gTGlkIG1ldGFsIHN0cmlwcyAtLT4KICA8cmVjdCB4PSI2IiAgeT0iMjAiIHdpZHRoPSI2OCIgaGVpZ2h0PSIzIiByeD0iMS41IiBmaWxsPSIjNjY2IiBvcGFjaXR5PSIwLjQiLz4KICA8cmVjdCB4PSI2IiAgeT0iMzEiIHdpZHRoPSI2OCIgaGVpZ2h0PSIzIiByeD0iMS41IiBmaWxsPSIjNjY2IiBvcGFjaXR5PSIwLjQiLz4KCiAgPCEtLSBMaWQgYnJhY2tldHMgLS0+CiAgPHJlY3QgeD0iNiIgIHk9IjIwIiB3aWR0aD0iOCIgaGVpZ2h0PSI1IiByeD0iMSIgZmlsbD0iIzU1NSIgb3BhY2l0eT0iMC43Ii8+CiAgPHJlY3QgeD0iNjYiIHk9IjIwIiB3aWR0aD0iOCIgaGVpZ2h0PSI1IiByeD0iMSIgZmlsbD0iIzU1NSIgb3BhY2l0eT0iMC43Ii8+CgogIDwhLS0gTG9jay9jbGFzcCBpbiBjZW50ZXIgLS0+CiAgPHJlY3QgeD0iMzQiIHk9IjI4IiB3aWR0aD0iMTIiIGhlaWdodD0iOCIgcng9IjIiIGZpbGw9IiM4ODgiIG9wYWNpdHk9IjAuOCIvPgogIDxyZWN0IHg9IjM2IiB5PSIzMCIgd2lkdGg9IjgiICBoZWlnaHQ9IjQiIHJ4PSIxIiBmaWxsPSIjNTU1Ii8+CiAgPGNpcmNsZSBjeD0iNDAiIGN5PSIzMiIgcj0iMS41IiBmaWxsPSIjYWFhIi8+CgogIDwhLS0gUnVzdCBzcG90cyBvbiBjbGFzcCAtLT4KICA8Y2lyY2xlIGN4PSIzNSIgY3k9IjI5IiByPSIxIiBmaWxsPSIjYzA1MjJhIiBvcGFjaXR5PSIwLjYiLz4KICA8Y2lyY2xlIGN4PSI0NSIgY3k9IjM0IiByPSIwLjgiIGZpbGw9IiNjMDUyMmEiIG9wYWNpdHk9IjAuNSIvPgoKICA8IS0tIFN0aWNrZXIgcmVtbmFudCAodG9ybikgLS0+CiAgPHBhdGggZD0iTTEwIDQyIEwxOCA0MiBMMTggNTIgTDEyIDUyIFoiIGZpbGw9IiNkNGE4NDkiIG9wYWNpdHk9IjAuMjUiLz4KCiAgPCEtLSBOYWlsIGhlYWRzIC0tPgogIDxjaXJjbGUgY3g9IjEyIiBjeT0iMzYiIHI9IjEuMiIgZmlsbD0iIzg4OCIvPgogIDxjaXJjbGUgY3g9IjY4IiBjeT0iMzYiIHI9IjEuMiIgZmlsbD0iIzg4OCIvPgogIDxjaXJjbGUgY3g9IjEyIiBjeT0iNjgiIHI9IjEuMiIgZmlsbD0iIzg4OCIvPgogIDxjaXJjbGUgY3g9IjY4IiBjeT0iNjgiIHI9IjEuMiIgZmlsbD0iIzg4OCIvPgogIDxjaXJjbGUgY3g9IjQwIiBjeT0iMzYiIHI9IjEuMiIgZmlsbD0iIzg4OCIvPgogIDxjaXJjbGUgY3g9IjQwIiBjeT0iNjgiIHI9IjEuMiIgZmlsbD0iIzg4OCIvPgo8L3N2Zz4=',
  '__DRONE__':   'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMjAgMTIwIiB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCI+CiAgPGRlZnM+CiAgICA8cmFkaWFsR3JhZGllbnQgaWQ9ImJvZHlHcmFkIiBjeD0iNTAlIiBjeT0iMzUlIiByPSI2MCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjNGE1NTY4Ii8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iIzFhMjAyYyIvPgogICAgPC9yYWRpYWxHcmFkaWVudD4KICAgIDxyYWRpYWxHcmFkaWVudCBpZD0icHJvcEdyYWQiIGN4PSI1MCUiIGN5PSIzMCUiIHI9IjcwJSI+CiAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiM3MTgwOTYiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjMmQzNzQ4Ii8+CiAgICA8L3JhZGlhbEdyYWRpZW50PgogICAgPHJhZGlhbEdyYWRpZW50IGlkPSJjYW1HcmFkIiBjeD0iNDAlIiBjeT0iMzUlIiByPSI2MCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjNjNiM2VkIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iIzJiNmNiMCIvPgogICAgPC9yYWRpYWxHcmFkaWVudD4KICAgIDxmaWx0ZXIgaWQ9Imdsb3ciPgogICAgICA8ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIyIiByZXN1bHQ9ImJsdXIiLz4KICAgICAgPGZlTWVyZ2U+PGZlTWVyZ2VOb2RlIGluPSJibHVyIi8+PGZlTWVyZ2VOb2RlIGluPSJTb3VyY2VHcmFwaGljIi8+PC9mZU1lcmdlPgogICAgPC9maWx0ZXI+CiAgICA8ZmlsdGVyIGlkPSJzaGFkb3ciPgogICAgICA8ZmVEcm9wU2hhZG93IGR4PSIwIiBkeT0iMyIgc3RkRGV2aWF0aW9uPSIzIiBmbG9vZC1jb2xvcj0iIzAwMCIgZmxvb2Qtb3BhY2l0eT0iMC40Ii8+CiAgICA8L2ZpbHRlcj4KICA8L2RlZnM+CgogIDwhLS0gQXJtcyAtLT4KICA8bGluZSB4MT0iMzUiIHkxPSI1NSIgeDI9IjE4IiB5Mj0iMzgiIHN0cm9rZT0iIzRhNTU2OCIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KICA8bGluZSB4MT0iODUiIHkxPSI1NSIgeDI9IjEwMiIgeTI9IjM4IiBzdHJva2U9IiM0YTU1NjgiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjM1IiB5MT0iNjUiIHgyPSIxOCIgeTI9IjgyIiBzdHJva2U9IiM0YTU1NjgiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9Ijg1IiB5MT0iNjUiIHgyPSIxMDIiIHkyPSI4MiIgc3Ryb2tlPSIjNGE1NTY4IiBzdHJva2Utd2lkdGg9IjQiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgoKICA8IS0tIFByb3BlbGxlciBodWJzIC0tPgogIDxjaXJjbGUgY3g9IjE4IiBjeT0iMzUiIHI9IjE0IiBmaWxsPSJ1cmwoI3Byb3BHcmFkKSIgZmlsdGVyPSJ1cmwoI3NoYWRvdykiLz4KICA8Y2lyY2xlIGN4PSIxMDIiIGN5PSIzNSIgcj0iMTQiIGZpbGw9InVybCgjcHJvcEdyYWQpIiBmaWx0ZXI9InVybCgjc2hhZG93KSIvPgogIDxjaXJjbGUgY3g9IjE4IiBjeT0iODIiIHI9IjE0IiBmaWxsPSJ1cmwoI3Byb3BHcmFkKSIgZmlsdGVyPSJ1cmwoI3NoYWRvdykiLz4KICA8Y2lyY2xlIGN4PSIxMDIiIGN5PSI4MiIgcj0iMTQiIGZpbGw9InVybCgjcHJvcEdyYWQpIiBmaWx0ZXI9InVybCgjc2hhZG93KSIvPgoKICA8IS0tIFByb3BlbGxlciBibGFkZXMgLS0+CiAgPGVsbGlwc2UgY3g9IjE4IiBjeT0iMzUiIHJ4PSIxMyIgcnk9IjMiIGZpbGw9IiNhMGFlYzAiIG9wYWNpdHk9IjAuODUiIHRyYW5zZm9ybT0icm90YXRlKC0yMCwxOCwzNSkiLz4KICA8ZWxsaXBzZSBjeD0iMTAyIiBjeT0iMzUiIHJ4PSIxMyIgcnk9IjMiIGZpbGw9IiNhMGFlYzAiIG9wYWNpdHk9IjAuODUiIHRyYW5zZm9ybT0icm90YXRlKDIwLDEwMiwzNSkiLz4KICA8ZWxsaXBzZSBjeD0iMTgiIGN5PSI4MiIgcng9IjEzIiByeT0iMyIgZmlsbD0iI2EwYWVjMCIgb3BhY2l0eT0iMC44NSIgdHJhbnNmb3JtPSJyb3RhdGUoMjAsMTgsODIpIi8+CiAgPGVsbGlwc2UgY3g9IjEwMiIgY3k9IjgyIiByeD0iMTMiIHJ5PSIzIiBmaWxsPSIjYTBhZWMwIiBvcGFjaXR5PSIwLjg1IiB0cmFuc2Zvcm09InJvdGF0ZSgtMjAsMTAyLDgyKSIvPgoKICA8IS0tIFByb3BlbGxlciBjZW50ZXIgZG90cyAtLT4KICA8Y2lyY2xlIGN4PSIxOCIgY3k9IjM1IiByPSIzIiBmaWxsPSIjZjVjODQyIi8+CiAgPGNpcmNsZSBjeD0iMTAyIiBjeT0iMzUiIHI9IjMiIGZpbGw9IiNmNWM4NDIiLz4KICA8Y2lyY2xlIGN4PSIxOCIgY3k9IjgyIiByPSIzIiBmaWxsPSIjZjVjODQyIi8+CiAgPGNpcmNsZSBjeD0iMTAyIiBjeT0iODIiIHI9IjMiIGZpbGw9IiNmNWM4NDIiLz4KCiAgPCEtLSBNYWluIGJvZHkgLS0+CiAgPHJlY3QgeD0iMzIiIHk9IjQ0IiB3aWR0aD0iNTYiIGhlaWdodD0iMzIiIHJ4PSIxMCIgZmlsbD0idXJsKCNib2R5R3JhZCkiIGZpbHRlcj0idXJsKCNzaGFkb3cpIi8+CiAgPCEtLSBCb2R5IGhpZ2hsaWdodCAtLT4KICA8cmVjdCB4PSIzNiIgeT0iNDciIHdpZHRoPSI0OCIgaGVpZ2h0PSIxMCIgcng9IjUiIGZpbGw9IndoaXRlIiBvcGFjaXR5PSIwLjA4Ii8+CiAgPCEtLSBCb2R5IGRldGFpbCBsaW5lcyAtLT4KICA8bGluZSB4MT0iNDIiIHkxPSI1NSIgeDI9Ijc4IiB5Mj0iNTUiIHN0cm9rZT0iIzcxODA5NiIgc3Ryb2tlLXdpZHRoPSIxIiBvcGFjaXR5PSIwLjUiLz4KICA8bGluZSB4MT0iNDIiIHkxPSI1OSIgeDI9Ijc4IiB5Mj0iNTkiIHN0cm9rZT0iIzcxODA5NiIgc3Ryb2tlLXdpZHRoPSIxIiBvcGFjaXR5PSIwLjMiLz4KCiAgPCEtLSBMRUQgbGlnaHRzIC0tPgogIDxjaXJjbGUgY3g9IjM4IiBjeT0iNzIiIHI9IjMiIGZpbGw9IiNmNTY1NjUiIGZpbHRlcj0idXJsKCNnbG93KSIgb3BhY2l0eT0iMC45Ii8+CiAgPGNpcmNsZSBjeD0iODIiIGN5PSI3MiIgcj0iMyIgZmlsbD0iIzQ4YmI3OCIgZmlsdGVyPSJ1cmwoI2dsb3cpIiBvcGFjaXR5PSIwLjkiLz4KCiAgPCEtLSBDYW1lcmEgZ2ltYmFsIC0tPgogIDxlbGxpcHNlIGN4PSI2MCIgY3k9IjgwIiByeD0iOCIgcnk9IjUiIGZpbGw9IiMyZDM3NDgiLz4KICA8Y2lyY2xlIGN4PSI2MCIgY3k9IjgwIiByPSI1IiBmaWxsPSJ1cmwoI2NhbUdyYWQpIiBmaWx0ZXI9InVybCgjc2hhZG93KSIvPgogIDxjaXJjbGUgY3g9IjYwIiBjeT0iODAiIHI9IjMiIGZpbGw9IiMxYTM2NWQiLz4KICA8Y2lyY2xlIGN4PSI1OCIgY3k9Ijc4IiByPSIxIiBmaWxsPSJ3aGl0ZSIgb3BhY2l0eT0iMC42Ii8+CgogIDwhLS0gQnJhbmQgc3RyaXBlIC0tPgogIDxyZWN0IHg9IjQ0IiB5PSI1MCIgd2lkdGg9IjMyIiBoZWlnaHQ9IjQiIHJ4PSIyIiBmaWxsPSIjZjVjODQyIiBvcGFjaXR5PSIwLjciLz4KCiAgPCEtLSBBbnRlbm5hIC0tPgogIDxsaW5lIHgxPSI2MCIgeTE9IjQ0IiB4Mj0iNjAiIHkyPSIzMiIgc3Ryb2tlPSIjNzE4MDk2IiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgogIDxjaXJjbGUgY3g9IjYwIiBjeT0iMzAiIHI9IjMiIGZpbGw9IiNmNWM4NDIiIGZpbHRlcj0idXJsKCNnbG93KSIvPgo8L3N2Zz4K',
  '__CHARGER__': 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMjAgMTIwIiB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9InN0YXRpb25Cb2R5IiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzJkMzc0OCIvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiMxYTIwMmMiLz4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9InRvcEdyYWQiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzRhNTU2OCIvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiMyZDM3NDgiLz4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9InNjcmVlbkdyYWQiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzFhMzY1ZCIvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiMwZDIxMzciLz4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICA8cmFkaWFsR3JhZGllbnQgaWQ9ImJvbHRHcmFkIiBjeD0iNTAlIiBjeT0iNTAlIiByPSI1MCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjZmVmMDhhIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iI2Y1Yzg0MiIvPgogICAgPC9yYWRpYWxHcmFkaWVudD4KICAgIDxmaWx0ZXIgaWQ9Imdsb3cyIj4KICAgICAgPGZlR2F1c3NpYW5CbHVyIHN0ZERldmlhdGlvbj0iMi41IiByZXN1bHQ9ImJsdXIiLz4KICAgICAgPGZlTWVyZ2U+PGZlTWVyZ2VOb2RlIGluPSJibHVyIi8+PGZlTWVyZ2VOb2RlIGluPSJTb3VyY2VHcmFwaGljIi8+PC9mZU1lcmdlPgogICAgPC9maWx0ZXI+CiAgICA8ZmlsdGVyIGlkPSJzaGFkb3cyIj4KICAgICAgPGZlRHJvcFNoYWRvdyBkeD0iMCIgZHk9IjQiIHN0ZERldmlhdGlvbj0iNCIgZmxvb2QtY29sb3I9IiMwMDAiIGZsb29kLW9wYWNpdHk9IjAuNSIvPgogICAgPC9maWx0ZXI+CiAgPC9kZWZzPgoKICA8IS0tIFNoYWRvdyAtLT4KICA8ZWxsaXBzZSBjeD0iNjAiIGN5PSIxMDgiIHJ4PSIyOCIgcnk9IjUiIGZpbGw9ImJsYWNrIiBvcGFjaXR5PSIwLjI1Ii8+CgogIDwhLS0gTWFpbiBib2R5IC0tPgogIDxyZWN0IHg9IjI0IiB5PSIzMCIgd2lkdGg9IjcyIiBoZWlnaHQ9Ijc1IiByeD0iMTAiIGZpbGw9InVybCgjc3RhdGlvbkJvZHkpIiBmaWx0ZXI9InVybCgjc2hhZG93MikiLz4KCiAgPCEtLSBUb3AgcGFuZWwgLS0+CiAgPHJlY3QgeD0iMjQiIHk9IjMwIiB3aWR0aD0iNzIiIGhlaWdodD0iMTgiIHJ4PSIxMCIgZmlsbD0idXJsKCN0b3BHcmFkKSIvPgogIDxyZWN0IHg9IjI0IiB5PSI0MCIgd2lkdGg9IjcyIiBoZWlnaHQ9IjgiIGZpbGw9InVybCgjdG9wR3JhZCkiLz4KCiAgPCEtLSBCb2R5IGhpZ2hsaWdodCAtLT4KICA8cmVjdCB4PSIyOCIgeT0iMzMiIHdpZHRoPSI2NCIgaGVpZ2h0PSI4IiByeD0iNCIgZmlsbD0id2hpdGUiIG9wYWNpdHk9IjAuMDciLz4KCiAgPCEtLSBTY3JlZW4gLS0+CiAgPHJlY3QgeD0iMzQiIHk9IjUyIiB3aWR0aD0iNTIiIGhlaWdodD0iMjgiIHJ4PSI1IiBmaWxsPSJ1cmwoI3NjcmVlbkdyYWQpIi8+CiAgPHJlY3QgeD0iMzYiIHk9IjU0IiB3aWR0aD0iNDgiIGhlaWdodD0iMjQiIHJ4PSI0IiBmaWxsPSIjMGExNjI4IiBvcGFjaXR5PSIwLjgiLz4KCiAgPCEtLSBTY3JlZW4gY29udGVudDogYmF0dGVyeSAlIC0tPgogIDx0ZXh0IHg9IjYwIiB5PSI2NCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgZm9udC1zaXplPSI5IiBmaWxsPSIjNDhiYjc4IiBmb250LXdlaWdodD0iYm9sZCI+Q0hBUkdJTkc8L3RleHQ+CiAgPCEtLSBCYXR0ZXJ5IGJhciAtLT4KICA8cmVjdCB4PSI0MCIgeT0iNjciIHdpZHRoPSI0MCIgaGVpZ2h0PSI2IiByeD0iMyIgZmlsbD0iIzFhMzY1ZCIvPgogIDxyZWN0IHg9IjQwIiB5PSI2NyIgd2lkdGg9IjI4IiBoZWlnaHQ9IjYiIHJ4PSIzIiBmaWxsPSIjNDhiYjc4IiBvcGFjaXR5PSIwLjkiLz4KICA8dGV4dCB4PSI2MCIgeT0iNzYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iNyIgZmlsbD0iIzYzYjNlZCI+NzIlICDimqEgNjVXPC90ZXh0PgoKICA8IS0tIDMgVVNCIHBvcnRzIC0tPgogIDxyZWN0IHg9IjM0IiB5PSI4NiIgd2lkdGg9IjE0IiBoZWlnaHQ9IjgiIHJ4PSIyIiBmaWxsPSIjMGQxYTJlIi8+CiAgPHJlY3QgeD0iMzYiIHk9Ijg4IiB3aWR0aD0iMTAiIGhlaWdodD0iNCIgcng9IjEiIGZpbGw9IiMyZDRhNmUiLz4KICA8cmVjdCB4PSI1MyIgeT0iODYiIHdpZHRoPSIxNCIgaGVpZ2h0PSI4IiByeD0iMiIgZmlsbD0iIzBkMWEyZSIvPgogIDxyZWN0IHg9IjU1IiB5PSI4OCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjQiIHJ4PSIxIiBmaWxsPSIjMmQ0YTZlIi8+CiAgPHJlY3QgeD0iNzIiIHk9Ijg2IiB3aWR0aD0iMTQiIGhlaWdodD0iOCIgcng9IjIiIGZpbGw9IiMwZDFhMmUiLz4KICA8cmVjdCB4PSI3NCIgeT0iODgiIHdpZHRoPSIxMCIgaGVpZ2h0PSI0IiByeD0iMSIgZmlsbD0iI2Y1Yzg0MiIgb3BhY2l0eT0iMC42Ii8+CgogIDwhLS0gUG9ydCBsYWJlbHMgLS0+CiAgPHRleHQgeD0iNDEiIHk9Ijk5IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0ibW9ub3NwYWNlIiBmb250LXNpemU9IjUiIGZpbGw9IiM3MTgwOTYiPlVTQi1DPC90ZXh0PgogIDx0ZXh0IHg9IjYwIiB5PSI5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgZm9udC1zaXplPSI1IiBmaWxsPSIjNzE4MDk2Ij5VU0ItQTwvdGV4dD4KICA8dGV4dCB4PSI3OSIgeT0iOTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iNSIgZmlsbD0iI2Y1Yzg0MiI+NjVXPC90ZXh0PgoKICA8IS0tIExpZ2h0bmluZyBib2x0IGxvZ28gLS0+CiAgPHBvbHlnb24gcG9pbnRzPSI1NywzNiA1NSw0NCA2MCw0MiA2MywzNiA2NSw0MyA2MCw0MSA1Nyw0OCIgZmlsbD0idXJsKCNib2x0R3JhZCkiIGZpbHRlcj0idXJsKCNnbG93MikiLz4KCiAgPCEtLSBMRUQgc3RyaXAgb24gdG9wIC0tPgogIDxyZWN0IHg9IjMwIiB5PSIzMCIgd2lkdGg9IjYwIiBoZWlnaHQ9IjMiIHJ4PSIxLjUiIGZpbGw9IiNmNWM4NDIiIG9wYWNpdHk9IjAuNCIgZmlsdGVyPSJ1cmwoI2dsb3cyKSIvPgoKICA8IS0tIFNpZGUgdmVudHMgLS0+CiAgPGxpbmUgeDE9IjI0IiB5MT0iNTgiIHgyPSIyNCIgeTI9IjYyIiBzdHJva2U9IiM0YTU1NjgiIHN0cm9rZS13aWR0aD0iMS41IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KICA8bGluZSB4MT0iMjQiIHkxPSI2NCIgeDI9IjI0IiB5Mj0iNjgiIHN0cm9rZT0iIzRhNTU2OCIgc3Ryb2tlLXdpZHRoPSIxLjUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgogIDxsaW5lIHgxPSIyNCIgeTE9IjcwIiB4Mj0iMjQiIHkyPSI3NCIgc3Ryb2tlPSIjNGE1NTY4IiBzdHJva2Utd2lkdGg9IjEuNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9Ijk2IiB5MT0iNTgiIHgyPSI5NiIgeTI9IjYyIiBzdHJva2U9IiM0YTU1NjgiIHN0cm9rZS13aWR0aD0iMS41IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KICA8bGluZSB4MT0iOTYiIHkxPSI2NCIgeDI9Ijk2IiB5Mj0iNjgiIHN0cm9rZT0iIzRhNTU2OCIgc3Ryb2tlLXdpZHRoPSIxLjUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgogIDxsaW5lIHgxPSI5NiIgeTE9IjcwIiB4Mj0iOTYiIHkyPSI3NCIgc3Ryb2tlPSIjNGE1NTY4IiBzdHJva2Utd2lkdGg9IjEuNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+Cjwvc3ZnPgo=',
};
// Max sell multiplier per rarity
const MAX_MULT = 2.0; // kept for reference
// Pity bonus per spin (added when that rarity does NOT drop)
const PITY_PER_SPIN = { rare: 0.5, epic: 0.2, legendary: 0.1 };

// =================== GAME STATE ===================
let state = {
  balance: 0,
  totalEarned: 0,
  clickValue: 1,
  passivePerSec: 0,
  owned: {},
  inventory: [],
  shop: [],          // {id, name, emoji, rarity, value, listPrice, listedAt, timerSec, sold}
  pity: {},  // per-case pity: { caseId: { rare, epic, legendary } }
  shopUnlocked: false,
  invLimit: 10,
  shopLimit: 10,
  shopMult: 1.2,   // current max sell multiplier (upgrades raise this)
  hasBulkMove: false, // unlocked 'move all to shop' feature
  hasBulkList: false, // unlocked 'list all at max' feature
  invUpgLevel: 0,   // inventory limit upgrade level (0=10 slots)
  shopUpgLevel: 0,  // shop limit upgrade level (0=10 slots)
  stats: {
    casesOpened: 0,
    itemsSold: 0,
    rarityCount: { common:0, rare:0, epic:0, legendary:0 },
    bestDrop: null
  },
  lifeAssets: [],   // [{id, itemId, name, emoji, category, price, boughtAt}]
  capitalAchievements: {}, // { id: true } ‚Äî one-time flags
  collections: {},         // { caseId: { itemName: {name,emoji,rarity,value} } }
  collectionBonuses: {},   // { caseId: { multiOpen:true, discount:true } }
  rivalNets: null,          // { name: currentNet } ‚Äî live Forbes wealth tracking
  collUpgLevels: {}          // { caseId: currentLevel } ‚Äî collection shop upgrade levels
};

function saveState() {
  try { localStorage.setItem('mbs_save2', JSON.stringify(state)); } catch(e) {}
}
function loadState() {
  try {
    const s = localStorage.getItem('mbs_save2');
    if (s) {
      const loaded = JSON.parse(s);
      state = Object.assign({}, state, loaded);
      if (!state.stats) state.stats = { casesOpened:0, itemsSold:0, rarityCount:{common:0,rare:0,epic:0,legendary:0}, bestDrop:null };
      if (!state.stats.rarityCount) state.stats.rarityCount = {common:0,rare:0,epic:0,legendary:0};
      if (!state.shop) state.shop = [];
      if (!state.pity) state.pity = {};
      if (state.shopUnlocked === undefined) state.shopUnlocked = false;
      if (!state.shopMult) state.shopMult = 1.2;
      if (!state.invLimit)  state.invLimit  = 10;
      if (!state.shopLimit) state.shopLimit = 10;
      if (state.hasBulkMove === undefined) state.hasBulkMove = false;
      if (state.hasBulkList === undefined) state.hasBulkList = false;
      // Sanitize shop entry ids ‚Äî convert floats to integers
      if (state.shop) {
        state.shop = state.shop.map((e, i) => ({
          ...e,
          id: Number.isInteger(e.id) ? e.id : (Date.now() + i)
        }));
      }
      if (state.invUpgLevel  === undefined) state.invUpgLevel  = 0;
      if (state.shopUpgLevel === undefined) state.shopUpgLevel = 0;
      if (!state.lifeAssets)     state.lifeAssets = [];
      if (!state.collections)    state.collections = {};
      if (!state.collectionBonuses) state.collectionBonuses = {};
      if (!state.rivalNets) {
        // Init rival nets from base values
        state.rivalNets = {};
        FORBES_RIVALS.forEach(r => { if (!r.isPlayer) state.rivalNets[r.name] = r.net; });
      }
      // Re-apply collection bonuses immediately after load
      // (called inline so bonuses are ready before any render)
      if (!state.capitalAchievements) state.capitalAchievements = {};
      if (!state.collUpgLevels) state.collUpgLevels = {};
      // Remove stuck sold items from previous sessions
      state.shop = state.shop.filter(x => !x.sold);

      // ‚îÄ‚îÄ –ü.8: Offline sales processing ‚îÄ‚îÄ
      if (!state.pendingOfflineSales) state.pendingOfflineSales = null;
      const now = Date.now();
      let offlineSoldCount = 0;
      let offlineEarned    = 0;
      const offlineSoldNames = [];

      state.shop = state.shop.filter(entry => {
        if (entry.timerActive && entry.endTime && entry.endTime <= now) {
          // This item sold while player was away
          offlineSoldCount++;
          offlineEarned += (entry.listPrice || entry.value || 0);
          offlineSoldNames.push(entry.name);
          return false; // remove from shop
        }
        return true;
      });

      if (offlineSoldCount > 0) {
        state.pendingOfflineSales = {
          count:   offlineSoldCount,
          earned:  offlineEarned,
          names:   offlineSoldNames,
        };
        // stats update
        if (!state.stats) state.stats = { casesOpened:0, itemsSold:0 };
        state.stats.itemsSold = (state.stats.itemsSold || 0) + offlineSoldCount;
      }
    }
  } catch(e) {}
}

// =================== UTILS ===================
function fmt(n) {
  if (n >= 1e6) return (n/1e6).toFixed(2) + 'M‚Ç¨';
  if (n >= 1e3) return (n/1e3).toFixed(1) + 'K‚Ç¨';
  return n + '‚Ç¨';
}
function showToast(msg, type='success') {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast show ' + type;
  setTimeout(() => { t.className = 'toast'; }, 2200);
}

// =================== SOUNDS (Web Audio API) ===================
let audioCtx = null;
function getAudioCtx() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  return audioCtx;
}
function playTick() {
  try {
    const ctx = getAudioCtx();
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.connect(g); g.connect(ctx.destination);
    o.frequency.value = 800 + Math.random() * 400;
    o.type = 'sine';
    g.gain.setValueAtTime(.15, ctx.currentTime);
    g.gain.exponentialRampToValueAtTime(.001, ctx.currentTime + .08);
    o.start(); o.stop(ctx.currentTime + .08);
  } catch(e) {}
}
function playClick() {
  try {
    const ctx = getAudioCtx();
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.connect(g); g.connect(ctx.destination);
    o.frequency.value = 440;
    o.type = 'triangle';
    g.gain.setValueAtTime(.1, ctx.currentTime);
    g.gain.exponentialRampToValueAtTime(.001, ctx.currentTime + .06);
    o.start(); o.stop(ctx.currentTime + .06);
  } catch(e) {}
}
function playFanfare() {
  try {
    const ctx = getAudioCtx();
    const notes = [523, 659, 784, 1047];
    notes.forEach((freq, i) => {
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.connect(g); g.connect(ctx.destination);
      o.frequency.value = freq;
      o.type = 'sine';
      const t = ctx.currentTime + i * 0.15;
      g.gain.setValueAtTime(0, t);
      g.gain.linearRampToValueAtTime(.25, t + .05);
      g.gain.exponentialRampToValueAtTime(.001, t + .4);
      o.start(t); o.stop(t + .4);
    });
  } catch(e) {}
}
function playSell() {
  try {
    const ctx = getAudioCtx();
    [523, 659].forEach((freq, i) => {
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.connect(g); g.connect(ctx.destination);
      o.frequency.value = freq;
      o.type = 'sine';
      const t = ctx.currentTime + i * .1;
      g.gain.setValueAtTime(.12, t);
      g.gain.exponentialRampToValueAtTime(.001, t + .2);
      o.start(t); o.stop(t + .2);
    });
  } catch(e) {}
}

// =================== ITEM DISPLAY ===================
function itemDisplay(emoji, size) {
  size = size || 40;
  if (ITEM_IMAGES[emoji]) {
    return '<img src="' + ITEM_IMAGES[emoji] + '" width="' + size + '" height="' + size + '" style="object-fit:contain;display:block;">';
  }
  return '<span style="font-size:' + Math.round(size * 0.75) + 'px;line-height:1">' + emoji + '</span>';
}

// =================== CLICKER ===================
function handleClick(e) {
  // Base click value + collection bonuses
  let clickAmt = state.clickValue;
  clickAmt += (state._collBonus_clickFlat || 0);
  clickAmt = Math.round(clickAmt * (state._collBonus_clickMult || 1));

  // Critical click chance (Elite Collector bonus)
  const critChance = state._collBonus_critChance || 0;
  let isCrit = false;
  if (critChance > 0 && Math.random() < critChance) {
    clickAmt *= 10;
    isCrit = true;
  }

  state.balance     += clickAmt;
  state.totalEarned += clickAmt;
  playClick();
  updateHUD();

  const el = document.createElement('div');
  el.className = 'float-earn';
  el.textContent = (isCrit ? '‚ö° –ö–†–ò–¢! +' : '+') + fmt(clickAmt);
  el.style.left = (e.clientX - 20) + 'px';
  el.style.top  = (e.clientY - 20) + 'px';
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 900);

  renderUpgrades();
  saveState();
}

// Passive income
function getDynamicPassiveBonus() {
  // Elite Collector: –î–∏–Ω–∞–º—ñ—á–Ω–∏–π –ø–∞—Å–∏–≤ ‚Äî % –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –∫–∞–ø—ñ—Ç–∞–ª—É
  if (!state._collBonus_dynamicPassive) return 0;
  const cap = calcCapital().total;
  if      (cap < 10000)       return 0.005;   // 0.5%
  else if (cap < 50000)       return 0.01;    // 1%
  else if (cap < 200000)      return 0.02;    // 2%
  else if (cap < 1000000)     return 0.05;    // 5%
  else if (cap < 10000000)    return 0.10;    // 10%
  else if (cap < 100000000)   return 0.25;    // 25%
  else if (cap < 1000000000)  return 0.50;    // 50%
  else                        return 1.00;    // 100%
}

setInterval(() => {
  if (state.passivePerSec > 0) {
    const passiveMult  = state._collBonus_passiveMult  || 1;
    const passiveSpeed = state._collBonus_passiveSpeed || 1;
    const passiveFlat  = state._collBonus_passiveFlat  || 0;
    const dynBonus     = getDynamicPassiveBonus();
    const base = state.passivePerSec * passiveMult * passiveSpeed + passiveFlat;
    const earned = Math.round(base * (1 + dynBonus));
    state.balance     += earned;
    state.totalEarned += earned;
    updateHUD();
    saveState();
  }
}, 1000);

// =================== HUD ===================
function updateHUD() {
  const el = document.getElementById('balanceDisplay');
  el.textContent = fmt(state.balance);
  el.classList.remove('pop');
  void el.offsetWidth;
  el.classList.add('pop');
  setTimeout(() => el.classList.remove('pop'), 100);

  document.getElementById('totalEarned').textContent = fmt(state.totalEarned);
  const _clickMultHUD = state._collBonus_clickMult || 1;
  const _totalClick = Math.round((state.clickValue + (state._collBonus_clickFlat || 0)) * _clickMultHUD);
  document.getElementById('perClickDisplay').textContent = _totalClick;
  document.getElementById('clickValHint').textContent = _totalClick;
  const pm  = state._collBonus_passiveMult  || 1;
  const ps  = state._collBonus_passiveSpeed || 1;
  const pfl = state._collBonus_passiveFlat  || 0;
  const dyn = getDynamicPassiveBonus ? getDynamicPassiveBonus() : 0;
  const actualPassive = state.passivePerSec > 0
    ? Math.round((state.passivePerSec * pm * ps + pfl) * (1 + dyn)) : 0;
  // –ü.11: Update clicker capital banner
  const _cc = calcCapital();
  const _cr = getForbesRank(_cc.total);
  const _ect = document.getElementById('clickerCapTotal');
  const _ecb = document.getElementById('clickerBalance');
  const _ecf = document.getElementById('clickerForbes');
  if (_ect) _ect.textContent = fmtCapital(_cc.total);
  if (_ecb) _ecb.textContent = fmtCapital(state.balance);
  if (_ecf) _ecf.textContent = '#' + _cr;
    document.getElementById('passiveDisplay').textContent =
    actualPassive > 0
      ? '+' + actualPassive + '‚Ç¨/—Å–µ–∫' + (pm > 1 || ps > 1 ? ' ‚ú®' : '')
      : '';

  const inv = state.inventory.length;
  const badge = document.getElementById('invBadge');
  if (inv > 0) { badge.style.display = 'inline'; badge.textContent = inv; }
  else badge.style.display = 'none';

  // Inventory limit bar
  const invPct = Math.min(100, (inv / state.invLimit) * 100);
  const invBar = document.getElementById('invLimitBar');
  const invLbl = document.getElementById('invLimitLabel');
  if (invBar) { invBar.style.width = invPct + '%'; invBar.className = 'limit-fill' + (invPct >= 100 ? ' full' : invPct >= 80 ? ' warn' : ''); }
  if (invLbl) invLbl.textContent = inv + ' / ' + state.invLimit;

  // Shop limit bar
  const shopActive = state.shop.filter(x => !x.sold).length;
  const shopPct = Math.min(100, (shopActive / state.shopLimit) * 100);
  const shopBar = document.getElementById('shopLimitBar');
  const shopLbl = document.getElementById('shopLimitLabel');
  if (shopBar) { shopBar.style.width = shopPct + '%'; shopBar.className = 'limit-fill' + (shopPct >= 100 ? ' full' : shopPct >= 80 ? ' warn' : ''); }
  if (shopLbl) shopLbl.textContent = shopActive + ' / ' + state.shopLimit;

  // Unlock shop button state
  const unlockBtn = document.getElementById('unlockShopBtn');
  if (unlockBtn) unlockBtn.disabled = state.balance < 500;
  // Refresh mult upgrade btn affordability
  const multCard = document.getElementById('multUpgradeCard');
  if (multCard && multCard.innerHTML) renderMultUpgrade();
  // Re-render inv/shop upgrades if visible
  const invBulkCard = document.getElementById('bulkMoveUpgradeCard');
  if (invBulkCard && invBulkCard.innerHTML) renderInvUpgrades();
  const shopLimCard = document.getElementById('shopLimitUpgradeCard');
  if (shopLimCard && shopLimCard.innerHTML) renderShopUpgrades();
  const collUpgCont = document.getElementById('collShopUpgradesContainer');
  if (collUpgCont) renderCollShopUpgrades();
  const listAllCard = document.getElementById('listAllMaxCard');
  if (listAllCard && listAllCard.innerHTML) renderListAllMaxCard();
  updateCapitalUI();
  // Show bulk move button if purchased
  const bulkWrap = document.getElementById('bulkMoveWrap');
  if (bulkWrap) bulkWrap.style.display = state.hasBulkMove ? 'block' : 'none';
  const listAllBtn = document.getElementById('listAllMaxBtn');
  if (listAllBtn) listAllBtn.style.display = state.hasBulkList ? 'block' : 'none';
}

// =================== UPGRADES ===================
function renderUpgrades() {
  const list = document.getElementById('upgradeList');
  list.innerHTML = '';
  UPGRADES.forEach(u => {
    const owned  = !!state.owned[u.id];
    const canBuy = !owned && state.balance >= u.price;

    const div = document.createElement('div');
    div.className = 'upgrade-item' + (owned ? ' owned' : !canBuy ? ' locked' : '');

    const iconEl = document.createElement('div');
    iconEl.className = 'upg-icon';
    iconEl.textContent = u.icon;

    const infoEl = document.createElement('div');
    infoEl.className = 'upg-info';
    const nameEl = document.createElement('div');
    nameEl.className = 'upg-name';
    nameEl.textContent = u.name;
    const descEl = document.createElement('div');
    descEl.className = 'upg-desc';
    descEl.textContent = u.desc;
    infoEl.appendChild(nameEl);
    infoEl.appendChild(descEl);

    const btn = document.createElement('button');
    btn.className = 'upg-btn ' + (owned ? 'done' : canBuy ? 'buyable' : 'cant');
    btn.textContent = owned ? '‚úì –ö—É–ø–ª–µ–Ω–æ' : fmt(u.price);
    if (!owned) btn.addEventListener('click', () => buyUpgrade(u.id));

    div.appendChild(iconEl);
    div.appendChild(infoEl);
    div.appendChild(btn);
    list.appendChild(div);
  });

}

function buyUpgrade(id) {
  const u = UPGRADES.find(x => x.id === id);
  if (!u || state.owned[id] || state.balance < u.price) return;
  state.balance -= u.price;
  state.owned[id] = true;
  state.clickValue += u.clickBonus;
  state.passivePerSec += u.passiveBonus;
  playSell();
  showToast('‚úÖ ' + u.name + ' –∫—É–ø–ª–µ–Ω–æ!');
  updateHUD(); renderUpgrades(); saveState();
}

function buyInvUpgrade() {
  const nextLvl = state.invUpgLevel + 1;
  if (nextLvl >= INV_LEVELS.length) return;
  const next = INV_LEVELS[nextLvl];
  if (state.balance < next.price) { showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤!'); return; }
  state.balance -= next.price;
  state.invUpgLevel = nextLvl;
  state.invLimit = next.slots;
  playSell();
  showToast('‚úÖ –°–∫–ª–∞–¥ —Ä–æ–∑—à–∏—Ä–µ–Ω–æ –¥–æ ' + next.slots + ' –º—ñ—Å—Ü—å!');
  updateHUD(); saveState(); renderInvUpgrades();
}

function buyShopUpgrade() {
  const nextLvl = state.shopUpgLevel + 1;
  if (nextLvl >= SHOP_LEVELS.length) return;
  const next = SHOP_LEVELS[nextLvl];
  if (!state.shopUnlocked) { showToast('üîí –°–ø–æ—á–∞—Ç–∫—É –≤—ñ–¥–∫—Ä–∏–π –º–∞–≥–∞–∑–∏–Ω!'); return; }
  if (state.balance < next.price) { showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤!'); return; }
  state.balance -= next.price;
  state.shopUpgLevel = nextLvl;
  state.shopLimit = next.slots;
  playSell();
  showToast('‚úÖ –ú–∞–≥–∞–∑–∏–Ω —Ä–æ–∑—à–∏—Ä–µ–Ω–æ –¥–æ ' + next.slots + ' —Å–ª–æ—Ç—ñ–≤!');
  updateHUD(); saveState(); renderShopUpgrades();
}

function buyBulkMove() {
  if (state.hasBulkMove) return;
  if (state.balance < BULK_MOVE_PRICE) { showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤!'); return; }
  state.balance -= BULK_MOVE_PRICE;
  state.hasBulkMove = true;
  playSell();
  showToast('‚úÖ –ú–∞—Å–æ–≤–µ –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è —Ä–æ–∑–±–ª–æ–∫–æ–≤–∞–Ω–æ!');
  updateHUD(); saveState(); renderInvUpgrades();
  // Show bulk move button
  const wrap = document.getElementById('bulkMoveWrap');
  if (wrap) wrap.style.display = 'block';
}

function bulkMoveToShop() {
  if (!state.shopUnlocked) { showToast('üîí –°–ø–æ—á–∞—Ç–∫—É –≤—ñ–¥–∫—Ä–∏–π –º–∞–≥–∞–∑–∏–Ω!'); return; }
  const activeInShop = state.shop.filter(x => !x.sold).length;
  const available = state.shopLimit - activeInShop;
  if (available <= 0) { showToast('‚ùå –ú–∞–≥–∞–∑–∏–Ω –ø–æ–≤–Ω–∏–π!'); return; }
  const shuffled = [...state.inventory].sort(() => Math.random() - 0.5);
  const toMove = shuffled.slice(0, available);
  if (!toMove.length) { showToast('–°–∫–ª–∞–¥ –ø–æ—Ä–æ–∂–Ω—ñ–π!'); return; }
  let moved = 0;
  toMove.forEach(item => {
    const baseVal  = getSellValue(item);                       // market price + collection bonus
    const maxPrice = Math.round(baseVal * state.shopMult);     // max = boosted base √ó shopMult
    const entryId  = Date.now() + moved; // unique integer id
    const shopEntry = {
      id:        entryId,
      invId:     item.id,
      name:      item.name,
      emoji:     item.emoji,
      rarity:    item.rarity,
      value:     item.value,   // keep original for reference
      maxPrice:  maxPrice,
      listPrice: baseVal,      // default listing = boosted base price
      listedAt:  Date.now(),
      timerSec:  0,
      sold:      false,
      fromCase:      item.fromCase || null,
      fromContainer: item.fromContainer || null,
    };
    state.shop.push(shopEntry);
    state.inventory = state.inventory.filter(x => x.id !== item.id);
    moved++;
  });
  showToast('üöÄ –ü–µ—Ä–µ–º—ñ—â–µ–Ω–æ ' + moved + ' –ø—Ä–µ–¥–º–µ—Ç—ñ–≤ —É –º–∞–≥–∞–∑–∏–Ω!');
  updateHUD(); saveState(); renderInventory(); renderShop();
}

// =================== CASES ===================
function buildRarityBar(container, caseId) {
  const ch = getDisplayChances(caseId);
  const base = { common:60, rare:25, epic:12, legendary:3 };

  function seg(pct, color, label, bonusPct) {
    const bonusStr = bonusPct > 0
      ? ' <span class="pity-plus">+' + bonusPct.toFixed(1) + '</span>'
      : '';
    // Hide label text if segment too narrow to fit
    const showLabel = pct >= 6;
    return '<div class="rarity-seg" style="width:' + pct + '%;background:' + color + '">' +
      (showLabel ? '<span class="rarity-seg-label">' + label + '%' + bonusStr + '</span>' : '') +
    '</div>';
  }

  const track = document.createElement('div');
  track.className = 'case-rarity-bar-track';
  track.innerHTML =
    seg(ch.common,    'var(--common)',    ch.common,    0) +
    seg(ch.rare,      'var(--rare)',      ch.rare,      +(ch.rare      - base.rare).toFixed(1)) +
    seg(ch.epic,      'var(--epic)',      ch.epic,      +(ch.epic      - base.epic).toFixed(1)) +
    seg(ch.legendary, 'var(--legendary)', ch.legendary, +(ch.legendary - base.legendary).toFixed(1));

  container.innerHTML = '';
  container.appendChild(track);
}

function updateRarityBar(caseId) {
  const bar = document.getElementById('rarity-bar-' + caseId);
  if (bar) buildRarityBar(bar, caseId);
}

function updateAllRarityBars() {
  CASES.forEach(c => updateRarityBar(c.id));
  MYSTERY_BOXES.forEach(mb => updateRarityBar(mb.id));
  // Re-render containers if visible (pity bars update)
  const cPane = document.getElementById('casesPane-containers');
  if (cPane && cPane.style.display !== 'none') renderContainers();
}


function renderCases() {
  const grid = document.getElementById('casesGrid');
  grid.innerHTML = '';
  CASES.forEach(c => {
    const canOpen = state.balance >= c.price;
    const card = document.createElement('div');
    card.className = 'case-card';

    const banner = document.createElement('div');
    banner.className = 'case-banner';
    const emojiEl = document.createElement('div');
    emojiEl.className = 'case-emoji';
    emojiEl.innerHTML = itemDisplay(c.icon, 48);
    const metaEl = document.createElement('div');
    metaEl.className = 'case-meta';
    const nameEl = document.createElement('div');
    nameEl.className = 'case-name';
    nameEl.textContent = c.name;
    const descEl = document.createElement('div');
    descEl.className = 'case-desc';
    descEl.textContent = c.desc;
    metaEl.appendChild(nameEl);
    metaEl.appendChild(descEl);
    const priceTag = document.createElement('div');
    priceTag.className = 'case-price-tag';
    priceTag.textContent = fmt(c.price);
    banner.appendChild(emojiEl);
    banner.appendChild(metaEl);
    banner.appendChild(priceTag);

    const rarityBar = document.createElement('div');
    rarityBar.className = 'case-rarity-bar';
    rarityBar.id = 'rarity-bar-' + c.id;
    buildRarityBar(rarityBar, c.id);

    // Buttons row
    const btnRow = document.createElement('div');
    btnRow.style.cssText = 'display:flex;gap:8px;padding:0 18px 16px;';

    const effectivePrice = getCaseOpenPrice(c);
    const collBonus = state.collectionBonuses[c.id] || {};

    const openBtn = document.createElement('button');
    openBtn.className = 'open-case-btn ' + (canOpen ? 'can' : 'cannot');
    openBtn.style.cssText = 'flex:1;margin:0;';
    const priceLabel = effectivePrice < c.price
      ? fmt(effectivePrice) + ' <span style="text-decoration:line-through;opacity:.5;font-size:10px;">' + fmt(c.price) + '</span>'
      : fmt(c.price);
    openBtn.innerHTML = canOpen ? 'üé≤ –í—ñ–¥–∫—Ä–∏—Ç–∏ –∑–∞ ' + priceLabel : 'üîí –ü–æ—Ç—Ä—ñ–±–Ω–æ ' + fmt(c.price);
    if (canOpen) openBtn.addEventListener('click', () => openCaseModal(c.id));

    const previewBtn = document.createElement('button');
    previewBtn.style.cssText = 'padding:10px 14px;border-radius:10px;border:1px solid var(--border);background:var(--bg);color:var(--muted);cursor:pointer;font-size:16px;flex-shrink:0;';
    previewBtn.textContent = 'üëÅÔ∏è';
    previewBtn.title = '–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤–º—ñ—Å—Ç –∫–µ–π—Å—É';
    previewBtn.addEventListener('click', () => openPreviewModal(c.id));

    btnRow.appendChild(openBtn);
    btnRow.appendChild(previewBtn);

    // x5 multi-open if collection mastered
    if (collBonus.multiOpen) {
      const x5Btn = document.createElement('button');
      x5Btn.className = 'open-case-btn can';
      x5Btn.style.cssText = 'flex:none;padding:4px 6px;font-size:11px;font-weight:800;background:rgba(245,200,66,.12);border:1px solid rgba(245,200,66,.35);color:var(--gold);margin:0;line-height:1.1;text-align:center;width:34px;min-width:34px;max-width:34px;box-sizing:border-box;border-radius:8px;';
      x5Btn.innerHTML = '‚ö°√ó5';
      const cost5 = effectivePrice * 5;
      if (state.balance < cost5) { x5Btn.disabled = true; x5Btn.style.opacity = '.4'; }
      x5Btn.addEventListener('click', () => openCaseMulti(c.id, 5));
      btnRow.appendChild(x5Btn);
    }

    card.appendChild(banner);
    card.appendChild(rarityBar);
    card.appendChild(btnRow);
    grid.appendChild(card);
  });
}

// =================== ITEMS PREVIEW MODAL ===================
function openPreviewModal(caseId) {
  const c = CASES.find(x => x.id === caseId);
  if (!c) return;
  document.getElementById('previewTitle').textContent = c.icon + ' ' + c.name;
  const list = document.getElementById('previewList');
  list.innerHTML = '';

  // Sort by value desc
  const sorted = [...c.items].sort((a,b) => b.value - a.value);
  const maxVal = sorted[0].value;

  // Show pity header if any pity is active
  const p = getPityForCase(caseId);
  const hasPity = p.rare > 0 || p.epic > 0 || p.legendary > 0;
  if (hasPity) {
    const pityHeader = document.createElement('div');
    pityHeader.style.cssText = 'background:rgba(245,200,66,.08);border:1px solid rgba(245,200,66,.2);border-radius:10px;padding:10px 14px;margin-bottom:4px;font-size:12px;';
    pityHeader.innerHTML =
      '<div style="color:var(--gold);font-weight:700;margin-bottom:6px;">üçÄ Pity System ‚Äî –Ω–∞–∫–æ–ø–∏—á–µ–Ω—ñ –±–æ–Ω—É—Å–∏:</div>' +
      (p.rare      > 0 ? '<div style="color:var(--rare)">üîµ –†—ñ–¥–∫—ñ—Å–Ω–∏–π: +' + p.rare.toFixed(1)      + '% –¥–æ –±–∞–∑–æ–≤–æ–≥–æ —à–∞–Ω—Å—É</div>' : '') +
      (p.epic      > 0 ? '<div style="color:var(--epic)">üü£ –ï–ø—ñ—á–Ω–∏–π: +'   + p.epic.toFixed(1)      + '% –¥–æ –±–∞–∑–æ–≤–æ–≥–æ —à–∞–Ω—Å—É</div>' : '') +
      (p.legendary > 0 ? '<div style="color:var(--legendary)">üü° –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∏–π: +' + p.legendary.toFixed(1) + '% –¥–æ –±–∞–∑–æ–≤–æ–≥–æ —à–∞–Ω—Å—É</div>' : '');
    list.appendChild(pityHeader);
  }

  // Calculate current effective chances
  const chances = getDisplayChances(caseId);
  const baseChances = { common: 60, rare: 25, epic: 12, legendary: 3 };

  // Group items by rarity to show rarity header once
  const rarityOrder = ['legendary','epic','rare','common'];
  const byRarity = {};
  sorted.forEach(item => {
    if (!byRarity[item.rarity]) byRarity[item.rarity] = [];
    byRarity[item.rarity].push(item);
  });

  rarityOrder.forEach(rarity => {
    if (!byRarity[rarity]) return;
    const currentChance = chances[rarity];
    const baseChance    = baseChances[rarity];
    const bonus = +(currentChance - baseChance).toFixed(1);
    const bonusStr = bonus > 0 ? ' <span style="color:var(--green);font-size:10px">+' + bonus + '%</span>' : '';

    // Rarity divider
    const divider = document.createElement('div');
    divider.style.cssText = 'font-size:11px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--' + rarity + ');padding:6px 2px 2px;display:flex;align-items:center;gap:6px;';
    divider.innerHTML = RARITY_LABELS[rarity] + ' ‚Äî ' + currentChance + '%' + bonusStr;
    list.appendChild(divider);

    byRarity[rarity].forEach(item => {
      const div = document.createElement('div');
      div.className = 'preview-item ' + item.rarity;
      div.innerHTML =
        '<span class="pi-emoji">' + itemDisplay(item.emoji, 28) + '</span>' +
        '<span class="pi-name r-' + item.rarity + '">' + item.name + '</span>' +
        '<div style="text-align:right">' +
          '<div class="pi-val r-' + item.rarity + '">' + fmt(item.value) + '</div>' +
        '</div>';
      list.appendChild(div);
    });
  });

  document.getElementById('previewModal').classList.add('show');
}

function closePreviewModal() {
  document.getElementById('previewModal').classList.remove('show');
}

function openMboxPreviewModal(mbId) {
  const mb = MYSTERY_BOXES.find(x => x.id === mbId);
  if (!mb) return;

  // Reuse the same previewModal + previewList
  document.getElementById('previewTitle').textContent = mb.icon + ' ' + mb.name;
  const list = document.getElementById('previewList');
  list.innerHTML = '';

  // ‚îÄ‚îÄ Pity header ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const p = getPityForCase(mbId);
  const hasPity = p.rare > 0 || p.epic > 0 || p.legendary > 0;
  if (hasPity) {
    const pityHeader = document.createElement('div');
    pityHeader.style.cssText = 'background:rgba(245,200,66,.08);border:1px solid rgba(245,200,66,.2);border-radius:10px;padding:10px 14px;margin-bottom:4px;font-size:12px;';
    pityHeader.innerHTML =
      '<div style="color:var(--gold);font-weight:700;margin-bottom:6px;">üçÄ Pity System ‚Äî –Ω–∞–∫–æ–ø–∏—á–µ–Ω—ñ –±–æ–Ω—É—Å–∏:</div>' +
      (p.rare      > 0 ? '<div style="color:var(--rare)">üîµ –†—ñ–¥–∫—ñ—Å–Ω–∏–π: +' + p.rare.toFixed(1)      + '% –¥–æ –±–∞–∑–æ–≤–æ–≥–æ —à–∞–Ω—Å—É</div>' : '') +
      (p.epic      > 0 ? '<div style="color:var(--epic)">üü£ –ï–ø—ñ—á–Ω–∏–π: +'   + p.epic.toFixed(1)      + '% –¥–æ –±–∞–∑–æ–≤–æ–≥–æ —à–∞–Ω—Å—É</div>' : '') +
      (p.legendary > 0 ? '<div style="color:var(--legendary)">üü° –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∏–π: +' + p.legendary.toFixed(1) + '% –¥–æ –±–∞–∑–æ–≤–æ–≥–æ —à–∞–Ω—Å—É</div>' : '');
    list.appendChild(pityHeader);
  }

  // ‚îÄ‚îÄ Note: each spin rolls 1 item √ó 3 times ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const noteEl = document.createElement('div');
  noteEl.style.cssText = 'font-size:11px;color:var(--muted);background:var(--bg3);border-radius:8px;padding:8px 12px;margin-bottom:4px;';
  noteEl.innerHTML = 'üé∞ <b style="color:var(--text)">Mystery Box</b> ‚Äî –≤–∏–≥—Ä–∞—î—à <b style="color:var(--gold)">3 –ø—Ä–∏–∑–∏</b> –∑–∞ –æ–¥–Ω–µ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è. –®–∞–Ω—Å–∏ –∫–æ–∂–Ω–æ–≥–æ —Å–ª–æ—Ç–∞ –Ω–µ–∑–∞–ª–µ–∂–Ω—ñ.';
  list.appendChild(noteEl);

  // ‚îÄ‚îÄ Items by rarity with per-item chance ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const chances     = getDisplayChances(mbId);
  const baseChances = { common:60, rare:25, epic:12, legendary:3 };
  const rarityOrder = ['legendary','epic','rare','common'];
  const byRarity    = {};
  [...mb.items].sort((a,b) => b.value - a.value).forEach(item => {
    if (!byRarity[item.rarity]) byRarity[item.rarity] = [];
    byRarity[item.rarity].push(item);
  });

  rarityOrder.forEach(rarity => {
    if (!byRarity[rarity]) return;
    const currentChance = chances[rarity];
    const baseChance    = baseChances[rarity];
    const bonus = +(currentChance - baseChance).toFixed(1);
    const bonusStr = bonus > 0
      ? ' <span style="color:var(--green);font-size:10px">+' + bonus + '%</span>' : '';
    const itemCount   = byRarity[rarity].length;
    const perItemChance = +(currentChance / itemCount).toFixed(2);

    // Rarity header row
    const divider = document.createElement('div');
    divider.style.cssText = 'font-size:11px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--' + rarity + ');padding:6px 2px 2px;display:flex;align-items:center;gap:6px;';
    divider.innerHTML = RARITY_LABELS[rarity] + ' ‚Äî ' + currentChance + '%' + bonusStr +
      '<span style="color:var(--muted);font-size:10px;font-weight:400;margin-left:auto;">~' + perItemChance + '% –∫–æ–∂–µ–Ω</span>';
    list.appendChild(divider);

    byRarity[rarity].forEach(item => {
      const div = document.createElement('div');
      div.className = 'preview-item ' + item.rarity;
      div.innerHTML =
        '<span class="pi-emoji">' + itemDisplay(item.emoji, 28) + '</span>' +
        '<span class="pi-name r-' + item.rarity + '">' + item.name + '</span>' +
        '<div style="text-align:right">' +
          '<div class="pi-val r-' + item.rarity + '">' + fmt(item.value) + '</div>' +
          '<div style="font-size:10px;color:var(--muted);">~' + perItemChance + '%</div>' +
        '</div>';
      list.appendChild(div);
    });
  });

  document.getElementById('previewModal').classList.add('show');
}

document.getElementById('previewModal').addEventListener('click', function(e) {
  if (e.target === this) closePreviewModal();
});

// =================== CASE MODAL ===================
let currentCase   = null;
let currentResult = null;
let spinning      = false;
let hasSpunOnce   = false; // track if first spin done

function openCaseModal(caseId) {
  currentCase = CASES.find(c => c.id === caseId);
  if (!currentCase) return;
  // Apply collection discount to case price for this session
  currentCase._effectivePrice = getCaseOpenPrice(currentCase);
  hasSpunOnce = false;
  currentResult = null;
  document.getElementById('modalResult').style.display = 'none';
  document.getElementById('spinBtn').disabled = false;
  document.getElementById('spinBtn').textContent = 'üé≤ –í–Ü–î–ö–†–ò–¢–ò';
  buildCarousel(currentCase);
  document.getElementById('caseModal').classList.add('show');
}

function buildCarousel(c) {
  const track = document.getElementById('carouselTrack');
  track.innerHTML = '';
  track.style.transition = 'none';
  track.style.transform = 'translateX(0)';
}

// Get current effective weights including pity bonuses
function getPityForCase(caseId) {
  if (!state.pity[caseId]) state.pity[caseId] = { rare: 0, epic: 0, legendary: 0 };
  return state.pity[caseId];
}

// IDs —â–æ –Ω–∞–ª–µ–∂–∞—Ç—å –∫–µ–π—Å–∞–º (–Ω–µ mbox/containers)
const CASE_IDS = new Set(['street','office','chef','gamer','fitness','apple','photo','workshop','smart','elite']);

function getCurrentWeights(caseId) {
  const base = { ...RARITY_WEIGHTS };
  const id = caseId || (currentCase ? currentCase.id : '_');
  const p = getPityForCase(id);
  let rareBonus      = p.rare;
  let epicBonus      = p.epic;
  let legendaryBonus = p.legendary;

  // Rarity bonuses –ª–∏—à–µ –¥–ª—è –∫–µ–π—Å—ñ–≤ ‚Äî –ù–ï –¥–ª—è Mystery Boxes —ñ Containers
  if (CASE_IDS.has(id)) {
    // Fitness Pro collection bonus: +12% rare chance for fitness case
    if (id === 'fitness' && state._collBonus_fitnessRare) rareBonus += 12;
    // Office Hero cert: +5% Rare global (only cases)
    if (state._collBonus_officeRare) rareBonus += 5;
    // Global rarity bonuses from shop upgrades (only cases)
    rareBonus      += (state._collBonus_globalRareChance || 0);
    epicBonus      += (state._collBonus_globalEpicChance || 0);
    legendaryBonus += (state._collBonus_globalLegChance  || 0);
  }

  const totalBonus = rareBonus + epicBonus + legendaryBonus;
  return {
    common:    Math.max(1, base.common - totalBonus),
    rare:      base.rare      + rareBonus,
    epic:      base.epic      + epicBonus,
    legendary: base.legendary + legendaryBonus,
  };
}

// Get display percentages (normalized to 100)
function getDisplayChances(caseId) {
  const w = getCurrentWeights(caseId);
  const total = w.common + w.rare + w.epic + w.legendary;
  return {
    common:    +((w.common    / total) * 100).toFixed(1),
    rare:      +((w.rare      / total) * 100).toFixed(1),
    epic:      +((w.epic      / total) * 100).toFixed(1),
    legendary: +((w.legendary / total) * 100).toFixed(1),
  };
}

function pickItem(c, useWeights) {
  const w = useWeights || { common:60, rare:25, epic:12, legendary:3 };
  const pool = [];
  c.items.forEach(item => {
    const weight = Math.round(w[item.rarity]);
    for (let i = 0; i < weight; i++) pool.push(item);
  });
  return pool[Math.floor(Math.random() * pool.length)];
}

function spinCarousel() {
  if (spinning) return;
  const casePrice = currentCase._effectivePrice || currentCase.price;
  if (state.balance < casePrice) {
    showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤!'); return;
  }

  // Auto-keep previous result on re-spin
  if (hasSpunOnce && currentResult) {
    autoKeepResult(currentResult);
  }

  state.balance -= casePrice;
  state.stats.casesOpened++;
  updateHUD();
  saveState();

  spinning = true;
  document.getElementById('spinBtn').disabled = true;
  document.getElementById('spinBtn').textContent = '‚è≥ –ö—Ä—É—Ç–∏—Ç—å—Å—è...';
  document.getElementById('modalResult').style.display = 'none';

  // Roll actual result using pity-adjusted weights
  currentResult = pickItem(currentCase, getCurrentWeights());

  // Build strip (visual only ‚Äî uses base weights for variety)
  const track = document.getElementById('carouselTrack');
  track.style.transition = 'none';
  track.style.transform = 'translateX(0)';
  void track.offsetWidth;

  const strip = [];
  for (let i = 0; i < 35; i++) strip.push(pickItem(currentCase));
  strip[30] = currentResult;

  track.innerHTML = '';
  strip.forEach(item => {
    const div = document.createElement('div');
    div.className = 'carousel-item ' + item.rarity;
    div.innerHTML = itemDisplay(item.emoji, 44) + '<div class="c-name">' + item.name + '</div>';
    track.appendChild(div);
  });

  const itemW  = 108;
  const center = track.parentElement.offsetWidth / 2 - 50;
  const target = -(30 * itemW - center);

  // Tick sounds during spin
  let tickCount = 0;
  const tickInterval = setInterval(() => {
    playTick();
    tickCount++;
    if (tickCount > 25) clearInterval(tickInterval);
  }, 120);

  void track.offsetWidth;
  track.style.transition = 'transform 3s cubic-bezier(0.12, 0.8, 0.3, 1)';
  track.style.transform = 'translateX(' + target + 'px)';

  setTimeout(() => {
    clearInterval(tickInterval);
    spinning = false;
    hasSpunOnce = true;

    // Update stats
    state.stats.rarityCount[currentResult.rarity] = (state.stats.rarityCount[currentResult.rarity] || 0) + 1;
    if (!state.stats.bestDrop || currentResult.value > state.stats.bestDrop.value) {
      state.stats.bestDrop = { name: currentResult.name, emoji: currentResult.emoji, rarity: currentResult.rarity, value: currentResult.value };
    }

    // ---- PITY SYSTEM ----
    const casePity = getPityForCase(currentCase.id);
    const droppedRarity = currentResult.rarity;
    // Reset pity for the rarity that dropped; accumulate for others
    if (droppedRarity === 'legendary') {
      casePity.legendary = 0;
      // legendary drop also resets epic & rare (getting legendary is "better" than epic/rare)
      // Actually per spec: only the same rarity resets. Others keep accumulating.
      // So only reset legendary:
    } else if (droppedRarity === 'epic') {
      casePity.epic = 0;
    } else if (droppedRarity === 'rare') {
      casePity.rare = 0;
    }
    // common drop ‚Üí add pity to all higher rarities
    if (droppedRarity === 'common') {
      casePity.rare = +(casePity.rare + PITY_PER_SPIN.rare).toFixed(2);
      casePity.epic = +(casePity.epic + PITY_PER_SPIN.epic).toFixed(2);
      casePity.legendary = +(casePity.legendary + PITY_PER_SPIN.legendary).toFixed(2);
    } else if (droppedRarity === 'rare') {
      // rare dropped ‚Üí still accumulate epic and legendary pity, reset rare
      casePity.epic = +(casePity.epic + PITY_PER_SPIN.epic).toFixed(2);
      casePity.legendary = +(casePity.legendary + PITY_PER_SPIN.legendary).toFixed(2);
    } else if (droppedRarity === 'epic') {
      // epic dropped ‚Üí still accumulate legendary pity, reset epic
      casePity.legendary = +(casePity.legendary + PITY_PER_SPIN.legendary).toFixed(2);
    }
    // legendary drop resets only legendary, others keep going
    // Cap pity bonuses so they don't go infinite
    casePity.rare      = Math.min(casePity.rare,      40);
    casePity.epic      = Math.min(casePity.epic,      30);
    casePity.legendary = Math.min(casePity.legendary, 15);
    saveState();

    showResult(currentResult);
    // Update bars after spin result (pity may have changed)
    setTimeout(updateAllRarityBars, 100);
    if (currentResult.rarity === 'legendary') { playFanfare(); spawnConfetti(); }
    else if (currentResult.rarity === 'epic') playSell();
  }, 3200);
}

function autoKeepResult(item) {
  if (state.inventory.length >= state.invLimit) {
    const autoSellVal = getSellValue(item);
    showToast('‚ùå –°–∫–ª–∞–¥ –ø–æ–≤–Ω–∏–π! ' + item.name + ' –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–æ–¥–∞–Ω–æ –∑–∞ ' + fmt(autoSellVal));
    state.balance += autoSellVal;
    state.totalEarned += autoSellVal;
    state.stats.itemsSold++;
    updateHUD(); saveState(); return;
  }
  state.inventory.unshift({
    id: Date.now() + Math.random(),
    name: item.name,
    emoji: item.emoji,
    rarity: item.rarity,
    value: item.value,
    fromCase: currentCase.name
  });
  showToast('üéí ' + item.name + ' –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–æ —Å–∫–ª–∞–¥—É');
  updateHUD();
  saveState();
  renderInventory();
}

function showResult(item) {
  document.getElementById('spinBtn').textContent = 'üé≤ –©–ï –†–ê–ó';
  document.getElementById('spinBtn').disabled = false;

  const res = document.getElementById('modalResult');
  res.style.display = 'block';
  document.getElementById('resultRarityBadge').textContent = RARITY_LABELS[item.rarity];
  document.getElementById('resultRarityBadge').className = 'result-rarity bg-' + item.rarity;
  document.getElementById('resultEmoji').innerHTML = itemDisplay(item.emoji, 52);
  document.getElementById('resultName').textContent = item.name;
  // Show pity bonuses below result
  const chances = getDisplayChances();
  const p = currentCase ? getPityForCase(currentCase.id) : { rare:0, epic:0, legendary:0 };
  let pityLine = '';
  if (p.rare > 0 || p.epic > 0 || p.legendary > 0) {
    pityLine = '<div style="font-size:11px;color:var(--muted);margin-top:4px;">üçÄ Pity: ' +
      (p.rare > 0      ? '<span style="color:var(--rare)">Rare +' + p.rare.toFixed(1) + '%</span> ' : '') +
      (p.epic > 0      ? '<span style="color:var(--epic)">Epic +' + p.epic.toFixed(1) + '%</span> ' : '') +
      (p.legendary > 0 ? '<span style="color:var(--legendary)">Leg +' + p.legendary.toFixed(1) + '%</span>' : '') +
    '</div>';
  }
  document.getElementById('resultVal').innerHTML = '–†–∏–Ω–∫–æ–≤–∞ —Ü—ñ–Ω–∞: <span>' + fmt(item.value) + '</span>' + pityLine;

  res.style.opacity = '0';
  res.style.transform = 'translateY(10px)';
  void res.offsetWidth;
  res.style.transition = 'all .4s .1s';
  res.style.opacity = '1';
  res.style.transform = 'translateY(0)';
}

function sellResult() {
  if (!currentResult) return;
  const sellVal = getSellValue(currentResult);
  state.balance += sellVal;
  state.totalEarned += sellVal;
  state.stats.itemsSold++;
  playSell();
  const bonusTxt = sellVal > currentResult.value ? ' ‚ú®' : '';
  showToast('üí∏ –ü—Ä–æ–¥–∞–Ω–æ –∑–∞ ' + fmt(sellVal) + bonusTxt, 'gold');
  currentResult = null;
  hasSpunOnce = false;
  document.getElementById('modalResult').style.display = 'none';
  document.getElementById('spinBtn').textContent = 'üé≤ –í–Ü–î–ö–†–ò–¢–ò';
  updateHUD(); saveState(); renderCases();
}

function keepResult() {
  if (!currentResult) return;
  if (state.inventory.length >= state.invLimit) {
    showToast('‚ùå –°–∫–ª–∞–¥ –ø–æ–≤–Ω–∏–π! –†–æ–∑—à–∏—Ä –∞–±–æ –ø—Ä–æ–¥–∞–π –ø—Ä–µ–¥–º–µ—Ç–∏.'); return;
  }
  state.inventory.unshift({
    id: Date.now(),
    name: currentResult.name,
    emoji: currentResult.emoji,
    rarity: currentResult.rarity,
    value: currentResult.value,
    fromCase: currentCase.name
  });
  showToast('üéí –î–æ–¥–∞–Ω–æ –¥–æ —Å–∫–ª–∞–¥—É');
  currentResult = null;
  hasSpunOnce = false;
  document.getElementById('modalResult').style.display = 'none';
  document.getElementById('spinBtn').textContent = 'üé≤ –í–Ü–î–ö–†–ò–¢–ò';
  updateHUD(); saveState(); closeModal(); renderCases(); renderInventory();
}

function closeModal() {
  if (spinning) return;
  if (currentResult && hasSpunOnce) {
    autoKeepResult(currentResult);
    currentResult = null;
  }
  document.getElementById('caseModal').classList.remove('show');
  hasSpunOnce = false;
  // –ü.2: Restore carousel-wrap so next open doesn't throw null error
  const wrap = document.querySelector('#caseModal .carousel-wrap');
  if (wrap && !document.getElementById('carouselTrack')) {
    wrap.innerHTML = '<div class="carousel-track" id="carouselTrack"></div>';
    wrap.style.cssText = '';
  }
}

document.getElementById('caseModal').addEventListener('click', function(e) {
  if (e.target === this && !spinning) closeModal();
});

// =================== INVENTORY ===================
function renderInventory() {
  const grid = document.getElementById('inventoryGrid');
  document.getElementById('invCount').textContent = state.inventory.length + ' –ø—Ä–µ–¥–º–µ—Ç—ñ–≤';
  if (!state.inventory.length) {
    grid.innerHTML = '<div class="empty-state"><div class="e-icon">üì¶</div><div>–°–∫–ª–∞–¥ –ø–æ—Ä–æ–∂–Ω—ñ–π.<br>–í—ñ–¥–∫—Ä–∏–π –∫–µ–π—Å —ñ –∑–±–µ—Ä–∏ –ø—Ä–µ–¥–º–µ—Ç–∏!</div></div>';
    return;
  }
  grid.innerHTML = '';
  const _sorted = [...state.inventory].sort((a, b) => {
    const aC = CASES.find(c => c.name === a.fromCase);
    const bC = CASES.find(c => c.name === b.fromCase);
    const aE = aC && !getColl(aC.id)[a.name] ? 1 : 0;
    const bE = bC && !getColl(bC.id)[b.name] ? 1 : 0;
    return bE - aE;
  });
  _sorted.forEach(item => {
    const div = document.createElement('div');
    div.className = 'inv-item';

    const emojiRow = document.createElement('div');
    emojiRow.style.cssText = 'display:flex;justify-content:space-between;align-items:flex-start;';
    const emojiEl = document.createElement('div');
    emojiEl.className = 'item-emoji';
    emojiEl.innerHTML = itemDisplay(item.emoji, 38);
    const dot = document.createElement('span');
    dot.className = 'item-rarity-dot';
    dot.style.background = 'var(--' + item.rarity + ')';
    dot.style.cssText += ';display:inline-block;width:8px;height:8px;border-radius:50%;margin-top:4px;';
    emojiRow.appendChild(emojiEl);
    emojiRow.appendChild(dot);

    const nameEl = document.createElement('div');
    nameEl.className = 'item-name r-' + item.rarity;
    nameEl.textContent = item.name;
    const valEl = document.createElement('div');
    valEl.className = 'item-val';
    valEl.innerHTML = '–¶—ñ–Ω–∞: <span>' + fmt(item.value) + '</span>';
    const fromEl = document.createElement('div');
    fromEl.className = 'item-val';
    fromEl.style.fontSize = '11px';
    fromEl.textContent = item.fromCase;

    const sellBtn = document.createElement('button');
    sellBtn.className = 'sell-instant-btn';
    const displaySellVal = getSellValue(item);
    const bonusMark = displaySellVal > item.value ? ' ‚ú®' : '';
    sellBtn.textContent = 'üí∏ –ü—Ä–æ–¥–∞—Ç–∏ –∑–∞ ' + fmt(displaySellVal) + bonusMark;
    sellBtn.addEventListener('click', () => sellFromInventory(item.id));

    const shopBtn = document.createElement('button');
    shopBtn.className = 'sell-instant-btn';
    shopBtn.style.cssText = 'background:rgba(59,130,246,.15);color:var(--blue);border:1px solid rgba(59,130,246,.3);';
    shopBtn.textContent = 'üè™ –£ –º–∞–≥–∞–∑–∏–Ω';
    shopBtn.addEventListener('click', () => listInShop(item.id));

    // Collection button ‚Äî only if item's case exists in CASES and item not yet collected
    const srcCase = CASES.find(c => c.name === item.fromCase);
    if (srcCase) {
      const collArr = getColl(srcCase.id);
      if (!collArr[item.name]) {
        const collBtn = document.createElement('button');
        collBtn.className = 'sell-instant-btn';
        collBtn.style.cssText = 'background:rgba(245,200,66,.12);color:var(--gold);border:1px solid rgba(245,200,66,.3);';
        collBtn.textContent = 'üì• –í –∫–æ–ª–µ–∫—Ü—ñ—é';
        collBtn.addEventListener('click', () => addToCollection(item.id));
        div.appendChild(collBtn);
      }
    }

    div.appendChild(emojiRow);
    div.appendChild(nameEl);
    div.appendChild(valEl);
    div.appendChild(fromEl);
    div.appendChild(sellBtn);
    div.appendChild(shopBtn);
    grid.appendChild(div);
  });
}

function isItemFromCase(item) {
  // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –ø—Ä–µ–¥–º–µ—Ç –∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–µ–π—Å–∞ (–Ω–µ mbox/container)
  if (!item.fromCase) return false;
  return CASES.some(c => c.name === item.fromCase);
}

function getSellValue(item) {
  let val = item.value;
  const r = item.rarity;
  // Sell multipliers —Ç—ñ–ª—å–∫–∏ –¥–ª—è –ø—Ä–µ–¥–º–µ—Ç—ñ–≤ –∑ –∫–µ–π—Å—ñ–≤
  if (isItemFromCase(item)) {
    if (r === 'common'    && (state._collBonus_commonSellMult||1) > 1)
      val = Math.round(val * state._collBonus_commonSellMult);
    if (r === 'rare'      && (state._collBonus_rareSellMult||1)   > 1)
      val = Math.round(val * state._collBonus_rareSellMult);
    if (r === 'epic'      && (state._collBonus_epicSellMult||1)   > 1)
      val = Math.round(val * state._collBonus_epicSellMult);
    if (r === 'legendary' && (state._collBonus_legSellMult||1)    > 1)
      val = Math.round(val * state._collBonus_legSellMult);
  }
  return val;
}

function sellFromInventory(id) {
  const idx = state.inventory.findIndex(x => x.id === id);
  if (idx === -1) return;
  const item = state.inventory[idx];
  const sellVal = getSellValue(item);
  state.balance += sellVal;
  state.totalEarned += sellVal;
  state.stats.itemsSold++;
  state.inventory.splice(idx, 1);
  playSell();
  const bonus = sellVal > item.value ? ' (+–±–æ–Ω—É—Å!)' : '';
  showToast('üí∏ ' + item.name + ' –ø—Ä–æ–¥–∞–Ω–æ –∑–∞ ' + fmt(sellVal) + bonus, 'gold');
  updateHUD(); saveState(); renderInventory(); renderCases();
}

// =================== SHOP ===================
function listInShop(invId) {
  if (!state.shopUnlocked) { showToast('üîí –°–ø–æ—á–∞—Ç–∫—É –≤—ñ–¥–∫—Ä–∏–π –º–∞–≥–∞–∑–∏–Ω!'); return; }
  const shopActive = state.shop.filter(x => !x.sold).length;
  if (shopActive >= state.shopLimit) { showToast('‚ùå –ú–∞–≥–∞–∑–∏–Ω –ø–æ–≤–Ω–∏–π! –†–æ–∑—à–∏—Ä –∞–±–æ –¥–æ—á–µ–∫–∞–π—Å—è –ø—Ä–æ–¥–∞–∂—É.'); return; }
  const idx = state.inventory.findIndex(x => x.id === invId);
  if (idx === -1) return;
  const item = state.inventory[idx];

  // Max price = shopMult √ó boosted base price (with collection bonuses applied)
  const baseVal  = getSellValue(item);
  const maxPrice = Math.round(baseVal * state.shopMult);

  const shopEntry = {
    id: Date.now() + state.shop.length,
    invId: invId,
    name: item.name,
    emoji: item.emoji,
    rarity: item.rarity,
    value: item.value,   // original market value (kept for reference)
    maxPrice: maxPrice,
    listPrice: baseVal,  // default listing = boosted base
    listedAt: Date.now(),
    timerSec: 20,
    sold: false,
    fromCase: item.fromCase || null,       // track source for bonus eligibility
    fromContainer: item.fromContainer || null,
  };
  state.inventory.splice(idx, 1);
  state.shop.push(shopEntry);
  showToast('üè™ ' + item.name + ' –≤–∏—Å—Ç–∞–≤–ª–µ–Ω–æ –≤ –º–∞–≥–∞–∑–∏–Ω!');
  updateHUD(); saveState(); renderInventory(); renderShop();
}

// Active timers map: entryId ‚Üí {interval, endTime, timerSec, listPrice}
const activeTimers = {};

// =================== INV UPGRADES ===================
function switchInvTab(tab) {
  document.querySelectorAll('#screen-inventory .shop-tab').forEach(b => b.classList.remove('active'));
  document.getElementById('invTab-' + tab).classList.add('active');
  document.getElementById('invPane-items').style.display       = tab === 'items'       ? 'block' : 'none';
  document.getElementById('invPane-upgrades').style.display    = tab === 'upgrades'    ? 'block' : 'none';
  document.getElementById('invPane-collections').style.display = tab === 'collections' ? 'block' : 'none';
  if (tab === 'upgrades')    renderInvUpgrades();
  if (tab === 'collections') renderCollections();
}

function renderLevelCard(container, opts) {
  // Generic level-up card renderer
  // opts: { icon, title, subtitle, curLevel, levels, onBuy, isShopLocked }
  const { icon, title, subtitle, curLevel, levels, onBuy, isShopLocked } = opts;
  const isMax  = curLevel >= levels.length - 1;
  const next   = isMax ? null : levels[curLevel + 1];
  const cur    = levels[curLevel];
  const pct    = (curLevel / (levels.length - 1)) * 100;

  const stepsHtml = levels.map((l, i) => {
    let cls = i < curLevel ? 'done' : i === curLevel ? 'current' : '';
    return '<span class="' + cls + '">' + l.slots + '</span>';
  }).join('');

  const canAfford = next && !isShopLocked && state.balance >= next.price;
  const btnText   = isMax
    ? 'üèÜ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —Ä—ñ–≤–µ–Ω—å!'
    : isShopLocked
      ? 'üîí –°–ø–æ—á–∞—Ç–∫—É –≤—ñ–¥–∫—Ä–∏–π –º–∞–≥–∞–∑–∏–Ω'
      : '–†–æ–∑—à–∏—Ä–∏—Ç–∏ –¥–æ ' + next.slots + ' –∑–∞ ' + fmt(next.price);
  const btnDis = isMax || isShopLocked || !canAfford;

  container.innerHTML =
    '<div class="mult-upgrade-card">' +
      '<div class="mult-upgrade-header">' +
        '<div class="mult-upgrade-icon">' + icon + '</div>' +
        '<div><div class="mult-upgrade-title">' + title + '</div>' +
          '<div class="mult-upgrade-subtitle">' + subtitle + '</div></div>' +
      '</div>' +
      '<div class="mult-current-badge">üì¶ –ü–æ—Ç–æ—á–Ω–æ: ' + cur.slots + ' ' + (opts.badgeLabel || '–º—ñ—Å—Ü—å') + '</div>' +
      '<div class="mult-progress-track"><div class="mult-progress-fill" style="width:' + pct + '%"></div></div>' +
      '<div class="mult-steps">' + stepsHtml + '</div>' +
      (!isMax ? '<div style="font-size:12px;color:var(--muted);margin-bottom:12px;">üîì –ù–∞—Å—Ç—É–ø–Ω–∏–π: <b style="color:var(--text)">' + next.label + '</b> ‚Äî ' + next.desc + '</div>' : '') +
      '<button class="mult-upgrade-btn' + (isMax ? ' maxed' : '') + '"' +
        (btnDis && !isMax ? ' disabled' : '') +
        (isMax || isShopLocked ? '' : ' onclick="' + onBuy + '()"') + '>' +
        btnText +
      '</button>' +
    '</div>';
}

function renderInvUpgrades() {
  // Bulk move one-time purchase card
  const bulkCard = document.getElementById('bulkMoveUpgradeCard');
  if (bulkCard) {
    if (state.hasBulkMove) {
      bulkCard.innerHTML =
        '<div class="mult-upgrade-card" style="margin-bottom:14px">' +
          '<div class="mult-upgrade-header">' +
            '<div class="mult-upgrade-icon">üöÄ</div>' +
            '<div><div class="mult-upgrade-title">–ú–∞—Å–æ–≤–µ –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è</div>' +
              '<div class="mult-upgrade-subtitle">–ü–µ—Ä–µ–º—ñ—Å—Ç–∏—Ç–∏ –≤—Å—ñ –ø—Ä–µ–¥–º–µ—Ç–∏ –≤ –º–∞–≥–∞–∑–∏–Ω –æ–¥–Ω–∏–º –Ω–∞—Ç–∏—Å–∫–æ–º</div></div>' +
          '</div>' +
          '<button class="mult-upgrade-btn maxed">‚úÖ –†–æ–∑–±–ª–æ–∫–æ–≤–∞–Ω–æ</button>' +
        '</div>';
    } else {
      bulkCard.innerHTML =
        '<div class="mult-upgrade-card" style="margin-bottom:14px">' +
          '<div class="mult-upgrade-header">' +
            '<div class="mult-upgrade-icon">üöÄ</div>' +
            '<div><div class="mult-upgrade-title">–ú–∞—Å–æ–≤–µ –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è</div>' +
              '<div class="mult-upgrade-subtitle">–ü–µ—Ä–µ–º—ñ—â—É–π —É—Å—ñ –ø—Ä–µ–¥–º–µ—Ç–∏ –∑—ñ —Å–∫–ª–∞–¥—É –≤ –º–∞–≥–∞–∑–∏–Ω –æ–¥–Ω–∏–º –Ω–∞—Ç–∏—Å–∫–æ–º</div></div>' +
          '</div>' +
          '<div style="font-size:12px;color:var(--muted);margin-bottom:12px;">–ü—ñ—Å–ª—è –ø–æ–∫—É–ø–∫–∏ –∑ º—è–≤–∏—Ç—å—Å—è –∫–Ω–æ–ø–∫–∞ <b style="color:var(--text)">üöÄ –ü–µ—Ä–µ–º—ñ—Å—Ç–∏—Ç–∏ –≤—Å–µ –≤ –º–∞–≥–∞–∑–∏–Ω</b> –Ω–∞ –≤–∫–ª–∞–¥—Ü—ñ –ü—Ä–µ–¥–º–µ—Ç–∏</div>' +
          '<button class="mult-upgrade-btn"' + (state.balance >= BULK_MOVE_PRICE ? '' : ' disabled') + ' onclick="buyBulkMove()">' +
            '–†–æ–∑–±–ª–æ–∫—É–≤–∞—Ç–∏ –∑–∞ ' + fmt(BULK_MOVE_PRICE) +
          '</button>' +
        '</div>';
    }
  }

  // Inv limit card
  const invCard = document.getElementById('invLimitUpgradeCard');
  if (invCard) renderLevelCard(invCard, {
    icon: 'üì¶', title: '–†–æ–∑–º—ñ—Ä —Å–∫–ª–∞–¥—É', subtitle: '–ó–±—ñ–ª—å—à—É–π –∫—ñ–ª—å–∫—ñ—Å—Ç—å –º—ñ—Å—Ü—å –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è',
    curLevel: state.invUpgLevel, levels: INV_LEVELS, onBuy: 'buyInvUpgrade', isShopLocked: false
  });
}

function buyBulkList() {
  if (state.hasBulkList) return;
  if (state.balance < 3000) { showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤!'); return; }
  state.balance -= 3000;
  state.hasBulkList = true;
  playSell();
  showToast('‚ö° "MAX ALL" —Ä–æ–∑–±–ª–æ–∫–æ–≤–∞–Ω–æ!');
  updateHUD(); saveState(); renderListAllMaxCard();
  // Show the button in listings
  const btn = document.getElementById('listAllMaxBtn');
  if (btn) btn.style.display = 'block';
}

function listAllAtMax() {
  if (!state.shopUnlocked) { showToast('üîí –ú–∞–≥–∞–∑–∏–Ω –Ω–µ –≤—ñ–¥–∫—Ä–∏—Ç–∏–π!'); return; }
  const unlisted = state.shop.filter(x => !x.sold && !activeTimers[x.id]);
  if (!unlisted.length) { showToast('–ù–µ–º–∞—î –Ω–µ–≤–∏—Å—Ç–∞–≤–ª–µ–Ω–∏—Ö —Ç–æ–≤–∞—Ä—ñ–≤!'); return; }
  let count = 0;
  unlisted.forEach(entry => {
    // Set listPrice to max before calling startSellTimer
    entry.listPrice = entry.maxPrice;
    // Also set the input value so startSellTimer reads it correctly
    const inputEl = document.getElementById('price-input-' + entry.id);
    if (inputEl) inputEl.value = entry.maxPrice;
    startSellTimer(entry.id);
    count++;
  });
  showToast('‚ö° ' + count + ' —Ç–æ–≤–∞—Ä—ñ–≤ –≤–∏—Å—Ç–∞–≤–ª–µ–Ω–æ –ø–æ MAX —Ü—ñ–Ω—ñ!');
  saveState();
}

function renderListAllMaxCard() {
  const card = document.getElementById('listAllMaxCard');
  if (!card) return;
  if (state.hasBulkList) {
    card.innerHTML =
      '<div class="mult-upgrade-card">' +
        '<div class="mult-upgrade-header">' +
          '<div class="mult-upgrade-icon">‚ö°</div>' +
          '<div><div class="mult-upgrade-title">–í–∏—Å—Ç–∞–≤–∏—Ç–∏ –≤—Å—ñ –ø–æ MAX</div>' +
            '<div class="mult-upgrade-subtitle">–ö–Ω–æ–ø–∫–∞ ‚ö° MAX ALL –¥–æ—Å—Ç—É–ø–Ω–∞ —É –≤–∫–ª–∞–¥—Ü—ñ –õ—ñ—Å—Ç–∏–Ω–≥–∏</div></div>' +
        '</div>' +
        '<button class="mult-upgrade-btn maxed">‚úÖ –†–æ–∑–±–ª–æ–∫–æ–≤–∞–Ω–æ</button>' +
      '</div>';
  } else {
    card.innerHTML =
      '<div class="mult-upgrade-card">' +
        '<div class="mult-upgrade-header">' +
          '<div class="mult-upgrade-icon">‚ö°</div>' +
          '<div><div class="mult-upgrade-title">–í–∏—Å—Ç–∞–≤–∏—Ç–∏ –≤—Å—ñ –ø–æ MAX</div>' +
            '<div class="mult-upgrade-subtitle">–û–¥–Ω–∏–º –Ω–∞—Ç–∏—Å–∫–æ–º –≤–∏—Å—Ç–∞–≤–ª—è–π —É—Å—ñ —Ç–æ–≤–∞—Ä–∏ –∑–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–º –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–æ–º (' + state.shopMult.toFixed(1) + '√ó)</div></div>' +
        '</div>' +
        '<div style="font-size:12px;color:var(--muted);margin-bottom:12px;">–ü—ñ—Å–ª—è –ø–æ–∫—É–ø–∫–∏ –∑ º—è–≤–∏—Ç—å—Å—è –∫–Ω–æ–ø–∫–∞ <b style="color:var(--gold)">‚ö° MAX ALL</b> —É –≤–∫–ª–∞–¥—Ü—ñ –õ—ñ—Å—Ç–∏–Ω–≥–∏</div>' +
        '<button class="mult-upgrade-btn"' + (state.balance >= 3000 ? '' : ' disabled') + ' onclick="buyBulkList()">' +
          '–†–æ–∑–±–ª–æ–∫—É–≤–∞—Ç–∏ –∑–∞ ' + fmt(3000) +
        '</button>' +
      '</div>';
  }
}

function renderShopUpgrades() {
  const card = document.getElementById('shopLimitUpgradeCard');
  if (card) renderLevelCard(card, {
    icon: 'üè™', title: '–†–æ–∑–º—ñ—Ä –º–∞–≥–∞–∑–∏–Ω—É', subtitle: '–ó–±—ñ–ª—å—à—É–π –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ª–æ—Ç—ñ–≤ –¥–ª—è –ø—Ä–æ–¥–∞–∂—É',
    curLevel: state.shopUpgLevel, levels: SHOP_LEVELS, onBuy: 'buyShopUpgrade',
    isShopLocked: !state.shopUnlocked, badgeLabel: '—Å–ª–æ—Ç—ñ–≤'
  });
}

// =================== SHOP MULT UPGRADE ===================
const MULT_LEVELS = [
  { mult: 1.2, price: 0,      label: '–ë–∞–∑–æ–≤–∏–π —Ä—ñ–≤–µ–Ω—å',   desc: '–ü—Ä–æ–¥–∞–≤–∞–π –¥–æ 1.2√ó —Ä–∏–Ω–∫–æ–≤–æ—ó —Ü—ñ–Ω–∏' },
  { mult: 1.3, price: 2000,   label: '–†—ñ–≤–µ–Ω—å I',         desc: '–ü—Ä–æ–¥–∞–≤–∞–π –¥–æ 1.3√ó —Ä–∏–Ω–∫–æ–≤–æ—ó —Ü—ñ–Ω–∏' },
  { mult: 1.4, price: 5000,   label: '–†—ñ–≤–µ–Ω—å II',        desc: '–ü—Ä–æ–¥–∞–≤–∞–π –¥–æ 1.4√ó —Ä–∏–Ω–∫–æ–≤–æ—ó —Ü—ñ–Ω–∏' },
  { mult: 1.5, price: 12000,  label: '–†—ñ–≤–µ–Ω—å III',       desc: '–ü—Ä–æ–¥–∞–≤–∞–π –¥–æ 1.5√ó —Ä–∏–Ω–∫–æ–≤–æ—ó —Ü—ñ–Ω–∏' },
  { mult: 1.6, price: 28000,  label: '–†—ñ–≤–µ–Ω—å IV',        desc: '–ü—Ä–æ–¥–∞–≤–∞–π –¥–æ 1.6√ó —Ä–∏–Ω–∫–æ–≤–æ—ó —Ü—ñ–Ω–∏' },
  { mult: 1.7, price: 60000,  label: '–†—ñ–≤–µ–Ω—å V',         desc: '–ü—Ä–æ–¥–∞–≤–∞–π –¥–æ 1.7√ó —Ä–∏–Ω–∫–æ–≤–æ—ó —Ü—ñ–Ω–∏' },
  { mult: 1.8, price: 130000, label: '–†—ñ–≤–µ–Ω—å VI',        desc: '–ü—Ä–æ–¥–∞–≤–∞–π –¥–æ 1.8√ó —Ä–∏–Ω–∫–æ–≤–æ—ó —Ü—ñ–Ω–∏' },
  { mult: 1.9, price: 280000, label: '–†—ñ–≤–µ–Ω—å VII',       desc: '–ü—Ä–æ–¥–∞–≤–∞–π –¥–æ 1.9√ó —Ä–∏–Ω–∫–æ–≤–æ—ó —Ü—ñ–Ω–∏' },
  { mult: 2.0, price: 600000, label: '–ú–∞–∫—Å–∏–º—É–º',         desc: '–ü—Ä–æ–¥–∞–≤–∞–π –¥–æ 2.0√ó —Ä–∏–Ω–∫–æ–≤–æ—ó —Ü—ñ–Ω–∏ ‚Äî –º–∞–∫—Å–∏–º—É–º!' },
];

function getCurrentMultIdx() {
  const cur = state.shopMult;
  return MULT_LEVELS.findIndex(l => Math.abs(l.mult - cur) < 0.01);
}

function buyMultUpgrade() {
  const curIdx = getCurrentMultIdx();
  if (curIdx < 0 || curIdx >= MULT_LEVELS.length - 1) return;
  const next = MULT_LEVELS[curIdx + 1];
  if (state.balance < next.price) { showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤!'); return; }
  state.balance -= next.price;
  state.shopMult = next.mult;
  playSell();
  showToast('‚úÖ –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –ø—ñ–¥–≤–∏—â–µ–Ω–æ –¥–æ ' + next.mult + '√ó!');
  updateHUD(); saveState(); renderMultUpgrade();
}

function renderMultUpgrade() {
  const card = document.getElementById('multUpgradeCard');
  if (!card) return;
  const curIdx = getCurrentMultIdx();
  const cur    = MULT_LEVELS[curIdx];
  const isMax  = curIdx >= MULT_LEVELS.length - 1;
  const next   = isMax ? null : MULT_LEVELS[curIdx + 1];

  // Progress %: 0‚Üí1.2 is 0%, 2.0‚Üí1.2 is 100%  ‚Üí (cur-1.2)/(2.0-1.2) * 100
  const pct = ((state.shopMult - 1.2) / 0.8) * 100;

  // Steps row
  const stepsHtml = MULT_LEVELS.map((l, i) => {
    let cls = '';
    if (i < curIdx) cls = 'done';
    else if (i === curIdx) cls = 'current';
    return '<span class="' + cls + '">' + l.mult.toFixed(1) + '√ó</span>';
  }).join('');

  const btnText  = isMax ? 'üèÜ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —Ä—ñ–≤–µ–Ω—å!' : '–ü–æ–∫—Ä–∞—â–∏—Ç–∏ –¥–æ ' + next.mult.toFixed(1) + '√ó –∑–∞ ' + fmt(next.price);
  const btnClass = isMax ? 'mult-upgrade-btn maxed' : (next && state.balance >= next.price ? 'mult-upgrade-btn' : 'mult-upgrade-btn');
  const btnDis   = isMax || (next && state.balance < next.price);

  card.innerHTML =
    '<div class="mult-upgrade-card">' +
      '<div class="mult-upgrade-header">' +
        '<div class="mult-upgrade-icon">üíπ</div>' +
        '<div>' +
          '<div class="mult-upgrade-title">–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –ø—Ä–æ–¥–∞–∂—É</div>' +
          '<div class="mult-upgrade-subtitle">–ü—ñ–¥–≤–∏—â—É–π –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É —Ü—ñ–Ω—É —Å–≤–æ—ó—Ö —Ç–æ–≤–∞—Ä—ñ–≤</div>' +
        '</div>' +
      '</div>' +
      '<div class="mult-current-badge">üìà –ü–æ—Ç–æ—á–Ω–∏–π –º–∞–∫—Å–∏–º—É–º: ' + state.shopMult.toFixed(1) + '√ó —Ä–∏–Ω–∫–æ–≤–æ—ó —Ü—ñ–Ω–∏</div>' +
      '<div class="mult-progress-track"><div class="mult-progress-fill" style="width:' + pct + '%"></div></div>' +
      '<div class="mult-steps">' + stepsHtml + '</div>' +
      (isMax ? '' :
        '<div style="font-size:12px;color:var(--muted);margin-bottom:12px;">' +
          'üîì –ù–∞—Å—Ç—É–ø–Ω–∏–π —Ä—ñ–≤–µ–Ω—å: <b style="color:var(--text)">' + next.label + '</b> ‚Äî ' + next.desc +
        '</div>'
      ) +
      '<button class="' + btnClass + '"' + (btnDis && !isMax ? ' disabled' : '') + (isMax ? '' : ' onclick="buyMultUpgrade()"') + '>' + btnText + '</button>' +
    '</div>';
}

function switchShopTab(tab) {
  document.querySelectorAll('.shop-tab').forEach(b => b.classList.remove('active'));
  document.getElementById('shopTab-' + tab).classList.add('active');
  document.getElementById('shopPane-listings').style.display  = tab === 'listings'  ? 'block' : 'none';
  document.getElementById('shopPane-upgrades').style.display  = tab === 'upgrades'  ? 'block' : 'none';
  if (tab === 'upgrades') { renderMultUpgrade(); renderShopUpgrades(); renderListAllMaxCard(); renderCollShopUpgrades(); }
}

function unlockShop() {
  if (state.balance < 500) { showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤!'); return; }
  state.balance -= 500;
  state.shopUnlocked = true;
  playSell();
  showToast('üè™ –ú–∞–≥–∞–∑–∏–Ω –≤—ñ–¥–∫—Ä–∏—Ç–æ!');
  updateHUD(); saveState(); renderShop(); renderMultUpgrade(); renderUpgrades();
}

function renderShop() {
  // Toggle locked/unlocked view
  const lockedEl   = document.getElementById('shopLocked');
  const unlockedEl = document.getElementById('shopUnlocked');
  if (lockedEl && unlockedEl) {
    lockedEl.style.display   = state.shopUnlocked ? 'none'  : 'block';
    unlockedEl.style.display = state.shopUnlocked ? 'block' : 'none';
  }
  if (!state.shopUnlocked) return;

  const grid = document.getElementById('shopGrid');
  const count = document.getElementById('shopCount');
  const activeEntries = state.shop.filter(x => !x.sold);
  count.textContent = activeEntries.length + ' / ' + state.shopLimit + ' —Ç–æ–≤–∞—Ä—ñ–≤';

  const visibleEntries = state.shop.filter(x => !x.sold);
  if (!visibleEntries.length) {
    grid.innerHTML = '<div class="empty-state"><div class="e-icon">üè™</div><div>–ú–∞–≥–∞–∑–∏–Ω –ø–æ—Ä–æ–∂–Ω—ñ–π.<br>–ü–µ—Ä–µ–Ω–µ—Å–∏ –ø—Ä–µ–¥–º–µ—Ç–∏ –∑—ñ —Å–∫–ª–∞–¥—É!</div></div>';
    return;
  }
  grid.innerHTML = ''; // clear before rendering items

  // Sort: items without active timer (new/unlisted) first, active timers below
  const sortedShop = [...state.shop].sort((a, b) => {
    const aActive = !!activeTimers[a.id];
    const bActive = !!activeTimers[b.id];
    if (aActive === bActive) return 0;
    return aActive ? 1 : -1; // unlisted (no timer) comes first
  });

  // Re-order DOM to match sort
  const grid2 = document.getElementById('shopGrid');
  sortedShop.forEach(entry => {
    const existing = document.getElementById('shop-entry-' + entry.id);
    if (existing) grid2.appendChild(existing); // move to end in sorted order
  });

  sortedShop.forEach(entry => {
    // If card already exists in DOM ‚Äî don't touch it (timer is running)
    if (document.getElementById('shop-entry-' + entry.id)) return;

    const div = document.createElement('div');
    div.className = 'shop-item' + (entry.sold ? ' sold' : '');
    div.id = 'shop-entry-' + entry.id;

    const top = document.createElement('div');
    top.className = 'shop-item-top';
    const emojiEl = document.createElement('div');
    emojiEl.className = 'shop-item-emoji';
    emojiEl.innerHTML = itemDisplay(entry.emoji, 32);
    const info = document.createElement('div');
    info.className = 'shop-item-info';
    const nameEl = document.createElement('div');
    nameEl.className = 'shop-item-name r-' + entry.rarity;
    nameEl.textContent = entry.name;
    const fromEl = document.createElement('div');
    fromEl.className = 'shop-item-from';
    const bonusBase = getSellValue({rarity: entry.rarity, value: entry.value});
    fromEl.textContent = '–†–∏–Ω–∫–æ–≤–∞: ' + fmt(bonusBase) + (bonusBase > entry.value ? ' ‚ú®' : '') + ' ¬∑ –ú–∞–∫—Å: ' + fmt(entry.maxPrice);
    info.appendChild(nameEl);
    info.appendChild(fromEl);
    top.appendChild(emojiEl);
    top.appendChild(info);

    if (entry.sold) {
      const soldBadge = document.createElement('div');
      soldBadge.innerHTML = '<span class="shop-sold-badge">‚úÖ –ü—Ä–æ–¥–∞–Ω–æ –∑–∞ ' + fmt(entry.listPrice) + '</span>';
      div.appendChild(top);
      div.appendChild(soldBadge);
    } else {
      const priceWrap = document.createElement('div');
      priceWrap.className = 'price-input-wrap';
      const input = document.createElement('input');
      input.type = 'number';
      input.className = 'price-input';
      input.value = entry.listPrice;
      input.min = 1;
      input.max = entry.maxPrice;
      input.id = 'price-input-' + entry.id;

      const hint = document.createElement('div');
      hint.className = 'price-hint';
      hint.innerHTML = '–¥–æ <span>' + fmt(entry.maxPrice) + '</span>';

      const maxBtn = document.createElement('button');
      maxBtn.className = 'max-btn';
      maxBtn.textContent = 'MAX';
      maxBtn.addEventListener('click', () => { input.value = entry.maxPrice; });

      priceWrap.appendChild(input);
      priceWrap.appendChild(maxBtn);
      priceWrap.appendChild(hint);

      const listBtn = document.createElement('button');
      listBtn.className = 'list-btn';
      listBtn.textContent = 'üì¢ –í–∏—Å—Ç–∞–≤–∏—Ç–∏';
      listBtn.id = 'list-btn-' + entry.id;
      listBtn.addEventListener('click', () => startSellTimer(entry.id));

      const timerWrap = document.createElement('div');
      timerWrap.id = 'timer-wrap-' + entry.id;
      timerWrap.style.display = 'none';
      timerWrap.innerHTML =
        '<div class="timer-bar-wrap"><div class="timer-bar" id="timer-bar-' + entry.id + '" style="width:100%"></div></div>' +
        '<div class="timer-label" id="timer-label-' + entry.id + '">–û—á—ñ–∫—É—î–º–æ –ø–æ–∫—É–ø—Ü—è...</div>';

      div.appendChild(top);
      div.appendChild(priceWrap);
      div.appendChild(listBtn);
      div.appendChild(timerWrap);

      // –ü.4: If this entry has an active timer (restored from save), show timer-wrap immediately
      if (entry.timerActive && entry.endTime && entry.endTime > Date.now()) {
        priceWrap.style.display = 'none';
        listBtn.style.display = 'none';
        timerWrap.style.display = 'block';
        // Show remaining time immediately
        const rem = entry.endTime - Date.now();
        const sec = Math.ceil(rem / 1000);
        const pct = Math.max(0, Math.min(100, (rem / (entry.timerSec * 1000)) * 100));
        const barEl = timerWrap.querySelector('.timer-bar');
        const lblEl = timerWrap.querySelector('.timer-label');
        if (barEl) barEl.style.width = pct + '%';
        if (lblEl) lblEl.textContent = sec >= 60
          ? '–ü—Ä–æ–¥–∞—î—Ç—å—Å—è... ' + Math.floor(sec/60) + '—Ö–≤ ' + (sec%60) + '—Å'
          : '–ü—Ä–æ–¥–∞—î—Ç—å—Å—è... ' + sec + '—Å';
      }
    }

    grid.appendChild(div);
  });

  // Remove DOM cards for entries no longer in state
  grid.querySelectorAll('.shop-item').forEach(el => {
    const rawId = el.id.replace('shop-entry-', '');
    const numId = parseFloat(rawId); // use parseFloat to handle both int and float ids
    if (!state.shop.find(x => x.id == numId)) el.remove();
  });
}

function calcSellTimer(listPrice, marketPrice, maxPrice, fromCaseName) {
  // At market price ‚Üí instant (0s)
  if (listPrice <= marketPrice) return 0;
  // Square-root scale: 1M‚Ç¨ = 3600s (60min), 4‚Ç¨ = 7s, 1200‚Ç¨ = 2min
  const base = Math.min(Math.round(3600 * Math.sqrt(Math.max(listPrice, 0) / 1_000_000)), 3600);
  // shopTimerMult (Hobbyist Workshop bonus) ‚Äî —Ç—ñ–ª—å–∫–∏ –¥–ª—è –ø—Ä–µ–¥–º–µ—Ç—ñ–≤ –∑ –∫–µ–π—Å—ñ–≤
  const isCaseItem = fromCaseName && CASES.some(c => c.name === fromCaseName);
  const mult = isCaseItem ? (state._collBonus_shopTimerMult || 1.0) : 1.0;
  return Math.max(1, Math.round(base * mult));
}

function removeSoldCard(entryId) {
  const card = document.getElementById('shop-entry-' + entryId);
  if (card) {
    card.style.transition = 'opacity .4s, transform .4s';
    card.style.opacity = '0';
    card.style.transform = 'translateX(40px)';
    setTimeout(() => {
      card.remove();
      const i = state.shop.findIndex(x => x.id === entryId);
      if (i !== -1) state.shop.splice(i, 1);
      saveState();
      // Update count
      const activeEntries = state.shop.filter(x => !x.sold);
      const countEl = document.getElementById('shopCount');
      if (countEl) countEl.textContent = activeEntries.length + ' —Ç–æ–≤–∞—Ä—ñ–≤';
      const grid = document.getElementById('shopGrid');
      if (grid && !state.shop.length) {
        grid.innerHTML = '<div class="empty-state"><div class="e-icon">üè™</div><div>–ú–∞–≥–∞–∑–∏–Ω –ø–æ—Ä–æ–∂–Ω—ñ–π.<br>–ü–µ—Ä–µ–Ω–µ—Å–∏ –ø—Ä–µ–¥–º–µ—Ç–∏ –∑—ñ —Å–∫–ª–∞–¥—É!</div></div>';
      }
    }, 450);
  }
  delete activeTimers[entryId];
}

function completeSale(entry, listPrice) {
  if (activeTimers[entry.id]) {
    clearInterval(activeTimers[entry.id].interval);
  }
  entry.sold = true;
  entry.timerActive = false;
  entry.endTime = null;
  state.balance += listPrice;
  state.totalEarned += listPrice;
  state.stats.itemsSold++;
  playSell();
  showToast('üè™ ' + entry.name + ' –ø—Ä–æ–¥–∞–Ω–æ –∑–∞ ' + fmt(listPrice) + '!', 'gold');
  updateHUD(); saveState();

  // Show sold badge in existing card, then fade out
  const card = document.getElementById('shop-entry-' + entry.id);
  if (card) {
    card.innerHTML = '';
    card.className = 'shop-item sold';
    card.innerHTML =
      '<div class="shop-item-top">' +
        '<div class="shop-item-emoji">' + itemDisplay(entry.emoji, 32) + '</div>' +
        '<div class="shop-item-info">' +
          '<div class="shop-item-name r-' + entry.rarity + '">' + entry.name + '</div>' +
        '</div>' +
      '</div>' +
      '<span class="shop-sold-badge">‚úÖ –ü—Ä–æ–¥–∞–Ω–æ –∑–∞ ' + fmt(listPrice) + '</span>';
  }
  setTimeout(() => removeSoldCard(entry.id), 1800);
}

function startSellTimer(entryId) {
  const entry = state.shop.find(x => x.id === entryId);
  if (!entry) return;

  // Already has a running timer
  if (activeTimers[entryId]) return;

  const inputEl = document.getElementById('price-input-' + entryId);
  const rawPrice = parseFloat(inputEl ? inputEl.value : entry.listPrice);
  const listPrice = Math.min(Math.max(rawPrice, 1), entry.maxPrice);
  entry.listPrice = listPrice;

  const timerSec = calcSellTimer(listPrice, entry.value, entry.maxPrice, entry.fromCase);
  entry.timerSec = timerSec; // persisted for offline bar calculation
  entry.listedAt = Date.now();
  saveState();

  if (timerSec === 0) {
    completeSale(entry, listPrice);
    return;
  }

  // Hide price controls, show timer
  const priceWrap = inputEl ? inputEl.parentElement : null;
  if (priceWrap) priceWrap.style.display = 'none';
  const listBtn = document.getElementById('list-btn-' + entryId);
  if (listBtn) listBtn.style.display = 'none';
  const timerWrap = document.getElementById('timer-wrap-' + entryId);
  if (timerWrap) timerWrap.style.display = 'block';

  const endTime = Date.now() + timerSec * 1000;
  entry.endTime = endTime; // persist for offline calculation
  entry.timerActive = true;
  saveState();

  const interval = setInterval(() => {
    const remaining = Math.max(0, endTime - Date.now());
    const pct = (remaining / (timerSec * 1000)) * 100;

    const timerBar   = document.getElementById('timer-bar-'   + entryId);
    const timerLabel = document.getElementById('timer-label-' + entryId);

    if (timerBar)   timerBar.style.width = pct + '%';
    if (timerLabel) {
      const sec = Math.ceil(remaining / 1000);
      timerLabel.textContent = remaining > 0
        ? (sec >= 60 ? '–ü—Ä–æ–¥–∞—î—Ç—å—Å—è... ' + Math.floor(sec/60) + '—Ö–≤ ' + (sec%60) + '—Å' : '–ü—Ä–æ–¥–∞—î—Ç—å—Å—è... ' + sec + '—Å')
        : '–ü—Ä–æ–¥–∞–Ω–æ!';
    }

    if (remaining <= 0) {
      clearInterval(interval);
      delete activeTimers[entryId];
      completeSale(entry, listPrice);
    }
  }, 500);

  activeTimers[entryId] = { interval, endTime, timerSec, listPrice };
}

// =================== STATS ===================
function renderStats() {
  updateCapitalUI();
  document.getElementById('statCasesOpened').textContent = state.stats.casesOpened;
  document.getElementById('statTotalEarned').textContent = fmt(state.totalEarned);
  document.getElementById('statItemsSold').textContent = state.stats.itemsSold;
  document.getElementById('statInShop').textContent = state.shop.filter(x => !x.sold).length;

  const bd = state.stats.bestDrop;
  if (bd) {
    document.getElementById('bestDropCard').querySelector('.best-drop-emoji').textContent = bd.emoji;
    document.getElementById('bestDropCard').querySelector('.bd-label').textContent = '–ù–∞–π–∫—Ä–∞—â–∏–π –¥—Ä–æ–ø ¬∑ ' + RARITY_LABELS[bd.rarity];
    document.getElementById('bestDropName').textContent = bd.name;
    document.getElementById('bestDropVal').textContent = fmt(bd.value);
  }

  const rc = state.stats.rarityCount;
  const total = Object.values(rc).reduce((a,b) => a+b, 0) || 1;
  const rarityDef = [
    { key:'legendary', label:'üü° Legendary', color:'var(--legendary)' },
    { key:'epic',      label:'üü£ Epic',      color:'var(--epic)' },
    { key:'rare',      label:'üîµ Rare',      color:'var(--rare)' },
    { key:'common',    label:'‚ö™ Common',    color:'var(--common)' },
  ];
  const container = document.getElementById('rarityStats');
  container.innerHTML = '';
  rarityDef.forEach(r => {
    const cnt = rc[r.key] || 0;
    const pct = Math.round((cnt / total) * 100);
    const row = document.createElement('div');
    row.className = 'rarity-stat-row';
    row.innerHTML =
      '<span class="rs-label">' + r.label + '</span>' +
      '<div class="rs-bar"><div class="rs-fill" style="width:' + pct + '%;background:' + r.color + ';"></div></div>' +
      '<span class="rs-count" style="color:' + r.color + '">' + cnt + '</span>';
    container.appendChild(row);
  });
  renderAchievements();
}


// =================== CAPITAL SYSTEM ===================
function calcCapital() {
  const cash = state.balance;
  // Inventory items (market value) ‚Äî includes container vehicle items at full value
  const invVal = state.inventory.reduce((s, x) => s + (x.value || 0), 0);
  // LifeShop assets (purchase price = 100% capital)
  const lifeVal = (state.lifeAssets || []).reduce((s, x) => s + (x.price || 0), 0);
  return { cash, invVal, lifeVal, total: cash + invVal + lifeVal };
}

function getRivalNet(r) {
  return (state.rivalNets && state.rivalNets[r.name] != null)
    ? state.rivalNets[r.name]
    : r.net;
}

function getForbesRank(capital) {
  let rank = 1;
  FORBES_RIVALS.filter(r => !r.isPlayer).forEach(r => {
    if (capital < getRivalNet(r)) rank++;
  });
  return Math.min(rank, FORBES_RIVALS.length);
}

function fmtCapital(n) {
  if (n >= 1e12) return (n / 1e12).toFixed(2) + 'T‚Ç¨';
  if (n >= 1e9)  return (n / 1e9).toFixed(2)  + 'B‚Ç¨';
  if (n >= 1e6)  return (n / 1e6).toFixed(2)  + 'M‚Ç¨';
  if (n >= 1e3)  return (n / 1e3).toFixed(1)  + 'K‚Ç¨';
  return fmt(n);
}

function updateCapitalUI() {
  const cap = calcCapital();
  const rank = getForbesRank(cap.total);
  const rankStr = '#' + rank;
  // LifeShop screen banners
  ['capitalAmount','statsCapitalAmount'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.textContent = fmtCapital(cap.total);
  });
  [['capCash','statsCapCash'], ['capInventory','statsCapInv'], ['capLifeshop','statsCapLife']].forEach(([a,b]) => {
    const vals = [fmtCapital(cap.cash), fmtCapital(cap.invVal), fmtCapital(cap.lifeVal)];
    const idx  = [['capCash','statsCapCash'],['capInventory','statsCapInv'],['capLifeshop','statsCapLife']].findIndex(x=>x[0]===a);
    const v    = vals[idx];
    [a, b].forEach(id => { const el = document.getElementById(id); if (el) el.textContent = v; });
  });
  ['forbesRankNum','statsForbesRank'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.textContent = rankStr;
  });
  // Check achievements
  checkCapitalAchievements(cap.total);
  // Re-render achievements if stats screen visible
  const achSection = document.getElementById('achievementsSection');
  if (achSection) renderAchievements();
}

// =================== LIFESHOP LOGIC ===================
function buyLifeItem(itemId) {
  const item = LIFESHOP_ALL.find(x => x.id === itemId);
  if (!item) return;
  if (state.balance < item.price) { showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤!'); return; }
  state.balance -= item.price;
  state.lifeAssets = state.lifeAssets || [];
  state.lifeAssets.push({
    id:       Date.now() + state.lifeAssets.length,
    itemId:   item.id,
    name:     item.name,
    emoji:    item.emoji,
    category: item.category,
    price:    item.price,
  });
  playSell();
  showToast('‚úÖ ' + item.name + ' –ø—Ä–∏–¥–±–∞–Ω–æ!');
  updateHUD(); updateCapitalUI(); saveState();
  renderLifeShopPane(item.category);
  renderLifeShopPane('owned');
}

function sellLifeAsset(assetId) {
  const asset = (state.lifeAssets || []).find(x => x.id === assetId);
  if (!asset) return;
  const lifeFee   = state._collBonus_lifeshopFee || 0.80;
  const sellPrice = Math.round(asset.price * lifeFee);
  state.balance += sellPrice;
  state.lifeAssets = state.lifeAssets.filter(x => x.id !== assetId);
  playSell();
  showToast('üí∏ –ü—Ä–æ–¥–∞–Ω–æ –∑–∞ ' + fmtCapital(sellPrice) + ' (80% –≤—ñ–¥ —Ü—ñ–Ω–∏)');
  updateHUD(); updateCapitalUI(); saveState();
  renderLifeShopPane(asset.category);
  renderLifeShopPane('owned');
}

function switchLifeTab(tab) {
  document.querySelectorAll('#lifeshopTabs .shop-tab').forEach(b => b.classList.remove('active'));
  document.getElementById('lstab-' + tab).classList.add('active');
  document.querySelectorAll('.lifeshop-pane').forEach(p => p.style.display = 'none');
  document.getElementById('lspane-' + tab).style.display = 'flex';
  renderLifeShopPane(tab);
}

function renderLifeShopPane(tab) {
  const pane = document.getElementById('lspane-' + tab);
  if (!pane || pane.style.display === 'none') return;
  pane.innerHTML = '';

  if (tab === 'owned') {
    renderOwnedPane(pane);
    return;
  }

  const items = LIFESHOP_ITEMS[tab] || [];
  items.forEach(item => {
    // –ü.3: –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä ‚Äî –æ–¥–Ω–∞ –ø–æ–∫—É–ø–∫–∞ (–º–æ–∂–Ω–∞ –∑–Ω–æ–≤—É –∫—É–ø–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ –ø—ñ—Å–ª—è –ø—Ä–æ–¥–∞–∂—É)
    const owned = (state.lifeAssets || []).some(x => x.itemId === item.id);
    const canAfford = !owned && state.balance >= item.price;
    const cantBuy   = !owned && state.balance < item.price;
    const card = document.createElement('div');
    card.className = 'ls-item-card' + (owned ? ' owned-card' : '') + (cantBuy ? ' cant-afford' : '');

    let _btnHtml;
    if (owned) {
      _btnHtml = '<span class="ls-owned-badge" style="flex-shrink:0;">‚úÖ –í –ê–ö–¢–ò–í–Ü</span>';
    } else if (canAfford) {
      _btnHtml = '<button class="ls-buy-btn" onclick="buyLifeItem(\'' + item.id + '\')">' + 'üõí –ö—É–ø–∏—Ç–∏</button>';
    } else {
      _btnHtml = '<button class="ls-buy-btn ls-cant">üîí ' + fmtCapital(item.price) + '</button>';
    }

    card.innerHTML =
      '<div class="ls-item-emoji">' + item.emoji + '</div>' +
      '<div class="ls-item-info">' +
        '<div class="ls-item-name">' + item.name + '</div>' +
        '<div class="ls-item-price">' + fmtCapital(item.price) + '</div>' +
        (owned ? '<div class="ls-item-count" style="color:var(--gold);font-size:10px;">–ü—Ä–æ–¥–∞–π—Ç–µ —â–æ–± –∫—É–ø–∏—Ç–∏ –∑–Ω–æ–≤—É</div>' : '') +
      '</div>' +
      _btnHtml;

    pane.appendChild(card);
  });
}

function renderOwnedPane(pane) {
  const assets = state.lifeAssets || [];
  if (!assets.length) {
    pane.innerHTML = '<div class="empty-state"><div class="e-icon">üíé</div><div>–©–µ –Ω—ñ—á–æ–≥–æ –Ω–µ –ø—Ä–∏–¥–±–∞–Ω–æ.<br>–ó–∞—Ö–æ–¥—å —É –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó —Ç–∞ –∫—É–ø—É–π –∞–∫—Ç–∏–≤–∏!</div></div>';
    return;
  }

  // Total assets value
  const totalVal = assets.reduce((s, x) => s + x.price, 0);
  const header = document.createElement('div');
  header.style.cssText = 'background:rgba(245,200,66,.07);border:1px solid rgba(245,200,66,.2);border-radius:10px;padding:10px 14px;font-size:12px;margin-bottom:4px;';
  header.innerHTML = 'üíé –ê–∫—Ç–∏–≤—ñ–≤: <b style="color:var(--gold)">' + assets.length + ' —à—Ç</b>   ¬∑ –ó–∞–≥–∞–ª—å–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å: <b style="color:var(--gold)">' + fmtCapital(totalVal) + '</b>   ¬∑ –ü—Ä–∏ –ø—Ä–æ–¥–∞–∂—É: <b style="color:#ef4444">~' + fmtCapital(Math.round(totalVal * 0.8)) + '</b> <span style="color:var(--muted)">(80%)</span>';
  pane.appendChild(header);

  // Sort by price desc
  [...assets].sort((a,b) => b.price - a.price).forEach(asset => {
    const card = document.createElement('div');
    card.className = 'ls-item-card owned-card';
    card.innerHTML =
      '<div class="ls-item-emoji">' + asset.emoji + '</div>' +
      '<div class="ls-item-info">' +
        '<div class="ls-item-name">' + asset.name + '</div>' +
        '<div class="ls-item-price">' + fmtCapital(asset.price) + '</div>' +
        '<div class="ls-item-count" style="color:var(--muted)">–ü—Ä–æ–¥–∞–∂: ' + fmtCapital(Math.round(asset.price * 0.8)) + ' (80%)</div>' +
      '</div>' +
      '<span class="ls-owned-badge" style="margin-right:6px;">–í –ê–ö–¢–ò–í–Ü</span>' +
      '<button class="ls-sell-btn" onclick="sellLifeAsset(' + asset.id + ')">üí∏ –ü—Ä–æ–¥–∞—Ç–∏</button>';
    pane.appendChild(card);
  });

  // Forbes table at the bottom
  renderForbesTable(pane);
}

function renderForbesTable(container) {
  const cap = calcCapital();
  const title = document.createElement('div');
  title.className = 'section-title';
  title.style.marginTop = '16px';
  title.textContent = 'üèÜ Forbes ‚Äî –†–µ–π—Ç–∏–Ω–≥ –º—ñ–ª—å—è—Ä–¥–µ—Ä—ñ–≤';
  container.appendChild(title);

  const tableWrap = document.createElement('div');
  tableWrap.className = 'forbes-table';

  // Build list with player inserted correctly
  const rivals = FORBES_RIVALS.filter(r => !r.isPlayer).map(r => ({
    ...r, net: getRivalNet(r)
  }));
  const allInList = [...rivals, { name:'–¢–∏', net:cap.total, emoji:'üòé', isPlayer:true }];
  allInList.sort((a,b) => b.net - a.net);

  allInList.forEach((person, i) => {
    const lastChange = !person.isPlayer ? (window.rivalLastChange?.[person.name] || null) : null;
    const hasCrisis  = lastChange?.crisis === true;

    // Wrapper (row + optional event detail)
    const wrapper = document.createElement('div');

    const row = document.createElement('div');
    row.className = 'forbes-row' + (person.isPlayer ? ' player-row' : '') + (hasCrisis ? ' crisis-row' : '');
    const medal = i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : '#' + (i+1);

    // Change indicator badge
    let changeBadge = '';
    if (!person.isPlayer) {
      if (lastChange === null) {
        const growthPct = (getRivalGrowthRate(person.net) * 100).toFixed(2);
        changeBadge = '<span class="forbes-badge sleep">üí§ +' + growthPct + '%/—Ö–≤</span>';
      } else if (hasCrisis) {
        changeBadge = '<span class="forbes-badge crisis">üìâ ‚àí' + fmtCapital(Math.abs(lastChange.delta)) + '</span>';
      } else if (lastChange?.delta > 0) {
        const growthPct = (getRivalGrowthRate(person.net) * 100).toFixed(2);
        changeBadge = '<span class="forbes-badge grow">üü¢ +' + growthPct + '%/—Ö–≤</span>';
      }
    }

    row.innerHTML =
      '<div class="forbes-rank">' + medal + '</div>' +
      '<div class="forbes-emoji">' + person.emoji + '</div>' +
      '<div style="flex:1;min-width:0;">' +
        '<div style="font-size:13px;font-weight:700;color:var(--text);">' +
          person.name + (person.isPlayer ? ' üëà' : '') +
        '</div>' +
        (changeBadge ? '<div style="margin-top:2px;">' + changeBadge + '</div>' : '') +
      '</div>' +
      '<div class="forbes-net">' + fmtCapital(person.net) + '</div>';

    wrapper.appendChild(row);

    // Crisis event detail row (expands below)
    if (hasCrisis && lastChange.text) {
      const detail = document.createElement('div');
      detail.className = 'forbes-crisis-detail';
      detail.innerHTML =
        '<span style="color:#ef4444;font-weight:700;">‚ö†Ô∏è –ü–æ–¥—ñ—è:</span> ' + lastChange.text;
      wrapper.appendChild(detail);
    }

    tableWrap.appendChild(wrapper);
  });
  container.appendChild(tableWrap);
}

function renderLifeShop() {
  updateCapitalUI();
  // Render currently visible tab
  const activeTab = document.querySelector('#lifeshopTabs .shop-tab.active');
  if (activeTab) {
    const tab = activeTab.id.replace('lstab-','');
    renderLifeShopPane(tab);
  } else {
    renderLifeShopPane('transport');
  }
}


// =================== CAPITAL ACHIEVEMENTS ===================
const CAPITAL_ACHIEVEMENTS = [
  { id:'cap1k',    threshold:1_000,           icon:'üå±', title:'–ü–µ—Ä—à–∏–π –∫—Ä–æ–∫',         desc:'–î–æ—Å—è–≥–Ω–∏ –∫–∞–ø—ñ—Ç–∞–ª—É 1,000‚Ç¨',       label:'–ü–æ—á–∞—Ç–∫—ñ–≤–µ—Ü—å' },
  { id:'cap10k',   threshold:10_000,          icon:'üíµ', title:'–ü–µ—Ä—à—ñ –¥–µ—Å—è—Ç–∫–∏ —Ç–∏—Å—è—á', desc:'–î–æ—Å—è–≥–Ω–∏ –∫–∞–ø—ñ—Ç–∞–ª—É 10,000‚Ç¨',      label:'–î—Ä—ñ–±–Ω–∏–π —ñ–Ω–≤–µ—Å—Ç–æ—Ä' },
  { id:'cap100k',  threshold:100_000,         icon:'üèÖ', title:'–£—Å–ø—ñ—à–Ω–∏–π –ø—ñ–¥–ø—Ä–∏—î–º–µ—Ü—å',desc:'–î–æ—Å—è–≥–Ω–∏ –∫–∞–ø—ñ—Ç–∞–ª—É 100,000‚Ç¨',     label:'–ü—ñ–¥–ø—Ä–∏—î–º–µ—Ü—å' },
  { id:'cap1m',    threshold:1_000_000,       icon:'üí∞', title:'–ú—ñ–ª—å–π–æ–Ω–µ—Ä!',          desc:'–î–æ—Å—è–≥–Ω–∏ –∫–∞–ø—ñ—Ç–∞–ª—É 1,000,000‚Ç¨',   label:'–ú—ñ–ª—å–π–æ–Ω–µ—Ä' },
  { id:'cap10m',   threshold:10_000_000,      icon:'üèÜ', title:'–í–µ–ª–∏–∫–∏–π –≥—Ä–∞–≤–µ—Ü—å',     desc:'–î–æ—Å—è–≥–Ω–∏ –∫–∞–ø—ñ—Ç–∞–ª—É 10,000,000‚Ç¨',  label:'–í–µ–ª–∏–∫–∏–π –≥—Ä–∞–≤–µ—Ü—å' },
  { id:'cap100m',  threshold:100_000_000,     icon:'üíé', title:'–ú–∞–≥–Ω–∞—Ç',              desc:'–î–æ—Å—è–≥–Ω–∏ –∫–∞–ø—ñ—Ç–∞–ª—É 100M‚Ç¨',        label:'–ú–∞–≥–Ω–∞—Ç' },
  { id:'cap1b',    threshold:1_000_000_000,   icon:'üöÄ', title:'–ú—ñ–ª—å—è—Ä–¥–µ—Ä Forbes',    desc:'–î–æ—Å—è–≥–Ω–∏ –∫–∞–ø—ñ—Ç–∞–ª—É 1B‚Ç¨',          label:'–ú—ñ–ª—å—è—Ä–¥–µ—Ä' },
  { id:'cap10b',   threshold:10_000_000_000,  icon:'üåç', title:'–ú–µ–≥–∞–±–∞–≥–∞—Ç—ñ–π',         desc:'–î–æ—Å—è–≥–Ω–∏ –∫–∞–ø—ñ—Ç–∞–ª—É 10B‚Ç¨',         label:'–ú–µ–≥–∞–±–∞–≥–∞—Ç—ñ–π' },
  { id:'cap100b',  threshold:100_000_000_000, icon:'üëë', title:'–ö–æ—Ä–æ–ª—å Forbes',       desc:'–î–æ—Å—è–≥–Ω–∏ –∫–∞–ø—ñ—Ç–∞–ª—É 100B‚Ç¨',        label:'–ö–æ—Ä–æ–ª—å Forbes' },
  { id:'cap1t',    threshold:1_000_000_000_000,icon:'üåå',title:'–¢—Ä–∏–ª—å–π–æ–Ω–µ—Ä',          desc:'–î–æ—Å—è–≥–Ω–∏ –∫–∞–ø—ñ—Ç–∞–ª—É 1T‚Ç¨',          label:'–¢—Ä–∏–ª—å–π–æ–Ω–µ—Ä' },
];

// ‚îÄ‚îÄ Popup notification ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showAchievementPopup(ach) {
  // Remove existing if any
  const old = document.getElementById('achPopup');
  if (old) old.remove();

  const el = document.createElement('div');
  el.id = 'achPopup';
  el.innerHTML =
    '<div style="font-size:10px;letter-spacing:1.5px;text-transform:uppercase;color:rgba(245,200,66,.7);margin-bottom:4px;">üèÜ –î–û–°–Ø–ì–ù–ï–ù–ù–Ø –†–û–ó–ë–õ–û–ö–û–í–ê–ù–û</div>' +
    '<div style="display:flex;align-items:center;gap:10px;">' +
      '<div style="font-size:28px;">' + ach.icon + '</div>' +
      '<div>' +
        '<div style="font-size:14px;font-weight:800;color:#fff;font-family:\'Orbitron\',sans-serif;">' + ach.title + '</div>' +
        '<div style="font-size:11px;color:rgba(255,255,255,.65);margin-top:2px;">' + ach.desc + '</div>' +
      '</div>' +
    '</div>';
  document.body.appendChild(el);

  // Animate in
  requestAnimationFrame(() => { el.style.opacity = '1'; el.style.transform = 'translateX(-50%) translateY(0)'; });

  // Auto-dismiss after 3s
  setTimeout(() => {
    el.style.opacity = '0';
    el.style.transform = 'translateX(-50%) translateY(-20px)';
    setTimeout(() => el.remove(), 400);
  }, 3000);
}

// ‚îÄ‚îÄ Check achievements against current capital ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function checkCapitalAchievements(capital) {
  CAPITAL_ACHIEVEMENTS.forEach(ach => {
    if (!state.capitalAchievements[ach.id] && capital >= ach.threshold) {
      state.capitalAchievements[ach.id] = true;
      saveState();
      showAchievementPopup(ach);
    }
  });
}

// ‚îÄ‚îÄ Render achievements section in stats ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderAchievements() {
  const container = document.getElementById('achievementsSection');
  if (!container) return;
  const cap = calcCapital();
  container.innerHTML = '';

  CAPITAL_ACHIEVEMENTS.forEach(ach => {
    const done    = !!state.capitalAchievements[ach.id];
    const current = Math.min(cap.total, ach.threshold);
    const pct     = Math.min(100, (cap.total / ach.threshold) * 100);

    const card = document.createElement('div');
    card.className = 'ach-card' + (done ? ' ach-done' : '');
    card.innerHTML =
      '<div class="ach-icon' + (done ? ' ach-icon-done' : '') + '">' + ach.icon + '</div>' +
      '<div class="ach-body">' +
        '<div class="ach-title">' + ach.title + '</div>' +
        '<div class="ach-desc">' + ach.desc + '</div>' +
        (!done ?
          '<div class="ach-progress-wrap">' +
            '<div class="ach-progress-bar"><div class="ach-progress-fill" style="width:' + pct.toFixed(1) + '%"></div></div>' +
            '<div class="ach-pct">' + fmtCapital(cap.total) + ' / ' + fmtCapital(ach.threshold) + '</div>' +
          '</div>'
        : '') +
      '</div>' +
      '<div class="ach-badge' + (done ? ' ach-badge-done' : ' ach-badge-locked') + '">' +
        (done ? '‚úÖ –í–∏–∫–æ–Ω–∞–Ω–æ' : 'üîí –ó–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ') +
      '</div>';
    container.appendChild(card);
  });
}



// Per-case unique mastery bonuses
// ‚îÄ‚îÄ –£–Ω—ñ–∫–∞–ª—å–Ω—ñ –±–æ–Ω—É—Å–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É (–∞–∫—Ç–∏–≤—É—é—Ç—å—Å—è –æ–¥—Ä–∞–∑—É –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ) ‚îÄ‚îÄ
const COLLECTION_UNIQUE_BONUS = {
  street:   { desc: '+25‚Ç¨ –¥–æ –∫–æ–∂–Ω–æ–≥–æ –∫–ª—ñ–∫—É',
              apply: s => { s._collBonus_clickFlat = (s._collBonus_clickFlat||0) + 25; } },
  office:   { desc: '+5% —à–∞–Ω—Å –Ω–∞ Rare –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ',
              apply: s => { s._collBonus_officeRare = true; } },
  chef:     { desc: '+50‚Ç¨ –¥–æ –∫–æ–∂–Ω–æ–≥–æ –∫–ª—ñ–∫—É',
              apply: s => { s._collBonus_clickFlat = (s._collBonus_clickFlat||0) + 50; } },
  gamer:    { desc: '+15‚Ç¨/—Å–µ–∫ –ø–∞—Å–∏–≤–Ω–æ',
              apply: s => { s._collBonus_passiveFlat = (s._collBonus_passiveFlat||0) + 15; } },
  fitness:  { desc: '+100‚Ç¨ –¥–æ –∫–æ–∂–Ω–æ–≥–æ –∫–ª—ñ–∫—É',
              apply: s => { s._collBonus_clickFlat = (s._collBonus_clickFlat||0) + 100; } },
  apple:    { desc: '+5% –¥–æ —Ü—ñ–Ω–∏ Epic –ø—Ä–µ–¥–º–µ—Ç—ñ–≤',
              apply: s => { s._collBonus_epicSellMult = Math.max(s._collBonus_epicSellMult||1, 1.05); } },
  photo:    { desc: '+100‚Ç¨/—Å–µ–∫ –ø–∞—Å–∏–≤–Ω–æ',
              apply: s => { s._collBonus_passiveFlat = (s._collBonus_passiveFlat||0) + 100; } },
  workshop: { desc: '-5% —Ü—ñ–Ω–∞ –≤—Å—ñ—Ö –∫–µ–π—Å—ñ–≤',
              apply: s => { s._collBonus_casePriceMult = (s._collBonus_casePriceMult||1) * 0.95; } },
  smart:    { desc: '+200‚Ç¨ –¥–æ –∫–æ–∂–Ω–æ–≥–æ –∫–ª—ñ–∫—É',
              apply: s => { s._collBonus_clickFlat = (s._collBonus_clickFlat||0) + 200; } },
  elite:    { desc: '‚ú® –ó–æ–ª–æ—Ç–∞ –ö–∞—Ä—Ç–∞ ‚Äî –î–∏–Ω–∞–º—ñ—á–Ω–∏–π –ø–∞—Å–∏–≤',
              apply: s => { s._collBonus_dynamicPassive = true; } },
};

// ‚îÄ‚îÄ –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ–∫—Ä–∞—â–µ–Ω—å –º–∞–≥–∞–∑–∏–Ω—É –≤—ñ–¥ –∫–æ–∂–Ω–æ—ó –∫–æ–ª–µ–∫—Ü—ñ—ó ‚îÄ‚îÄ
// shopUpgrade: { icon, title, steps:10|5, basePrice, priceScale, effect, effectLabel, maxLabel }
const COLLECTION_SHOP_UPGRADES = {
  street: {
    icon: 'üè∑Ô∏è', title: '–¶—ñ–Ω–∞ Common',
    subtitle: '–ü—ñ–¥–≤–∏—â—É–π —Ü—ñ–Ω—É Common –ø—Ä–µ–¥–º–µ—Ç—ñ–≤ —É –º–∞–≥–∞–∑–∏–Ω—ñ',
    steps: 10, basePrice: 500, scale: 2.2,
    getEffect: lvl => 1 + lvl * 0.10,
    effectLabel: lvl => '+' + (lvl*10) + '% –¥–æ Common',
    apply: (s, lvl) => { s._collBonus_commonSellMult = 1 + lvl * 0.10; },
  },
  office: {
    icon: 'üìä', title: '–¶—ñ–Ω–∞ Rare',
    subtitle: '–ü—ñ–¥–≤–∏—â—É–π —Ü—ñ–Ω—É Rare –ø—Ä–µ–¥–º–µ—Ç—ñ–≤ —É –º–∞–≥–∞–∑–∏–Ω—ñ',
    steps: 10, basePrice: 2000, scale: 2.5,
    getEffect: lvl => 1 + lvl * 0.05,
    effectLabel: lvl => '+' + (lvl*5) + '% –¥–æ Rare',
    apply: (s, lvl) => { s._collBonus_rareSellMult = 1 + lvl * 0.05; },
  },
  chef: {
    icon: 'üçΩÔ∏è', title: '–®–∞–Ω—Å Rare',
    subtitle: '–ó–±—ñ–ª—å—à—É–π –±–∞–∑–æ–≤–∏–π —à–∞–Ω—Å –≤–∏–ø–∞–¥—ñ–Ω–Ω—è Rare',
    steps: 10, basePrice: 3000, scale: 2.4,
    getEffect: lvl => lvl * 1,
    effectLabel: lvl => '+' + lvl + '% —à–∞–Ω—Å Rare',
    apply: (s, lvl) => { s._collBonus_globalRareChance = lvl; },
  },
  gamer: {
    icon: '‚ö°', title: '–ï–Ω–µ—Ä–≥—ñ—è –∫–ª—ñ–∫—É',
    subtitle: '–ú–Ω–æ–∂–Ω–∏–∫ –¥–æ—Ö–æ–¥—É –∑–∞ –∫–ª—ñ–∫',
    steps: 10, basePrice: 5000, scale: 2.6,
    getEffect: lvl => 1 + lvl * 0.10,
    effectLabel: lvl => '+' + (lvl*10) + '% –¥–æ –∫–ª—ñ–∫—É',
    apply: (s, lvl) => { s._collBonus_clickMult = 1 + lvl * 0.10; },
  },
  fitness: {
    icon: 'üí•', title: '–®–∞–Ω—Å Epic',
    subtitle: '–ó–±—ñ–ª—å—à—É–π –±–∞–∑–æ–≤–∏–π —à–∞–Ω—Å –≤–∏–ø–∞–¥—ñ–Ω–Ω—è Epic',
    steps: 5, basePrice: 8000, scale: 3.0,
    getEffect: lvl => lvl * 1,
    effectLabel: lvl => '+' + lvl + '% —à–∞–Ω—Å Epic',
    apply: (s, lvl) => { s._collBonus_globalEpicChance = lvl; },
  },
  apple: {
    icon: 'üü£', title: '–õ–æ–≥—ñ—Å—Ç–∏–∫–∞',
    subtitle: '–°–∫–æ—Ä–æ—á–µ–Ω–Ω—è —á–∞—Å—É –ø—Ä–æ–¥–∞–∂—É –≤ –º–∞–≥–∞–∑–∏–Ω—ñ',
    steps: 10, basePrice: 15000, scale: 2.8,
    getEffect: lvl => 1 - lvl * 0.03,
    effectLabel: lvl => '-' + (lvl*3) + '% —á–∞—Å –ø—Ä–æ–¥–∞–∂—É',
    apply: (s, lvl) => { s._collBonus_shopTimerMult = Math.max(0.1, 1 - lvl * 0.03); },
  },
  photo: {
    icon: 'üí†', title: '–¶—ñ–Ω–∞ Epic',
    subtitle: '–ü—ñ–¥–≤–∏—â—É–π —Ü—ñ–Ω—É Epic –ø—Ä–µ–¥–º–µ—Ç—ñ–≤ —É –º–∞–≥–∞–∑–∏–Ω—ñ',
    steps: 10, basePrice: 25000, scale: 2.7,
    getEffect: lvl => 1 + lvl * 0.02,
    effectLabel: lvl => '+' + (lvl*2) + '% –¥–æ Epic',
    apply: (s, lvl) => { s._collBonus_epicSellMult = Math.max(s._collBonus_epicSellMult||1, 1 + lvl * 0.02); },
  },
  workshop: {
    icon: 'üåü', title: '–®–∞–Ω—Å Legendary',
    subtitle: '–ó–±—ñ–ª—å—à—É–π –±–∞–∑–æ–≤–∏–π —à–∞–Ω—Å –≤–∏–ø–∞–¥—ñ–Ω–Ω—è Legendary',
    steps: 5, basePrice: 50000, scale: 4.0,
    getEffect: lvl => lvl * 0.2,
    effectLabel: lvl => '+' + (lvl*0.2).toFixed(1) + '% —à–∞–Ω—Å Leg',
    apply: (s, lvl) => { s._collBonus_globalLegChance = lvl * 0.2; },
  },
  smart: {
    icon: '‚úñÔ∏è', title: '–ú–Ω–æ–∂–Ω–∏–∫ –ü–∞—Å–∏–≤—É',
    subtitle: '–ó–±—ñ–ª—å—à—É–π –∑–∞–≥–∞–ª—å–Ω–∏–π –ø–∞—Å–∏–≤–Ω–∏–π –¥–æ—Ö—ñ–¥',
    steps: 10, basePrice: 150000, scale: 3.0,
    getEffect: lvl => 1 + lvl * 0.02,
    effectLabel: lvl => '+' + (lvl*2) + '% –ø–∞—Å–∏–≤–Ω–∏–π –¥–æ—Ö—ñ–¥',
    apply: (s, lvl) => { s._collBonus_passiveMult = 1 + lvl * 0.02; },
  },
  elite: {
    icon: 'üëë', title: '–¶—ñ–Ω–∞ Legendary',
    subtitle: '–ü—ñ–¥–≤–∏—â—É–π —Ü—ñ–Ω—É Legendary –ø—Ä–µ–¥–º–µ—Ç—ñ–≤ —É –º–∞–≥–∞–∑–∏–Ω—ñ',
    steps: 5, basePrice: 1000000, scale: 5.0,
    getEffect: lvl => 1 + lvl * 0.02,
    effectLabel: lvl => '+' + (lvl*2) + '% –¥–æ Legendary',
    apply: (s, lvl) => { s._collBonus_legSellMult = 1 + lvl * 0.02; },
  },
};

// =================== COLLECTIONS ===================
const COLLECTION_SIZE = 15; // items per collection


// Re-apply all active collection bonuses (called on load + after new completion)
function applyAllCollectionBonuses() {
  // Reset all bonus fields
  state._collBonus_clickFlat         = 0;
  state._collBonus_clickMult         = 1;
  state._collBonus_passiveMult       = 1;
  state._collBonus_passiveSpeed      = 1;
  state._collBonus_passiveFlat       = 0;
  state._collBonus_commonSellMult    = 1;
  state._collBonus_rareSellMult      = 1;
  state._collBonus_epicSellMult      = 1;
  state._collBonus_legSellMult       = 1;
  state._collBonus_shopTimerMult     = 1.0;
  state._collBonus_lifeshopFee       = 0.80;
  state._collBonus_critChance        = 0;
  state._collBonus_fitnessRare       = false;
  state._collBonus_officeRare        = false;
  state._collBonus_casePriceMult     = 1;
  state._collBonus_globalRareChance  = 0;
  state._collBonus_globalEpicChance  = 0;
  state._collBonus_globalLegChance   = 0;
  state._collBonus_dynamicPassive    = false;

  // Apply unique cert bonuses (instant, on collection mastery)
  Object.keys(state.collectionBonuses || {}).forEach(caseId => {
    const b = state.collectionBonuses[caseId];
    if (b?.multiOpen && COLLECTION_UNIQUE_BONUS[caseId]) {
      COLLECTION_UNIQUE_BONUS[caseId].apply(state);
    }
  });

  // Apply shop upgrade bonuses (tiered, from collUpgLevels)
  Object.keys(state.collUpgLevels || {}).forEach(caseId => {
    const lvl = state.collUpgLevels[caseId] || 0;
    if (lvl > 0 && COLLECTION_SHOP_UPGRADES[caseId]) {
      COLLECTION_SHOP_UPGRADES[caseId].apply(state, lvl);
    }
  });
}

// Get collection for a case (init if needed)
function getColl(caseId) {
  if (!state.collections[caseId]) state.collections[caseId] = {};
  return state.collections[caseId];
}

// Check if item is already in any collection
function isItemInCollection(itemName, caseId) {
  const coll = getColl(caseId);
  return !!coll[itemName];
}

// Add item to collection
function addToCollection(invId) {
  const idx = state.inventory.findIndex(x => x.id === invId);
  if (idx === -1) return;
  const item = state.inventory[idx];

  // Find which case this item belongs to
  const sourceCase = CASES.find(c => c.name === item.fromCase);
  if (!sourceCase) { showToast('‚ùå –ü—Ä–µ–¥–º–µ—Ç –Ω–µ –∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–µ–π—Å–∞'); return; }

  const coll = getColl(sourceCase.id);
  if (coll[item.name]) { showToast('üèÖ –¶–µ–π –ø—Ä–µ–¥–º–µ—Ç –≤–∂–µ —î –≤ –∫–æ–ª–µ–∫—Ü—ñ—ó!'); return; }

  // Check collection not full
  if (Object.keys(coll).length >= COLLECTION_SIZE) {
    showToast('‚úÖ –ö–æ–ª–µ–∫—Ü—ñ—è –≤–∂–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–∞!'); return;
  }

  // Move item from inventory to collection
  coll[item.name] = { name: item.name, emoji: item.emoji, rarity: item.rarity, value: item.value };
  state.inventory.splice(idx, 1);

  saveState();
  renderInventory();
  updateCapitalUI();

  // Check for mastery completion
  const count = Object.keys(coll).length;
  if (count >= COLLECTION_SIZE && !state.collectionBonuses[sourceCase.id]?.multiOpen) {
    // First time completing this collection!
    if (!state.collectionBonuses[sourceCase.id]) state.collectionBonuses[sourceCase.id] = {};
    state.collectionBonuses[sourceCase.id].multiOpen = true;
    state.collectionBonuses[sourceCase.id].discount  = true;
    applyAllCollectionBonuses();
    saveState();
    showCertificate(sourceCase);
  } else {
    showToast('üèÖ –î–æ–¥–∞–Ω–æ –¥–æ –∫–æ–ª–µ–∫—Ü—ñ—ó ¬´' + sourceCase.name + '¬ª (' + count + '/' + COLLECTION_SIZE + ')');
  }
}

function showCertificate(c) {
  // Full-screen certificate popup
  const div = document.createElement('div');
  div.className = 'cert-popup';
  const _ub = COLLECTION_UNIQUE_BONUS[c.id];
  const _su = COLLECTION_SHOP_UPGRADES[c.id];
  const _shopUpgHtml = _su
    ? '<div style="margin-top:8px;padding:8px 10px;background:rgba(245,200,66,.08);border-radius:8px;border:1px solid rgba(245,200,66,.25);">'
      + '<div style="font-size:11px;color:var(--gold);font-weight:700;margin-bottom:2px;">üè™ –ù–æ–≤–µ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –≤ –º–∞–≥–∞–∑–∏–Ω—ñ!</div>'
      + '<div style="font-size:10px;color:var(--muted);">' + _su.icon + ' ' + _su.title + ' ¬∑ ' + _su.steps + ' —Ä—ñ–≤–Ω—ñ–≤ ¬∑ ' + _su.subtitle + '</div></div>'
    : '';
  div.innerHTML =
    '<div class="cert-card">' +
      '<div class="cert-title">üèÜ –ö–û–õ–ï–ö–¶–Ü–Ø –ó–Ü–ë–†–ê–ù–ê!</div>' +
      '<div class="cert-case" style="margin:10px 0;display:flex;justify-content:center;align-items:center;">' + itemDisplay(c.icon, 56) + '</div>' +
      '<div style="font-size:17px;font-weight:800;color:var(--gold);margin-bottom:2px;">' + c.name + '</div>' +
      '<div style="font-size:11px;color:var(--muted);margin-bottom:12px;">–ó–æ–ª–æ—Ç–∏–π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –ú–∞–π—Å—Ç—Ä–∞</div>' +
      '<div class="cert-bonuses" style="text-align:left;">' +
        '<div style="margin-bottom:5px;">‚ö° <b style="color:var(--gold)">–û–ø—Ç–æ–≤–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç</b> ‚Äî –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è √ó5 –∑–∞ –∫–ª—ñ–∫</div>' +
        '<div style="margin-bottom:5px;">üíö <b style="color:#22c55e">–ü—Ä—è–º—ñ –ø–æ—Å—Ç–∞–≤–∫–∏</b> ‚Äî —Ü—ñ–Ω–∞ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è ‚àí20%</div>' +
        (_ub ? '<div style="margin-bottom:5px;">‚ú® <b style="color:#60a5fa">–£–Ω—ñ–∫–∞–ª—å–Ω–∏–π –±–æ–Ω—É—Å</b> ‚Äî ' + _ub.desc + '</div>' : '') +
        _shopUpgHtml +
      '</div>' +
      '<button onclick="this.closest(\'.cert-popup\').remove()" ' +
        'style="margin-top:14px;padding:10px 28px;border-radius:10px;border:none;' +
        'background:linear-gradient(135deg,var(--gold),#f97316);color:#000;' +
        'font-family:Rajdhani,sans-serif;font-size:14px;font-weight:800;cursor:pointer;">üéâ –û–¢–†–ò–ú–ê–¢–ò!</button>' +
    '</div>';
  document.body.appendChild(div);
  spawnConfetti();
  renderCases(); // refresh case cards to show bonuses
}

// Render collections overview
function renderCollections() {
  const grid = document.getElementById('collectionsGrid');
  if (!grid) return;
  grid.innerHTML = '';

  CASES.forEach(c => {
    const coll   = getColl(c.id);
    const count  = Object.keys(coll).length;
    const pct    = Math.round((count / COLLECTION_SIZE) * 100);
    const bonus  = state.collectionBonuses[c.id] || {};
    const done   = count >= COLLECTION_SIZE;

    const card = document.createElement('div');
    card.className = 'coll-case-card' + (done ? ' mastered' : '');
    card.onclick = () => openCollModal(c.id);

    card.innerHTML =
      '<div class="coll-case-header">' +
        '<div class="coll-case-icon">' + itemDisplay(c.icon, 32) + '</div>' +
        '<div class="coll-case-meta">' +
          '<div class="coll-case-name">' + (done ? 'üèÜ ' : '') + c.name + '</div>' +
          '<div class="coll-case-prog">' + count + ' / ' + COLLECTION_SIZE + ' –ø—Ä–µ–¥–º–µ—Ç—ñ–≤' +
            (done ? ' ¬∑ <span style="color:var(--gold)">–ú–ê–ô–°–¢–ï–†</span>' : '') +
          '</div>' +
        '</div>' +
        '<div style="font-size:13px;font-weight:700;color:' + (done ? 'var(--gold)' : 'var(--muted)') + '">' + pct + '%</div>' +
      '</div>' +
      '<div class="coll-prog-bar"><div class="coll-prog-fill" style="width:' + pct + '%;"></div></div>' +
      (function(){
        const ub = COLLECTION_UNIQUE_BONUS[c.id];
        const su3 = COLLECTION_SHOP_UPGRADES[c.id];
        const upLvl3 = state.collUpgLevels[c.id] || 0;
        return '<div class="coll-bonuses">' +
          '<span class="coll-bonus-badge' + (bonus.multiOpen ? '' : ' inactive') + '">‚ö° √ó5' + (bonus.multiOpen ? '' : ' üîí') + '</span>' +
          '<span class="coll-bonus-badge' + (bonus.discount  ? '' : ' inactive') + '">üíö ‚àí20%' + (bonus.discount  ? '' : ' üîí') + '</span>' +
          (ub ? '<span class="coll-bonus-badge' + (bonus.multiOpen ? '' : ' inactive') + '" style="font-size:9px;" title="' + ub.desc + '">' + (bonus.multiOpen ? '' : 'üîí ') + ub.desc + '</span>' : '') +
          (su3 && bonus.multiOpen ? '<span class="coll-bonus-badge" style="font-size:9px;background:rgba(245,200,66,.1);border-color:rgba(245,200,66,.3);" title="–ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –º–∞–≥–∞–∑–∏–Ω—É">üè™ ' + upLvl3 + '/' + su3.steps + '</span>' : '') +
        '</div>';
      })();

    grid.appendChild(card);
  });
}

// Open collection detail modal
function openCollModal(caseId) {
  const c    = CASES.find(x => x.id === caseId);
  if (!c) return;
  const coll  = getColl(caseId);
  const count = Object.keys(coll).length;
  const bonus = state.collectionBonuses[caseId] || {};
  const done  = count >= COLLECTION_SIZE;

  document.getElementById('collModalIcon').innerHTML = itemDisplay(c.icon, 36);
  document.getElementById('collModalName').textContent = c.name;
  document.getElementById('collModalProg').textContent = count + ' / ' + COLLECTION_SIZE + ' –ø—Ä–µ–¥–º–µ—Ç—ñ–≤ –∑—ñ–±—Ä–∞–Ω–æ';

  // Bonuses row
  const bDiv = document.getElementById('collModalBonuses');
  const ub2 = COLLECTION_UNIQUE_BONUS[caseId];
  bDiv.innerHTML =
    '<div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:4px;">' +
      '<span class="coll-bonus-badge' + (bonus.multiOpen ? '' : ' inactive') + '">‚ö° –í—ñ–¥–∫—Ä–∏—Ç—Ç—è √ó5' + (bonus.multiOpen ? '' : ' üîí') + '</span>' +
      '<span class="coll-bonus-badge' + (bonus.discount  ? '' : ' inactive') + '">üíö –ó–Ω–∏–∂–∫–∞ ‚àí20%' + (bonus.discount  ? '' : ' üîí') + '</span>' +
    '</div>' +
    (ub2 ? '<div style="font-size:11px;padding:6px 10px;border-radius:8px;background:rgba(245,200,66,.08);border:1px solid rgba(245,200,66,.2);color:var(--gold);">' +
      (bonus.multiOpen ? '‚úÖ ' : 'üîí ') + '<b>–£–Ω—ñ–∫–∞–ª—å–Ω–∏–π –±–æ–Ω—É—Å:</b> ' + ub2.desc +
    '</div>' : '');

  // Slots ‚Äî show all 15 items in this case
  const slots = document.getElementById('collModalSlots');
  slots.innerHTML = '';
  c.items.forEach(item => {
    const inColl = !!coll[item.name];
    const div = document.createElement('div');
    div.className = 'coll-slot ' + (inColl ? 'filled ' + item.rarity : 'empty');
    div.innerHTML =
      '<span class="coll-slot-emoji">' + item.emoji + '</span>' +
      '<div class="coll-slot-name r-' + item.rarity + '">' + item.name + '</div>' +
      (inColl ? '<div class="coll-slot-check">‚úÖ</div>' : '');
    slots.appendChild(div);
  });

  document.getElementById('collectionModal').classList.add('show');
}

function closeCollModal() {
  document.getElementById('collectionModal').classList.remove('show');
}

document.getElementById('collectionModal').addEventListener('click', function(e) {
  if (e.target === this) closeCollModal();
});

// =================== COLLECTION BONUSES APPLIED ===================
// Applied in openCaseModal (price discount) and spin x5 button on case card
function getCaseOpenPrice(c) {
  const bonus = state.collectionBonuses[c.id] || {};
  let price = c.price;
  if (bonus.discount) price = Math.round(price * 0.8);
  // Hobbyist workshop collection bonus: -5% all cases
  const caseMult = state._collBonus_casePriceMult || 1;
  price = Math.round(price * caseMult);
  return Math.max(1, price);
}


function openCaseMulti(caseId, count) {
  const c = CASES.find(x => x.id === caseId);
  if (!c) return;
  const effectivePrice = getCaseOpenPrice(c);
  const totalCost = effectivePrice * count;
  if (state.balance < totalCost) { showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –¥–ª—è √ó' + count + '!'); return; }

  // Deduct all at once
  state.balance -= totalCost;
  state.stats.casesOpened += count;
  updateHUD(); saveState();

  // Pre-roll all results NOW (before animation)
  const results = [];
  for (let i = 0; i < count; i++) {
    const weights = getCurrentWeights(caseId);
    const item    = pickItem(c, weights);
    results.push(item);
    // Pity update per roll
    const p = getPityForCase(caseId);
    const r = item.rarity;
    if (r === 'legendary') { p.legendary = 0; }
    else if (r === 'epic') { p.epic = 0; p.legendary = +(p.legendary + PITY_PER_SPIN.legendary).toFixed(2); }
    else if (r === 'rare') { p.rare = 0; p.epic = +(p.epic + PITY_PER_SPIN.epic).toFixed(2); p.legendary = +(p.legendary + PITY_PER_SPIN.legendary).toFixed(2); }
    else { p.rare = +(p.rare + PITY_PER_SPIN.rare).toFixed(2); p.epic = +(p.epic + PITY_PER_SPIN.epic).toFixed(2); p.legendary = +(p.legendary + PITY_PER_SPIN.legendary).toFixed(2); }
    p.rare = Math.min(p.rare, 40); p.epic = Math.min(p.epic, 30); p.legendary = Math.min(p.legendary, 15);
    // Stats
    if (!state.stats.rarityCount) state.stats.rarityCount = {common:0,rare:0,epic:0,legendary:0};
    state.stats.rarityCount[r] = (state.stats.rarityCount[r] || 0) + 1;
    if (!state.stats.bestDrop || item.value > state.stats.bestDrop.value)
      state.stats.bestDrop = { name: item.name, emoji: item.emoji, rarity: item.rarity, value: item.value };
  }
  saveState();

  // Open the case modal and run 5 quick spins sequentially
  currentCase = c;
  currentCase._effectivePrice = effectivePrice;
  currentResult = null;
  hasSpunOnce   = false;
  document.getElementById('modalResult').style.display = 'none';
  document.getElementById('spinBtn').style.display = 'none'; // hide normal button during multi
  buildCarousel(c);
  document.getElementById('caseModal').classList.add('show');

  runMultiSpinSequence(c, results, 0, () => {
    // All 5 spins done ‚Äî show final results screen
    document.getElementById('spinBtn').style.display = '';
    document.getElementById('spinBtn').disabled = false;
    document.getElementById('spinBtn').textContent = 'üé≤ –í–Ü–î–ö–†–ò–¢–ò';
    showMultiOpenResults(c, results);
    updateAllRarityBars(); renderCases(); renderInventory();
  });
}

function runMultiSpinSequence(c, results, index, onDone) {
  if (index >= results.length) { onDone(); return; }
  spinning = true;
  document.getElementById('modalResult').style.display = 'none';

  const item  = results[index];
  const track = document.getElementById('carouselTrack');

  // Build strip ‚Äî shorter & faster for x5 feel
  track.style.transition = 'none';
  track.style.transform  = 'translateX(0)';
  void track.offsetWidth;
  track.innerHTML = '';

  const strip = [];
  for (let i = 0; i < 30; i++) strip.push(pickItem(c));
  strip[26] = item;
  strip.forEach(s => {
    const div = document.createElement('div');
    div.className = 'carousel-item ' + s.rarity;
    div.innerHTML = itemDisplay(s.emoji, 44) + '<div class="c-name">' + s.name + '</div>';
    track.appendChild(div);
  });

  const itemW  = 108;
  const center = track.parentElement.offsetWidth / 2 - 50;
  const target = -(26 * itemW - center);

  // Counter badge
  let badge = document.getElementById('multiSpinBadge');
  if (!badge) {
    badge = document.createElement('div');
    badge.id = 'multiSpinBadge';
    badge.style.cssText = 'position:absolute;top:10px;right:14px;font-family:Orbitron,sans-serif;font-size:13px;font-weight:800;color:var(--gold);background:rgba(0,0,0,.5);padding:4px 10px;border-radius:8px;border:1px solid rgba(245,200,66,.3);z-index:10;';
    document.querySelector('#caseModal .modal').style.position = 'relative';
    document.querySelector('#caseModal .modal').appendChild(badge);
  }
  badge.textContent = (index + 1) + ' / ' + results.length;

  // Tick sounds (faster)
  let tc = 0;
  const ti = setInterval(() => { playTick(); if (++tc > 18) clearInterval(ti); }, 90);

  void track.offsetWidth;
  // Faster animation for subsequent spins (1.6s each)
  const dur = index === 0 ? 2000 : 1400;
  track.style.transition = 'transform ' + (dur/1000) + 's cubic-bezier(0.12, 0.8, 0.3, 1)';
  track.style.transform  = 'translateX(' + target + 'px)';

  // Flash the result item briefly
  setTimeout(() => {
    clearInterval(ti);
    spinning = false;

    // Quick flash of rarity
    const flashEl = document.createElement('div');
    flashEl.style.cssText =
      'position:absolute;inset:0;display:flex;align-items:center;justify-content:center;' +
      'background:rgba(0,0,0,.55);animation:fadeFlash .5s ease forwards;z-index:5;pointer-events:none;';
    flashEl.innerHTML =
      '<div style="text-align:center;animation:popIn .4s cubic-bezier(.34,1.56,.64,1)">' +
        '<div style="font-size:46px;">' + item.emoji + '</div>' +
        '<div class="r-' + item.rarity + '" style="font-size:13px;font-weight:800;margin-top:4px;">' + RARITY_LABELS[item.rarity] + '</div>' +
      '</div>';
    document.querySelector('#caseModal .modal').appendChild(flashEl);
    if (item.rarity === 'legendary') { playFanfare(); spawnConfetti(); }
    else if (item.rarity === 'epic' || item.rarity === 'rare') playSell();

    setTimeout(() => {
      flashEl.remove();
      runMultiSpinSequence(c, results, index + 1, onDone);
    }, 600);
  }, dur + 50);
}

function showMultiOpenResults(c, results) {
  // Auto-keep / sell
  let kept = 0, sold = 0, soldValue = 0;
  results.forEach(item => {
    if (state.inventory.length < state.invLimit) {
      state.inventory.unshift({
        id: Date.now() + Math.random(),
        name: item.name, emoji: item.emoji, rarity: item.rarity,
        value: item.value, fromCase: c.name
      });
      kept++;
    } else {
      const x5SellVal = getSellValue(item);
      state.balance     += x5SellVal;
      state.totalEarned += x5SellVal;
      state.stats.itemsSold++;
      soldValue += x5SellVal;
      sold++;
    }
  });
  updateHUD(); saveState();

  // Remove counter badge
  const badge = document.getElementById('multiSpinBadge');
  if (badge) badge.remove();

  // Use a full-screen overlay to show all 5 results without scroll
  const overlay = document.createElement('div');
  overlay.id = 'multiResultOverlay';
  overlay.style.cssText = [
    'position:fixed;inset:0;z-index:3500;',
    'background:rgba(0,0,0,0.94);',
    'display:flex;flex-direction:column;align-items:center;justify-content:center;',
    'padding:16px;gap:10px;'
  ].join('');

  // Title row
  const title = document.createElement('div');
  title.style.cssText = 'font-family:Orbitron,sans-serif;font-size:16px;font-weight:800;color:var(--gold);letter-spacing:2px;';
  title.textContent = '‚ö° √ó' + results.length + ' –í–Ü–î–ö–†–ò–¢–¢–Ø';
  overlay.appendChild(title);

  // Summary badge
  const sumRow = document.createElement('div');
  sumRow.style.cssText = 'background:rgba(245,200,66,.08);border:1px solid rgba(245,200,66,.2);border-radius:8px;padding:6px 14px;font-size:12px;text-align:center;';
  sumRow.innerHTML =
    '<span style="color:var(--muted);">üéí –ù–∞ —Å–∫–ª–∞–¥: </span><b style="color:var(--green)">' + kept + '</b>' +
    (sold ? '  <span style="color:var(--muted);">üí∏ –ê–≤—Ç–æ–ø—Ä–æ–¥–∞–∂: </span><b style="color:var(--gold)">+' + fmt(soldValue) + '</b>' : '');
  overlay.appendChild(sumRow);

  // Cards grid ‚Äî 5 cards in one row (or 3+2 for narrow)
  const grid = document.createElement('div');
  grid.style.cssText = 'display:flex;flex-wrap:wrap;gap:8px;justify-content:center;width:100%;max-width:400px;';

  [...results].sort((a,b) => b.value - a.value).forEach((item, i) => {
    const card = document.createElement('div');
    // Rarity glow border
    const rarityColors = {legendary:'#f5c842',epic:'#a855f7',rare:'#3b82f6',common:'#64748b'};
    const rc = rarityColors[item.rarity] || '#444';
    card.style.cssText = [
      'background:var(--bg2);border-radius:12px;',
      'border:2px solid ' + rc + '55;',
      'box-shadow:0 0 10px ' + rc + '22;',
      'padding:10px 8px;text-align:center;',
      'flex:1;min-width:calc(33% - 8px);max-width:calc(33% - 8px);',
      'animation:prizeSlideIn .4s cubic-bezier(.34,1.56,.64,1) both;',
      'animation-delay:' + (i * 0.08) + 's;'
    ].join('');
    card.innerHTML =
      '<div style="font-size:32px;margin-bottom:4px;">' + item.emoji + '</div>' +
      '<div class="r-' + item.rarity + '" style="font-size:11px;font-weight:700;line-height:1.3;margin-bottom:3px;">' + item.name + '</div>' +
      '<div style="font-size:11px;color:var(--gold);font-weight:700;">' + fmt(item.value) + '</div>' +
      '<div style="font-size:9px;color:var(--' + item.rarity + ');text-transform:uppercase;letter-spacing:.5px;margin-top:2px;">' + item.rarity + '</div>';
    grid.appendChild(card);
  });
  overlay.appendChild(grid);

  // Close button
  const closeBtn = document.createElement('button');
  closeBtn.style.cssText = 'margin-top:6px;padding:13px 40px;border-radius:12px;border:none;background:linear-gradient(135deg,var(--gold),#f97316);color:#000;font-family:Rajdhani,sans-serif;font-size:16px;font-weight:800;cursor:pointer;letter-spacing:1px;width:100%;max-width:300px;';
  closeBtn.textContent = '‚úï –ó–∞–∫—Ä–∏—Ç–∏';
  closeBtn.onclick = () => {
    overlay.remove();
    closeModal();
  };
  overlay.appendChild(closeBtn);

  document.body.appendChild(overlay);

  const hasLegendary = results.some(r => r.rarity === 'legendary');
  if (hasLegendary) spawnConfetti();
}



// =================== COLLECTION SHOP UPGRADES ===================
function getCollUpgradePrice(caseId, nextLvl) {
  const upg = COLLECTION_SHOP_UPGRADES[caseId];
  if (!upg) return 0;
  return Math.round(upg.basePrice * Math.pow(upg.scale, nextLvl - 1));
}

function buyCollUpgrade(caseId) {
  const upg = COLLECTION_SHOP_UPGRADES[caseId];
  if (!upg) return;
  const curLvl  = state.collUpgLevels[caseId] || 0;
  const maxLvl  = upg.steps;
  if (curLvl >= maxLvl) return;
  const nextLvl = curLvl + 1;
  const price   = getCollUpgradePrice(caseId, nextLvl);
  if (state.balance < price) { showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤!'); return; }
  state.balance -= price;
  state.collUpgLevels[caseId] = nextLvl;
  applyAllCollectionBonuses();
  playSell();
  showToast('‚úÖ ' + upg.title + ' ‚Äî —Ä—ñ–≤–µ–Ω—å ' + nextLvl + '!', 'gold');
  updateHUD(); saveState();
  renderCollShopUpgrades();
}

function renderCollShopUpgrades() {
  const container = document.getElementById('collShopUpgradesContainer');
  if (!container) return;
  container.innerHTML = '';

  const cases = CASES;
  let anyUnlocked = false;

  cases.forEach(c => {
    const bonus = state.collectionBonuses[c.id] || {};
    if (!bonus.multiOpen) return; // not mastered yet
    const upg = COLLECTION_SHOP_UPGRADES[c.id];
    if (!upg) return;
    anyUnlocked = true;

    const curLvl  = state.collUpgLevels[c.id] || 0;
    const maxLvl  = upg.steps;
    const isMax   = curLvl >= maxLvl;
    const nextLvl = curLvl + 1;
    const price   = isMax ? 0 : getCollUpgradePrice(c.id, nextLvl);
    const pct     = (curLvl / maxLvl) * 100;
    const canAfford = !isMax && state.balance >= price;

    // Steps dots
    const dotsHtml = Array.from({length: maxLvl}, (_, i) => {
      const cls = i < curLvl ? 'done' : i === curLvl ? 'current' : '';
      return '<span class="' + cls + '">' + (i+1) + '</span>';
    }).join('');

    const rarityColors = {legendary:'#f5c842',epic:'#a855f7',rare:'#3b82f6',common:'#64748b'};
    // Pick accent color by case id pattern
    const accentMap = {street:'#64748b',office:'#3b82f6',chef:'#3b82f6',gamer:'#f97316',
      fitness:'#a855f7',apple:'#a855f7',photo:'#a855f7',workshop:'#f5c842',smart:'#22c55e',elite:'#f5c842'};
    const accent = accentMap[c.id] || 'var(--gold)';

    const card = document.createElement('div');
    card.className = 'mult-upgrade-card';
    card.style.cssText = 'margin-bottom:12px;border-left:3px solid ' + accent + ';';
    card.innerHTML =
      '<div class="mult-upgrade-header">' +
        '<div class="mult-upgrade-icon" style="font-size:20px;">' + upg.icon + '</div>' +
        '<div style="flex:1;">' +
          '<div class="mult-upgrade-title">' + upg.title +
            ' <span style="font-size:10px;color:var(--muted);font-weight:400;">(' + c.name + ')</span></div>' +
          '<div class="mult-upgrade-subtitle">' + upg.subtitle + '</div>' +
        '</div>' +
      '</div>' +
      '<div class="mult-current-badge" style="border-color:' + accent + '44;">' +
        upg.icon + ' ' + (curLvl > 0 ? upg.effectLabel(curLvl) : '–†—ñ–≤–µ–Ω—å 0 ‚Äî –Ω–µ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ') +
        ' <span style="color:var(--muted);font-size:10px;">(' + curLvl + '/' + maxLvl + ')</span>' +
      '</div>' +
      '<div class="mult-progress-track"><div class="mult-progress-fill" style="width:' + pct + '%;background:' + accent + ';"></div></div>' +
      '<div class="mult-steps">' + dotsHtml + '</div>' +
      (!isMax ?
        '<div style="font-size:11px;color:var(--muted);margin-bottom:10px;">' +
          'üîì –ù–∞—Å—Ç—É–ø–Ω–∏–π —Ä—ñ–≤–µ–Ω—å ' + nextLvl + ': <b style="color:var(--text)">' + upg.effectLabel(nextLvl) + '</b>' +
        '</div>' : ''
      ) +
      '<button class="mult-upgrade-btn' + (isMax ? ' maxed' : '') + '"' +
        (!isMax && !canAfford ? ' disabled' : '') +
        (!isMax ? ' onclick="buyCollUpgrade(\'' + c.id + '\')"' : '') + '>' +
        (isMax ? 'üèÜ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —Ä—ñ–≤–µ–Ω—å!' : '–ü–æ–∫—Ä–∞—â–∏—Ç–∏ (' + nextLvl + '/' + maxLvl + ') –∑–∞ ' + fmt(price)) +
      '</button>';

    container.appendChild(card);
  });

  if (!anyUnlocked) {
    container.innerHTML =
      '<div class="empty-state" style="padding:20px 0;">' +
        '<div class="e-icon">üèÜ</div>' +
        '<div>–ó–∞–≤–µ—Ä—à—É–π –∫–æ–ª–µ–∫—Ü—ñ—ó, —â–æ–± —Ä–æ–∑–±–ª–æ–∫—É–≤–∞—Ç–∏ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è!</div>' +
      '</div>';
  }
}

// =================== DEV PANEL ===================
function toggleDevPanel() {
  const p = document.getElementById('devPanel');
  p.style.display = p.style.display === 'none' ? 'block' : 'none';
}

function devAddMoney(amount) {
  state.balance += (amount || 10000);
  updateHUD(); saveState();
  showToast('üí∞ +' + fmt(amount || 10000) + ' –¥–æ–¥–∞–Ω–æ!', 'gold');
}

function devFillCollection(idx) {
  const cases = idx === 'all' ? CASES : [CASES[idx]];
  cases.forEach(c => {
    if (!c) return;
    if (!state.collections[c.id]) state.collections[c.id] = {};
    c.items.forEach(item => {
      state.collections[c.id][item.name] = {
        name: item.name, emoji: item.emoji,
        rarity: item.rarity, value: item.value
      };
    });
    if (!state.collectionBonuses[c.id]) state.collectionBonuses[c.id] = {};
    state.collectionBonuses[c.id].multiOpen = true;
    state.collectionBonuses[c.id].discount  = true;
  });
  applyAllCollectionBonuses();
  saveState();
  renderCases();
  renderCollections();
  showToast('üèÖ –ö–æ–ª–µ–∫—Ü—ñ—é –∑—ñ–±—Ä–∞–Ω–æ!', 'gold');
  if (idx !== 'all') showCertificate(CASES[idx]);
}

function devTestCrisis() {
  if (!state.rivalNets) return;
  const top5 = FORBES_RIVALS.filter(r => !r.isPlayer).slice(0, 5);
  top5.forEach(r => {
    const currentNet = state.rivalNets[r.name];
    const events = RIVAL_CRISIS_EVENTS[r.name];
    const ev = events ? events[Math.floor(Math.random() * events.length)] : null;
    const loss = currentNet * (ev ? ev.loss : 0.015);
    state.rivalNets[r.name] = Math.round(currentNet - loss);
    if (!window.rivalLastChange) window.rivalLastChange = {};
    window.rivalLastChange[r.name] = { delta: -loss, crisis: true, text: ev ? ev.text : null };
    showCrisisToast(r, loss, ev ? ev.text : null);
  });
  saveState(); updateCapitalUI();
  const owned = document.getElementById('lspane-owned');
  if (owned && owned.style.display !== 'none') renderLifeShop();
}

function devClearCollections() {
  state.collections = {};
  state.collectionBonuses = {};
  saveState();
  renderCases();
  renderCollections();
  showToast('üóëÔ∏è –ö–æ–ª–µ–∫—Ü—ñ—ó —Å–∫–∏–Ω—É—Ç–æ');
}


// =================== FORBES LIVE GROWTH ===================
// rivalLastChange: tracks last delta for UI arrows
if (!window.rivalLastChange) window.rivalLastChange = {};
let crisisCheckCounter = 0; // increments each minute, crisis check every 2nd

function tickRivalGrowth() {
  if (!state.rivalNets) return;
  const playerCapital = calcCapital().total;
  crisisCheckCounter++;
  const doCrisisCheck = (crisisCheckCounter % 2 === 0); // every 2 minutes

  // –ü.13: Pick at most ONE crisis victim per 2-min tick
  const activeRivals = FORBES_RIVALS.filter(r => !r.isPlayer);
  let crisisHandledThisTick = false;

  // Pre-select a single random TOP-10 crisis candidate if check is due
  let crisisVictim = null;
  if (doCrisisCheck) {
    const top10 = activeRivals.slice(0, 10).filter(r => {
      const net = state.rivalNets[r.name];
      return playerCapital >= net * 0.001; // only active rivals
    });
    if (top10.length && Math.random() < 0.15) {
      crisisVictim = top10[Math.floor(Math.random() * top10.length)];
    }
  }

  activeRivals.forEach(r => {
    const currentNet = state.rivalNets[r.name];

    // ‚îÄ‚îÄ Sleep check ‚îÄ‚îÄ
    const threshold = currentNet * 0.001;
    if (playerCapital < threshold) {
      window.rivalLastChange[r.name] = null;
      return;
    }

    // ‚îÄ‚îÄ Crisis (only pre-selected victim) ‚îÄ‚îÄ
    if (doCrisisCheck && crisisVictim && r.name === crisisVictim.name && !crisisHandledThisTick) {
      const events = RIVAL_CRISIS_EVENTS[r.name];
      const ev     = events ? events[Math.floor(Math.random() * events.length)] : null;
      const loss   = currentNet * (ev ? ev.loss : (0.005 + Math.random() * 0.02));
      state.rivalNets[r.name] = Math.round(currentNet - loss);
      window.rivalLastChange[r.name] = { delta: -loss, crisis: true, text: ev?.text || '–†–∏–Ω–∫–æ–≤–∞ –∫—Ä–∏–∑–∞' };
      showCrisisToast(r, loss, ev?.text);
      crisisHandledThisTick = true;
      return;
    }

    // ‚îÄ‚îÄ Phase-based growth ‚îÄ‚îÄ
    const rate = getRivalGrowthRate(currentNet);
    const gain = Math.round(currentNet * rate);
    state.rivalNets[r.name] = currentNet + gain;
    window.rivalLastChange[r.name] = { delta: gain, crisis: false };
  });

  saveState();
  updateCapitalUI();
  // Refresh Forbes table if visible
  const owned = document.getElementById('lspane-owned');
  if (owned && owned.style.display !== 'none') renderLifeShop();
}

function showCrisisToast(r, loss, text) {
  // Floating crisis notification
  const el = document.createElement('div');
  el.style.cssText = [
    'position:fixed', 'bottom:90px', 'left:50%', 'transform:translateX(-50%)',
    'z-index:9999', 'background:#1a0808', 'border:1px solid rgba(239,68,68,.5)',
    'border-radius:12px', 'padding:10px 16px', 'max-width:310px', 'text-align:center',
    'box-shadow:0 4px 20px rgba(239,68,68,.3)', 'animation:fadeIn .3s ease',
  ].join(';');
  el.innerHTML =
    '<div style="font-size:11px;color:#ef4444;font-weight:700;letter-spacing:.5px;">üìâ –†–ò–ù–ö–û–í–ê –ö–†–ò–ó–ê</div>' +
    '<div style="font-size:12px;color:#fff;margin:4px 0;">' + r.emoji + ' ' + r.name + '</div>' +
    '<div style="font-size:11px;color:var(--muted);">' + (text || '–†–∏–Ω–∫–æ–≤—ñ –≤—Ç—Ä–∞—Ç–∏') + '</div>' +
    '<div style="font-size:13px;font-weight:800;color:#ef4444;margin-top:4px;">‚àí' + fmtCapital(loss) + '</div>';
  document.body.appendChild(el);
  setTimeout(() => { el.style.transition = 'opacity .5s'; el.style.opacity = '0'; }, 5000);
  setTimeout(() => el.remove(), 5600);
}

// Tick every 60 seconds
setInterval(tickRivalGrowth, 60_000);


// =================== CONTAINERS SYSTEM ===================

// Build an inline SVG of a shipping container
function buildContainerSVG(c, w, h) {
  const col   = c.color;
  const acc   = c.accent;
  const strip = c.stripeColor;
  // Darken for shadow side
  return `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${w} ${h}" width="${w}" height="${h}">
    <defs>
      <linearGradient id="cg_${c.id}" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" stop-color="${acc}" stop-opacity=".9"/>
        <stop offset="100%" stop-color="${col}"/>
      </linearGradient>
      <linearGradient id="cgtop_${c.id}" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" stop-color="${acc}" stop-opacity=".7"/>
        <stop offset="100%" stop-color="${col}" stop-opacity=".5"/>
      </linearGradient>
      <filter id="cshadow_${c.id}"><feDropShadow dx="3" dy="4" stdDeviation="5" flood-color="#000" flood-opacity=".5"/></filter>
    </defs>

    <!-- Main body -->
    <rect x="10" y="30" width="${w-40}" height="${h-50}" rx="4"
      fill="url(#cg_${c.id})" filter="url(#cshadow_${c.id})"/>

    <!-- Corrugation lines (vertical ridges) -->
    ${[1,2,3,4,5,6,7].map(i => `<rect x="${10 + i*(w-40)/8}" y="30" width="5" height="${h-50}" fill="rgba(0,0,0,.15)" rx="1"/>`).join('')}

    <!-- Top face (isometric look) -->
    <polygon points="10,30 ${w-30},30 ${w-20},18 20,18"
      fill="url(#cgtop_${c.id})" opacity=".85"/>
    <!-- Right side face -->
    <polygon points="${w-30},30 ${w-30},${h-20} ${w-20},${h-30} ${w-20},18"
      fill="${col}" opacity=".6"/>

    <!-- Stripe/accent band -->
    <rect x="10" y="${h-45}" width="${w-40}" height="12" fill="${strip}" opacity=".7" rx="0"/>
    <!-- Bottom clearance -->
    <rect x="20" y="${h-22}" width="${w-60}" height="8" rx="3" fill="rgba(0,0,0,.4)"/>
    <!-- Doors (two halves) -->
    <line x1="${10+(w-40)/2}" y1="30" x2="${10+(w-40)/2}" y2="${h-20}" stroke="rgba(0,0,0,.4)" stroke-width="2"/>
    <!-- Door handle bars -->
    <rect x="${10+(w-40)/2 - 18}" y="${(h)/2 - 4}" width="14" height="8" rx="3" fill="rgba(255,255,255,.25)"/>
    <rect x="${10+(w-40)/2 + 4}"  y="${(h)/2 - 4}" width="14" height="8" rx="3" fill="rgba(255,255,255,.25)"/>
    <!-- Door hinges -->
    <circle cx="14" cy="${(h)/2 - 10}" r="4" fill="rgba(0,0,0,.5)"/>
    <circle cx="14" cy="${(h)/2 + 10}" r="4" fill="rgba(0,0,0,.5)"/>
    <circle cx="${w-34}" cy="${(h)/2 - 10}" r="4" fill="rgba(0,0,0,.5)"/>
    <circle cx="${w-34}" cy="${(h)/2 + 10}" r="4" fill="rgba(0,0,0,.5)"/>
    <!-- Shine -->
    <rect x="14" y="34" width="${(w-40)*0.4}" height="${(h-50)*0.3}" rx="2" fill="rgba(255,255,255,.07)"/>
    <!-- Container name label -->
    <rect x="${(w/2)-45}" y="46" width="90" height="16" rx="3" fill="rgba(0,0,0,.4)"/>
    <text x="${w/2}" y="58" text-anchor="middle" font-family="Rajdhani,Arial,sans-serif"
      font-size="9" font-weight="800" fill="rgba(255,255,255,.9)" letter-spacing="1">${c.name.toUpperCase()}</text>
  </svg>`;
}

// ‚îÄ‚îÄ Vehicle 3D SVG models ‚îÄ‚îÄ
function buildVehicleSVG(vehicleType, rarity) {
  const glowColor = rarity === 'legendary' ? '#f5c842' : rarity === 'epic' ? '#a855f7' : rarity === 'rare' ? '#3b82f6' : '#6ee7b7';

  // ‚îÄ‚îÄ MOTO / BIKE ‚îÄ‚îÄ
  if (vehicleType === 'moto') {
    return `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 180 110" width="180" height="110">
      <defs>
        <radialGradient id="mg" cx="50%" cy="80%" r="60%"><stop offset="0%" stop-color="${glowColor}" stop-opacity=".35"/><stop offset="100%" stop-color="${glowColor}" stop-opacity="0"/></radialGradient>
        <filter id="mb"><feGaussianBlur stdDeviation="3" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
      </defs>
      <ellipse cx="90" cy="105" rx="80" ry="6" fill="rgba(0,0,0,.45)"/>
      <ellipse cx="90" cy="95" rx="85" ry="14" fill="url(#mg)"/>
      <!-- Rear wheel -->
      <circle cx="130" cy="80" r="22" fill="none" stroke="#222" stroke-width="7"/>
      <circle cx="130" cy="80" r="14" fill="none" stroke="#444" stroke-width="3"/>
      <circle cx="130" cy="80" r="5" fill="#777"/>
      ${[0,1,2,3,4].map(i=>{const a=i*72*Math.PI/180;return `<line x1="${Math.round(130+5*Math.cos(a))}" y1="${Math.round(80+5*Math.sin(a))}" x2="${Math.round(130+14*Math.cos(a))}" y2="${Math.round(80+14*Math.sin(a))}" stroke="#666" stroke-width="2.5"/>`;}).join('')}
      <!-- Front wheel -->
      <circle cx="45" cy="80" r="22" fill="none" stroke="#222" stroke-width="7"/>
      <circle cx="45" cy="80" r="14" fill="none" stroke="#444" stroke-width="3"/>
      <circle cx="45" cy="80" r="5" fill="#777"/>
      ${[0,1,2,3,4].map(i=>{const a=i*72*Math.PI/180;return `<line x1="${Math.round(45+5*Math.cos(a))}" y1="${Math.round(80+5*Math.sin(a))}" x2="${Math.round(45+14*Math.cos(a))}" y2="${Math.round(80+14*Math.sin(a))}" stroke="#666" stroke-width="2.5"/>`;}).join('')}
      <!-- Swing arm -->
      <path d="M90 78 L130 78" stroke="#555" stroke-width="5" stroke-linecap="round"/>
      <!-- Frame -->
      <path d="M55 78 L70 50 L95 44 L120 55 L130 78" fill="none" stroke="#c0392b" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
      <!-- Seat -->
      <path d="M80 44 Q100 38 118 44" fill="none" stroke="#111" stroke-width="7" stroke-linecap="round"/>
      <path d="M80 44 Q100 36 118 44" fill="none" stroke="#333" stroke-width="5" stroke-linecap="round"/>
      <!-- Tank -->
      <ellipse cx="90" cy="54" rx="20" ry="10" fill="#aa2200"/>
      <ellipse cx="88" cy="51" rx="14" ry="6" fill="#ee3311" opacity=".5"/>
      <!-- Fork / handlebar -->
      <path d="M55 78 L52 52 L46 48" stroke="#888" stroke-width="4" stroke-linecap="round" fill="none"/>
      <line x1="38" y1="46" x2="58" y2="46" stroke="#aaa" stroke-width="5" stroke-linecap="round"/>
      <!-- Exhaust -->
      <path d="M130 72 L148 69 L150 76 L130 80" fill="#888"/>
      <!-- Headlight (animated) -->
      <ellipse id="hl_left" cx="44" cy="62" rx="9" ry="6" fill="url(#mg)" opacity="0" filter="url(#mb)"/>
      <ellipse cx="44" cy="62" rx="6" ry="4" fill="#fffde0" opacity=".95"/>
      <ellipse cx="43" cy="61" rx="3" ry="2" fill="white"/>
    </svg>`;
  }

  // ‚îÄ‚îÄ MICRO (scooter / skateboard / gyroscooter) ‚îÄ‚îÄ
  if (vehicleType === 'micro') {
    return `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 180 110" width="180" height="110">
      <defs>
        <radialGradient id="scg" cx="50%" cy="80%" r="60%"><stop offset="0%" stop-color="${glowColor}" stop-opacity=".3"/><stop offset="100%" stop-color="${glowColor}" stop-opacity="0"/></radialGradient>
        <filter id="scb"><feGaussianBlur stdDeviation="3" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
      </defs>
      <ellipse cx="90" cy="106" rx="70" ry="5" fill="rgba(0,0,0,.4)"/>
      <ellipse cx="90" cy="96" rx="75" ry="13" fill="url(#scg)"/>
      <!-- Scooter deck -->
      <rect x="25" y="76" width="130" height="10" rx="5" fill="#1a1a2e"/>
      <rect x="27" y="74" width="126" height="6" rx="3" fill="#2d2d5e"/>
      <!-- Wheels -->
      <circle cx="48"  cy="87" r="11" fill="none" stroke="#333" stroke-width="5"/>
      <circle cx="48"  cy="87" r="6"  fill="none" stroke="#555" stroke-width="2"/>
      <circle cx="48"  cy="87" r="3"  fill="#777"/>
      <circle cx="132" cy="87" r="11" fill="none" stroke="#333" stroke-width="5"/>
      <circle cx="132" cy="87" r="6"  fill="none" stroke="#555" stroke-width="2"/>
      <circle cx="132" cy="87" r="3"  fill="#777"/>
      <!-- Stem -->
      <rect x="87" y="30" width="8" height="47" rx="4" fill="#888"/>
      <!-- Folding joint -->
      <circle cx="91" cy="74" r="7" fill="#555"/>
      <circle cx="91" cy="74" r="4" fill="#333"/>
      <!-- Handlebar -->
      <rect x="60" y="28" width="62" height="7" rx="4" fill="#aaa"/>
      <!-- Grip caps -->
      <rect x="58"  y="26" width="10" height="11" rx="3" fill="#333"/>
      <rect x="114" y="26" width="10" height="11" rx="3" fill="#333"/>
      <!-- Brake lever -->
      <line x1="62" y1="34" x2="68" y2="40" stroke="#666" stroke-width="2.5" stroke-linecap="round"/>
      <!-- LED strip on deck -->
      <rect x="30" y="83" width="120" height="3" rx="1" fill="${glowColor}" opacity=".7" filter="url(#scb)"/>
      <!-- Headlight (animated) -->
      <ellipse id="hl_left" cx="28" cy="82" rx="8" ry="5" fill="${glowColor}" opacity="0" filter="url(#scb)"/>
      <circle cx="28" cy="82" r="4" fill="#fffde0" opacity=".9"/>
    </svg>`;
  }

  // ‚îÄ‚îÄ CAR ‚Äî 45¬∞ supercar with front-quarter view ‚îÄ‚îÄ
  return `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 220 130" width="220" height="130">
    <defs>
      <radialGradient id="cgv" cx="35%" cy="85%" r="65%">
        <stop offset="0%" stop-color="${glowColor}" stop-opacity=".3"/>
        <stop offset="100%" stop-color="${glowColor}" stop-opacity="0"/>
      </radialGradient>
      <radialGradient id="hlg" cx="50%" cy="50%" r="50%">
        <stop offset="0%"   stop-color="#fff8aa" stop-opacity="1"/>
        <stop offset="50%"  stop-color="#ffd700" stop-opacity=".7"/>
        <stop offset="100%" stop-color="#ffd700" stop-opacity="0"/>
      </radialGradient>
      <filter id="hgf"><feGaussianBlur stdDeviation="6" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
      <filter id="bdf"><feGaussianBlur stdDeviation="2" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
    </defs>

    <!-- Ground shadow -->
    <ellipse cx="105" cy="124" rx="95" ry="7" fill="rgba(0,0,0,.55)"/>
    <!-- Ambient glow -->
    <ellipse cx="85"  cy="110" rx="100" ry="20" fill="url(#cgv)"/>

    <!-- ‚îÄ‚îÄ BODY ‚Äì low wide supercar silhouette ‚îÄ‚îÄ -->
    <!-- Main lower body (quarter-angle) -->
    <path d="M18 80 Q22 68 55 62 L155 58 Q185 58 200 68 L202 80 Q202 92 195 95 L30 98 Q18 96 18 80Z"
      fill="#1a1a2e" stroke="rgba(255,255,255,.06)" stroke-width="1"/>

    <!-- Side skirt / underline -->
    <path d="M30 95 L195 92 L202 98 L25 100Z" fill="#111"/>

    <!-- Roof / cabin (sloping back, aggressive rake) -->
    <path d="M62 62 Q68 34 88 24 L148 22 Q170 26 178 40 L182 62Z"
      fill="#14142a"/>
    <!-- Roof highlight -->
    <path d="M75 55 Q82 36 98 28 Q118 22 138 26 Q155 32 164 46"
      fill="none" stroke="rgba(255,255,255,.1)" stroke-width="2.5"/>

    <!-- Windshield (raked at ~30¬∞) -->
    <path d="M70 60 Q76 38 92 26 L148 24 Q166 28 174 44 L176 62Z"
      fill="#334477" opacity=".8"/>
    <!-- Windshield glare -->
    <path d="M76 56 Q80 40 92 30 L108 28 L105 56Z"
      fill="rgba(255,255,255,.18)"/>

    <!-- Front fascia / bumper -->
    <path d="M18 76 Q22 60 48 56 L58 62 L55 80 Q36 82 18 80Z"
      fill="#22224a"/>

    <!-- Hood (long flat) -->
    <path d="M55 62 L58 58 L155 58 Q178 60 198 68 L200 74 L55 76Z"
      fill="#1e1e3a"/>
    <!-- Hood vent slits -->
    <line x1="100" y1="62" x2="155" y2="60" stroke="rgba(255,255,255,.06)" stroke-width="2"/>
    <line x1="100" y1="66" x2="162" y2="64" stroke="rgba(255,255,255,.06)" stroke-width="2"/>
    <line x1="100" y1="70" x2="168" y2="69" stroke="rgba(255,255,255,.06)" stroke-width="2"/>

    <!-- Air intake (front lower) -->
    <path d="M22 82 Q24 74 44 72 L54 74 L52 88 L22 88Z" fill="#111" rx="3"/>
    <!-- Splitter -->
    <rect x="16" y="93" width="40" height="5" rx="2" fill="#333"/>

    <!-- Door line / character line -->
    <path d="M58 68 Q100 65 180 68" fill="none" stroke="rgba(255,255,255,.08)" stroke-width="1.5"/>

    <!-- Mirror (left, aggressive) -->
    <path d="M60 66 L52 58 L48 62 L56 70Z" fill="#333"/>

    <!-- Front wheel arch -->
    <ellipse cx="45" cy="97" rx="27" ry="10" fill="#0d0d1a"/>
    <!-- Front wheel -->
    <ellipse cx="45" cy="97" rx="22" ry="22" fill="#111" stroke="#2a2a2a" stroke-width="2"/>
    <ellipse cx="45" cy="97" rx="14" ry="14" fill="none" stroke="#444" stroke-width="3"/>
    ${[0,1,2,3,4].map(i=>{const a=i*72*Math.PI/180+0.3;return `<line x1="${Math.round(45+5*Math.cos(a))}" y1="${Math.round(97+5*Math.sin(a))}" x2="${Math.round(45+15*Math.cos(a))}" y2="${Math.round(97+15*Math.sin(a))}" stroke="#666" stroke-width="2.5"/>`;}).join('')}
    <circle cx="45" cy="97" r="5" fill="#888"/>

    <!-- Rear wheel arch (partial, angled view) -->
    <ellipse cx="170" cy="97" rx="24" ry="10" fill="#0d0d1a"/>
    <ellipse cx="170" cy="97" rx="20" ry="20" fill="#111" stroke="#2a2a2a" stroke-width="2"/>
    <ellipse cx="170" cy="97" rx="12" ry="12" fill="none" stroke="#444" stroke-width="3"/>
    ${[0,1,2,3,4].map(i=>{const a=i*72*Math.PI/180;return `<line x1="${Math.round(170+4*Math.cos(a))}" y1="${Math.round(97+4*Math.sin(a))}" x2="${Math.round(170+13*Math.cos(a))}" y2="${Math.round(97+13*Math.sin(a))}" stroke="#666" stroke-width="2.5"/>`;}).join('')}
    <circle cx="170" cy="97" r="5" fill="#888"/>

    <!-- Rear diffuser -->
    <rect x="182" y="88" width="20" height="8" rx="2" fill="#111"/>
    ${[0,1,2].map(i=>`<line x1="${184+i*6}" y1="88" x2="${184+i*6}" y2="96" stroke="#333" stroke-width="1.5"/>`).join('')}

    <!-- Exhaust tips -->
    <ellipse cx="188" cy="97" rx="5" ry="4" fill="#222"/>
    <ellipse cx="196" cy="97" rx="4" ry="3" fill="#222"/>
    <ellipse cx="188" cy="97" rx="3" ry="2.5" fill="#333"/>
    <ellipse cx="196" cy="97" rx="2.5" ry="2" fill="#333"/>

    <!-- ‚îÄ‚îÄ HEADLIGHTS (front quarter view) ‚Äî animated ‚îÄ‚îÄ -->
    <!-- Glow halo (animated) -->
    <ellipse id="hl_left"  cx="26" cy="76" rx="18" ry="12" fill="url(#hlg)" opacity="0" filter="url(#hgf)"/>
    <ellipse id="hl_right" cx="36" cy="72" rx="14" ry="9"  fill="url(#hlg)" opacity="0" filter="url(#hgf)"/>
    <!-- Housing -->
    <path d="M20 72 Q22 65 40 63 L46 65 L44 76 Q30 78 20 76Z" fill="#fffde0" opacity=".9"/>
    <!-- DRL strip -->
    <path d="M22 70 Q28 65 42 64" fill="none" stroke="${glowColor}" stroke-width="2.5" stroke-linecap="round" opacity=".9"/>
    <!-- Lens detail -->
    <path d="M24 73 Q30 68 40 66 L42 68 L38 75 Q28 76 24 75Z" fill="rgba(255,255,255,.2)"/>
  </svg>`;
}


// ‚îÄ‚îÄ Container preview modal ‚îÄ‚îÄ
function openContainerPreviewModal(containerId) {
  const c = CONTAINERS.find(x => x.id === containerId);
  if (!c) return;

  document.getElementById('previewTitle').textContent = 'üö¢ ' + c.name + ' ‚Äî ' + c.subtitle;
  const list = document.getElementById('previewList');
  list.innerHTML = '';

  const p = getPityForCase(containerId);
  const hasPity = p.rare > 0 || p.epic > 0 || p.legendary > 0;
  if (hasPity) {
    const pityHeader = document.createElement('div');
    pityHeader.style.cssText = 'background:rgba(245,200,66,.08);border:1px solid rgba(245,200,66,.2);border-radius:10px;padding:10px 14px;margin-bottom:4px;font-size:12px;';
    pityHeader.innerHTML =
      '<div style="color:var(--gold);font-weight:700;margin-bottom:6px;">üçÄ Pity System ‚Äî –Ω–∞–∫–æ–ø–∏—á–µ–Ω—ñ –±–æ–Ω—É—Å–∏:</div>' +
      (p.rare      > 0 ? '<div style="color:var(--rare)">üîµ –†—ñ–¥–∫—ñ—Å–Ω–∏–π: +'      + p.rare.toFixed(1)      + '%</div>' : '') +
      (p.epic      > 0 ? '<div style="color:var(--epic)">üü£ –ï–ø—ñ—á–Ω–∏–π: +'        + p.epic.toFixed(1)      + '%</div>' : '') +
      (p.legendary > 0 ? '<div style="color:var(--legendary)">üü° –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∏–π: +' + p.legendary.toFixed(1) + '%</div>' : '');
    list.appendChild(pityHeader);
  }

  const chances     = getDisplayChances(containerId);
  const baseChances = { common:60, rare:25, epic:12, legendary:3 };
  const rarityOrder = ['legendary','epic','rare','common'];
  const byRarity    = {};
  [...c.items].sort((a,b) => b.value - a.value).forEach(item => {
    if (!byRarity[item.rarity]) byRarity[item.rarity] = [];
    byRarity[item.rarity].push(item);
  });

  rarityOrder.forEach(rarity => {
    if (!byRarity[rarity]) return;
    const currentChance  = chances[rarity];
    const baseChance     = baseChances[rarity];
    const bonus = +(currentChance - baseChance).toFixed(1);
    const bonusStr = bonus > 0 ? ' <span style="color:var(--green);font-size:10px">+' + bonus + '%</span>' : '';
    const itemCount     = byRarity[rarity].length;
    const perItemChance = +(currentChance / itemCount).toFixed(2);

    const divider = document.createElement('div');
    divider.style.cssText = 'font-size:11px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--' + rarity + ');padding:6px 2px 2px;display:flex;align-items:center;gap:6px;';
    divider.innerHTML = RARITY_LABELS[rarity] + ' ‚Äî ' + currentChance + '%' + bonusStr +
      '<span style="color:var(--muted);font-size:10px;font-weight:400;margin-left:auto;">~' + perItemChance + '% –∫–æ–∂–µ–Ω</span>';
    list.appendChild(divider);

    byRarity[rarity].forEach(item => {
      const div = document.createElement('div');
      div.className = 'preview-item ' + rarity;
      div.innerHTML =
        '<span class="pi-emoji">' + item.emoji + '</span>' +
        '<span class="pi-name r-' + rarity + '">' + item.name + '</span>' +
        '<div style="text-align:right">' +
          '<div class="pi-val r-' + rarity + '">' + fmtCapital(item.value) + '</div>' +
          '<div style="font-size:10px;color:var(--muted);">~' + perItemChance + '%</div>' +
        '</div>';
      list.appendChild(div);
    });
  });

  document.getElementById('previewModal').classList.add('show');
}

// ‚îÄ‚îÄ Render container cards ‚îÄ‚îÄ
function renderContainers() {
  const grid = document.getElementById('containersGrid');
  if (!grid) return;
  grid.innerHTML = '';
  CONTAINERS.forEach(c => {
    const canAfford = state.balance >= c.price;
    const ch        = getDisplayChances(c.id);
    const base      = { common:60, rare:25, epic:12, legendary:3 };
    const p         = getPityForCase(c.id);

    const card = document.createElement('div');
    card.className = 'cnt-card';

    // Rarity bar segments with pity labels
    function cntSeg(pct, color, label, bonus) {
      const bonusStr = bonus > 0 ? ' <span class="pity-plus">+' + bonus.toFixed(1) + '</span>' : '';
      const showLbl  = pct >= 7;
      return '<div class="rarity-seg" style="width:' + pct + '%;background:' + color + '">' +
        (showLbl ? '<span class="rarity-seg-label">' + label + '%' + bonusStr + '</span>' : '') +
      '</div>';
    }

    const rarityBarHTML =
      cntSeg(ch.common,    'var(--common)',    ch.common,    0) +
      cntSeg(ch.rare,      'var(--rare)',      ch.rare,      +(ch.rare - base.rare).toFixed(1)) +
      cntSeg(ch.epic,      'var(--epic)',      ch.epic,      +(ch.epic - base.epic).toFixed(1)) +
      cntSeg(ch.legendary, 'var(--legendary)', ch.legendary, +(ch.legendary - base.legendary).toFixed(1));

    const pityBadge = (p.rare > 0 || p.epic > 0 || p.legendary > 0)
      ? '<span style="font-size:10px;color:var(--gold);margin-left:6px;">üçÄ Pity –∞–∫—Ç–∏–≤–Ω–∏–π</span>' : '';

    card.innerHTML =
      '<div class="cnt-header" style="background:' + c.color + '18;">' +
        buildContainerSVG(c, 340, 160) +
      '</div>' +
      '<div class="cnt-body">' +
        '<div class="cnt-title" style="color:' + c.accent + ';">' + c.name + '</div>' +
        '<div class="cnt-subtitle">' + c.subtitle + ' ¬∑ ' + c.items.length + ' –ø—Ä–µ–¥–º–µ—Ç—ñ–≤' + pityBadge + '</div>' +
        '<div class="case-rarity-bar" id="cnt-rarity-' + c.id + '" style="margin:8px 0 10px;">' +
          '<div class="case-rarity-bar-track">' + rarityBarHTML + '</div>' +
        '</div>' +
        '<div class="cnt-price-row">' +
          '<div>' +
            '<div style="font-size:11px;color:var(--muted);">–¶—ñ–Ω–∞ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è</div>' +
            '<div style="font-size:18px;font-weight:800;color:' + (canAfford ? 'var(--gold)' : '#ef4444') + ';">' + fmtCapital(c.price) + '</div>' +
          '</div>' +
          '<div style="display:flex;gap:8px;align-items:center;">' +
            '<button style="padding:10px 14px;border-radius:10px;border:1px solid var(--border);background:var(--bg);color:var(--muted);cursor:pointer;font-size:16px;flex-shrink:0;" onclick="openContainerPreviewModal(\'' + c.id + '\')">üëÅÔ∏è</button>' +
            '<button class="cnt-open-btn" ' + (canAfford ? '' : 'disabled') +
              ' onclick="openContainer(\'' + c.id + '\')"' +
              ' style="background:linear-gradient(135deg,' + c.accent + ',' + c.color + ');">' +
              'üö¢ –í–Ü–î–ö–†–ò–¢–ò' +
            '</button>' +
          '</div>' +
        '</div>' +
      '</div>';
    grid.appendChild(card);
  });
}

// ‚îÄ‚îÄ Roll a container item (uses pity system identical to cases) ‚îÄ‚îÄ
function rollContainerItem(c) {
  // Containers: –±–∞–∑–æ–≤—ñ –≤–∞–≥–∏ 60/25/12/3 + pity, –ë–ï–ó collection rarity bonuses
  const w = getCurrentWeights(c.id); // pity only (CASE_IDS excludes containers)
  const item = pickItem(c, w);       // reuse pickItem from cases

  // Update pity: if we got a rarity, reset its counter; else increment others
  const p = getPityForCase(c.id);
  if (item.rarity === 'legendary') {
    p.legendary = 0; p.epic = 0; p.rare = 0;
  } else if (item.rarity === 'epic') {
    p.epic = 0; p.legendary += 0.3;
  } else if (item.rarity === 'rare') {
    p.rare = 0; p.epic += 0.5; p.legendary += 0.15;
  } else {
    p.rare += 0.8; p.epic += 0.4; p.legendary += 0.1;
  }

  return item;
}

// ‚îÄ‚îÄ Open container animation ‚îÄ‚îÄ
let currentContainerResult = null;

function openContainer(containerId) {
  const c = CONTAINERS.find(x => x.id === containerId);
  if (!c) return;
  if (state.balance < c.price) { showToast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤!'); return; }

  state.balance -= c.price;
  state.stats.casesOpened++;
  updateHUD(); saveState();

  const item = rollContainerItem(c);
  currentContainerResult = { item, container: c };

  // Build and show modal
  const modal = document.getElementById('containerModal');
  modal.innerHTML = buildContainerOpenHTML(c, item);
  modal.style.cssText = 'display:flex;position:fixed;inset:0;z-index:3000;background:rgba(0,0,0,.96);flex-direction:column;align-items:center;justify-content:center;overflow-y:auto;padding:20px;';

  // Animate: after 600ms open doors
  setTimeout(() => {
    const left  = document.getElementById('cont-door-L');
    const right = document.getElementById('cont-door-R');
    const prize = document.getElementById('cont-prize-area');
    const card  = document.getElementById('cont-result-card');
    const btns  = document.getElementById('cont-result-btns');
    if (left)  left.classList.add('open');
    if (right) right.classList.add('open');
    // Show prize inside after doors open
    setTimeout(() => { if (prize) prize.classList.add('show'); }, 900);
    // Show result card
    setTimeout(() => { if (card) card.classList.add('show'); }, 1400);
    // Show buttons
    setTimeout(() => { if (btns) btns.classList.add('show'); }, 2100);
    // Animate headlights for all vehicle types
    setTimeout(() => animateHeadlights(), 1800);
  }, 600);
}

function animateHeadlights() {
  const hlL = document.getElementById('hl_left');
  const hlR = document.getElementById('hl_right'); // may be null for moto/micro
  if (!hlL) return;
  let on = false;
  let count = 0;
  const iv = setInterval(() => {
    on = !on;
    hlL.style.opacity = on ? '1' : '0';
    if (hlR) hlR.style.opacity = on ? '1' : '0';
    count++;
    if (count > 7) {
      hlL.style.opacity = '1';
      if (hlR) hlR.style.opacity = '1';
      clearInterval(iv);
    }
  }, 180);
}

function buildContainerOpenHTML(c, item) {
  const rarityColors = { common:'#888', rare:'#3b82f6', epic:'#a855f7', legendary:'#f5c842' };
  const rarityNames  = { common:'–ó–≤–∏—á–∞–π–Ω–∏–π', rare:'–†—ñ–¥–∫—ñ—Å–Ω–∏–π', epic:'–ï–ø—ñ—á–Ω–∏–π', legendary:'–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∏–π' };
  const rc = rarityColors[item.rarity] || '#888';

  const vehicleSVG = buildVehicleSVG(item.vehicleType || 'car', item.rarity);

  return `
  <div class="cont-modal-inner">
    <div style="font-family:Orbitron,sans-serif;font-size:13px;font-weight:700;color:${c.accent};
      letter-spacing:2px;text-align:center;margin-bottom:6px;text-transform:uppercase;">
      ${c.name} ¬∑ ${c.subtitle}
    </div>

    <!-- Container door scene -->
    <div class="cont-scene">
      <!-- Background (inside of container) -->
      <div style="position:absolute;inset:0;border-radius:8px;
        background:radial-gradient(ellipse at center, #1a1a2e 0%, #0a0a12 100%);
        border:2px solid ${c.color}44;">
      </div>

      <!-- Prize inside (shown after doors open) -->
      <div class="cont-prize-area" id="cont-prize-area">
        <div style="transform:scale(.85);">${vehicleSVG}</div>
      </div>

      <!-- Left door -->
      <div class="cont-door-left" id="cont-door-L"
        style="background:linear-gradient(180deg,${c.accent}cc,${c.color}ee);
          border-right:2px solid rgba(0,0,0,.4);border-radius:8px 0 0 8px;">
        <div class="cont-door-stripe" style="background:${c.stripeColor};"></div>
        <div class="cont-door-lock">üîí</div>
        <div class="cont-door-stripe" style="background:${c.stripeColor};"></div>
        <div class="cont-door-hinge" style="background:rgba(0,0,0,.4);"></div>
        ${[0,1,2,3,4,5].map(()=>`<div style="width:90%;height:3px;background:rgba(0,0,0,.15);border-radius:2px;"></div>`).join('')}
      </div>

      <!-- Right door -->
      <div class="cont-door-right" id="cont-door-R"
        style="background:linear-gradient(180deg,${c.color}ee,${c.accent}cc);
          border-left:2px solid rgba(0,0,0,.4);border-radius:0 8px 8px 0;">
        <div class="cont-door-stripe" style="background:${c.stripeColor};"></div>
        <div class="cont-door-lock">üîí</div>
        <div class="cont-door-stripe" style="background:${c.stripeColor};"></div>
        <div class="cont-door-hinge" style="background:rgba(0,0,0,.4);"></div>
        ${[0,1,2,3,4,5].map(()=>`<div style="width:90%;height:3px;background:rgba(0,0,0,.15);border-radius:2px;"></div>`).join('')}
      </div>
    </div>

    <!-- Result card (appears after animation) -->
    <div class="cont-result-card" id="cont-result-card"
      style="border-color:${rc}44;box-shadow:0 0 20px ${rc}22;">
      <div class="cont-result-rarity" style="color:${rc};">${rarityNames[item.rarity]}</div>
      <div class="cont-result-name">${item.emoji} ${item.name}</div>
      <div class="cont-result-value">${fmtCapital(item.value)}</div>
      <div style="font-size:11px;color:var(--muted);margin-top:4px;">–†–∏–Ω–∫–æ–≤–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å</div>
    </div>

    <!-- Action buttons -->
    <div class="cont-result-btns" id="cont-result-btns">
      <button onclick="keepContainerResult()" class="open-case-btn can" style="flex:1;padding:11px;">
        üéí –ó–∞–±—Ä–∞—Ç–∏ –Ω–∞ —Å–∫–ª–∞–¥
      </button>
      <button onclick="sellContainerResult()" class="open-case-btn can"
        style="flex:1;padding:11px;background:rgba(239,68,68,.12);border-color:rgba(239,68,68,.4);color:#ef4444;">
        üí∏ –ü—Ä–æ–¥–∞—Ç–∏ –∑–∞ ${fmtCapital(item.value)}
      </button>
    </div>

    <button onclick="closeContainerModal()"
      style="margin-top:14px;padding:8px 24px;border-radius:10px;border:1px solid rgba(255,255,255,.15);
        background:rgba(255,255,255,.05);color:var(--muted);font-size:13px;cursor:pointer;">
      ‚úï –ó–∞–∫—Ä–∏—Ç–∏
    </button>
  </div>`;
}

function keepContainerResult() {
  if (!currentContainerResult) return;
  const item = currentContainerResult.item;
  if (state.inventory.length >= state.invLimit) {
    // Auto-sell if full
    const sv = getSellValue(item);
    state.balance += sv;
    state.totalEarned += sv;
    state.stats.itemsSold++;
    showToast('‚ùå –°–∫–ª–∞–¥ –ø–æ–≤–Ω–∏–π! ' + item.name + ' –ø—Ä–æ–¥–∞–Ω–æ –∑–∞ ' + fmtCapital(sv));
  } else {
    state.inventory.unshift({
      id: Date.now(),
      name: item.name,
      emoji: item.emoji,
      rarity: item.rarity,
      value: item.value,
      fromContainer: currentContainerResult.container.name,
      isVehicle: true
    });
    showToast('üöó ' + item.name + ' –Ω–∞ —Å–∫–ª–∞–¥—ñ!');
  }
  currentContainerResult = null;
  updateHUD(); saveState();
  closeContainerModal();
}

function sellContainerResult() {
  if (!currentContainerResult) return;
  const item = currentContainerResult.item;
  const sv = getSellValue(item);
  state.balance += sv;
  state.totalEarned += sv;
  state.stats.itemsSold++;
  showToast('üí∏ ' + item.name + ' –ø—Ä–æ–¥–∞–Ω–æ –∑–∞ ' + fmtCapital(sv), 'gold');
  currentContainerResult = null;
  updateHUD(); saveState();
  closeContainerModal();
}

function closeContainerModal() {
  // –ü.12: if there's still an unclaimed result, auto-keep it
  if (currentContainerResult) {
    keepContainerResult(); // this calls closeContainerModal again after keeping, but currentContainerResult is null then
    return;
  }
  const modal = document.getElementById('containerModal');
  if (modal) { modal.style.display = 'none'; modal.innerHTML = ''; }
  renderContainers();
}

// =================== RESET ===================
function confirmReset() {
  document.getElementById('confirmModal').classList.add('show');
}
function closeConfirm() {
  document.getElementById('confirmModal').classList.remove('show');
}
function doReset() {
  // Clear all active timers
  Object.values(activeTimers).forEach(t => clearInterval(t.interval));
  localStorage.removeItem('mbs_save2');
  location.reload();
}

// =================== CONFETTI ===================
function spawnConfetti() {
  const colors = ['#f5c842','#8b5cf6','#3b82f6','#22c55e','#ef4444','#fff'];
  for (let i = 0; i < 60; i++) {
    setTimeout(() => {
      const el = document.createElement('div');
      el.className = 'confetti-piece';
      el.style.left = Math.random() * 100 + 'vw';
      el.style.top = '20vh';
      el.style.background = colors[Math.floor(Math.random()*colors.length)];
      el.style.animationDuration = (.8 + Math.random() * 1.5) + 's';
      el.style.animationDelay = Math.random() * .5 + 's';
      document.body.appendChild(el);
      setTimeout(() => el.remove(), 2500);
    }, i * 20);
  }
}

// =================== NAV ===================

// =================== MYSTERY BOX ===================
let mboxCurrentId   = null;
let mboxWonPrizes   = [];
let mboxSpinAnim    = null;
let mboxWheelAngle  = 0;
let mboxWheelSpeed  = 0;
let mboxPhase       = 0;
let mboxPrizesDone  = 0;
const MBOX_PRIZES_COUNT = 3;

function switchCasesTab(tab) {
  document.querySelectorAll('#casesTabs .shop-tab').forEach(b => b.classList.remove('active'));
  document.getElementById('casesTab-' + tab).classList.add('active');
  document.getElementById('casesPane-regular').style.display    = tab === 'regular'    ? 'block' : 'none';
  document.getElementById('casesPane-mystery').style.display    = tab === 'mystery'    ? 'block' : 'none';
  document.getElementById('casesPane-containers').style.display = tab === 'containers' ? 'block' : 'none';
  if (tab === 'mystery')    renderMysteryBoxes();
  if (tab === 'containers') renderContainers();
}

function renderMysteryBoxes() {
  const grid = document.getElementById('mysteryGrid');
  if (!grid) return;
  grid.innerHTML = '';
  MYSTERY_BOXES.forEach(mb => {
    const canOpen = state.balance >= mb.price;
    const card = document.createElement('div');
    card.className = 'mystery-card';
    card.style.setProperty('--mbox-color', mb.color);

    // Count items by rarity
    const counts = {legendary:0, epic:0, rare:0, common:0};
    mb.items.forEach(it => counts[it.rarity]++);

    card.innerHTML =
      '<div class="mystery-banner">' +
        '<div class="mystery-icon">' + mb.icon + '</div>' +
        '<div class="mystery-meta">' +
          '<div class="mystery-name">' + mb.name + '</div>' +
          '<div class="mystery-desc">' + mb.desc + '</div>' +
        '</div>' +
        '<div>' +
          '<div class="mystery-price">' + fmt(mb.price) + '</div>' +
          '<div class="mystery-price-sub">–∑–∞ 3 –ø—Ä–∏–∑–∏</div>' +
        '</div>' +
      '</div>';

    // Rarity bar (reuse same buildRarityBar ‚Äî pity-aware)
    const rarityBar = document.createElement('div');
    rarityBar.className = 'case-rarity-bar';
    rarityBar.id = 'rarity-bar-' + mb.id;
    buildRarityBar(rarityBar, mb.id);
    card.appendChild(rarityBar);

    // Buttons row
    const btnRow = document.createElement('div');
    btnRow.style.cssText = 'display:flex;gap:8px;padding:0 18px 16px;';

    const openBtn = document.createElement('button');
    openBtn.className = 'mystery-open-btn' + (canOpen ? '' : ' cannot');
    openBtn.style.cssText = 'flex:1;margin:0;';
    openBtn.textContent = canOpen ? 'üé∞ –í—ñ–¥–∫—Ä–∏—Ç–∏ –∑–∞ ' + fmt(mb.price) : 'üîí –ü–æ—Ç—Ä—ñ–±–Ω–æ ' + fmt(mb.price);
    if (canOpen) openBtn.addEventListener('click', () => startMysteryBox(mb.id));

    const previewBtn = document.createElement('button');
    previewBtn.style.cssText = 'padding:10px 14px;border-radius:10px;border:1px solid var(--border);background:var(--bg);color:var(--muted);cursor:pointer;font-size:16px;flex-shrink:0;';
    previewBtn.textContent = 'üëÅÔ∏è';
    previewBtn.title = '–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ø—Ä–∏–∑–∏ –±–æ–∫—Å—É';
    previewBtn.addEventListener('click', () => openMboxPreviewModal(mb.id));

    btnRow.appendChild(openBtn);
    btnRow.appendChild(previewBtn);
    card.appendChild(btnRow);

    grid.appendChild(card);
  });
}

function startMysteryBox(id) {
  const mb = MYSTERY_BOXES.find(x => x.id === id);
  if (!mb) return;
  if (state.balance < mb.price) { showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤!'); return; }
  state.balance -= mb.price;
  state.stats = state.stats || {};
  state.stats.spent = (state.stats.spent || 0) + mb.price;
  mboxCurrentId  = id;
  mboxWonPrizes  = [];
  mboxPrizesDone = 0;
  mboxPhase      = 1;
  updateHUD(); saveState();
  // Show modal phase 1
  const modal = document.getElementById('mysteryModal');
  modal.style.display = 'flex';
  document.getElementById('mboxPhase1').style.display  = 'flex';
  document.getElementById('mboxPhase2').style.display  = 'none';
  document.getElementById('mboxTitle1').textContent    = mb.name;
  document.getElementById('mboxSubtitle1').textContent = mb.icon + '  ' + mb.desc;
  document.getElementById('mboxPrizesWon').innerHTML   = '';
  document.getElementById('mboxCollectWrap').style.display = 'none';
  document.getElementById('mboxWheelSection').style.opacity = '0';
  // Reset box walls to original position
  resetBoxWalls();
}

function resetBoxWalls() {
  const lid = document.getElementById('mboxLid');
  const wF  = document.getElementById('mboxWallFront');
  const wB  = document.getElementById('mboxWallBack');
  const wL  = document.getElementById('mboxWallLeft');
  const wR  = document.getElementById('mboxWallRight');
  if (lid) { lid.style.transform = ''; lid.style.opacity = '1'; lid.style.top = '50px'; }
  if (wF)  { wF.style.transform  = ''; wF.style.opacity  = '1'; }
  if (wB)  { wB.style.transform  = ''; wB.style.opacity  = '1'; }
  if (wL)  { wL.style.transform  = ''; wL.style.opacity  = '1'; }
  if (wR)  { wR.style.transform  = ''; wR.style.opacity  = '1'; }
}

function openMysteryBox() {
  if (mboxPhase !== 1) return;
  mboxPhase = 2;
  // Switch to phase 2
  document.getElementById('mboxPhase1').style.display = 'none';
  document.getElementById('mboxPhase2').style.display = 'flex';
  // Animate: lid flies up, walls fall
  const lid = document.getElementById('mboxLid');
  const wF  = document.getElementById('mboxWallFront');
  const wB  = document.getElementById('mboxWallBack');
  const wL  = document.getElementById('mboxWallLeft');
  const wR  = document.getElementById('mboxWallRight');
  // Lid shoots upward
  requestAnimationFrame(() => {
    if (lid) { lid.style.top = '-120px'; lid.style.opacity = '0'; lid.style.transform = 'rotate(-15deg)'; }
    // Walls fall outward with rotation
    setTimeout(() => {
      if (wF) { wF.style.transform = 'rotateX(90deg) translateY(40px)'; wF.style.opacity = '0'; }
      if (wB) { wB.style.transform = 'rotateX(-90deg) translateY(-40px)'; wB.style.opacity = '0'; }
      if (wL) { wL.style.transform = 'rotateY(-90deg) translateX(-50px)'; wL.style.opacity = '0'; }
      if (wR) { wR.style.transform = 'rotateY(90deg) translateX(50px)'; wR.style.opacity = '0'; }
    }, 300);
    // Show wheel after animation
    setTimeout(() => {
      const ws = document.getElementById('mboxWheelSection');
      if (ws) ws.style.opacity = '1';
      initFortuneWheel();
      // Start spinning for first prize
      setTimeout(() => spinForPrize(), 400);
    }, 1200);
  });
}

// ‚îÄ‚îÄ Fortune Wheel ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const WHEEL_COLORS = {
  legendary: ['#f5c842','#d4a017'],
  epic:      ['#a855f7','#7c3aed'],
  rare:      ['#60a5fa','#3b82f6'],
  common:    ['#64748b','#475569'],
};

function getWheelItems() {
  const mb = MYSTERY_BOXES.find(x => x.id === mboxCurrentId);
  if (!mb) return [];
  // Build representative 15-item wheel ensuring each rarity appears proportionally
  const byRarity = { legendary:[], epic:[], rare:[], common:[] };
  mb.items.forEach(x => { if (byRarity[x.rarity]) byRarity[x.rarity].push(x); });
  byRarity.legendary.sort(() => Math.random()-0.5);
  byRarity.epic.sort(()      => Math.random()-0.5);
  byRarity.rare.sort(()      => Math.random()-0.5);
  byRarity.common.sort(()    => Math.random()-0.5);
  // ~1 legendary, ~2 epic, ~4 rare, ~8 common = 15
  const picks = [
    ...byRarity.legendary.slice(0,1),
    ...byRarity.epic.slice(0,2),
    ...byRarity.rare.slice(0,4),
    ...byRarity.common.slice(0,8),
  ];
  // Shuffle final list
  picks.sort(() => Math.random()-0.5);
  return picks.slice(0,15);
}

let wheelItems     = [];
let wheelAngle     = 0;
let wheelVelocity  = 0;
let wheelRAF       = null;
let wheelTarget    = null;  // target angle for current spin
let spinCallback   = null;  // called when spin stops

function initFortuneWheel() {
  wheelItems = getWheelItems();
  wheelAngle = 0;
  drawWheel(0);
}

function drawWheel(angle) {
  const canvas = document.getElementById('fortuneWheel');
  if (!canvas) return;
  const ctx  = canvas.getContext('2d');
  const cx   = canvas.width  / 2;
  const cy   = canvas.height / 2;
  const r    = cx - 6;
  const n    = wheelItems.length;
  if (n === 0) return;
  const slice = (Math.PI * 2) / n;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Outer glow ring
  const outerGlow = ctx.createRadialGradient(cx,cy,r-4,cx,cy,r+10);
  outerGlow.addColorStop(0,'rgba(245,200,66,0.15)');
  outerGlow.addColorStop(1,'transparent');
  ctx.beginPath(); ctx.arc(cx,cy,r+10,0,Math.PI*2);
  ctx.fillStyle = outerGlow; ctx.fill();

  // Draw each slice
  for (let i = 0; i < n; i++) {
    const item  = wheelItems[i];
    const start = angle + i * slice;
    const end   = start + slice;
    const colors = WHEEL_COLORS[item.rarity] || ['#4a5568','#2d3748'];
    const midAngle = start + slice / 2;

    // Slice fill
    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.arc(cx, cy, r, start, end);
    ctx.closePath();
    const grad = ctx.createLinearGradient(
      cx + Math.cos(start)*r*0.3, cy + Math.sin(start)*r*0.3,
      cx + Math.cos(midAngle)*r,  cy + Math.sin(midAngle)*r);
    grad.addColorStop(0, colors[0] + 'cc');
    grad.addColorStop(1, colors[1] + 'ff');
    ctx.fillStyle = grad;
    ctx.fill();

    // Slice separator line
    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.lineTo(cx + Math.cos(start)*r, cy + Math.sin(start)*r);
    ctx.strokeStyle = 'rgba(0,0,0,0.5)';
    ctx.lineWidth = 1.5;
    ctx.stroke();

    // Rarity accent arc near rim
    ctx.beginPath();
    ctx.arc(cx, cy, r - 3, start + 0.03, end - 0.03);
    ctx.strokeStyle = colors[0] + 'aa';
    ctx.lineWidth = 3;
    ctx.stroke();

    // Emoji only (no text)
    const emojiR = r * 0.65;
    const tx = cx + Math.cos(midAngle) * emojiR;
    const ty = cy + Math.sin(midAngle) * emojiR;
    ctx.save();
    ctx.translate(tx, ty);
    ctx.rotate(midAngle + Math.PI / 2);
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.font = '16px Arial';
    ctx.shadowColor = 'rgba(0,0,0,0.8)';
    ctx.shadowBlur = 4;
    ctx.fillText(item.emoji, 0, 0);
    ctx.restore();
  }

  // Gold outer border
  ctx.beginPath();
  ctx.arc(cx, cy, r, 0, Math.PI * 2);
  ctx.strokeStyle = 'rgba(245,200,66,0.8)';
  ctx.lineWidth   = 4;
  ctx.stroke();

  // Inner center circle (hub)
  const hubGrad = ctx.createRadialGradient(cx,cy,0,cx,cy,r*0.12);
  hubGrad.addColorStop(0,'#fff8e0');
  hubGrad.addColorStop(1,'#d4a017');
  ctx.beginPath();
  ctx.arc(cx, cy, r * 0.12, 0, Math.PI * 2);
  ctx.fillStyle = hubGrad;
  ctx.fill();
  ctx.beginPath();
  ctx.arc(cx, cy, r * 0.12, 0, Math.PI * 2);
  ctx.strokeStyle = 'rgba(0,0,0,0.4)';
  ctx.lineWidth = 2;
  ctx.stroke();
}

function rollPrize() {
  const mb = MYSTERY_BOXES.find(x => x.id === mboxCurrentId);
  if (!mb) return null;
  // Mystery Boxes: –±–∞–∑–æ–≤—ñ –≤–∞–≥–∏ 60/25/12/3 + pity, –ë–ï–ó collection rarity bonuses
  const w = getCurrentWeights(mboxCurrentId); // pity only (CASE_IDS excludes mboxes)
  const total = w.common + w.rare + w.epic + w.legendary;
  const roll  = Math.random() * total;
  let rarity = 'common';
  if      (roll < w.legendary)                           rarity = 'legendary';
  else if (roll < w.legendary + w.epic)                  rarity = 'epic';
  else if (roll < w.legendary + w.epic + w.rare)         rarity = 'rare';

  const pool = mb.items.filter(x => x.rarity === rarity);
  if (!pool.length) return mb.items[Math.floor(Math.random() * mb.items.length)];
  return pool[Math.floor(Math.random() * pool.length)];
}

function spinForPrize() {
  if (mboxPrizesDone >= MBOX_PRIZES_COUNT) return;

  // Roll the actual prize first
  const prize = rollPrize();
  mboxWonPrizes.push(prize);

  // ‚îÄ‚îÄ Pity update (same logic as regular cases) ‚îÄ‚îÄ
  if (state.pity && mboxCurrentId) {
    const p = getPityForCase(mboxCurrentId);
    const r = prize.rarity;
    if (r === 'legendary') {
      p.legendary = 0;
    } else if (r === 'epic') {
      p.epic = 0;
      p.legendary = +(p.legendary + PITY_PER_SPIN.legendary).toFixed(2);
    } else if (r === 'rare') {
      p.rare = 0;
      p.epic      = +(p.epic      + PITY_PER_SPIN.epic).toFixed(2);
      p.legendary = +(p.legendary + PITY_PER_SPIN.legendary).toFixed(2);
    } else {
      p.rare      = +(p.rare      + PITY_PER_SPIN.rare).toFixed(2);
      p.epic      = +(p.epic      + PITY_PER_SPIN.epic).toFixed(2);
      p.legendary = +(p.legendary + PITY_PER_SPIN.legendary).toFixed(2);
    }
    // Cap at same limits as regular cases
    p.rare      = Math.min(p.rare,      20);
    p.epic      = Math.min(p.epic,      15);
    p.legendary = Math.min(p.legendary, 10);
    saveState();
  }

  // Find the prize on the wheel (or closest rarity match)
  const n = wheelItems.length;
  const slice = (Math.PI * 2) / n;
  let targetIdx = wheelItems.findIndex(x => x.name === prize.name);
  if (targetIdx === -1) targetIdx = wheelItems.findIndex(x => x.rarity === prize.rarity);
  if (targetIdx === -1) targetIdx = 0;

  // Pointer is at top = angle -œÄ/2
  // For slice i to land at pointer: wheelAngle + i*slice + slice/2 = -œÄ/2  (mod 2œÄ)
  // => finalAngle = -œÄ/2 - i*slice - slice/2
  // Add small random offset within slice for natural feel (¬±30% of slice width)
  const jitter = (Math.random() - 0.5) * slice * 0.5;
  let baseAngle = -Math.PI / 2 - targetIdx * slice - slice / 2 + jitter;

  // Normalize baseAngle so finalAngle > wheelAngle + minSpins
  const minSpins = (4 + Math.floor(Math.random() * 3)) * Math.PI * 2;
  const minFinal = wheelAngle + minSpins;
  // Bring baseAngle into same 2œÄ period, then add full rotations until past minFinal
  const TAU = Math.PI * 2;
  baseAngle = baseAngle % TAU;
  // Find how many full turns needed
  let finalAngle = baseAngle;
  while (finalAngle < minFinal) finalAngle += TAU;

  // Animate ‚Äî faster: 2.0‚Äì2.8s
  const duration = 2000 + Math.random() * 800;
  const startAngle = wheelAngle;
  const startTime  = performance.now();
  const label = document.getElementById('mboxSpinLabel');

  function animSpin(ts) {
    const elapsed = ts - startTime;
    const t = Math.min(elapsed / duration, 1);
    // Ease-out cubic
    const ease = 1 - Math.pow(1 - t, 3);
    wheelAngle = startAngle + (finalAngle - startAngle) * ease;
    drawWheel(wheelAngle);

    // Show current item at pointer
    const normAngle = (((-wheelAngle - Math.PI/2) % (Math.PI*2)) + Math.PI*2) % (Math.PI*2);
    const currentIdx = Math.floor(normAngle / slice) % n;
    if (wheelItems[currentIdx] && label) {
      label.textContent = wheelItems[currentIdx].emoji;
    }

    if (t < 1) {
      wheelRAF = requestAnimationFrame(animSpin);
    } else {
      wheelAngle = finalAngle;
      // Spin complete ‚Äî show prize
      mboxPrizesDone++;
      revealPrize(prize, mboxPrizesDone);
    }
  }
  wheelRAF = requestAnimationFrame(animSpin);
}

function revealPrize(item, num) {
  // Add prize card
  const wrap = document.getElementById('mboxPrizesWon');
  const card = document.createElement('div');
  card.className = 'prize-won-card ' + item.rarity;
  card.innerHTML =
    '<div class="prize-won-num">#' + num + '</div>' +
    '<div style="font-size:22px;">' + item.emoji + '</div>' +
    '<div class="prize-won-name">' + item.name + '</div>' +
    '<div class="prize-won-val">' + fmt(item.value) + '</div>';
  wrap.appendChild(card);

  // Update pity display
  if (mboxCurrentId) {
    const p = getPityForCase(mboxCurrentId);
    const pInfo = document.getElementById('mboxPityInfo');
    const parts = [];
    if (p.rare > 0)      parts.push('üîµ +' + p.rare.toFixed(1) + '%');
    if (p.epic > 0)      parts.push('üü£ +' + p.epic.toFixed(1) + '%');
    if (p.legendary > 0) parts.push('üü° +' + p.legendary.toFixed(1) + '%');
    if (pInfo) pInfo.textContent = parts.length ? 'üçÄ Pity: ' + parts.join('  ') : '';
  }

  if (mboxPrizesDone < MBOX_PRIZES_COUNT) {
    // Spin for next prize after pause
    const label = document.getElementById('mboxSpinLabel');
    if (label) label.textContent = '';
    setTimeout(() => spinForPrize(), 700);
  } else {
    // All done ‚Äî show collect button
    const ws = document.getElementById('mboxWheelSection');
    const label = document.getElementById('mboxSpinLabel');
    if (ws) ws.style.opacity = '0.4';
    if (label) label.textContent = 'üéâ –í—Å—ñ –ø—Ä–∏–∑–∏ –≤—ñ–¥–∫—Ä–∏—Ç–æ!';
    setTimeout(() => {
      document.getElementById('mboxCollectWrap').style.display = 'block';
    }, 500);
  }
}

function collectAllMboxPrizes() {
  if (!mboxWonPrizes.length) return;
  const freeSlots = state.invLimit - state.inventory.length;
  if (freeSlots <= 0) { showToast('‚ùå –°–∫–ª–∞–¥ –ø–æ–≤–Ω–∏–π!'); return; }
  const toAdd = mboxWonPrizes.slice(0, freeSlots);
  toAdd.forEach(item => {
    state.inventory.push({
      id:       Date.now() + Math.random(),
      name:     item.name,
      emoji:    item.emoji,
      rarity:   item.rarity,
      value:    item.value,
      fromCase: mboxCurrentId,
    });
  });
  if (toAdd.length < mboxWonPrizes.length) {
    showToast('‚ö†Ô∏è –°–∫–ª–∞–¥ –∑–∞–ø–æ–≤–Ω–µ–Ω–æ ‚Äî –¥–æ–¥–∞–Ω–æ ' + toAdd.length + ' –∑ ' + mboxWonPrizes.length);
  } else {
    showToast('üéÅ ' + toAdd.length + ' –ø—Ä–∏–∑—ñ–≤ –¥–æ–¥–∞–Ω–æ –Ω–∞ —Å–∫–ª–∞–¥!');
  }
  mboxWonPrizes = [];
  closeMysteryModal();
  updateHUD(); saveState(); renderInventory(); renderMysteryBoxes();
  updateAllRarityBars();
}

function closeMysteryModal() {
  if (wheelRAF) { cancelAnimationFrame(wheelRAF); wheelRAF = null; }
  document.getElementById('mysteryModal').style.display = 'none';
  mboxPhase = 0;
}

function showScreen(id, btn) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
  document.getElementById('screen-' + id).classList.add('active');
  btn.classList.add('active');
  if (id === 'cases')     { renderCases(); updateAllRarityBars(); renderMysteryBoxes(); }
  if (id === 'lifeshop')  { renderLifeShop(); }
  if (id === 'inventory') { renderInventory(); updateHUD(); }
  if (id === 'shop')      { renderShop(); renderMultUpgrade(); updateHUD(); }
  if (id === 'stats')     renderStats();
}


// ‚îÄ‚îÄ –ü.8: Offline sales modal ‚îÄ‚îÄ
function showOfflineSalesModal() {
  if (!state.pendingOfflineSales) return;
  const p = state.pendingOfflineSales;
  const modal = document.getElementById('offlineModal');
  document.getElementById('offlineMsg').textContent =
    '–ó–∞ –≤–∞—à—ñ –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ –º–∞–≥–∞–∑–∏–Ω –ø—Ä–æ–¥–∞–≤ ' + p.count + (p.count === 1 ? ' —Ç–æ–≤–∞—Ä' : p.count < 5 ? ' —Ç–æ–≤–∞—Ä–∏' : ' —Ç–æ–≤–∞—Ä—ñ–≤') + '.';
  document.getElementById('offlineAmount').textContent = '+' + fmtCapital(p.earned);
  const itemsList = document.getElementById('offlineItems');
  itemsList.innerHTML = p.names.map(n => '‚Ä¢ ' + n).join('<br>');
  modal.style.display = 'flex';
}

function claimOfflineSales() {
  if (!state.pendingOfflineSales) return;
  const earned = state.pendingOfflineSales.earned;
  state.balance     += earned;
  state.totalEarned += earned;
  state.pendingOfflineSales = null;
  document.getElementById('offlineModal').style.display = 'none';
  updateHUD(); saveState();
  showToast('üí∞ –û—Ç—Ä–∏–º–∞–Ω–æ ' + fmtCapital(earned) + ' –∑ –º–∞–≥–∞–∑–∏–Ω—É!', 'gold');
}


// ‚îÄ‚îÄ –ü.8: Restore in-progress timers after page reload ‚îÄ‚îÄ
function restoreActiveTimers() {
  const now = Date.now();
  state.shop.filter(x => !x.sold && x.timerActive && x.endTime && x.endTime > now).forEach(entry => {
    const remaining = entry.endTime - now;
    const listPrice = entry.listPrice || entry.value;
    // timerSec: use stored value (full duration) for bar % calculation
    const timerSec = entry.timerSec || Math.ceil(remaining / 1000);
    const endTime  = entry.endTime;

    const interval = setInterval(() => {
      const rem = Math.max(0, endTime - Date.now());
      const pct = (rem / (timerSec * 1000)) * 100;
      const timerBar   = document.getElementById('timer-bar-'   + entry.id);
      const timerLabel = document.getElementById('timer-label-' + entry.id);
      if (timerBar)   timerBar.style.width = Math.max(0, pct) + '%';
      if (timerLabel) {
        const sec = Math.ceil(rem / 1000);
        timerLabel.textContent = rem > 0
          ? (sec >= 60 ? '–ü—Ä–æ–¥–∞—î—Ç—å—Å—è... ' + Math.floor(sec/60) + '—Ö–≤ ' + (sec%60) + '—Å' : '–ü—Ä–æ–¥–∞—î—Ç—å—Å—è... ' + sec + '—Å')
          : '–ü—Ä–æ–¥–∞–Ω–æ!';
      }
      if (rem <= 0) {
        clearInterval(interval);
        delete activeTimers[entry.id];
        completeSale(entry, listPrice);
      }
    }, 500);

    activeTimers[entry.id] = { interval, endTime, timerSec, listPrice };
  });
}

// =================== INIT ===================
loadState();
// Apply collection bonuses immediately (must run after COLLECTION_UNIQUE_BONUS is defined)
applyAllCollectionBonuses();
// Ensure rival nets initialized (in case loadState ran before FORBES_RIVALS defined)
if (!state.rivalNets) {
  state.rivalNets = {};
  FORBES_RIVALS.forEach(r => { if (!r.isPlayer) state.rivalNets[r.name] = r.net; });
}
updateHUD();
renderUpgrades();
// –ü.8: Restore timers for items that were selling
setTimeout(restoreActiveTimers, 200);
// –ü.8: Show offline sales if any
if (state.pendingOfflineSales) {
  setTimeout(showOfflineSalesModal, 800);
}
</script>

<!-- ===== MYSTERY BOX MODAL ===== -->
<div id="mysteryModal" style="display:none;position:fixed;inset:0;z-index:2000;background:rgba(0,0,0,0.92);display:none;flex-direction:column;align-items:center;justify-content:flex-start;overflow-y:auto;padding:20px 16px 40px;">

  <!-- Phase 1: Big box waiting to be clicked -->
  <div id="mboxPhase1" style="display:flex;flex-direction:column;align-items:center;gap:20px;padding-top:40px;">
    <div style="font-family:'Orbitron',sans-serif;font-size:18px;font-weight:700;color:var(--gold);letter-spacing:2px;" id="mboxTitle1">MYSTERY BOX</div>
    <div style="font-size:13px;color:var(--muted);text-align:center;">–ù–∞—Ç–∏—Å–Ω–∏ –Ω–∞ –∫–æ—Ä–æ–±–∫—É, —â–æ–± –≤—ñ–¥–∫—Ä–∏—Ç–∏</div>
    <div id="bigBoxWrap" onclick="openMysteryBox()" style="cursor:pointer;position:relative;width:220px;height:220px;filter:drop-shadow(0 0 30px rgba(245,200,66,0.4));">
      <svg id="bigBoxSVG" viewBox="0 0 220 220" width="220" height="220" style="transition:transform .15s;">
        <!-- Box body -->
        <rect x="20" y="80" width="180" height="130" rx="6" fill="#2d1f0e" stroke="#8b6914" stroke-width="2"/>
        <rect x="20" y="80" width="180" height="130" rx="6" fill="url(#boxBodyGrad)"/>
        <!-- Front face detail -->
        <rect x="35" y="95" width="150" height="100" rx="4" fill="#1a1209" opacity="0.4"/>
        <!-- Ribbon V -->
        <rect x="100" y="80" width="20" height="130" fill="#f5c842" opacity="0.85"/>
        <rect x="20" y="140" width="180" height="20" fill="#f5c842" opacity="0.85"/>
        <!-- Lid -->
        <rect x="10" y="55" width="200" height="32" rx="6" fill="#4a2f0a" stroke="#8b6914" stroke-width="2"/>
        <rect x="10" y="55" width="200" height="32" rx="6" fill="url(#lidGrad)"/>
        <!-- Ribbon on lid -->
        <rect x="100" y="55" width="20" height="32" fill="#f5c842" opacity="0.85"/>
        <!-- Bow left -->
        <ellipse cx="90" cy="55" rx="20" ry="12" fill="#fde68a" transform="rotate(-25,90,55)"/>
        <!-- Bow right -->
        <ellipse cx="130" cy="55" rx="20" ry="12" fill="#fde68a" transform="rotate(25,130,55)"/>
        <!-- Bow center -->
        <circle cx="110" cy="55" r="10" fill="#f5c842"/>
        <!-- Question marks -->
        <text x="65" y="165" font-family="Arial" font-size="36" fill="rgba(245,200,66,0.15)" font-weight="bold">?</text>
        <text x="135" y="145" font-family="Arial" font-size="24" fill="rgba(245,200,66,0.1)" font-weight="bold">?</text>
        <text x="50" y="125" font-family="Arial" font-size="18" fill="rgba(245,200,66,0.08)" font-weight="bold">?</text>
        <!-- Glow dots -->
        <circle cx="40" cy="100" r="3" fill="#f5c842" opacity="0.6"/>
        <circle cx="180" cy="180" r="2" fill="#f5c842" opacity="0.4"/>
        <circle cx="170" cy="95" r="2.5" fill="#f5c842" opacity="0.5"/>
        <defs>
          <linearGradient id="boxBodyGrad" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#5c3d1e" stop-opacity="0.5"/>
            <stop offset="100%" stop-color="#1a0f00" stop-opacity="0.5"/>
          </linearGradient>
          <linearGradient id="lidGrad" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#7a5229" stop-opacity="0.5"/>
            <stop offset="100%" stop-color="#2d1a05" stop-opacity="0.5"/>
          </linearGradient>
        </defs>
      </svg>
    </div>
    <div style="font-size:13px;color:var(--muted);" id="mboxSubtitle1">–í—Å–µ—Ä–µ–¥–∏–Ω—ñ ‚Äî 3 —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –ø—Ä–∏–∑–∏</div>
    <button onclick="closeMysteryModal()" style="padding:10px 24px;border-radius:10px;border:1px solid var(--border);background:transparent;color:var(--muted);cursor:pointer;font-family:'Rajdhani',sans-serif;font-size:13px;">‚úï –°–∫–∞—Å—É–≤–∞—Ç–∏</button>
  </div>

  <!-- Phase 2: Box opening animation + wheel -->
  <div id="mboxPhase2" style="display:none;flex-direction:column;align-items:center;gap:0;width:100%;max-width:420px;">
    <!-- Box explode animation area -->
    <div id="mboxExplodeArea" style="position:relative;width:260px;height:180px;margin-bottom:8px;">
      <!-- Lid flies up -->
      <div id="mboxLid" style="position:absolute;left:30px;top:50px;width:200px;height:32px;transition:all 0.6s cubic-bezier(0.4,0,0.2,1);">
        <svg viewBox="0 0 200 32" width="200" height="32">
          <rect x="0" y="0" width="200" height="32" rx="6" fill="#4a2f0a" stroke="#8b6914" stroke-width="2"/>
          <rect x="90" y="0" width="20" height="32" fill="#f5c842" opacity="0.85"/>
          <ellipse cx="80" cy="0" rx="18" ry="10" fill="#fde68a" transform="rotate(-25,80,0)"/>
          <ellipse cx="120" cy="0" rx="18" ry="10" fill="#fde68a" transform="rotate(25,120,0)"/>
          <circle cx="100" cy="0" r="9" fill="#f5c842"/>
        </svg>
      </div>
      <!-- 4 walls -->
      <div id="mboxWallFront" style="position:absolute;left:30px;top:82px;width:200px;height:80px;transform-origin:bottom;transition:all 0.7s 0.4s cubic-bezier(0.4,0,0.2,1);">
        <svg viewBox="0 0 200 80" width="200" height="80"><rect width="200" height="80" rx="3" fill="#2d1f0e" stroke="#8b6914" stroke-width="1.5"/><rect x="90" y="0" width="20" height="80" fill="#f5c842" opacity="0.7"/></svg>
      </div>
      <div id="mboxWallBack" style="position:absolute;left:30px;top:82px;width:200px;height:80px;transform-origin:bottom;transition:all 0.7s 0.5s cubic-bezier(0.4,0,0.2,1);">
        <svg viewBox="0 0 200 80" width="200" height="80"><rect width="200" height="80" rx="3" fill="#221608" stroke="#8b6914" stroke-width="1.5"/><rect x="90" y="0" width="20" height="80" fill="#f5c842" opacity="0.6"/></svg>
      </div>
      <div id="mboxWallLeft" style="position:absolute;left:30px;top:82px;width:200px;height:80px;transform-origin:bottom;transition:all 0.7s 0.45s cubic-bezier(0.4,0,0.2,1);">
        <svg viewBox="0 0 200 80" width="200" height="80"><rect width="200" height="80" rx="3" fill="#2a1b0b" stroke="#8b6914" stroke-width="1.5"/><rect x="40" y="0" width="20" height="80" fill="#f5c842" opacity="0.5"/></svg>
      </div>
      <div id="mboxWallRight" style="position:absolute;left:30px;top:82px;width:200px;height:80px;transform-origin:bottom;transition:all 0.7s 0.55s cubic-bezier(0.4,0,0.2,1);">
        <svg viewBox="0 0 200 80" width="200" height="80"><rect width="200" height="80" rx="3" fill="#261809" stroke="#8b6914" stroke-width="1.5"/><rect x="140" y="0" width="20" height="80" fill="#f5c842" opacity="0.5"/></svg>
      </div>
    </div>

    <!-- Spinning wheel of fortune -->
    <div id="mboxWheelSection" style="opacity:0;transition:opacity 0.5s;display:flex;flex-direction:column;align-items:center;gap:10px;">
      <div style="font-size:11px;color:var(--muted);letter-spacing:1px;text-transform:uppercase;">–ö—Ä—É—Ç–∏—Ç—å—Å—è –∫–æ–ª–µ—Å–æ</div>
      <!-- Wheel -->
      <div style="position:relative;width:240px;height:240px;">
        <canvas id="fortuneWheel" width="240" height="240" style="border-radius:50%;"></canvas>
        <!-- Center pointer arrow -->
        <div style="position:absolute;top:-14px;left:50%;transform:translateX(-50%);font-size:22px;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.8));">‚ñº</div>
        <!-- Center circle -->
        <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:40px;height:40px;border-radius:50%;background:var(--bg);border:3px solid var(--gold);display:flex;align-items:center;justify-content:center;font-size:18px;">üé∞</div>
      </div>
      <!-- Current spinning item label -->
      <div id="mboxSpinLabel" style="font-size:13px;color:var(--gold);font-weight:600;min-height:20px;text-align:center;"></div>
      <!-- Pity indicator -->
      <div id="mboxPityInfo" style="font-size:11px;color:var(--muted);text-align:center;min-height:14px;"></div>
    </div>

    <!-- Won prizes (appear one by one) -->
    <div id="mboxPrizesWon" style="display:flex;flex-direction:column;gap:8px;width:100%;margin-top:12px;"></div>

    <!-- Collect all button (hidden until all 3 prizes revealed) -->
    <div id="mboxCollectWrap" style="display:none;width:100%;margin-top:16px;">
      <button onclick="collectAllMboxPrizes()" style="width:100%;padding:16px;border-radius:12px;border:none;cursor:pointer;font-family:'Orbitron',sans-serif;font-size:14px;font-weight:700;background:linear-gradient(135deg,var(--gold),#f97316);color:#000;letter-spacing:1px;box-shadow:0 4px 20px rgba(245,200,66,0.3);">
        üéÅ –ó–ê–ë–†–ê–¢–ò –í–°–Ü –ù–ê –°–ö–õ–ê–î
      </button>
    </div>
  </div>
</div>


<!-- ===== DEV PANEL ===== -->
<div id="devPanelBtn" onclick="toggleDevPanel()" style="
  position:fixed;bottom:80px;right:14px;z-index:9000;
  width:42px;height:42px;border-radius:50%;
  background:linear-gradient(135deg,#7c3aed,#4f46e5);
  border:2px solid rgba(255,255,255,.2);
  display:flex;align-items:center;justify-content:center;
  font-size:18px;cursor:pointer;
  box-shadow:0 4px 16px rgba(124,58,237,.5);
  user-select:none;">üõ†Ô∏è</div>

<div id="devPanel" style="
  display:none;position:fixed;bottom:132px;right:14px;z-index:9001;
  background:#1a1025;border:1px solid rgba(124,58,237,.5);
  border-radius:14px;padding:14px;min-width:220px;
  box-shadow:0 8px 32px rgba(0,0,0,.6);">
  <div style="font-size:11px;font-weight:800;color:#a78bfa;letter-spacing:1.5px;margin-bottom:10px;text-transform:uppercase;">üõ†Ô∏è Dev Panel</div>
  <div style="display:flex;flex-direction:column;gap:7px;">
    <button onclick="devAddMoney()" style="padding:8px 12px;border-radius:8px;border:none;background:linear-gradient(135deg,#f5c842,#f97316);color:#000;font-weight:800;cursor:pointer;font-size:12px;">üí∞ +10,000‚Ç¨</button>
    <button onclick="devAddMoney(1e6)" style="padding:8px 12px;border-radius:8px;border:none;background:linear-gradient(135deg,#f5c842,#f97316);color:#000;font-weight:800;cursor:pointer;font-size:12px;">üí∞ +1,000,000‚Ç¨</button>
    <button onclick="devFillCollection(0)" style="padding:8px 12px;border-radius:8px;border:none;background:linear-gradient(135deg,#8b5cf6,#6d28d9);color:#fff;font-weight:800;cursor:pointer;font-size:12px;">üèÖ –ó—ñ–±—Ä–∞—Ç–∏ –∫–æ–ª–µ–∫—Ü—ñ—é #1</button>
    <button onclick="devFillCollection(1)" style="padding:8px 12px;border-radius:8px;border:none;background:linear-gradient(135deg,#8b5cf6,#6d28d9);color:#fff;font-weight:800;cursor:pointer;font-size:12px;">üèÖ –ó—ñ–±—Ä–∞—Ç–∏ –∫–æ–ª–µ–∫—Ü—ñ—é #2</button>
    <button onclick="devFillCollection('all')" style="padding:8px 12px;border-radius:8px;border:none;background:rgba(139,92,246,.2);color:#a78bfa;border:1px solid rgba(139,92,246,.3);font-weight:800;cursor:pointer;font-size:12px;">‚ö° –í—Å—ñ 10 –∫–æ–ª–µ–∫—Ü—ñ–π</button>
    <button onclick="devTestCrisis()" style="padding:8px 12px;border-radius:8px;border:1px solid rgba(239,68,68,.3);background:rgba(239,68,68,.12);color:#ef4444;font-weight:700;cursor:pointer;font-size:12px;">üìâ –¢–µ—Å—Ç –∫—Ä–∏–∑–∏ Forbes</button>
    <button onclick="devClearCollections()" style="padding:8px 12px;border-radius:8px;border:none;background:rgba(239,68,68,.15);color:#ef4444;border:1px solid rgba(239,68,68,.25);font-weight:700;cursor:pointer;font-size:12px;">üóëÔ∏è –°–∫–∏–Ω—É—Ç–∏ –∫–æ–ª–µ–∫—Ü—ñ—ó</button>
  </div>
</div>

<!-- ===== CONTAINER OPEN MODAL ===== -->
<div id="containerModal" style="display:none;"></div>


<!-- ===== OFFLINE SALES MODAL ===== -->
<div id="offlineModal" style="display:none;position:fixed;inset:0;z-index:4000;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;padding:20px;">
  <div style="background:var(--bg2);border:1px solid rgba(245,200,66,.3);border-radius:18px;padding:24px;max-width:340px;width:100%;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,.6);">
    <div style="font-size:36px;margin-bottom:8px;">üè™</div>
    <div style="font-family:'Orbitron',sans-serif;font-size:15px;font-weight:700;color:var(--gold);margin-bottom:8px;">–ú–∞–≥–∞–∑–∏–Ω –ø—Ä–∞—Ü—é–≤–∞–≤ –±–µ–∑ –≤–∞—Å!</div>
    <div id="offlineMsg" style="font-size:13px;color:var(--muted);margin-bottom:6px;"></div>
    <div id="offlineAmount" style="font-size:26px;font-weight:800;color:var(--gold);margin:12px 0;"></div>
    <div id="offlineItems" style="font-size:11px;color:var(--muted);margin-bottom:16px;max-height:100px;overflow-y:auto;text-align:left;background:var(--bg3);border-radius:8px;padding:8px;"></div>
    <button onclick="claimOfflineSales()" style="width:100%;padding:14px;border-radius:12px;border:none;background:linear-gradient(135deg,var(--gold),#f97316);color:#000;font-family:'Rajdhani',sans-serif;font-size:16px;font-weight:800;cursor:pointer;letter-spacing:1px;">
      üí∞ –ó–ê–ë–†–ê–¢–ò –ì–†–û–®–Ü
    </button>
  </div>
</div>

</body></html>
